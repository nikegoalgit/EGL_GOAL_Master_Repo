package os0s;
import corpcom4.XSENTRY;
import corpcom4.XSEXIT;
import corpcom4.XSPF4;
import corpcom4.XSSEGTR;
import corpcom5.COMMAREA;
import corpcom5.ERRSQLCA;
import corpcom6.SQLCA;
import ob.common.OB8REC;
import sp.common.SP1ID;
import sp.common.SP1NM;
import sp.common.SP1REC;
import ta.common.TA1REC;
import ta.common.TA2REC;
import ta.common.TAEREC;
import xx.common.*;
import xx.common.XOBCD;
import xx.common.ZZZCHGCT;
import xx.common.ZZZCHGDT;
import xx.common.ZZZCHGTM;
import xx.common.ZZZSDT;
import xx04.*;
import xx04.XOBDESC;
import xx04.XOBTBL;
//*** PROGRAM=OS0S ****
// This transaction is for delaying decrement process on orders
// that match specific information identified by this transact-
// ion.
// 
// ************************************************************
//              Maintenance History
// -----------------------------------------------------------
//   Date      Who     Reason
// -----------------------------------------------------------
// 07/25/94   dmeier   install
// 10/17/94   schase   Added online function to maintain the
//                     Deadweek Flag. Chgd: os0sm005, os0sw01,
//                     os0ss-set-pri-attr, os0s010, os0s030.
//                     Added: os0ss-edit-dw-fl, os0ss-load-dw-
//                     fl, os0ss-sel-vobpgm01, os0ss-upd-
//                     vobpgm01.
// 01/30/95   craine   chg os0ss-edit-xob-fl and os0ss-edit-pgm
//                     -fl to allow 'n' for both falgs when
//                     deadweek flag is 'y'.
// 06/01/95   CRAINE   added true demand control flags.
// 
// *********************
Program OS0S type textUIProgram //VAGen Info - main text program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes, 
  msgTablePrefix = "OP00", inputRecord = COMMAREA, segmented = yes
  }

  // Data Declarations
  COMMAREA COMMAREA ; // record
  ERRSQLCA ERRSQLCA; // record
  OB8REC OB8REC; // record
  OS0SW01 OS0SW01; // record
  OS0SW02 OS0SW02; // record
  SP1REC SP1REC; // record
  SQLCA SQLCA; // record
  TA1REC TA1REC; // record
  TA2REC TA2REC; // record
  TAEREC TAEREC; // record
  VOBPRI01 VOBPRI01; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use XOBTBL {deleteAfterUse = yes}; // table
  use OS0SM.OS0SM005,  // forms
      OS0SM.OS0SM100, 
      OS0SM.OS0SM200
   {
    pfKeyEquate = no
  };

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    OS0S001: OS0S001();
    ;
    ;
    goto OS0S005;
    ;
    ;
    OS0S005: OS0S005();
    ;
    ;
    goto OS0S005;
    ;
    ;
    OS0S010: OS0S010();
    OS0S020: OS0S020();
    OS0S030: OS0S030();
    OS0S100: OS0S100();
    OS0S110: OS0S110();
    OS0S120: OS0S120();
    OS0S130: OS0S130();
    OS0S140: OS0S140();
    OS0S200: OS0S200();
    OS0S210: OS0S210();
    OS0S220: OS0S220();
    OS0S230: OS0S230();
    OS0S240: OS0S240();
  end // end main
end // end OS0S

// MAINT DELAY DECR - INITIALIZE
Function OS0S001()
  ;
  ;
  XSENTRY(); /* check security*/
  XSSEGTR(); /* get seg tranid*/
  ;
  OS0SS-INIT-OS0SW01(); /* initialize ws record*/
  ;
  ;
end // end OS0S001

// MAINT DELAY DECR - MAINLINE
Function OS0S005()
  ;
  ;
  OS0SW01.OS0SW-MAP-ERR-FL = "N";
  OS0SW01.OS0SW-ADD-XOB-FL = "N";
  OS0SW01.OS0SW-ADD-PGM-FL = "N";
  ;
  OS0S010(); /* converse OS0SM OS0SM005*/
  OS0S020(); /* validate attention key*/
  OS0S030(); /* validate OS0SM OS0SM005*/
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N"
   && OS0SW01.OS0SW-ADD-XOB-FL == "Y")
    OS0S100(); /* add order type decrement criteria*/
  end
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N"
   && OS0SW01.OS0SW-ADD-PGM-FL == "Y")
    OS0S200(); /* add sales prgm decrement criteria*/
  end
  ;
  ;
end // end OS0S005

// CONVERSE MAIN MAINT SCREEN
Function OS0S010()
  ;
  ;
  if (OS0SW01.OS0SW-UPD-MAP-FL == "Y")
    OS0SW01.OS0SW-UPD-MAP-FL = "N";
    if (OS0SW01.OS0SW-UPD-DATA-FL == "Y")
      OS0SW01.OS0SW-UPD-DATA-FL = "N";
      ;
      OS0SS-SET-PRI-DATA(); /* set priority decrement data*/
      OS0SS-SET-DMD-DATA(); /* set true demand data*/
    end
    ;
    OS0SS-LOAD-PRI-MAP(); /* load priority decrement map*/
  end
  ;
  OS0SS-LOAD-DW-FL(); /* load deadweek flag*/
  ;
  OS0SS-EVAL-FLAGS(); /* evaluate decr flags*/
  ;
  converse OS0SM005 ;
  ;
  ;
  OS0SS-SET-PRI-ATTR(); /* reset map attributes*/
  ;
  OS0SW01.OS0SW-MAP-ERR-FL = "N";
  ;
end // end OS0S010

// VALIDATE PF KEYS
Function OS0S020()
  ;
  ;
  if (converseVar.eventKey is enter) /* continue process*/
    /* continue*/
  else
    if (converseVar.eventKey is pf3 /* exit application*/
     || converseVar.eventKey is pf4 
     || OS0SM005.CATOAP != " ")    
      OS0SS-EXIT-APPL();
    else
      if (converseVar.eventKey is pf5) /* review order type criteria*/
        OS0SW01.OS0SW-ADD-XOB-FL = "Y";
      else
        if (converseVar.eventKey is pf6) /* review sales prgm criteria*/
          OS0SW01.OS0SW-ADD-PGM-FL = "Y";
        else
          if (converseVar.eventKey is pf19) /* refresh map*/
            OS0SW01.OS0SW-MAP-ERR-FL = "Y";
            OS0SW01.OS0SW-UPD-MAP-FL = "Y";
            OS0SW01.OS0SW-UPD-DATA-FL = "Y";
            converseLib.validationFailed(825);
          else
            OS0SW01.OS0SW-MAP-ERR-FL = "Y";
            converseLib.validationFailed(2); /* invalid pf key*/
          end
        end
      end
    end
  end
  ;
  ;
end // end OS0S020

// VALIDATE OS0SM005 DATA
Function OS0S030()
  ;
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N")
    if (converseVar.eventKey is enter)
      OS0SW01.OS0SW-DEL-XOB-FL = "N";
      OS0SW01.OS0SW-DEL-PGM-FL = "N";
      ;
      OS0SS-EDIT-PGM-FL(); /* edit decrement sales prgm flag*/
      OS0SS-EDIT-XOB-FL(); /* edit decrement order type flag*/
      OS0SS-EDIT-DEC-FL(); /* edit decrement airspeed orders flag*/
      OS0SS-EDIT-TRY-FL(); /* edit last try flag*/
      OS0SS-EDIT-DAYS(); /* edit days to push*/
      OS0SS-EDIT-DMD-FL(); /* edit true demand flag*/
      OS0SS-EDIT-DW-FL(); /* edit deadweek flag*/
      if (OS0SW01.OS0SW-MAP-ERR-FL == "N")
        OS0SS-EVAL-FLAGS(); /* edit flag combinations*/
      end
      ;
      if (OS0SW01.OS0SW-MAP-ERR-FL == "N")
        OS0SS-GET-CURR-DTE(); /* get current date and time*/
        if (OS0SM005.OS0SM-DELAY-DEC-FL != OS0SW01.OS0SW-DELAY-DECR-FL)
          OS0SS-UPD-DELAY-FL(); /* update delay decrement flag*/
        end
        ;
        if (OS0SW01.OS0SW-DEL-XOB-FL == "Y"
         || OS0SW01.OS0SW-DEL-PGM-FL == "Y")
          OS0SS-DEL-PRI-DATA(); /* delete decrement data*/
        end
        ;
        if (OS0SM005.OS0SM-DEADWEEK-FL != OS0SW01.OS0SW-DEADWEEK-FL)
          OS0SS-UPD-VOBPGM01(); /* update deadweek flag*/
        end
        ;
        if (OS0SM005.OS0SM-TRUE-DEMAND-FL != OS0SW01.OS0SW-TRUE-DEMAND-FL)
          OS0SS-UPD-OBPGM-A(); /* update true demand flag*/
        end
        ;
        if (OS0SM005.OS0SM-DAYS-TO-PUSH != OS0SW01.OS0SW-DAYS-TO-PUSH
         || OS0SM005.OS0SM-LAST-TRY-FL != OS0SW01.OS0SW-LAST-TRY-FL)
          OS0SS-UPD-OBPGM-B(); /* update true demand decrement info*/
        end
        OS0SW01.OS0SW-UPD-MAP-FL = "Y";
        OS0SW01.OS0SW-UPD-DATA-FL = "Y";
        ;
      end
    end
  end
  ;
  ;
end // end OS0S030

// REVIEW ORDER TYPE CRITERIA
Function OS0S100()
  ;
  ;
  OS0SW01.OS0SW-CURR-PG = 1;
  OS0SW01.OS0SW-UPD-DATA-FL = "Y";
  OS0SW01.OS0SW-UPD-MAP-FL = "Y";
  OS0SW01.OS0SW-RETURN-FL = "N";
  ;
  while (OS0SW01.OS0SW-RETURN-FL == "N")
    OS0SW01.OS0SW-MAP-ERR-FL = "N";
    OS0SW01.OS0SW-TBL-ERR-FL = "N";
    ;
    OS0S110(); /* converse OS0SM100*/
    OS0S120(); /* validate pf keys*/
    ;
    if (OS0SW01.OS0SW-MAP-ERR-FL == "N"
     && OS0SW01.OS0SW-TBL-ERR-FL == "N")
      OS0SW01.OS0SW-DATA-CHG-FL = "N";
      ;
      OS0S130(); /* edit ord type priority data*/
      OS0S140(); /* update ord type priority data*/
    end
  end
  ;
  OS0S150(); /* check ord type decrement flag*/
  ;
  ;
end // end OS0S100

// CONVERSE OS0SM100
Function OS0S110()
  ;
  ;
  if (OS0SW01.OS0SW-UPD-MAP-FL == "Y")
    OS0SW01.OS0SW-UPD-MAP-FL = "N";
    if (OS0SW01.OS0SW-UPD-DATA-FL == "Y")
      OS0SW01.OS0SW-UPD-DATA-FL = "N";
      OS0SW01.OS0SW-DB2-ERR-FL = "N";
      ;
      OS0SS-BLD-XOB-TBL(); /* build xob priority table*/
      ;
      if (OS0SW01.OS0SW-DB2-ERR-FL == "Y")
        OS0SW01.OS0SW-TBL-ERR-FL = "Y";
        OS0SW01.OS0SW-UPD-MAP-FL = "Y";
        OS0SW01.OS0SW-UPD-DATA-FL = "Y";
      end
    end
    ;
    OS0SS-LOAD-XOB-MAP();
  end
  ;
  ;
  converse OS0SM100 ;
  ;
  ;
  OS0SS-SET-XOB-ATTR(); /* reset map attributes*/
  ;
  ;
end // end OS0S110

// VALIDATE PF KEYS
Function OS0S120()
  ;
  ;
  if (converseVar.eventKey is enter) /* continue process*/
    /* continue*/
  else
    if (converseVar.eventKey is pf3 /* return to prev screen*/
     || converseVar.eventKey is pf4) /* xfer to main menu*/
      OS0SS-EXIT-XOB(); /* exit order type criteria*/
    else
      if (converseVar.eventKey is pf7) /* scroll back*/
        OS0SS-SCROLL-BACK();
      else
        if (converseVar.eventKey is pf8) /* scroll forward*/
          OS0SS-SCROLL-FRWD();
        else
          if (converseVar.eventKey is pf19) /* refresh OS0SM100*/
            OS0SW01.OS0SW-UPD-DATA-FL = "Y";
            OS0SW01.OS0SW-UPD-MAP-FL = "Y";
            OS0SW01.OS0SW-MAP-ERR-FL = "Y";
            converseLib.validationFailed(825);
          else /* invalid pf key*/
            OS0SW01.OS0SW-MAP-ERR-FL = "Y";
            converseLib.validationFailed(2);
          end
        end
      end
    end
  end
  ;
  ;
end // end OS0S120

// EDIT ORDER TYPE CRITERIA
Function OS0S130()
  ;
  ;
  if (OS0SM100.OS0SM-CURR-PG != OS0SW01.OS0SW-CURR-PG)
    OS0SS-EDIT-XOB-PG();
  else
    OS0SW01.OS0SW-SUB = 1;
    while (OS0SW01.OS0SW-SUB <= 11
     && OS0SW01.OS0SW-MAP-ERR-FL == "N")
      OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-POS + OS0SW01.OS0SW-SUB;
      ;
      if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != " "
       || OS0SM100.XOBCD[OS0SW-SUB] != OS0SW02.XOBCD[OS0SW-TBL-SUB]
       || OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB]
       != OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB])
        OS0SW01.OS0SW-DATA-CHG-FL = "Y";
        ;
        OS0SS-EDIT-XOB-DEC(); /* edit xob decrement flag*/
        OS0SS-EDIT-XOB-CD(); /* edit xob id*/
        OS0SS-EDIT-XOB-OPT(); /* edit xob option code*/
      end
      ;
      OS0SW01.OS0SW-SUB = OS0SW01.OS0SW-SUB + 1;
    end
  end
  ;
  ;
end // end OS0S130

// UPDATE ORDER TYPE CRITERIA
Function OS0S140()
  ;
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N"
   && OS0SW01.OS0SW-DATA-CHG-FL == "Y")
    OS0SS-GET-CURR-DTE(); /* get current date and time*/
    ;
    OS0SW01.OS0SW-DB2-ERR-FL = "N";
    OS0SW01.OS0SW-SUB = 1;
    ;
    while (OS0SW01.OS0SW-DB2-ERR-FL == "N"
     && OS0SW01.OS0SW-SUB <= 11)
      if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != " ")
        OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-POS + OS0SW01.OS0SW-SUB;
        ;
        OS0SS-UPD-XOB-DATA(); /* update xob priority data*/
        ;
        if (OS0SW01.OS0SW-DB2-ERR-FL == "N")
          OS0SS-UPD-XOB-TBL(); /* update xob priority table*/
          OS0SS-UPD-XOB-MAP(); /* update xob priority map*/
        else
          set OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] cursor, bold;
          OS0SW01.OS0SW-MAP-ERR-FL = "Y";
        end
      end
      ;
      OS0SW01.OS0SW-SUB = OS0SW01.OS0SW-SUB + 1;
    end
  end
  ;
  ;
end // end OS0S140

// CHECK ORDER TYPE DECR FLAG
Function OS0S150()
  ;
  ;
  if (OS0SM005.OS0SM-DECR-XOB-FL == "Y"
   && OS0SW01.OS0SW-DECR-XOB-FL == "N")
    set OS0SM005.OS0SM-DECR-XOB-FL cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(887); /* no ord type decr criteria found*/
  else
    if (OS0SM005.OS0SM-DECR-XOB-FL == "N"
     && OS0SW01.OS0SW-DECR-XOB-FL == "Y")
      OS0SM005.OS0SM-DECR-XOB-FL = "Y";
    end
  end
  ;
  ;
end // end OS0S150

// REVIEW SALES PRGM CRITERIA
Function OS0S200()
  ;
  ;
  OS0SW01.OS0SW-CURR-PG = 1;
  OS0SW01.OS0SW-UPD-DATA-FL = "Y";
  OS0SW01.OS0SW-UPD-MAP-FL = "Y";
  OS0SW01.OS0SW-RETURN-FL = "N";
  ;
  while (OS0SW01.OS0SW-RETURN-FL == "N")
    OS0SW01.OS0SW-MAP-ERR-FL = "N";
    OS0SW01.OS0SW-TBL-ERR-FL = "N";
    ;
    OS0S210(); /* converse OS0SM200*/
    OS0S220(); /* validate pf keys*/
    ;
    if (OS0SW01.OS0SW-MAP-ERR-FL == "N"
     && OS0SW01.OS0SW-TBL-ERR-FL == "N")
      OS0SW01.OS0SW-DATA-CHG-FL = "N";
      ;
      OS0S230(); /* edit sales prgm priority data*/
      OS0S240(); /* update sales prgm priority data*/
    end
  end
  ;
  OS0S250(); /* check sales prgm decrement flag*/
  ;
  ;
end // end OS0S200

// CONVERSE OS0SM200
Function OS0S210()
  ;
  ;
  if (OS0SW01.OS0SW-UPD-MAP-FL == "Y")
    OS0SW01.OS0SW-UPD-MAP-FL = "N";
    if (OS0SW01.OS0SW-UPD-DATA-FL == "Y")
      OS0SW01.OS0SW-UPD-DATA-FL = "N";
      OS0SW01.OS0SW-DB2-ERR-FL = "N";
      ;
      OS0SS-BLD-PGM-TBL(); /* build pgm priority table*/
      ;
      if (OS0SW01.OS0SW-DB2-ERR-FL == "Y")
        OS0SW01.OS0SW-TBL-ERR-FL = "Y";
        OS0SW01.OS0SW-UPD-MAP-FL = "Y";
        OS0SW01.OS0SW-UPD-DATA-FL = "Y";
      end
    end
    ;
    OS0SS-LOAD-PGM-MAP();
  end
  ;
  ;
  converse OS0SM200 ;
  ;
  ;
  OS0SS-SET-PGM-ATTR(); /* reset map attributes*/
  ;
  ;
end // end OS0S210

// VALIDATE PF KEYS
Function OS0S220()
  ;
  ;
  if (converseVar.eventKey is enter) /* continue process*/
    /* continue*/
  else
    if (converseVar.eventKey is pf3 /* return to prev screen*/
     || converseVar.eventKey is pf4) /* xfer to main menu*/
      OS0SS-EXIT-PGM(); /* exit sales prgm criteria*/
    else
      if (converseVar.eventKey is pf7) /* scroll back*/
        OS0SS-SCROLL-BACK();
      else
        if (converseVar.eventKey is pf8) /* scroll forward*/
          OS0SS-SCROLL-FRWD();
        else
          if (converseVar.eventKey is pf19) /* refresh OS0SM200*/
            OS0SW01.OS0SW-UPD-DATA-FL = "Y";
            OS0SW01.OS0SW-UPD-MAP-FL = "Y";
            OS0SW01.OS0SW-MAP-ERR-FL = "Y";
          else /* invalid pf key*/
            OS0SW01.OS0SW-MAP-ERR-FL = "Y";
            converseLib.validationFailed(2);
          end
        end
      end
    end
  end
  ;
  ;
end // end OS0S220

// EDIT SALES PROGRAM CRITERIA
Function OS0S230()
  ;
  ;
  if (OS0SM200.OS0SM-CURR-PG != OS0SW01.OS0SW-CURR-PG)
    OS0SS-EDIT-PGM-PG(); /* edit program page*/
  else
    OS0SW01.OS0SW-SUB = 1;
    while (OS0SW01.OS0SW-SUB <= 11
     && OS0SW01.OS0SW-MAP-ERR-FL == "N")
      OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-POS + OS0SW01.OS0SW-SUB;
      ;
      if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != " "
       || OS0SM200.SP1ID[OS0SW-SUB] != OS0SW02.SP1ID[OS0SW-TBL-SUB]
       || OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB]
       != OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB])
        OS0SW01.OS0SW-DATA-CHG-FL = "Y";
        ;
        OS0SS-EDIT-PGM-DEC(); /* edit spgm decrement flag*/
        OS0SS-EDIT-PGM-ID(); /* edit spgm id*/
        OS0SS-EDIT-PGM-OPT(); /* edit spgm option code*/
      end
      ;
      OS0SW01.OS0SW-SUB = OS0SW01.OS0SW-SUB + 1;
    end
  end
  ;
  ;
end // end OS0S230

// UPDATE SALES PRGM CRITERIA
Function OS0S240()
  ;
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N"
   && OS0SW01.OS0SW-DATA-CHG-FL == "Y")
    OS0SS-GET-CURR-DTE(); /* get current date and time*/
    ;
    OS0SW01.OS0SW-DB2-ERR-FL = "N";
    OS0SW01.OS0SW-SUB = 1;
    ;
    while (OS0SW01.OS0SW-DB2-ERR-FL == "N"
     && OS0SW01.OS0SW-SUB <= 11)
      if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != " ")
        OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-POS + OS0SW01.OS0SW-SUB;
        ;
        OS0SS-UPD-PGM-DATA(); /* update pgm priority data*/
        ;
        if (OS0SW01.OS0SW-DB2-ERR-FL == "N")
          OS0SS-UPD-PGM-TBL(); /* update pgm priority table*/
          OS0SS-UPD-PGM-MAP(); /* update pgm priority map*/
        else
          set OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] cursor, bold;
          OS0SW01.OS0SW-MAP-ERR-FL = "Y";
        end
      end
      ;
      OS0SW01.OS0SW-SUB = OS0SW01.OS0SW-SUB + 1;
    end
  end
  ;
  ;
end // end OS0S240

// CHECK SALES PRGM DECR FLAG
Function OS0S250()
  ;
  ;
  if (OS0SM005.OS0SM-DECR-PGM-FL == "Y"
   && OS0SW01.OS0SW-DECR-PGM-FL == "N")
    set OS0SM005.OS0SM-DECR-PGM-FL cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(888); /* no sales prgm decr criteria found*/
  else
    if (OS0SM005.OS0SM-DECR-PGM-FL == "N"
     && OS0SW01.OS0SW-DECR-PGM-FL == "Y")
      OS0SM005.OS0SM-DECR-PGM-FL = "Y";
    end
  end
  ;
  ;
end // end OS0S250

// add VOBPRI01 via IO7190
Function OS0SS-ADD-VOBPRI01()
  ;
  ;
  set VOBPRI01 empty;
  set SQLCA empty;
  ;
  VOBPRI01.XOBCD = OS0SW01.XOBCD;
  VOBPRI01.SP1ID = OS0SW01.SP1ID;
  VOBPRI01.OB-ALW-DECR-FL = OS0SW01.OB-ALW-DECR-FL;
  VOBPRI01.ZZZSDT = TA2REC.TA2GRGGN;
  VOBPRI01.ZZZCHGDT = TA2REC.TA2GRGGN;
  VOBPRI01.ZZZCHGTM = TA2REC.TA2TIMHM;
  ;
  call "IO7190" ("A ", SQLCA, VOBPRI01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful add*/
     /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == -803) /* data already added*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(860);
    else
      if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
        OS0SW01.OS0SW-DB2-ERR-FL = "Y";
        converseLib.validationFailed(10);
      else
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0Q";
        TA1REC.TA1LOC = "OS0QS-ADD-VOBPRI01 IO7190 A";
        TA1REC.TA1DBASE = "DORDB  ";
        TA1REC.TA1TBLVU = "VOBPRI01";
        TA1REC.TA1TBLKE = VOBPRI01.VOBPRI01-KEY;
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0SS-ADD-VOBPRI01

// move VOBPRI01 spgm row to tbl
Function OS0SS-BLD-PGM-ROW()
  ;
  ;
  OS0SW02.OS0SW-REC-TTL = OS0SW02.OS0SW-REC-TTL + 1;
  ;
  if (OS0SW02.OS0SW-REC-TTL >= OS0SW01.OS0SW-MIN-REC
   && OS0SW02.OS0SW-REC-TTL <= OS0SW01.OS0SW-MAX-REC)
    ;
    OS0SW02.SP1ID[OS0SW-TBL-SUB] = VOBPRI01.SP1ID;
    OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB] = VOBPRI01.OB-ALW-DECR-FL;
    OS0SW02.ZZZCHGCT[OS0SW-TBL-SUB] = VOBPRI01.ZZZCHGCT;
    ;
    OS0SW01.SP1ID = VOBPRI01.SP1ID;
    ;
    OS0SS-SEL-SP1REC(); /* select sp1rec via IO0070*/
    ;
    if (SQLCA.VAGen_SQLCODE == 0) /* successful select*/
      OS0SW02.SP1NM[OS0SW-TBL-SUB] = SP1REC.SP1NM;
    else
      OS0SW02.SP1NM[OS0SW-TBL-SUB] = " ";
    end
    ;
    OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-SUB + 1;
  end
  ;
  ;
end // end OS0SS-BLD-PGM-ROW

// build pgm priority table
Function OS0SS-BLD-PGM-TBL()
  ;
  ;
  set OS0SW02 empty; /* initialize pgm exclude table*/
  ;
  OS0SS-OPN-VOBPRI01(); /* open VOBPRI01 cursor via IO7190*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful open*/
    OS0SW02.OS0SW-TBL-SUB = 1;
    OS0SW02.OS0SW-EOF-FL = "N";
    ;
    while (OS0SW02.OS0SW-EOF-FL == "N")
      OS0SS-NXT-VOBPRI01(); /* fetch next VOBPRI01 via IO7190*/
      ;
      if (SQLCA.VAGen_SQLCODE == 0) /* successful fetch*/
        if (VOBPRI01.SP1ID != "****"
         && VOBPRI01.SP1ID != "    ")
          OS0SS-BLD-PGM-ROW(); /* load pgm table row*/
        end
      end
    end
    ;
    if (SQLCA.VAGen_SQLCODE != -911) /* cursor not closed by rollback*/
      OS0SS-CLS-VOBPRI01(); /* close VOBPRI01 cursor*/
    end
  end
  ;
  OS0SS-CALC-PGM-PG(); /* calc pgm page numbers*/
  OS0SS-CALC-PGM-POS(); /* calc current pgm tbl position*/
  ;
  ;
end // end OS0SS-BLD-PGM-TBL

// move VOBPRI01 xob row to tbl
Function OS0SS-BLD-XOB-ROW()
  ;
  ;
  OS0SW02.OS0SW-REC-TTL = OS0SW02.OS0SW-REC-TTL + 1;
  ;
  if (OS0SW02.OS0SW-REC-TTL >= OS0SW01.OS0SW-MIN-REC
   && OS0SW02.OS0SW-REC-TTL <= OS0SW01.OS0SW-MAX-REC)
    ;
    OS0SW02.XOBCD[OS0SW-TBL-SUB] = VOBPRI01.XOBCD;
    OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB] = VOBPRI01.OB-ALW-DECR-FL;
    OS0SW02.ZZZCHGCT[OS0SW-TBL-SUB] = VOBPRI01.ZZZCHGCT;
    ;
    sysVar.arrayIndex = 1;
    if (VOBPRI01.XOBCD in XOBTBL.XOBCD from sysVar.arrayIndex)
      OS0SW02.XOBDESC[OS0SW-TBL-SUB] = XOBTBL.XOBDESC[sysVar.arrayIndex];
    else
      OS0SW02.XOBDESC[OS0SW-TBL-SUB] = " ";
    end
    ;
    OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-SUB + 1;
  end
  ;
  ;
end // end OS0SS-BLD-XOB-ROW

// build xob priority table
Function OS0SS-BLD-XOB-TBL()
  ;
  ;
  set OS0SW02 empty; /* initialize xob exclude table*/
  ;
  OS0SS-OPN-VOBPRI01(); /* open VOBPRI01 cursor via IO7190*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful open*/
    OS0SW02.OS0SW-TBL-SUB = 1;
    OS0SW02.OS0SW-EOF-FL = "N";
    ;
    while (OS0SW02.OS0SW-EOF-FL == "N")
      OS0SS-NXT-VOBPRI01(); /* fetch next VOBPRI01 via IO7190*/
      ;
      if (SQLCA.VAGen_SQLCODE == 0) /* successful fetch*/
        if (VOBPRI01.XOBCD != "**"
         && VOBPRI01.XOBCD != "  ")
          OS0SS-BLD-XOB-ROW(); /* load xob table row*/
        end
      end
    end
    ;
    if (SQLCA.VAGen_SQLCODE != -911) /* cursor not closed by rollback*/
      OS0SS-CLS-VOBPRI01(); /* close VOBPRI01 cursor*/
    end
  end
  ;
  OS0SS-CALC-XOB-PG(); /* calc xob page numbers*/
  OS0SS-CALC-XOB-POS(); /* calc current xob tbl position*/
  ;
  ;
end // end OS0SS-BLD-XOB-TBL

// calc spgm page numbers
Function OS0SS-CALC-PGM-PG()
  ;
  ;
  OS0SW01.OS0SW-LAST-PG = OS0SW02.OS0SW-REC-TTL / 11;
  OS0SW01.OS0SW-REMAIN = OS0SW02.OS0SW-REC-TTL % 11;
  ;
  if (OS0SW01.OS0SW-REMAIN != 0)
    OS0SW01.OS0SW-LAST-PG = OS0SW01.OS0SW-LAST-PG + 1;
  end
  ;
  OS0SW01.OS0SW-LAST-PG = OS0SW01.OS0SW-LAST-PG + 1;
  ;
  if (OS0SW01.OS0SW-CURR-PG > OS0SW01.OS0SW-LAST-PG)
    OS0SW01.OS0SW-CURR-PG = OS0SW01.OS0SW-LAST-PG;
  end
  ;
  ;
end // end OS0SS-CALC-PGM-PG

// reset curr position in table
Function OS0SS-CALC-PGM-POS()
  ;
  ;
  OS0SW02.OS0SW-REC-CNT = OS0SW01.OS0SW-CURR-PG * 11;
  OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 10;
  ;
  while (OS0SW02.OS0SW-REC-CNT > 110)
    OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 110;
  end
  ;
  OS0SW02.OS0SW-TBL-POS = OS0SW02.OS0SW-REC-CNT - 1;
  ;
  ;
end // end OS0SS-CALC-PGM-POS

// calc xob page numbers
Function OS0SS-CALC-XOB-PG()
  ;
  ;
  OS0SW01.OS0SW-LAST-PG = OS0SW02.OS0SW-REC-TTL / 11;
  OS0SW01.OS0SW-REMAIN = OS0SW02.OS0SW-REC-TTL % 11;
  ;
  if (OS0SW01.OS0SW-REMAIN != 0)
    OS0SW01.OS0SW-LAST-PG = OS0SW01.OS0SW-LAST-PG + 1;
  end
  ;
  OS0SW01.OS0SW-LAST-PG = OS0SW01.OS0SW-LAST-PG + 1;
  ;
  if (OS0SW01.OS0SW-CURR-PG > OS0SW01.OS0SW-LAST-PG)
    OS0SW01.OS0SW-CURR-PG = OS0SW01.OS0SW-LAST-PG;
  end
  ;
  ;
end // end OS0SS-CALC-XOB-PG

// reset curr position in table
Function OS0SS-CALC-XOB-POS()
  ;
  ;
  OS0SW02.OS0SW-REC-CNT = OS0SW01.OS0SW-CURR-PG * 11;
  OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 10;
  ;
  while (OS0SW02.OS0SW-REC-CNT > 110)
    OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 110;
  end
  ;
  OS0SW02.OS0SW-TBL-POS = OS0SW02.OS0SW-REC-CNT - 1;
  ;
  ;
end // end OS0SS-CALC-XOB-POS

// close vobpri01 cursor
Function OS0SS-CLS-VOBPRI01()
  ;
  ;
  set SQLCA empty;
  set VOBPRI01 empty;
  ;
  call "IO7190" ("C1", SQLCA, VOBPRI01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0
   || SQLCA.VAGen_SQLCODE == -911)
     /* continue*/
  else
    TA1REC.TA1TYPE = "DB2 ";
    TA1REC.TA1FUNC = "RETN";
    TA1REC.TA1PGMNM = "OS0Q";
    TA1REC.TA1LOC = "OS0QS-CLS-VOBPRI01 IO7190 C1";
    TA1REC.TA1DBASE = "DORDB  ";
    TA1REC.TA1TBLVU = "VOBPRI01";
    TA1REC.TA1TBLKE = " ";
    ;
    call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
    ;
    COMMAREA.CAUSERA = " ";
    ;
    XSPF4();
    exit program;
  end
  ;
  ;
end // end OS0SS-CLS-VOBPRI01

// delete priority decrement data
Function OS0SS-DEL-PRI-DATA()
  ;
  ;
  OS0SW01.OS0SW-DB2-ERR-FL = "N";
  ;
  OS0SS-OPN-VOBPRI01(); /* open VOBPRI01 via IO7190*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful open*/
    ;
    while (SQLCA.VAGen_SQLCODE == 0) /* until unsuccessful fetch*/
      OS0SS-NXT-VOBPRI01(); /* fetch VOBPRI01 via IO7190*/
      ;
      if (SQLCA.VAGen_SQLCODE == 0 /* successful fetch of pri data row*/
       && VOBPRI01.XOBCD != "**"   
       && VOBPRI01.SP1ID != "****")
        OS0SW01.XOBCD = VOBPRI01.XOBCD;
        OS0SW01.SP1ID = VOBPRI01.SP1ID;
        ;
        if (OS0SW01.XOBCD != "  " /* order type decrement data*/
         && OS0SW01.OS0SW-DEL-XOB-FL == "Y")
          OS0SS-DEL-VOBPRI01(); /* delete VOBPRI01 via IO7190*/
        else
          if (OS0SW01.SP1ID != "    " /* sales prgm decrement data*/
           && OS0SW01.OS0SW-DEL-PGM-FL == "Y")
            OS0SS-DEL-VOBPRI01(); /* delete VOBPRI01 via IO7190*/
          end
        end
      end
    end
    ;
    if (SQLCA.VAGen_SQLCODE != -911) /* cursor not closed by rollback*/
      OS0SS-CLS-VOBPRI01(); /* close VOBPRI01 via IO7190*/
    end
  end
  ;
  if (OS0SW01.OS0SW-DB2-ERR-FL == "N")
    OS0SW01.OS0SW-DECR-XOB-FL = OS0SM005.OS0SM-DECR-XOB-FL;
    OS0SW01.OS0SW-DECR-PGM-FL = OS0SM005.OS0SM-DECR-PGM-FL;
  end
  ;
  ;
end // end OS0SS-DEL-PRI-DATA

// delete VOBPRI01 via IO7190
Function OS0SS-DEL-VOBPRI01()
  ;
  ;
  set SQLCA empty;
  set VOBPRI01 empty;
  ;
  VOBPRI01.XOBCD = OS0SW01.XOBCD;
  VOBPRI01.SP1ID = OS0SW01.SP1ID;
  ;
  call "IO7190" ("D ", SQLCA, VOBPRI01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0 /* successful delete*/
   || SQLCA.VAGen_SQLCODE == 100) /* row not found*/
     /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
      OS0SW01.OS0SW-MAP-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0Q";
      TA1REC.TA1LOC = "OS0QS-DEL-VOBPRI01 IO7190 D";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPRI01";
      TA1REC.TA1TBLKE = VOBPRI01.VOBPRI01-KEY;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0SS-DEL-VOBPRI01

// edit days to push
Function OS0SS-EDIT-DAYS()
  ;
  ;
  if (OS0SM005.OS0SM-DAYS-TO-PUSH == 0
   || OS0SM005.OS0SM-DAYS-TO-PUSH == 30
   || OS0SM005.OS0SM-DAYS-TO-PUSH == 60
   || OS0SM005.OS0SM-DAYS-TO-PUSH == 90
  ) /* next sentence*/
  else
    set OS0SM005.OS0SM-DAYS-TO-PUSH cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(894); /* must be 'y' or 'n'*/
  end
  ;
  ;
  ;
end // end OS0SS-EDIT-DAYS

// edit delay decrement flag
Function OS0SS-EDIT-DEC-FL()
  ;
  ;
  if (OS0SM005.OS0SM-DELAY-DEC-FL != "N"
   && OS0SM005.OS0SM-DELAY-DEC-FL != "Y")
    set OS0SM005.OS0SM-DELAY-DEC-FL cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(848); /* must be 'y' or 'n'*/
  end
  ;
  ;
end // end OS0SS-EDIT-DEC-FL

// edit true demand flag
Function OS0SS-EDIT-DMD-FL()
  ;
  ;
  if (OS0SM005.OS0SM-TRUE-DEMAND-FL == "Y"
   || OS0SM005.OS0SM-TRUE-DEMAND-FL == "N")
    /* next sentence*/
  else
    set OS0SM005.OS0SM-TRUE-DEMAND-FL cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(848); /* must be 'y' or 'n'*/
  end
  ;
  ;
  ;
end // end OS0SS-EDIT-DMD-FL

// edit deadweek flag
Function OS0SS-EDIT-DW-FL()
  ;
  ;
  if (OS0SM005.OS0SM-DEADWEEK-FL != "N"
   && OS0SM005.OS0SM-DEADWEEK-FL != "Y")
    set OS0SM005.OS0SM-DEADWEEK-FL cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(848); /* must be 'y' or 'n'*/
  end
  ;
  ;
end // end OS0SS-EDIT-DW-FL

// edit xob allow decrement flag
Function OS0SS-EDIT-PGM-DEC()
  ;
  ;
  if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "D")
    if (OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB] != "Y"
     && OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB] != "N")
      set OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB] cursor, bold;
      OS0SW01.OS0SW-MAP-ERR-FL = "Y";
      converseLib.validationFailed(848); /* must be 'y' or 'n'*/
    end
  end
  ;
  ;
end // end OS0SS-EDIT-PGM-DEC

// edit decrement sales prgm flag
Function OS0SS-EDIT-PGM-FL()
  ;
  ;
  if (OS0SM005.OS0SM-DECR-PGM-FL != "Y"
   && OS0SM005.OS0SM-DECR-PGM-FL != "N")
    set OS0SM005.OS0SM-DECR-PGM-FL cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(848); /* must be 'y' or 'n'*/
  end
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N")
    if (OS0SM005.OS0SM-DECR-PGM-FL != OS0SW01.OS0SW-DECR-PGM-FL)
      if (OS0SM005.OS0SM-DECR-PGM-FL == "Y")
        OS0SW01.OS0SW-ADD-PGM-FL = "Y";
      else
        OS0SW01.OS0SW-DEL-PGM-FL = "Y";
      end
    end
  end
  ;
  ;
end // end OS0SS-EDIT-PGM-FL

// edit sales program id
Function OS0SS-EDIT-PGM-ID()
  ;
  ;
  if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "D")
    if (OS0SW02.SP1ID[OS0SW-TBL-SUB] == " ")
      if (OS0SM200.SP1ID[OS0SW-SUB] == " ")
        set OS0SM200.SP1ID[OS0SW-SUB] cursor, bold;
        OS0SW01.OS0SW-MAP-ERR-FL = "Y";
        converseLib.validationFailed(856); /* enter a sales program id*/
      else
        OS0SW01.SP1ID = OS0SM200.SP1ID[OS0SW-SUB];
        ;
        OS0SS-SEL-SP1REC(); /* select sp1rec via IO0070*/
        ;
        if (SQLCA.VAGen_SQLCODE == 0) /* successful select*/
          OS0SM200.SP1NM[OS0SW-SUB] = SP1REC.SP1NM;
        else
          set OS0SM200.SP1ID[OS0SW-SUB] cursor, bold;
          OS0SM200.SP1NM[OS0SW-SUB] = " ";
          OS0SW01.OS0SW-MAP-ERR-FL = "Y";
          ;
          if (SQLCA.VAGen_SQLCODE == 100) /* sp1id not found*/
            converseLib.validationFailed(24);
          end
        end
      end
    end
  end
  ;
  ;
end // end OS0SS-EDIT-PGM-ID

// edit xob option code
Function OS0SS-EDIT-PGM-OPT()
  ;
  ;
  if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "A"
   && OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "C"
   && OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "D")
    set OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(857);
  else
    if (OS0SW02.SP1ID[OS0SW-TBL-SUB] == " "
     && OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "A")
      set OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] cursor, bold;
      OS0SW01.OS0SW-MAP-ERR-FL = "Y";
      converseLib.validationFailed(858); /* enter 'a' to add*/
    else
      if (OS0SW02.SP1ID[OS0SW-TBL-SUB] != " ")
        if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "C"
         && OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "D")
          set OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] cursor, bold;
          OS0SW01.OS0SW-MAP-ERR-FL = "Y";
          converseLib.validationFailed(859); /* enter 'c' to change - 'd' to delete*/
        end
      end
    end
  end
  ;
  ;
end // end OS0SS-EDIT-PGM-OPT

// edit sales program page number
Function OS0SS-EDIT-PGM-PG()
  ;
  ;
  OS0SW01.OS0SW-MAP-ERR-FL = "Y";
  ;
  if (OS0SM200.OS0SM-CURR-PG < 1)
    set OS0SM200.OS0SM-CURR-PG cursor, bold;
    converseLib.validationFailed(5); /* page cannot be less than 1*/
  else
    if (OS0SM200.OS0SM-CURR-PG > OS0SM200.OS0SM-LAST-PG)
      set OS0SM200.OS0SM-CURR-PG cursor, bold;
      converseLib.validationFailed(3); /* page cannot exceed total pages*/
    else
      OS0SW01.OS0SW-CURR-PG = OS0SM200.OS0SM-CURR-PG;
      OS0SW01.OS0SW-UPD-MAP-FL = "Y";
      ;
      OS0SW02.OS0SW-REC-CNT = OS0SW01.OS0SW-CURR-PG * 11;
      OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 10;
      ;
      while (OS0SW02.OS0SW-REC-CNT > 110)
        OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 110;
      end
      ;
      OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 1;
      ;
      while (OS0SW02.OS0SW-REC-CNT < OS0SW01.OS0SW-MIN-REC)
        OS0SW01.OS0SW-MIN-REC = OS0SW-MIN-REC - 110;
        OS0SW01.OS0SW-MAX-REC = OS0SW-MAX-REC - 110;
        OS0SW01.OS0SW-UPD-DATA-FL = "Y";
      end
      ;
      while (OS0SW02.OS0SW-REC-CNT > OS0SW01.OS0SW-MAX-REC)
        OS0SW01.OS0SW-MIN-REC = OS0SW-MAX-REC + 110;
        OS0SW01.OS0SW-MAX-REC = OS0SW-MIN-REC + 110;
        OS0SW01.OS0SW-UPD-DATA-FL = "Y";
      end
      ;
      OS0SW02.OS0SW-TBL-POS = OS0SW02.OS0SW-REC-CNT;
    end
  end
  ;
  ;
end // end OS0SS-EDIT-PGM-PG

// edit last try flag
Function OS0SS-EDIT-TRY-FL()
  ;
  ;
  if (OS0SM005.OS0SM-LAST-TRY-FL == "Y"
   || OS0SM005.OS0SM-LAST-TRY-FL == "N")
    /* next sentence*/
  else
    set OS0SM005.OS0SM-LAST-TRY-FL cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(848); /* must be 'y' or 'n'*/
  end
  ;
  ;
  ;
end // end OS0SS-EDIT-TRY-FL

// edit base order type code
Function OS0SS-EDIT-XOB-CD()
  ;
  ;
  if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "D")
    if (OS0SW02.XOBCD[OS0SW-TBL-SUB] == " ")
      if (OS0SM100.XOBCD[OS0SW-SUB] == " ")
        set OS0SM100.XOBCD[OS0SW-SUB] cursor, bold;
        OS0SW01.OS0SW-MAP-ERR-FL = "Y";
        converseLib.validationFailed(323); /* enter a base order type*/
      else
        sysVar.arrayIndex = 1;
        if (OS0SM100.XOBCD[OS0SW-SUB] in XOBTBL.XOBCD from sysVar.arrayIndex)
          OS0SM100.XOBDESC[OS0SW-SUB] = XOBTBL.XOBDESC[sysVar.arrayIndex];
        else
          set OS0SM100.XOBCD[OS0SW-SUB] cursor, bold;
          OS0SM100.XOBDESC[OS0SW-SUB] = " ";
          OS0SW01.OS0SW-MAP-ERR-FL = "Y";
          converseLib.validationFailed(17);
        end
      end
    end
  end
  ;
  ;
end // end OS0SS-EDIT-XOB-CD

// edit xob allow decrement flag
Function OS0SS-EDIT-XOB-DEC()
  ;
  ;
  if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "D")
    if (OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB] != "Y"
     && OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB] != "N")
      set OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB] cursor, bold;
      OS0SW01.OS0SW-MAP-ERR-FL = "Y";
      converseLib.validationFailed(848); /* must be 'y' or 'n'*/
    end
  end
  ;
  ;
end // end OS0SS-EDIT-XOB-DEC

// edit decrement order type flag
Function OS0SS-EDIT-XOB-FL()
  ;
  ;
  if (OS0SM005.OS0SM-DECR-XOB-FL != "Y"
   && OS0SM005.OS0SM-DECR-XOB-FL != "N")
    set OS0SM005.OS0SM-DECR-XOB-FL cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(848); /* must be 'y' or 'n'*/
  end
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N")
    if (OS0SM005.OS0SM-DECR-XOB-FL != OS0SW01.OS0SW-DECR-XOB-FL)
      if (OS0SM005.OS0SM-DECR-XOB-FL == "Y")
        OS0SW01.OS0SW-ADD-XOB-FL = "Y";
      else
        OS0SW01.OS0SW-DEL-XOB-FL = "Y";
      end
    end
  end
  ;
  ;
end // end OS0SS-EDIT-XOB-FL

// edit xob option code
Function OS0SS-EDIT-XOB-OPT()
  ;
  ;
  if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "A"
   && OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "C"
   && OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "D")
    set OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] cursor, bold;
    OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    converseLib.validationFailed(857);
  else
    if (OS0SW02.XOBCD[OS0SW-TBL-SUB] == " "
     && OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "A")
      set OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] cursor, bold;
      OS0SW01.OS0SW-MAP-ERR-FL = "Y";
      converseLib.validationFailed(858); /* enter 'a' to add*/
    else
      if (OS0SW02.XOBCD[OS0SW-TBL-SUB] != " ")
        if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "C"
         && OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "D")
          set OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] cursor, bold;
          OS0SW01.OS0SW-MAP-ERR-FL = "Y";
          converseLib.validationFailed(859); /* enter 'c' to change - 'd' to delete*/
        end
      end
    end
  end
  ;
  ;
end // end OS0SS-EDIT-XOB-OPT

// edit order type page number
Function OS0SS-EDIT-XOB-PG()
  ;
  ;
  OS0SW01.OS0SW-MAP-ERR-FL = "Y";
  ;
  if (OS0SM100.OS0SM-CURR-PG < 1)
    set OS0SM100.OS0SM-CURR-PG cursor, bold;
    converseLib.validationFailed(5); /* page cannot be less than 1*/
  else
    if (OS0SM100.OS0SM-CURR-PG > OS0SM100.OS0SM-LAST-PG)
      set OS0SM100.OS0SM-CURR-PG cursor, bold;
      converseLib.validationFailed(3); /* page cannot exceed total pages*/
    else
      OS0SW01.OS0SW-CURR-PG = OS0SM100.OS0SM-CURR-PG;
      OS0SW01.OS0SW-UPD-MAP-FL = "Y";
      ;
      OS0SW02.OS0SW-REC-CNT = OS0SW01.OS0SW-CURR-PG * 11;
      OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 10;
      ;
      while (OS0SW02.OS0SW-REC-CNT > 110)
        OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 110;
      end
      ;
      OS0SW02.OS0SW-REC-CNT = OS0SW02.OS0SW-REC-CNT - 1;
      ;
      while (OS0SW02.OS0SW-REC-CNT < OS0SW01.OS0SW-MIN-REC)
        OS0SW01.OS0SW-MIN-REC = OS0SW-MIN-REC - 110;
        OS0SW01.OS0SW-MAX-REC = OS0SW-MAX-REC - 110;
        OS0SW01.OS0SW-UPD-DATA-FL = "Y";
      end
      ;
      while (OS0SW02.OS0SW-REC-CNT > OS0SW01.OS0SW-MAX-REC)
        OS0SW01.OS0SW-MIN-REC = OS0SW-MAX-REC + 110;
        OS0SW01.OS0SW-MAX-REC = OS0SW-MIN-REC + 110;
        OS0SW01.OS0SW-UPD-DATA-FL = "Y";
      end
      ;
      OS0SW02.OS0SW-TBL-POS = OS0SW02.OS0SW-REC-CNT;
    end
  end
  ;
  ;
end // end OS0SS-EDIT-XOB-PG

// evaluate delay exception flags
Function OS0SS-EVAL-FLAGS()
  ;
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N")
    if (OS0SM005.OS0SM-DEADWEEK-FL == "N"
     && OS0SM005.OS0SM-TRUE-DEMAND-FL == "Y")
      set OS0SM005.OS0SM-TRUE-DEMAND-FL cursor, bold;
      converseLib.validationFailed(895);
      OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    end
  end
  ;
  ;
  if (OS0SW01.OS0SW-MAP-ERR-FL == "N")
    if (OS0SM005.OS0SM-DECR-XOB-FL == "N"
     && OS0SM005.OS0SM-DECR-PGM-FL == "N"
     && OS0SM005.OS0SM-DELAY-DEC-FL == "Y")
      set OS0SM005.OS0SM-DECR-XOB-FL cursor, bold;
      set OS0SM005.OS0SM-DECR-PGM-FL bold;
      converseLib.validationFailed(888);
      OS0SW01.OS0SW-MAP-ERR-FL = "Y";
    end
  end
  ;
  ;
end // end OS0SS-EVAL-FLAGS

// exit application
Function OS0SS-EXIT-APPL()
  ;
  ;
  if (converseVar.eventKey is pf3) /* xfer to op criteria menu*/
    COMMAREA.CATOAP = "OP0Y";
  else
    if (converseVar.eventKey is pf4) /* xfer to main menu*/
      COMMAREA.CATOAP = "MN0M";
    else /* xfer to requested appl*/
      COMMAREA.CATOAP = OS0SM005.CATOAP;
      COMMAREA.CAITEM = OS0SM005.CAITEM;
    end
  end
  ;
  XSEXIT();
  ;
  OS0SW01.OS0SW-MAP-ERR-FL = "Y";
  OS0SM005.VAGen_EZEMSG = COMMAREA.CAMSG;
  COMMAREA.CATOAP = " ";
  COMMAREA.CAITEM = " ";
  COMMAREA.CAMSG = " ";
  ;
  ;
end // end OS0SS-EXIT-APPL

// exit sales prgm criteria
Function OS0SS-EXIT-PGM()
  ;
  ;
  if (converseVar.eventKey is pf4) /* xfer to main menu*/
    COMMAREA.CATOAP = "MN0M";
    ;
    XSEXIT();
    exit program;
  else
    OS0SW01.OS0SW-DB2-ERR-FL = "N";
    ;
    OS0SS-RESET-PGM-FL(); /* reset ws decr pgm flag*/
    ;
    if (OS0SW01.OS0SW-DB2-ERR-FL == "N")
      OS0SW01.OS0SW-RETURN-FL = "Y";
    end
  end
  ;
  ;
end // end OS0SS-EXIT-PGM

// exit review xob criteria
Function OS0SS-EXIT-XOB()
  ;
  ;
  if (converseVar.eventKey is pf4) /* xfer to main menu*/
    COMMAREA.CATOAP = "MN0M";
    ;
    XSEXIT();
    exit program;
  else
    OS0SW01.OS0SW-DB2-ERR-FL = "N";
    ;
    OS0SS-RESET-XOB-FL(); /* reset ws decr xob flag*/
    ;
    if (OS0SW01.OS0SW-DB2-ERR-FL == "N")
      OS0SW01.OS0SW-RETURN-FL = "Y";
    end
  end
  ;
  ;
end // end OS0SS-EXIT-XOB

// get current date and time
Function OS0SS-GET-CURR-DTE()
  ;
  ;
  set TA2REC empty;
  ;
  TA2REC.TA2DTOPT = "GETDATE";
  call "TA0040" (TA2REC) {isNoRefresh = yes, isExternal = yes};
  ;
  ;
end // end OS0SS-GET-CURR-DTE

// initialize ws record
Function OS0SS-INIT-OS0SW01()
  ;
  ;
  set OS0SW01 empty;
  ;
  OS0SW01.OS0SW-UPD-DATA-FL = "Y";
  OS0SW01.OS0SW-UPD-MAP-FL = "Y";
  OS0SW01.OS0SW-MAX-REC = 110;
  ;
  ;
end // end OS0SS-INIT-OS0SW01

// load deadweek flag to map
Function OS0SS-LOAD-DW-FL()
  ;
  OS0SS-SEL-VOBPGM01(); /* select dordb.vobpgm01*/
  ;
  OS0SM005.OS0SM-DEADWEEK-FL = OB8REC.OP1PARTN;
  OS0SW01.OS0SW-DEADWEEK-FL = OB8REC.OP1PARTN;
  ;
end // end OS0SS-LOAD-DW-FL

// move pgm priority data to map
Function OS0SS-LOAD-PGM-MAP()
  ;
  ;
  OS0SW01.OS0SW-ERR-MSG-NBR = converseVar.validationMsgNum;
  ;
  set OS0SM200 initial;
  ;
  OS0SM200.OS0SM-MAP-RVN = "01";
  OS0SM200.OS0SM-MAP-DTE = VGVar.currentShortGregorianDate;
  OS0SM200.OS0SM-CURR-PG = OS0SW01.OS0SW-CURR-PG;
  OS0SM200.OS0SM-LAST-PG = OS0SW01.OS0SW-LAST-PG;
  ;
  OS0SW01.OS0SW-SUB = 11;
  while (OS0SW01.OS0SW-SUB >= 1)
    if (OS0SW01.OS0SW-TBL-ERR-FL == "N")
      OS0SS-LOAD-PGM-ROW(); /* move table row to map row*/
    else
      set OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] skip, invisible;
      set OS0SM200.SP1ID[OS0SW-SUB] skip, invisible;
      set OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB] skip, invisible;
    end
    ;
    OS0SW01.OS0SW-SUB = OS0SW01.OS0SW-SUB - 1;
  end
  ;
  if (OS0SW01.OS0SW-ERR-MSG-NBR == 9999)
    converseLib.validationFailed();
  else
    converseLib.validationFailed(OS0SW01.OS0SW-ERR-MSG-NBR);
  end
  ;
  ;
end // end OS0SS-LOAD-PGM-MAP

// move table row to map row
Function OS0SS-LOAD-PGM-ROW()
  ;
  ;
  set OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] cursor, normal;
  set OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB] normal;
  ;
  OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-POS + OS0SW01.OS0SW-SUB;
  if (OS0SW02.SP1ID[OS0SW-TBL-SUB] != " ")
    OS0SM200.SP1ID[OS0SW-SUB] = OS0SW02.SP1ID[OS0SW-TBL-SUB];
    OS0SM200.SP1NM[OS0SW-SUB] = OS0SW02.SP1NM[OS0SW-TBL-SUB];
    OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB] = OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB];
  else
    set OS0SM200.SP1ID[OS0SW-SUB] normal;
  end
  ;
  ;
end // end OS0SS-LOAD-PGM-ROW

// move priority decr data to map
Function OS0SS-LOAD-PRI-MAP()
  ;
  ;
  OS0SW01.OS0SW-ERR-MSG-NBR = converseVar.validationMsgNum;
  ;
  set OS0SM005 initial;
  ;
  OS0SM005.OS0SM-MAP-RVN = "01";
  OS0SM005.OS0SM-MAP-DTE = VGVar.currentShortGregorianDate;
  ;
  OS0SM005.OS0SM-TRUE-DEMAND-FL = OS0SW01.OS0SW-TRUE-DEMAND-FL;
  OS0SM005.OS0SM-DAYS-TO-PUSH = OS0SW01.OS0SW-DAYS-TO-PUSH;
  OS0SM005.OS0SM-LAST-TRY-FL = OS0SW01.OS0SW-LAST-TRY-FL;
  ;
  OS0SM005.OS0SM-DELAY-DEC-FL = OS0SW01.OS0SW-DELAY-DECR-FL;
  OS0SM005.OS0SM-DECR-XOB-FL = OS0SW01.OS0SW-DECR-XOB-FL;
  OS0SM005.OS0SM-DECR-PGM-FL = OS0SW01.OS0SW-DECR-PGM-FL;
  ;
  if (OS0SW01.OS0SW-ERR-MSG-NBR == 9999)
    converseLib.validationFailed();
  else
    converseLib.validationFailed(OS0SW01.OS0SW-ERR-MSG-NBR);
  end
  ;
  ;
end // end OS0SS-LOAD-PRI-MAP

// move priority xob data to map
Function OS0SS-LOAD-XOB-MAP()
  ;
  ;
  OS0SW01.OS0SW-ERR-MSG-NBR = converseVar.validationMsgNum;
  ;
  set OS0SM100 initial;
  ;
  OS0SM100.OS0SM-MAP-RVN = "01";
  OS0SM100.OS0SM-MAP-DTE = VGVar.currentShortGregorianDate;
  OS0SM100.OS0SM-CURR-PG = OS0SW01.OS0SW-CURR-PG;
  OS0SM100.OS0SM-LAST-PG = OS0SW01.OS0SW-LAST-PG;
  ;
  OS0SW01.OS0SW-SUB = 11;
  while (OS0SW01.OS0SW-SUB >= 1)
    if (OS0SW01.OS0SW-TBL-ERR-FL == "N")
      OS0SS-LOAD-XOB-ROW(); /* move table row to map row*/
    else
      set OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] skip, invisible;
      set OS0SM100.XOBCD[OS0SW-SUB] skip, invisible;
      set OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB] skip, invisible;
    end
    ;
    OS0SW01.OS0SW-SUB = OS0SW01.OS0SW-SUB - 1;
  end
  ;
  if (OS0SW01.OS0SW-ERR-MSG-NBR == 9999)
    converseLib.validationFailed();
  else
    converseLib.validationFailed(OS0SW01.OS0SW-ERR-MSG-NBR);
  end
  ;
  ;
end // end OS0SS-LOAD-XOB-MAP

// move table row to map
Function OS0SS-LOAD-XOB-ROW()
  ;
  ;
  set OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] cursor, normal;
  set OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB] normal;
  ;
  OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-POS + OS0SW01.OS0SW-SUB;
  if (OS0SW02.XOBCD[OS0SW-TBL-SUB] != " ")
    OS0SM100.XOBCD[OS0SW-SUB] = OS0SW02.XOBCD[OS0SW-TBL-SUB];
    OS0SM100.XOBDESC[OS0SW-SUB] = OS0SW02.XOBDESC[OS0SW-TBL-SUB];
    OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB] = OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB];
  else
    set OS0SM100.XOBCD[OS0SW-SUB] normal;
  end
  ;
  ;
end // end OS0SS-LOAD-XOB-ROW

// fetch next VOBPRI01 via IO7190
Function OS0SS-NXT-VOBPRI01()
  ;
  ;
  set SQLCA empty;
  ;
  call "IO7190" ("N1", SQLCA, VOBPRI01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful fetch*/
       /* continue*/
  else
    OS0SW02.OS0SW-EOF-FL = "Y";
    ;
    if (SQLCA.VAGen_SQLCODE == 100) /* end of file*/
       /* continue*/
    else
      if (SQLCA.VAGen_SQLCODE == -911) /* database busy*/
        OS0SW01.OS0SW-DB2-ERR-FL = "Y";
        converseLib.validationFailed(10);
      else
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0Q";
        TA1REC.TA1LOC = "OS0QS-NXT-VOBPRI01 IO7190 N1";
        TA1REC.TA1DBASE = "DORDB   ";
        TA1REC.TA1TBLVU = "VOBPRI01";
        TA1REC.TA1TBLKE = " ";
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0SS-NXT-VOBPRI01

// open VOBPRI01 via IO7190
Function OS0SS-OPN-VOBPRI01()
  ;
  ;
  set SQLCA empty;
  set VOBPRI01 empty;
  ;
  call "IO7190" ("S1", SQLCA, VOBPRI01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0Q";
      TA1REC.TA1LOC = "OS0QS-OPN-VOBPRI01 IO7190 S1";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPRI01";
      TA1REC.TA1TBLKE = " ";
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0SS-OPN-VOBPRI01

// reset ws sales prgm decr flag
Function OS0SS-RESET-PGM-FL()
  ;
  ;
  OS0SW01.OS0SW-DECR-PGM-FL = " ";
  ;
  OS0SS-OPN-VOBPRI01(); /* open VOBPRI01 via IO7190*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful open*/
    while (OS0SW01.OS0SW-DECR-PGM-FL != "Y"
     && SQLCA.VAGen_SQLCODE == 0)
      OS0SS-NXT-VOBPRI01(); /* fetch next VOBPRI01 via IO7190*/
      ;
      if (SQLCA.VAGen_SQLCODE == 0) /* successful fetch*/
        OS0SS-SET-PGM-FL(); /* set decrement sales prgm flag*/
      end
    end
    ;
    if (SQLCA.VAGen_SQLCODE != -911) /* cursor not closed with rollback*/
      OS0SS-CLS-VOBPRI01(); /* close VOBPRI01 via IO7190;*/
    end
  end
  ;
  if (OS0SW01.OS0SW-DB2-ERR-FL == "N"
   && OS0SW01.OS0SW-DECR-PGM-FL == " ")
    OS0SW01.OS0SW-DECR-PGM-FL = "N";
  end
  ;
  ;
end // end OS0SS-RESET-PGM-FL

// reset ws decr order type flag
Function OS0SS-RESET-XOB-FL()
  ;
  ;
  OS0SW01.OS0SW-DECR-XOB-FL = " ";
  ;
  OS0SS-OPN-VOBPRI01(); /* open VOBPRI01 via IO7190*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful open*/
    while (OS0SW01.OS0SW-DECR-XOB-FL != "Y"
     && SQLCA.VAGen_SQLCODE == 0)
      OS0SS-NXT-VOBPRI01(); /* fetch next VOBPRI01 via IO7190*/
      ;
      if (SQLCA.VAGen_SQLCODE == 0) /* successful fetch*/
        OS0SS-SET-XOB-FL(); /* set decrement order type flag*/
      end
    end
    ;
    if (SQLCA.VAGen_SQLCODE != -911) /* cursor not closed with rollback*/
      OS0SS-CLS-VOBPRI01(); /* close VOBPRI01 via IO7190;*/
    end
  end
  ;
  if (OS0SW01.OS0SW-DB2-ERR-FL == "N"
   && OS0SW01.OS0SW-DECR-XOB-FL == " ")
    OS0SW01.OS0SW-DECR-XOB-FL = "N";
  end
  ;
  ;
end // end OS0SS-RESET-XOB-FL

// scroll back thru data
Function OS0SS-SCROLL-BACK()
  ;
  ;
  OS0SW01.OS0SW-MAP-ERR-FL = "Y";
  ;
  if (OS0SW01.OS0SW-CURR-PG == 1)
    converseLib.validationFailed(643); /* cannot scroll back*/
  else
    OS0SW01.OS0SW-CURR-PG = OS0SW01.OS0SW-CURR-PG - 1;
    OS0SW01.OS0SW-UPD-MAP-FL = "Y";
    ;
    if (OS0SW02.OS0SW-TBL-POS > 0)
      OS0SW02.OS0SW-TBL-POS = OS0SW02.OS0SW-TBL-POS - 11;
    else
      OS0SW01.OS0SW-MIN-REC = OS0SW01.OS0SW-MIN-REC - 110;
      OS0SW01.OS0SW-MAX-REC = OS0SW01.OS0SW-MAX-REC - 110;
      ;
      OS0SW01.OS0SW-UPD-DATA-FL = "Y";
    end
  end
  ;
  ;
end // end OS0SS-SCROLL-BACK

// scroll frwd thru data
Function OS0SS-SCROLL-FRWD()
  ;
  ;
  OS0SW01.OS0SW-MAP-ERR-FL = "Y";
  ;
  if (OS0SW01.OS0SW-CURR-PG == OS0SW01.OS0SW-LAST-PG)
    converseLib.validationFailed(644); /* cannot scroll frwd*/
  else
    OS0SW01.OS0SW-CURR-PG = OS0SW01.OS0SW-CURR-PG + 1;
    OS0SW01.OS0SW-UPD-MAP-FL = "Y";
    ;
    if (OS0SW02.OS0SW-TBL-POS < 88)
      OS0SW02.OS0SW-TBL-POS = OS0SW02.OS0SW-TBL-POS + 11;
    else
      OS0SW01.OS0SW-MIN-REC = OS0SW01.OS0SW-MIN-REC + 110;
      OS0SW01.OS0SW-MAX-REC = OS0SW01.OS0SW-MAX-REC + 110;
      ;
      OS0SW01.OS0SW-UPD-DATA-FL = "Y";
    end
  end
  ;
  ;
end // end OS0SS-SCROLL-FRWD

// select SP1REC via IO0070
Function OS0SS-SEL-SP1REC()
  ;
  ;
  OS0SW01.OS0SW-DB2-ERR-FL = "N";
  ;
  set SQLCA empty;
  set SP1REC empty;
  ;
  SP1REC.SP1ID = OS0SW01.SP1ID;
  ;
  call "IO0070" ("S ", SQLCA, SP1REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0 /* successful select*/
   || SQLCA.VAGen_SQLCODE == 100) /* row not found*/
     /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0S";
      TA1REC.TA1LOC = "OS0SS-SEL-SP1REC IO0070 S";
      TA1REC.TA1DBASE = "DSPGM  ";
      TA1REC.TA1TBLVU = "SP1REC";
      TA1REC.TA1TBLKE = SP1REC.SP1ID;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0SS-SEL-SP1REC

// select VOBPGM01 via IO5220
Function OS0SS-SEL-VOBPGM01()
  ;
  ;
  set SQLCA empty;
  set OB8REC empty;
  ;
  OB8REC.XXXPGMNO = "OB1070"; /* program number for deadweek fl*/
  ;
  call "IO5220" ("S ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0 /* successful select*/
  )                            /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0S";
      TA1REC.TA1LOC = "OS0SS-SEL-VOBPGM01 IO5220 S";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPGM01";
      TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0SS-SEL-VOBPGM01

// select VOBPRI01 via IO7190
Function OS0SS-SEL-VOBPRI01()
  ;
  ;
  set SQLCA empty;
  set VOBPRI01 empty;
  ;
  VOBPRI01.XOBCD = OS0SW01.XOBCD;
  VOBPRI01.SP1ID = OS0SW01.SP1ID;
  ;
  call "IO7190" ("S ", SQLCA, VOBPRI01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0 /* successful select*/
   || SQLCA.VAGen_SQLCODE == 100) /* row not found*/
     /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0Q";
      TA1REC.TA1LOC = "OS0QS-SEL-VOBPRI01 IO7190 S";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPRI01";
      TA1REC.TA1TBLKE = VOBPRI01.VOBPRI01-KEY;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0SS-SEL-VOBPRI01

// set delay airspeed decr flag
Function OS0SS-SET-DELAY-FL()
  ;
  ;
  if (VOBPRI01.XOBCD == "**" /* priority decrement row*/
   && VOBPRI01.SP1ID == "****")
    if (VOBPRI01.OB-ALW-DECR-FL == "N")
      OS0SW01.OS0SW-DELAY-DECR-FL = "Y";
    else
      OS0SW01.OS0SW-DELAY-DECR-FL = "N";
    end
  end
  ;
  ;
end // end OS0SS-SET-DELAY-FL

Function OS0SS-SET-DMD-DATA()
  ;
  ;
  OS0SW01.OS0SW-TRUE-DEMAND-FL = " ";
  OS0SW01.OS0SW-DAYS-TO-PUSH = 0;
  OS0SW01.OS0SW-LAST-TRY-FL = " ";
  OS0SW01.OS0SW-DB2-ERR-FL = "N";
  ;
  OS0SS-VOBPGM01-A(); /* select vobpgm01 for true demand*/
  OS0SS-VOBPGM01-B(); /* select vobpgm01 for true demand*/
                                   /* decrement*/
  ;
  if (OS0SW01.OS0SW-TRUE-DEMAND-FL == " ")
    OS0SW01.OS0SW-TRUE-DEMAND-FL = "N";
  end
  ;
  if (OS0SW01.OS0SW-LAST-TRY-FL == " ")
    OS0SW01.OS0SW-LAST-TRY-FL = "N";
  end
  ;
  ;
  ;
end // end OS0SS-SET-DMD-DATA

// reset map attributes
Function OS0SS-SET-PGM-ATTR()
  ;
  ;
  set OS0SM200.OS0SM-CURR-PG initialAttributes;
  ;
  OS0SW01.OS0SW-SUB = 11;
  while (OS0SW01.OS0SW-SUB >= 1)
    set OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] cursor, normal;
    set OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB] normal;
    ;
    OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-POS + OS0SW01.OS0SW-SUB;
    if (OS0SW02.SP1ID[OS0SW-TBL-SUB] == " ")
      set OS0SM200.SP1ID[OS0SW-SUB] normal;
    else
      set OS0SM200.SP1ID[OS0SW-SUB] initialAttributes;
    end
    ;
    OS0SW01.OS0SW-SUB = OS0SW01.OS0SW-SUB - 1;
  end
  ;
  ;
end // end OS0SS-SET-PGM-ATTR

// set decrement sales prgm flag
Function OS0SS-SET-PGM-FL()
  ;
  ;
  if (VOBPRI01.SP1ID != "****" /* sales prgm decrement row*/
   && VOBPRI01.SP1ID != "    " 
   && OS0SW01.OS0SW-DECR-PGM-FL != "Y")
    OS0SW01.OS0SW-DECR-PGM-FL = VOBPRI01.OB-ALW-DECR-FL;
  end
  ;
  ;
end // end OS0SS-SET-PGM-FL

// set OS0QM005 attributes
Function OS0SS-SET-PRI-ATTR()
  ;
  ;
  set OS0SM005.OS0SM-DEADWEEK-FL initialAttributes;
  set OS0SM005.OS0SM-TRUE-DEMAND-FL initialAttributes;
  set OS0SM005.OS0SM-DAYS-TO-PUSH initialAttributes;
  set OS0SM005.OS0SM-LAST-TRY-FL initialAttributes;
  set OS0SM005.OS0SM-DELAY-DEC-FL initialAttributes;
  set OS0SM005.OS0SM-DECR-XOB-FL initialAttributes;
  set OS0SM005.OS0SM-DECR-PGM-FL initialAttributes;
  set OS0SM005.CATOAP initialAttributes;
  ;
  ;
end // end OS0SS-SET-PRI-ATTR

// set priority decrement data
Function OS0SS-SET-PRI-DATA()
  ;
  ;
  OS0SW01.OS0SW-DELAY-DECR-FL = " ";
  OS0SW01.OS0SW-DECR-XOB-FL = " ";
  OS0SW01.OS0SW-DECR-PGM-FL = " ";
  OS0SW01.OS0SW-DB2-ERR-FL = "N";
  ;
  OS0SS-OPN-VOBPRI01(); /* open VOBPRI01 via IO7190*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful open*/
    OS0SW01.OS0SW-RETURN-FL = "N";
    ;
    while (OS0SW01.OS0SW-RETURN-FL == "N"
     && SQLCA.VAGen_SQLCODE == 0)
      OS0SS-NXT-VOBPRI01(); /* fetch next VOBPRI01 via IO7190*/
      ;
      if (SQLCA.VAGen_SQLCODE == 0) /* successful fetch*/
        OS0SS-SET-DELAY-FL(); /* set decrement delay flag*/
        OS0SS-SET-XOB-FL(); /* set decrement order type flag*/
        OS0SS-SET-PGM-FL(); /* set decrement sales prgm flag*/
        ;
        if (OS0SW01.OS0SW-DELAY-DECR-FL == "Y"
         || OS0SW01.OS0SW-DELAY-DECR-FL == "N")
          if (OS0SW01.OS0SW-DECR-XOB-FL == "Y"
           && OS0SW01.OS0SW-DECR-PGM-FL == "Y")
            OS0SW01.OS0SW-RETURN-FL = "Y";
          end
        end
      end
    end
    ;
    if (SQLCA.VAGen_SQLCODE != -911) /* cursor not closed with rollback*/
      OS0SS-CLS-VOBPRI01(); /* close VOBPRI01 via IO7190;*/
    end
  end
  ;
  if (OS0SW01.OS0SW-DB2-ERR-FL == "N")
    if (OS0SW01.OS0SW-DELAY-DECR-FL == " ")
      OS0SW01.OS0SW-DELAY-DECR-FL = "N";
    end
    ;
    if (OS0SW01.OS0SW-DECR-XOB-FL == " ")
      OS0SW01.OS0SW-DECR-XOB-FL = "N";
    end
    ;
    if (OS0SW01.OS0SW-DECR-PGM-FL == " ")
      OS0SW01.OS0SW-DECR-PGM-FL = "N";
    end
  end
  ;
  ;
end // end OS0SS-SET-PRI-DATA

// reset map attributes
Function OS0SS-SET-XOB-ATTR()
  ;
  ;
  set OS0SM100.OS0SM-CURR-PG initialAttributes;
  ;
  OS0SW01.OS0SW-SUB = 11;
  while (OS0SW01.OS0SW-SUB >= 1)
    set OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] cursor, normal;
    set OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB] normal;
    ;
    OS0SW02.OS0SW-TBL-SUB = OS0SW02.OS0SW-TBL-POS + OS0SW01.OS0SW-SUB;
    if (OS0SW02.XOBCD[OS0SW-TBL-SUB] == " ")
      set OS0SM100.XOBCD[OS0SW-SUB] normal;
    else
      set OS0SM100.XOBCD[OS0SW-SUB] initialAttributes;
    end
    ;
    OS0SW01.OS0SW-SUB = OS0SW01.OS0SW-SUB - 1;
  end
  ;
  ;
end // end OS0SS-SET-XOB-ATTR

// set decrement order type flag
Function OS0SS-SET-XOB-FL()
  ;
  ;
  if (VOBPRI01.XOBCD != "**" /* order type decrement row*/
   && VOBPRI01.XOBCD != " "  
   && OS0SW01.OS0SW-DECR-XOB-FL != "Y")
    OS0SW01.OS0SW-DECR-XOB-FL = VOBPRI01.OB-ALW-DECR-FL;
  end
  ;
  ;
end // end OS0SS-SET-XOB-FL

// update delay decrement flag
Function OS0SS-UPD-DELAY-FL()
  ;
  ;
  OS0SW01.OS0SW-DB2-ERR-FL = "N";
  ;
  OS0SW01.XOBCD = "**";
  OS0SW01.SP1ID = "****";
  ;
  if (OS0SM005.OS0SM-DELAY-DEC-FL == "N")
    OS0SW01.OB-ALW-DECR-FL = "Y";
  else
    OS0SW01.OB-ALW-DECR-FL = "N";
  end
  ;
  OS0SS-SEL-VOBPRI01(); /* select VOBPRI01 via IO7190*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful select*/
    OS0SW01.ZZZCHGCT = VOBPRI01.ZZZCHGCT;
    ;
    OS0SS-UPD-VOBPRI01(); /* update VOBPRI01 via IO7190*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* row not found*/
      OS0SS-ADD-VOBPRI01(); /* add VOBPRI01 via I07190*/
    end
  end
  ;
  if (OS0SW01.OS0SW-DB2-ERR-FL == "N")
    OS0SW01.OS0SW-DELAY-DECR-FL = OS0SM005.OS0SM-DELAY-DEC-FL;
  end
  ;
  ;
end // end OS0SS-UPD-DELAY-FL

// update vobpgm01 for ob2100
Function OS0SS-UPD-OBPGM-A()
  ;
  ;
  set SQLCA empty;
  set OB8REC empty;
  ;
  OB8REC.XXXPGMNO = "OB2100"; /* pgm number*/
  ;
  call "IO5220" ("S ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* update was successful*/
    /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0S";
      TA1REC.TA1LOC = "OS0SS-UPD-VOBPGM01 IO5220 U";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPGM01";
      TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
  set SQLCA empty;
  ;
  OB8REC.XXXPGMNO = "OB2100"; /* pgm number*/
  OB8REC.OP1PARTN = OS0SM005.OS0SM-TRUE-DEMAND-FL; /* true demand flag*/
  OB8REC.ZZZCHGDT = TA2REC.TA2GRGGN; /* new chg date*/
  OB8REC.ZZZCHGTM = TA2REC.TA2TIMHM; /* new chg time*/
  ;
  call "IO5220" ("U ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* update was successful*/
    /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0S";
      TA1REC.TA1LOC = "OS0SS-UPD-VOBPGM01 IO5220 U";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPGM01";
      TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0SS-UPD-OBPGM-A

// update vobpgm01 for ob2110
Function OS0SS-UPD-OBPGM-B()
  ;
  ;
  set SQLCA empty;
  set OB8REC empty;
  ;
  OB8REC.XXXPGMNO = "OB2110"; /* pgm number*/
  ;
  call "IO5220" ("S ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* update was successful*/
    /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0S";
      TA1REC.TA1LOC = "OS0SS-UPD-OBPGM-B IO5220 U";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPGM01";
      TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
  ;
  set SQLCA empty;
  ;
  OB8REC.XXXPGMNO = "OB2110"; /* pgm number*/
  OB8REC.OP1PARTN = OS0SM005.OS0SM-LAST-TRY-FL; /* last try flag*/
  OB8REC.OP1NORID = OS0SM005.OS0SM-DAYS-TO-PUSH; /* days-to-push*/
  OB8REC.ZZZCHGDT = TA2REC.TA2GRGGN; /* new chg date*/
  OB8REC.ZZZCHGTM = TA2REC.TA2TIMHM; /* new chg time*/
  ;
  call "IO5220" ("U ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* update was successful*/
    /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0S";
      TA1REC.TA1LOC = "OS0SS-UPD-OBPGM-B IO5220 U";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPGM01";
      TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0SS-UPD-OBPGM-B

// update xob priority data
Function OS0SS-UPD-PGM-DATA()
  ;
  ;
  OS0SW01.SP1ID = OS0SM200.SP1ID[OS0SW-SUB];
  OS0SW01.SP1NM = OS0SM200.SP1NM[OS0SW-SUB];
  OS0SW01.OB-ALW-DECR-FL = OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB];
  OS0SW01.ZZZCHGCT = OS0SW02.ZZZCHGCT[OS0SW-TBL-SUB];
  OS0SW01.XOBCD = " ";
  ;
  if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] == "A")
    OS0SS-ADD-VOBPRI01(); /* add VOBPRI01 via IO7190*/
  else
    if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] == "C")
      OS0SS-UPD-VOBPRI01(); /* update VOBPRI01 via IO7190*/
    else
      OS0SS-DEL-VOBPRI01(); /* delete VOBPRI01 via IO7190*/
    end
  end
  ;
  ;
end // end OS0SS-UPD-PGM-DATA

// update xob priority map row
Function OS0SS-UPD-PGM-MAP()
  ;
  ;
  if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] == "A")
    set OS0SM200.SP1ID[OS0SW-SUB] initialAttributes;
  else
    set OS0SM200.SP1ID[OS0SW-SUB] normal;
    ;
    if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] == "D")
      OS0SM200.SP1ID[OS0SW-SUB] = " ";
      OS0SM200.SP1NM[OS0SW-SUB] = " ";
      OS0SM200.OB-ALW-DECR-FL[OS0SW-SUB] = " ";
    end
  end
  ;
  OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] = " ";
  ;
  ;
end // end OS0SS-UPD-PGM-MAP

// update xob priority table row
Function OS0SS-UPD-PGM-TBL()
  ;
  ;
  if (OS0SM200.OS0SM-OPT-CD[OS0SW-SUB] != "D")
    OS0SW02.SP1ID[OS0SW-TBL-SUB] = OS0SW01.SP1ID;
    OS0SW02.SP1NM[OS0SW-TBL-SUB] = OS0SW01.SP1NM;
    OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB] = OS0SW01.OB-ALW-DECR-FL;
    OS0SW02.ZZZCHGCT[OS0SW-TBL-SUB] = OS0SW01.ZZZCHGCT;
  else
    OS0SW02.SP1ID[OS0SW-TBL-SUB] = " ";
    OS0SW02.SP1NM[OS0SW-TBL-SUB] = " ";
    OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB] = " ";
    OS0SW02.ZZZCHGCT[OS0SW-TBL-SUB] = 0;
  end
  ;
  ;
end // end OS0SS-UPD-PGM-TBL

// update VOBPRI01 via IO7190
Function OS0SS-UPD-VOBPGM01()
  ;
  ;
  set SQLCA empty;
  set OB8REC empty;
  ;
  OB8REC.XXXPGMNO = "OB1070"; /* pgm number*/
  ;
  call "IO5220" ("S ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* update was successful*/
    /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0S";
      TA1REC.TA1LOC = "OS0SS-UPD-VOBPGM01 IO5220 U";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPGM01";
      TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
  set SQLCA empty;
  ;
  OB8REC.XXXPGMNO = "OB1070"; /* pgm number*/
  OB8REC.OP1PARTN = OS0SM005.OS0SM-DEADWEEK-FL; /* deadweek flag*/
  OB8REC.ZZZCHGDT = TA2REC.TA2GRGGN; /* new chg date*/
  OB8REC.ZZZCHGTM = TA2REC.TA2TIMHM; /* new chg time*/
  ;
  call "IO5220" ("U ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* update was successful*/
    /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(10);
    else
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0S";
      TA1REC.TA1LOC = "OS0SS-UPD-VOBPGM01 IO5220 U";
      TA1REC.TA1DBASE = "DORDB  ";
      TA1REC.TA1TBLVU = "VOBPGM01";
      TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0SS-UPD-VOBPGM01

// update VOBPRI01 via IO7190
Function OS0SS-UPD-VOBPRI01()
  ;
  ;
  set SQLCA empty;
  set VOBPRI01 empty;
  ;
  VOBPRI01.XOBCD = OS0SW01.XOBCD;
  VOBPRI01.SP1ID = OS0SW01.SP1ID;
  VOBPRI01.OB-ALW-DECR-FL = OS0SW01.OB-ALW-DECR-FL;
  VOBPRI01.ZZZCHGDT = TA2REC.TA2GRGGN;
  VOBPRI01.ZZZCHGTM = TA2REC.TA2TIMHM;
  VOBPRI01.ZZZCHGCT = OS0SW01.ZZZCHGCT;
  ;
  call "IO7190" ("U ", SQLCA, VOBPRI01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* update was successful*/
    OS0SW01.ZZZCHGCT = OS0SW01.ZZZCHGCT + 1;
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* row not found for update*/
      OS0SW01.OS0SW-DB2-ERR-FL = "Y";
      converseLib.validationFailed(860);
    else
      if (SQLCA.VAGen_SQLCODE == -911) /* database is busy*/
        OS0SW01.OS0SW-DB2-ERR-FL = "Y";
        converseLib.validationFailed(10);
      else
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0Q";
        TA1REC.TA1LOC = "OS0QS-UPD-VOBPRI01 IO7190 U";
        TA1REC.TA1DBASE = "DORDB  ";
        TA1REC.TA1TBLVU = "VOBPRI01";
        TA1REC.TA1TBLKE = VOBPRI01.VOBPRI01-KEY;
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0SS-UPD-VOBPRI01

// update xob priority data
Function OS0SS-UPD-XOB-DATA()
  ;
  ;
  OS0SW01.XOBCD = OS0SM100.XOBCD[OS0SW-SUB];
  OS0SW01.XOBDESC = OS0SM100.XOBDESC[OS0SW-SUB];
  OS0SW01.OB-ALW-DECR-FL = OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB];
  OS0SW01.ZZZCHGCT = OS0SW02.ZZZCHGCT[OS0SW-TBL-SUB];
  OS0SW01.SP1ID = " ";
  ;
  if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] == "A")
    OS0SS-ADD-VOBPRI01(); /* add VOBPRI01 via IO7190*/
  else
    if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] == "C")
      OS0SS-UPD-VOBPRI01(); /* update VOBPRI01 via IO7190*/
    else
      OS0SS-DEL-VOBPRI01(); /* delete VOBPRI01 via IO7190*/
    end
  end
  ;
  ;
end // end OS0SS-UPD-XOB-DATA

// update xob priority map row
Function OS0SS-UPD-XOB-MAP()
  ;
  ;
  if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] == "A")
    set OS0SM100.XOBCD[OS0SW-SUB] initialAttributes;
  else
    set OS0SM100.XOBCD[OS0SW-SUB] normal;
    ;
    if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] == "D")
      OS0SM100.XOBCD[OS0SW-SUB] = " ";
      OS0SM100.XOBDESC[OS0SW-SUB] = " ";
      OS0SM100.OB-ALW-DECR-FL[OS0SW-SUB] = " ";
    end
  end
  ;
  OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] = " ";
  ;
  ;
end // end OS0SS-UPD-XOB-MAP

// update xob priority table row
Function OS0SS-UPD-XOB-TBL()
  ;
  ;
  if (OS0SM100.OS0SM-OPT-CD[OS0SW-SUB] != "D")
    OS0SW02.XOBCD[OS0SW-TBL-SUB] = OS0SW01.XOBCD;
    OS0SW02.XOBDESC[OS0SW-TBL-SUB] = OS0SW01.XOBDESC;
    OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB] = OS0SW01.OB-ALW-DECR-FL;
    OS0SW02.ZZZCHGCT[OS0SW-TBL-SUB] = OS0SW01.ZZZCHGCT;
  else
    OS0SW02.XOBCD[OS0SW-TBL-SUB] = " ";
    OS0SW02.XOBDESC[OS0SW-TBL-SUB] = " ";
    OS0SW02.OB-ALW-DECR-FL[OS0SW-TBL-SUB] = " ";
    OS0SW02.ZZZCHGCT[OS0SW-TBL-SUB] = 0;
  end
  ;
  ;
end // end OS0SS-UPD-XOB-TBL

Function OS0SS-VOBPGM01-A()
  ;
  ;
  set SQLCA empty;
  set OB8REC empty;
  ;
  OB8REC.XXXPGMNO = "OB2100"; /* program number for true demand*/
  ;
  call "IO5220" ("S ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful select*/
    OS0SW01.OS0SW-TRUE-DEMAND-FL = OB8REC.OP1PARTN;
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* successful select*/
      OS0SW01.OS0SW-TRUE-DEMAND-FL = "N";
    else
      if (SQLCA.VAGen_SQLCODE == -911) /* database busy*/
        OS0SW01.OS0SW-DB2-ERR-FL = "Y";
        converseLib.validationFailed(10);
      else
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0S";
        TA1REC.TA1LOC = "OS0SS-VOBPGM01-A IO5220 S";
        TA1REC.TA1DBASE = "DORDB  ";
        TA1REC.TA1TBLVU = "VOBPGM01";
        TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0SS-VOBPGM01-A

Function OS0SS-VOBPGM01-B()
  ;
  ;
  set SQLCA empty;
  set OB8REC empty;
  ;
  OB8REC.XXXPGMNO = "OB2110"; /* program number for true demand decrem*/
  ;
  call "IO5220" ("S ", SQLCA, OB8REC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* successful select*/
    OS0SW01.OS0SW-LAST-TRY-FL = OB8REC.OP1PARTN;
    OS0SW01.OS0SW-DAYS-TO-PUSH = OB8REC.OP1NORID;
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* successful select*/
      OS0SW01.OS0SW-TRUE-DEMAND-FL = "N";
      OS0SW01.OS0SW-DAYS-TO-PUSH = 0;
    else
      if (SQLCA.VAGen_SQLCODE == -911) /* database busy*/
        OS0SW01.OS0SW-DB2-ERR-FL = "Y";
        converseLib.validationFailed(10);
      else
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0S";
        TA1REC.TA1LOC = "OS0SS-VOBPGM01-B IO5220 S";
        TA1REC.TA1DBASE = "DORDB  ";
        TA1REC.TA1TBLVU = "VOBPGM01";
        TA1REC.TA1TBLKE = OB8REC.XXXPGMNO;
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0SS-VOBPGM01-B

Record OS0SW01 type basicRecord
  10 OS0SW-ERR-MSG-NBR OS0SW-ERR-MSG-NBR ; 
  10 OS0SW-UPD-MAP-FL OS0SW-UPD-MAP-FL ; 
  10 OS0SW-UPD-DATA-FL OS0SW-UPD-DATA-FL ; 
  10 OS0SW-DEADWEEK-FL OS0SW-DEADWEEK-FL ; 
  10 OS0SW-DELAY-DECR-FL OS0SW-DELAY-DECR-FL ; 
  10 OS0SW-DECR-XOB-FL OS0SW-DECR-XOB-FL ; 
  10 OS0SW-DECR-PGM-FL OS0SW-DECR-PGM-FL ; 
  10 OS0SW-TRUE-DEMAND-FL OS0SW-TRUE-DEMAND-FL ; 
  10 OS0SW-DAYS-TO-PUSH OS0SW-DAYS-TO-PUSH ; 
  10 OS0SW-LAST-TRY-FL OS0SW-LAST-TRY-FL ; 
  10 OS0SW-MAP-ERR-FL OS0SW-MAP-ERR-FL ; 
  10 OS0SW-TBL-ERR-FL OS0SW-TBL-ERR-FL ; 
  10 OS0SW-DATA-CHG-FL OS0SW-DATA-CHG-FL ; 
  10 OS0SW-DB2-ERR-FL OS0SW-DB2-ERR-FL ; 
  10 OS0SW-RETURN-FL OS0SW-RETURN-FL ; 
  10 OS0SW-ADD-XOB-FL OS0SW-ADD-XOB-FL ; 
  10 OS0SW-ADD-PGM-FL OS0SW-ADD-PGM-FL ; 
  10 OS0SW-DEL-XOB-FL OS0SW-DEL-XOB-FL ; 
  10 OS0SW-DEL-PGM-FL OS0SW-DEL-PGM-FL ; 
  10 OS0SW-MIN-REC OS0SW-MIN-REC ; 
  10 OS0SW-MAX-REC OS0SW-MAX-REC ; 
  10 OS0SW-REC-CNT OS0SW-REC-CNT ; 
  10 OS0SW-TBL-POS OS0SW-TBL-POS ; 
  10 OS0SW-CURR-PG OS0SW-CURR-PG ; 
  10 OS0SW-LAST-PG OS0SW-LAST-PG ; 
  10 OS0SW-REMAIN OS0SW-REMAIN ; 
  10 XOBCD XOBCD ; 
  10 XOBDESC XOBDESC ; 
  10 SP1ID SP1ID ; 
  10 SP1NM SP1NM ; 
  10 OB-ALW-DECR-FL OB-ALW-DECR-FL ; 
  10 ZZZCHGCT ZZZCHGCT ; 
  10 OS0SW-SUB OS0SW-SUB ; 
end // end OS0SW01

Record OS0SW02 type basicRecord
  10 OS0SW-EOF-FL OS0SW-EOF-FL ; 
  10 OS0SW-TBL-SUB OS0SW-TBL-SUB ; 
  10 OS0SW-REC-CNT OS0SW-REC-CNT ; 
  10 OS0SW-REC-TTL OS0SW-REC-TTL ; 
  10 OS0SW-TBL-POS OS0SW-TBL-POS ; 
  10 OS0SW-DECR-TABLE OS0SW-DECR-TABLE [110] ; 
    15 XOBCD XOBCD ; 
    15 XOBDESC XOBDESC ; 
    15 SP1ID SP1ID ; 
    15 SP1NM SP1NM ; 
    15 OB-ALW-DECR-FL OB-ALW-DECR-FL ; 
    15 ZZZCHGCT ZZZCHGCT ; 
end // end OS0SW02

Record VOBPRI01 type basicRecord
  5 VOBPRI01-GROUP VOBPRI01-GROUP ; 
    10 VOBPRI01-KEY VOBPRI01-KEY ; 
      15 XOBCD XOBCD ; 
      15 SP1ID SP1ID ; 
    10 OB-ALW-DECR-FL OB-ALW-DECR-FL ; 
    10 ZZZSDT ZZZSDT ; 
    10 ZZZCHGDT ZZZCHGDT ; 
    10 ZZZCHGTM ZZZCHGTM ; 
    10 ZZZCHGCT ZZZCHGCT ; 
end // end VOBPRI01

// ob_alw_decr_fl
DataItem OB-ALW-DECR-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// add sales prgm criteria flag
DataItem OS0SW-ADD-PGM-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// add order type criteria flag
DataItem OS0SW-ADD-XOB-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// current xob page
DataItem OS0SW-CURR-PG smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// data change flag
DataItem OS0SW-DATA-CHG-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// days to push
DataItem OS0SW-DAYS-TO-PUSH smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// db2 error flag
DataItem OS0SW-DB2-ERR-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// deadweek flag
DataItem OS0SW-DEADWEEK-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// decrement sales prgm flag
DataItem OS0SW-DECR-PGM-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// xob data table
DataItem OS0SW-DECR-TABLE char(59)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// decrement order type flag
DataItem OS0SW-DECR-XOB-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// delete sls prgm criteria flag
DataItem OS0SW-DEL-PGM-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// delete ord type criteria flag
DataItem OS0SW-DEL-XOB-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// delay airspeed decrement flag
DataItem OS0SW-DELAY-DECR-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// end of fetch flag
DataItem OS0SW-EOF-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// error message nbr
DataItem OS0SW-ERR-MSG-NBR smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

DataItem OS0SW-LAST-PG smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// last try flag
DataItem OS0SW-LAST-TRY-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// map error flag
DataItem OS0SW-MAP-ERR-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// maximum xob record count
DataItem OS0SW-MAX-REC smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// minimum xob record count
DataItem OS0SW-MIN-REC smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// xob record count
DataItem OS0SW-REC-CNT smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// xob record total
DataItem OS0SW-REC-TTL smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// remainder
DataItem OS0SW-REMAIN smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// return flag
DataItem OS0SW-RETURN-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// map subscript
DataItem OS0SW-SUB smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// table error flag
DataItem OS0SW-TBL-ERR-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// spgm table position
DataItem OS0SW-TBL-POS smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// xob array subscript
DataItem OS0SW-TBL-SUB smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// process true demand flag
DataItem OS0SW-TRUE-DEMAND-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// update data flag
DataItem OS0SW-UPD-DATA-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// update map flag
DataItem OS0SW-UPD-MAP-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem VOBPRI01-GROUP char(19)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem VOBPRI01-KEY char(6)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

