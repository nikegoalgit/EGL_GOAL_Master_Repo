package os0m;
import corpcom4.XSENTRY;
import corpcom4.XSEXIT;
import corpcom4.XSPF4;
import corpcom4.XSSEGTR;
import corpcom5.COMMAREA;
import corpcom5.ERRSQLCA;
import corpcom6.SQLCA;
import ku.common.KUCREC;
import ku.common.KUKREC;
import op.common.*;
import os.common.OSRREC;
import os.common.OSWWREC;
import ta.common.TA1REC;
import ta.common.TA2REC;
import ta.common.TA5REC;
import ta.common.TAEREC;
import vv.common.VBASGN01;
import xx.common.*;
import xx02.*;
import xx02.XGPTBL;
import xx05.*;
import xx05.XSOTBL;
//*** PROGRAM=OS0M ****
// OVERVIEW:
// POSSIBLE STATEMENT GROUP MEANINGS:
//    OS0MS-ADD-X  Add Record
//    OS0MS-GET-X  Select Record
//    OS0MS-BLD-X  Build Record
//    OS0MS-EDT-X  Edit Record
//    OS0MS-FMT-X  Format Record
//    OS0MS-UPD-X  Update Record
//    OS0MS-LOAD-X Load Process
// 
// **  statement group naming is flexible and may not have
//     any meaning especially after several enhancements.
// 
// ********************************************************
// *     M A I N T E N A N C E     L O G                  *
// ********************************************************
// *
// * DATE        NAME          DESCRIPTION OF CHANGE
// *
// * 04/18/94   SCHASE     Created.
// * 11/29/94   CBRINE     Added OSWW-MSG-NBR to OSWWREC.
// * 02/13/95   SCHASE     Made GPC Code required for entry.
// *                       OS0MS-EDT-GPC-CD, OS0MM001, OS0MS-
// *                       EDT-MAP.
// * 11/25/97   klee       added change to key
// *********************
Program OS0M type textUIProgram //VAGen Info - main text program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes, 
  msgTablePrefix = "OP00", inputRecord = COMMAREA, segmented = yes
  }

  // Data Declarations
  COMMAREA COMMAREA ; // record
  ERRSQLCA ERRSQLCA; // record
  KUCREC KUCREC; // record
  KUKREC KUKREC; // record
  OS0MW01 OS0MW01; // record
  OSRREC OSRREC; // record
  OSWWREC OSWWREC; // record
  SQLCA SQLCA; // record
  TA1REC TA1REC; // record
  TA2REC TA2REC; // record
  TA5REC TA5REC; // record
  TAEREC TAEREC; // record
  VBASGN01 VBASGN01; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use XGPTBL {deleteAfterUse = yes}; // table
  use XSOTBL {deleteAfterUse = yes}; // table
  use OS0MM.OS0MM001 // form
   {
    pfKeyEquate = no
  };

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    OS0M000: OS0M000();
    goto OS0M010;
    OS0M010: OS0M010();
    goto OS0M010;
  end // end main
end // end OS0M

// main execute process
Function OS0M000()
     /* Check csp security*/
  ;
  XSENTRY();
  XSSEGTR(); /* set segmented tran id*/
  ;
     /* Initialize application - init records, get zz date/time,*/
                              /* save map name for diagnostics*/
  OS0MS-INIT-OS0M();
  ;
  ;
     /* Display commarea message*/
  ;
  OS0MM001.CAMSG = OSWWREC.CAMSG;
  OSWWREC.CAMSG = " ";
  ;
  ;
     /* Build map for display*/
  ;
  OS0MS-BLD-MAP();
  ;
  ;
  ;
end // end OS0M000

// converse/ after process
Function OS0M010()
  ;
  converseLib.clearScreen();
   /* set map to scroll properly*/
  converseVar.segmentedMode = 1; /* force segmented converse mode*/
  ;
  converse OS0MM001 ;
  ;
     /* Init error stuff*/
  ;
  OSWWREC.OSWWERFL = "N";
  converseLib.validationFailed(0);
  OS0MM001.CAMSG = " ";
  ;
  ;
     /* Reset field attributes*/
  ;
  OS0MS-RESET-ATTRIB();
  ;
  ;
     /* Edit map*/
  ;
  if (converseVar.eventKey is enter /* continue*/
   || converseVar.eventKey is pf12) /* edit only*/
    OS0MS-EDT-MAP();
  end
  ;
  ;
     /* Update map*/
  ;
  if (converseVar.eventKey is enter) /* continue*/
    if (OSWWREC.OSWWERFL == "N") /* no errors*/
      if (OS0MW01.OS0MW-CHG-FLAG == "Y") /* fields changed*/
        OS0MS-UPD-MAP(); /* update vbasgn01 db rec*/
      end
    end
  end
  ;
  ;
     /* Transfer control to another application*/
  ;
  OS0MS-TRNSFR-CNTL(); /* transfer to requested application.*/
  ;
  ;
end // end OS0M010

// ADD NEW VBASGN01 RECORD
Function OS0MS-ADD-VBASGN01()
  ;
  ;
  set SQLCA empty;
  ;
  call "IO7200" ("A ", SQLCA, VBASGN01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0)
   /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == -911)
      OSWWREC.OSWWERFL = "Y";
      converseLib.validationFailed(010); /* database busy*/
    else
      if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
        OS0MS-PRG-TMP-STOR(); /* purge os0l temp storage*/
      end
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0M";
      TA1REC.TA1LOCAT[1] = "OS0MS-UP";
      TA1REC.TA1LOCAT[2] = "D-VBASGN";
      TA1REC.TA1LOCAT[3] = "01 A    ";
      TA1REC.TA1LOCAT[4] = "IO7200  ";
      TA1REC.TA1DBASE = "DORDB   ";
      TA1REC.TA1TBLVU = "VBASGN01";
      TA1REC.TA1TBLKE = VBASGN01.OB-BULK-ASGN-ID;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0MS-ADD-VBASGN01

// BUILD OS0M MAP
Function OS0MS-BLD-MAP()
  ;
     /* build map headings*/
  ;
  OS0MS-FMT-HEADINGS();
  ;
    /* display existing bulk assignment id*/
  ;
  if (OSWWREC.OB-BULK-ASGN-ID != " ") /* if bulk asgnmnt id exists*/
    OS0MW01.OS0MW-MAINT-CD = "C"; /* change maint code*/
    OS0MS-GET-VBASGN01(); /* select from vbasgn01*/
    OS0MS-LOAD-MAP(); /* load values to map*/
  else
    OS0MW01.OS0MW-MAINT-CD = "A"; /* add maint code*/
    OS0MS-LOAD-MAP(); /* load values to map*/
  end
  ;
     /* reset field attributes*/
  ;
  OS0MS-RESET-ATTRIB();
  ;
  ;
end // end OS0MS-BLD-MAP

// MMDDYY TO COMP - NO VALIDATE
Function OS0MS-CCYYMMDD-MAP()
    /* convert CCYYMMDD date to display MMDDYY for map*/
  ;
  ;
  ;
   /* the calling stmt group must move the CCYYMMDD date*/
   /* to OSWWREC.OSWWDT8 before entering this routine*/
  ;
  if (OSWWREC.OSWWDT8 == 0)
    OSWWREC.OSWWDT6 = 0;
    return;
  end
  ;
  ;
  OSWWREC.OSWWDT6Y = OSWWREC.OSWWDT8Y;
  OSWWREC.OSWWDT6M = OSWWREC.OSWWDT8M;
  OSWWREC.OSWWDT6D = OSWWREC.OSWWDT8D;
  ;
   /* the calling stmt group needs to move*/
   /* OSWWREC.OSWWDT6 to the map field.*/
  ;
end // end OS0MS-CCYYMMDD-MAP

// ADD NEW VBASGN01 RECORD
Function OS0MS-DLT-VBASGN01()
  ;
  ;
  set SQLCA empty;
  ;
  call "IO7200" ("D ", SQLCA, VBASGN01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0)
   /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == -911)
      OSWWREC.OSWWERFL = "Y";
      converseLib.validationFailed(010); /* database busy*/
    else
      if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
        OS0MS-PRG-TMP-STOR(); /* purge os0l temp storage*/
      end
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0M";
      TA1REC.TA1LOCAT[1] = "OS0MS-DE";
      TA1REC.TA1LOCAT[2] = "D-VBASGN";
      TA1REC.TA1LOCAT[3] = "01 A    ";
      TA1REC.TA1LOCAT[4] = "IO7200  ";
      TA1REC.TA1DBASE = "DORDB   ";
      TA1REC.TA1TBLVU = "VBASGN01";
      TA1REC.TA1TBLKE = VBASGN01.OB-BULK-ASGN-ID;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0MS-DLT-VBASGN01

// EDIT BULK ASGNMNT DESCRIPTION
Function OS0MS-EDT-BA-DESC()
  ;
  if (OS0MM001.OB-BULK-ASGN-DESC == " ") /* check for spaces*/
    converseLib.validationFailed(852); /* description is required*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-BULK-ASGN-DESC cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-BA-DESC

// EDIT BULK ASGNMNT ID
Function OS0MS-EDT-BA-ID()
  ;
  if (OS0MM001.OB-BULK-ASGN-ID == " ") /* check for spaces*/
    converseLib.validationFailed(853); /* id is required*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-BULK-ASGN-ID cursor, bold;
  end
  ;
  OS0MW01.OS0MW-OLD-OB-BULK-ASGN-ID = OSWWREC.OB-BULK-ASGN-ID;
  OSWWREC.OB-BULK-ASGN-ID = OS0MM001.OB-BULK-ASGN-ID;
  ;
  OS0MS-GET-VBASGN01(); /* verify if already exists*/
  if (SQLCA.VAGen_SQLCODE == 0)
    converseLib.validationFailed(865); /* bulk asgnmnt id already exists*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-BULK-ASGN-ID cursor, bold;
    VBASGN01.OB-BULK-ASGN-ID = " "; /* clear vbasgn01 record for edit*/
  end
  ;
  ;
end // end OS0MS-EDT-BA-ID

// EDIT BEGINNING NEED DATE
Function OS0MS-EDT-BEG-NEED()
  ;
  ;
    /* verify date is a valid date*/
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-NEED-DRAW-BDT; /* frmt oswwrec MMDDYY*/
  ;
  OS0MS-VALIDATE-DT(); /* validate date*/
  ;
  if (TA2REC.TA2RTNCD == 0) /* good return*/
    VBASGN01.OB-NEED-DRAW-BDT = OSWWREC.OSWWDT8; /* frmt begin date*/
  else
    set OS0MM001.OB-NEED-DRAW-BDT cursor, bold;
  end
  ;
    /* verify that both need dates were entered*/
  ;
  if (OS0MM001.OB-NEED-DRAW-XDT == 0
   || OS0MM001.OB-NEED-DRAW-XDT == "MMDDYY")
    converseLib.validationFailed(861); /* missing need date for range*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-NEED-DRAW-XDT cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-BEG-NEED

// EDIT GROUP/PARENT/COMPNY COMBO
Function OS0MS-EDT-CU-COMBO()
  ;
    /* verify that atleast one group/parent/company was entered*/
  ;
  if (OS0MM001.KUCGRPID == 0
   && OS0MM001.KUKPCOID == 0
   && OS0MM001.KUCCOID == 0)
    converseLib.validationFailed(855); /* Atleast one group/parent/company*/
    OSWWREC.OSWWERFL = "Y"; /* is required*/
    set OS0MM001.KUCGRPID cursor, bold;
    set OS0MM001.KUKPCOID bold;
    set OS0MM001.KUCCOID bold;
    return;
  end
  ;
end // end OS0MS-EDT-CU-COMBO

// EDIT EFFECTIVE BEGIN DATE
Function OS0MS-EDT-EFF-BEG()
  ;
    /* verify beginning effective date is a valid date*/
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-BULK-ASGN-EBDT; /* frmt oswwrec MMDDYY*/
  OS0MM001.OB-BULK-ASGN-EBDT = OSWWREC.OSWWDT6; /* apply date to map*/
  ;
  OS0MS-VALIDATE-DT(); /* validate date*/
  ;
  if (TA2REC.TA2RTNCD == 0) /* good return*/
    VBASGN01.OB-BULK-ASGN-EBDT = OSWWREC.OSWWDT8; /* frmt ending date*/
  else
    set OS0MM001.OB-BULK-ASGN-EBDT cursor, bold;
  end
  ;
    /* edit beginning effective date*/
  ;
  if (OS0MM001.OB-BULK-ASGN-EBDT == 0 /* no beginning eff date enterd*/
   || OS0MM001.OB-BULK-ASGN-EBDT == "MMDDYY")
    converseLib.validationFailed(854); /* eff date is required*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-BULK-ASGN-EBDT cursor, bold;
    return;
  end
  ;
    /* edit beginning effective date prior to current date*/
  ;
  OS0MS-GET-CURR-DTE(); /* get current date for compare*/
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-BULK-ASGN-EBDT;
  OS0MS-MMDDYY-COMP(); /* convert date for compare*/
  ;
  if (OSWWREC.OSWWDT8 < TA2REC.TA2GRGGN) /* less than current date*/
    converseLib.validationFailed(872); /* eff beg date cannot be less than current date*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-BULK-ASGN-EBDT cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-EFF-BEG

// EDIT EFFECTIVE END DATE
Function OS0MS-EDT-EFF-END()
  ;
    /* verify ending effective date is a valid date*/
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-BULK-ASGN-EXDT; /* frmt oswwrec MMDDYY*/
  OS0MM001.OB-BULK-ASGN-EXDT = OSWWREC.OSWWDT6; /* apply date to map*/
  ;
  OS0MS-VALIDATE-DT(); /* validate date*/
  ;
  if (TA2REC.TA2RTNCD == 0) /* good return*/
    VBASGN01.OB-BULK-ASGN-EXDT = OSWWREC.OSWWDT8; /* frmt ending date*/
  else
    set OS0MM001.OB-BULK-ASGN-EXDT cursor, bold;
  end
  ;
    /* edit ending effective date*/
  ;
  if (OS0MM001.OB-BULK-ASGN-EXDT == 0 /* no ending eff date entered*/
   || OS0MM001.OB-BULK-ASGN-EXDT == "MMDDYY")
    converseLib.validationFailed(854); /* eff date is required*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-BULK-ASGN-EXDT cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-EFF-END

// EDIT EFFECTIVE DATE RANGE
Function OS0MS-EDT-EFF-RNG()
  ;
  ;
    /* edit beginning and ending date ranges*/
  ;
  if (VBASGN01.OB-BULK-ASGN-EXDT >= VBASGN01.OB-BULK-ASGN-EBDT)
                                          /* if end date > or = begin date*/
     /* next sentence*/
  else
    converseLib.validationFailed(850); /* ending date must be > or = to beginning date*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-BULK-ASGN-EXDT cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-EFF-RNG

// EDIT ENDING NEED DATE
Function OS0MS-EDT-END-NEED()
  ;
  ;
    /* verify date is a valid date*/
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-NEED-DRAW-XDT; /* frmt oswwrec MMDDYY*/
  ;
  OS0MS-VALIDATE-DT(); /* validate date*/
  ;
  if (TA2REC.TA2RTNCD == 0) /* good return*/
    VBASGN01.OB-NEED-DRAW-XDT = OSWWREC.OSWWDT8; /* frmt ending date*/
  else
    set OS0MM001.OB-NEED-DRAW-XDT cursor, bold;
  end
  ;
    /* verify that both need dates were entered*/
  ;
  if (OS0MM001.OB-NEED-DRAW-BDT == 0
   || OS0MM001.OB-NEED-DRAW-BDT == "MMDDYY")
    converseLib.validationFailed(861); /* missing need date for range*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-NEED-DRAW-BDT cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-END-NEED

// EDIT FUTURES ONLY FLAG
Function OS0MS-EDT-FUTR-FL()
  ;
  if (OS0MM001.XOTFUTRF == "Y"
   || OS0MM001.XOTFUTRF == "N")
     /* next sentence*/
  else
    converseLib.validationFailed(848); /* the correct response is 'y' or 'n'*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.XOTFUTRF cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-FUTR-FL

// EDIT GENERAL PRODUCT CODE
Function OS0MS-EDT-GPC-CD()
  ;
  if (OS0MM001.XGPCD == " ") /* no gpc entered to edit*/
    converseLib.validationFailed(483); /* GPC CODE IS REQUIRED*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.XGPCD cursor, bold;
    return;
  end
  ;
  if (OS0MM001.XGPCD in XGPTBL.XGPCD /* if gpc is on tbl*/
   && XGPTBL.XXXSTAT[sysVar.arrayIndex] == "A") /* and is a active status*/
     /* next sentence*/
  else
    converseLib.validationFailed(847); /* GPC code is invalid or inactive*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.XGPCD cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-GPC-CD

// EDIT CUSTOMER ID
Function OS0MS-EDT-KUCCOID()
  ;
    /* verify company exists*/
  ;
  OS0MS-GET-KUCREC2(); /* select company*/
  ;
    /* edit for other entries*/
  ;
  if (OS0MM001.KUCGRPID > 0) /* company group also entered*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    converseLib.validationFailed(834); /* mult selections not allowed*/
    set OS0MM001.KUCCOID cursor, bold;
  end
  ;
  if (OS0MM001.KUKPCOID > 0) /* parent company also entered*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    converseLib.validationFailed(834); /* mult selections not allowed*/
    set OS0MM001.KUCCOID cursor, bold;
  end
  ;
end // end OS0MS-EDT-KUCCOID

// EDIT COMPANY GROUP ID
Function OS0MS-EDT-KUCGRPID()
  ;
    /* verify company group exists*/
  ;
  OS0MS-GET-KUCREC1(); /* select company group id*/
  ;
    /* edit for other entries*/
  ;
  if (OS0MM001.KUKPCOID > 0) /* parent company also entered*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    converseLib.validationFailed(834); /* mult selections not allowed*/
    set OS0MM001.KUCGRPID cursor, bold;
  end
  ;
  if (OS0MM001.KUCCOID > 0) /* company also entered*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    converseLib.validationFailed(834); /* mult selections not allowed*/
    set OS0MM001.KUCGRPID cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-KUCGRPID

// EDIT PARENT COMPANY ID
Function OS0MS-EDT-KUKPCOID()
  ;
    /* verify parent company exists*/
  ;
  OS0MS-GET-KUKREC(); /* select parent company*/
  ;
    /* edit for other entries*/
  ;
  if (OS0MM001.KUCGRPID > 0) /* company group also entered*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    converseLib.validationFailed(834); /* mult selections not allowed*/
    set OS0MM001.KUKPCOID cursor, bold;
  end
  ;
  if (OS0MM001.KUCCOID > 0) /* company also entered*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    converseLib.validationFailed(834); /* mult selections not allowed*/
    set OS0MM001.KUKPCOID cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-KUKPCOID

// EDIT OS0MM001 MAP
Function OS0MS-EDT-MAP()
  ;
  OS0MW01.OS0MW-CHG-FLAG = "N"; /* init change flag*/
  OS0MW01.OS0MW-UPD-TEMP = "N"; /* init upd temp stor*/
  ;
    /* Edit Ending Need Date*/
  ;
  if (OS0MM001.OB-NEED-DRAW-XDT == 0
   || OS0MM001.OB-NEED-DRAW-XDT == "MMDDYY"
  ) /* next sentence*/
  else
    OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
    OS0MS-EDT-END-NEED();
  end
  ;
    /* Edit Beginning Need Date*/
  ;
  if (OS0MM001.OB-NEED-DRAW-BDT == 0
   || OS0MM001.OB-NEED-DRAW-BDT == "MMDDYY"
  ) /* next sentence*/
  else
    OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
    OS0MS-EDT-BEG-NEED();
  end
  ;
    /* edit need dates for valid range*/
  ;
  OS0MS-EDT-NEED-RNG();
  ;
    /* Edit Sales Office Code*/
  ;
  if (OS0MM001.XSOCD != VBASGN01.XSOCD) /* xso changed*/
    OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
    OS0MS-EDT-XSO-CD();
  end
  ;
    /* Edit XOT Future Flag*/
  ;
  if (OS0MM001.XOTFUTRF != VBASGN01.XOTFUTRF) /* future flag chgd*/
    OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
    OS0MS-EDT-FUTR-FL();
  end
  ;
    /* Edit XOT Prop Flag*/
  ;
  if (OS0MM001.XOTPROPF != VBASGN01.XOTPROPF) /* prop flag chgd*/
    OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
    OS0MS-EDT-PROP-FL();
  end
  ;
    /* edit xot prop vs. future flags*/
  ;
  OS0MS-EDT-XOT-CMBO(); /* edit prop vs future*/
  ;
    /* Edit GPC Code*/
  ;
  OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
  OS0MS-EDT-GPC-CD(); /* edit GPC Required*/
  ;
    /* validate company*/
  ;
  if (OS0MM001.KUCCOID > 0) /* company exists*/
    if (OS0MM001.KUCCOID != VBASGN01.KUCCOID) /* and has changed*/
      OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
      OS0MS-EDT-KUCCOID(); /* verify company exists*/
    end
  end
  ;
  ;
    /* validate parent company*/
  ;
  if (OS0MM001.KUKPCOID > 0) /* parent company exists*/
    if (OS0MM001.KUKPCOID != VBASGN01.KUKPCOID) /* and has changed*/
      OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
      OS0MS-EDT-KUKPCOID(); /* verify parent comp exist*/
    end
  end
  ;
  ;
    /* validate customer group*/
  ;
  if (OS0MM001.KUCGRPID > 0) /* customer group exists*/
    if (OS0MM001.KUCGRPID != VBASGN01.KUCGRPID) /* and has changed*/
      OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
      OS0MS-EDT-KUCGRPID(); /* verify cust grp exists*/
    end
  end
  ;
    /* edit group/parent/company combination for atleast one entered*/
  ;
  OS0MS-EDT-CU-COMBO();
  ;
    /* validate status code*/
  ;
  if (OS0MM001.XXX-STAT != VBASGN01.XXX-STAT) /* status changed*/
    OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
    OS0MW01.OS0MW-UPD-TEMP = "Y"; /* update temp storage*/
    OS0MS-EDT-XXX-STAT(); /* edit status code*/
  end
  ;
    /* validate effective dates*/
  ;
  OSWWREC.OSWWDT8 = VBASGN01.OB-BULK-ASGN-EXDT;
  OS0MS-CCYYMMDD-MAP(); /* convert to mmddyy*/
  if (OS0MM001.OB-BULK-ASGN-EXDT != OSWWREC.OSWWDT6
   || OS0MM001.OB-BULK-ASGN-EXDT == 0
   || OS0MM001.OB-BULK-ASGN-EXDT == "MMDDYY")
    OS0MW01.OS0MW-UPD-TEMP = "Y"; /* set upd temp storage*/
    OS0MS-EDT-EFF-END(); /* effective end date*/
  end
  ;
  OSWWREC.OSWWDT8 = VBASGN01.OB-BULK-ASGN-EBDT;
  OS0MS-CCYYMMDD-MAP(); /* convert to mmddyy*/
  if (OS0MM001.OB-BULK-ASGN-EBDT != OSWWREC.OSWWDT6
   || OS0MM001.OB-BULK-ASGN-EXDT == 0
   || OS0MM001.OB-BULK-ASGN-EXDT == "MMDDYY")
    OS0MW01.OS0MW-UPD-TEMP = "Y"; /* set upd temp storage*/
    OS0MS-EDT-EFF-BEG(); /* effective begin date*/
  end
  ;
  OS0MS-EDT-EFF-RNG(); /* edit eff date range*/
  ;
    /* validate bulk assignment description*/
   /* *********************************************************/
   /* IF OS0MW01.OS0MW-MAINT-CD EQ 'A';             /* add mode*/
   /* *********************************************************/
  ;
  if (OS0MM001.OB-BULK-ASGN-DESC != VBASGN01.OB-BULK-ASGN-DESC /* changed*/
   || OS0MM001.OB-BULK-ASGN-DESC == " ")                       /* nothing entered*/
    OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
    OS0MS-EDT-BA-DESC(); /* edit bulk asgnmnt desc*/
  end
   /* END;*/
  ;
    /* validate bulk assignment id*/
  ;
   /* *********************************************************/
   /* IF OS0MW01.OS0MW-MAINT-CD EQ 'A';             /* add mode*/
   /* *********************************************************/
  if (OS0MM001.OB-BULK-ASGN-ID != VBASGN01.OB-BULK-ASGN-ID /* changed*/
   || OS0MM001.OB-BULK-ASGN-ID == " ")                     /* nothing entered*/
    OS0MW01.OS0MW-CHG-FLAG = "Y"; /* field changed*/
    OS0MW01.OS0MW-KEY-CHG-FLAG = "Y"; /* field changed*/
    OS0MS-EDT-BA-ID(); /* edit bulk asgnmnt id*/
  end
   /* END;*/
  ;
  ;
end // end OS0MS-EDT-MAP

// EDIT MMDDYY DATE FORMAT
Function OS0MS-EDT-MMDDYY()
   /* Edit MMDDYY date*/
  ;
   /* move the map date to OSWWREC.OSWWDT6 before entering*/
   /* this routine*/
   /* the calling stmt grp must handle the return code*/
   /* processing*/
  ;
  set TA2REC empty;
  TA2REC.TA2GRGA = OSWWREC.OSWWDT6;
  TA2REC.TA2DTOPT = "GREGGREG";
  TA2REC.TA2GRTYP = "A";
  call "TA0040" (TA2REC) {isNoRefresh = yes, isExternal = yes};
  ;
end // end OS0MS-EDT-MMDDYY

// EDIT NEED DATE RANGE
Function OS0MS-EDT-NEED-RNG()
  ;
  ;
    /* edit beginning and ending date ranges*/
  ;
  if (VBASGN01.OB-NEED-DRAW-XDT >= VBASGN01.OB-NEED-DRAW-BDT)
                                          /* if end date > or = begin date*/
     /* next sentence*/
  else
    converseLib.validationFailed(850); /* ending date must be > or = to beginning date*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.OB-NEED-DRAW-XDT cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-NEED-RNG

// EDIT PROP ONLY FLAG
Function OS0MS-EDT-PROP-FL()
  ;
  if (OS0MM001.XOTPROPF == "Y"
   || OS0MM001.XOTPROPF == "N"
  ) /* next sentence*/
  else
    converseLib.validationFailed(848); /* the correct response is 'y' or 'n'*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.XOTPROPF cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-PROP-FL

// EDIT XOT PROP/FUTURE FLAG CMBO
Function OS0MS-EDT-XOT-CMBO()
  ;
    /* verify that both flags are not 'n' - resulting in no matches*/
  ;
  if (OS0MM001.XOTPROPF == "N"
   && OS0MM001.XOTFUTRF == "N")
    converseLib.validationFailed(873); /* both 'n' values will not match to any ord*/
    OSWWREC.OSWWERFL = "Y";
    set OS0MM001.XOTPROPF cursor, bold;
    set OS0MM001.XOTFUTRF bold;
  end
  ;
  ;
end // end OS0MS-EDT-XOT-CMBO

// EDIT SALES OFFICE CODE
Function OS0MS-EDT-XSO-CD()
  ;
  if (OS0MM001.XSOCD == " ") /* no xso entered to edit*/
    return;
  end
  ;
  if (OS0MM001.XSOCD in XSOTBL.XSOCD /* if xso is on tbl*/
   && XSOTBL.XXXSTAT[sysVar.arrayIndex] == "A") /* and is a active status*/
     /* next sentence*/
  else
    converseLib.validationFailed(862); /* xso code is invalid or inactive*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.XSOCD cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-XSO-CD

// EDIT BULK ASGNMNT STATUS CODE
Function OS0MS-EDT-XXX-STAT()
  ;
  if (OS0MM001.XXX-STAT == "A" /* active status*/
   || OS0MM001.XXX-STAT == "I") /* inactive status*/
     /* next sentence*/
  else
    converseLib.validationFailed(851); /* GPC code is invalid or inactive*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
    set OS0MM001.XXX-STAT cursor, bold;
  end
  ;
  ;
end // end OS0MS-EDT-XXX-STAT

// FORMAT OS0MM001 HEADINGS
Function OS0MS-FMT-HEADINGS()
  ;
  OS0MM001.OS0MM-MAP-DTE = OSWWREC.OSWWCDAT; /* formatted current date*/
  ;
  OS0MM001.OS0MM-MAP-RVN = 01; /* map revision number*/
  ;
end // end OS0MS-FMT-HEADINGS

// FORMAT VBASGN01 FROM MAP FLDS
Function OS0MS-FMT-VBASGN01()
  ;
  ;
  VBASGN01.OB-BULK-ASGN-ID = OS0MM001.OB-BULK-ASGN-ID;
  OSWWREC.OB-BULK-ASGN-ID = OS0MM001.OB-BULK-ASGN-ID;
  ;
  VBASGN01.OB-BULK-ASGN-DESC = OS0MM001.OB-BULK-ASGN-DESC;
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-BULK-ASGN-EBDT;
  OS0MS-MMDDYY-COMP(); /* convert to comp*/
  VBASGN01.OB-BULK-ASGN-EBDT = OSWWREC.OSWWDT8;
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-BULK-ASGN-EXDT;
  OS0MS-MMDDYY-COMP(); /* convert to comp*/
  VBASGN01.OB-BULK-ASGN-EXDT = OSWWREC.OSWWDT8;
  ;
  VBASGN01.XXX-STAT = OS0MM001.XXX-STAT;
  ;
  if (OS0MM001.KUCGRPID > 0)
    VBASGN01.KUCGRPID = OS0MM001.KUCGRPID;
    VBASGN01.CU-GRP-CO-ID1 = OS0MM001.KUCGRPID;
    OB-SEL-GRPCO-ID-FL = "S";
  else
    VBASGN01.KUCGRPID = 0;
  end
  ;
  if (OS0MM001.KUKPCOID > 0)
    VBASGN01.KUKPCOID = OS0MM001.KUKPCOID;
    VBASGN01.CU-PNT-CO-ID1 = OS0MM001.KUKPCOID;
    OB-SEL-PNTCO-ID-FL = "S";
  else
    VBASGN01.KUKPCOID = 0;
  end
  ;
  if (OS0MM001.KUCCOID > 0)
    VBASGN01.KUCCOID = OS0MM001.KUCCOID;
    VBASGN01.CU-CO-ID1 = OS0MM001.KUCCOID;
    OB-SEL-CO-ID-FL = "S";
  else
    VBASGN01.KUCCOID = 0;
  end
  ;
  VBASGN01.XOTPROPF = OS0MM001.XOTPROPF;
  VBASGN01.XOTFUTRF = OS0MM001.XOTFUTRF;
  VBASGN01.XGPCD = OS0MM001.XGPCD;
  VBASGN01.XSOCD = OS0MM001.XSOCD;
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-NEED-DRAW-BDT;
  OS0MS-MMDDYY-COMP();
  VBASGN01.OB-NEED-DRAW-BDT = OSWWREC.OSWWDT8;
  ;
  OSWWREC.OSWWDT6 = OS0MM001.OB-NEED-DRAW-XDT;
  OS0MS-MMDDYY-COMP();
  VBASGN01.OB-NEED-DRAW-XDT = OSWWREC.OSWWDT8;
  ;
  if (OS0MW01.OS0MW-MAINT-CD == "A")
    VBASGN01.ZZZSDT = TA2REC.TA2GRGGN;
    VBASGN01.ZZZSTM = TA2REC.TA2TIMHM;
  end
  ;
  ;
  VBASGN01.ZZZCHGDT = TA2REC.TA2GRGGN;
  VBASGN01.ZZZCHGTM = TA2REC.TA2TIMHM;
  ;
  ;
end // end OS0MS-FMT-VBASGN01

// GET CURRENT DATE
Function OS0MS-GET-CURR-DTE()
  ;
  ;
  set TA2REC empty;
  ;
  TA2REC.TA2DTOPT = "GETDATE";
  call "TA0040" (TA2REC) {isNoRefresh = yes, isExternal = yes};
  ;
  ;
end // end OS0MS-GET-CURR-DTE

// GET KUCREC VIA IO FOR KUCGRPID
Function OS0MS-GET-KUCREC1()
  ;
  ;
  set SQLCA empty;
  set KUCREC empty;
  ;
  KUCREC.KUCGRPID = OS0MM001.KUCGRPID;
  OS0MW01.OS0MW-POST-KEY2 = OS0MM001.KUCGRPID;
  ;
  call "IO0240" ("S1", SQLCA, KUCREC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0)
    /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == 100)
      set OS0MM001.KUCGRPID cursor, bold;
      converseLib.validationFailed(835);
      OSWWREC.OSWWERFL = "Y";
    else
      if (SQLCA.VAGen_SQLCODE == -911)
        OSWWREC.OSWWERFL = "Y";
        converseLib.validationFailed(010);
        set OS0MM001.KUCGRPID cursor;
      else
        if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
          OS0MS-PRG-TMP-STOR(); /* purge os0l temp storage*/
        end
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0M    ";
        TA1REC.TA1LOCAT[1] = "OS0MS-GE";
        TA1REC.TA1LOCAT[2] = "T-KUCREC";
        TA1REC.TA1LOCAT[3] = " IO0240 ";
        TA1REC.TA1LOCAT[4] = "S1      ";
        TA1REC.TA1DBASE = "DCUST   ";
        TA1REC.TA1TBLVU = "VCMPNY01";
        TA1REC.TA1TBLKE = OS0MW01.OS0MW-POST-KEY2;
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0MS-GET-KUCREC1

// GET KUCREC VIA IO FOR KUCCOID
Function OS0MS-GET-KUCREC2()
  ;
  ;
  set SQLCA empty;
  set KUCREC empty;
  ;
  KUCREC.KUCCOID = OS0MM001.KUCCOID;
  OS0MW01.OS0MW-POST-KEY2 = OS0MM001.KUCCOID;
  ;
  call "IO0240" ("S ", SQLCA, KUCREC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0)
    /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == 100)
      set OS0MM001.KUCCOID cursor, bold;
      converseLib.validationFailed(837);
      OSWWREC.OSWWERFL = "Y";
    else
      if (SQLCA.VAGen_SQLCODE == -911)
        OSWWREC.OSWWERFL = "Y";
        converseLib.validationFailed(010);
        set OS0MM001.KUCCOID cursor;
      else
        if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
          OS0MS-PRG-TMP-STOR(); /* purge os0l temp stor*/
        end
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0M    ";
        TA1REC.TA1LOCAT[1] = "OS0MS-GE";
        TA1REC.TA1LOCAT[2] = "T-KUCREC";
        TA1REC.TA1LOCAT[3] = " IO0240 ";
        TA1REC.TA1LOCAT[4] = "S       ";
        TA1REC.TA1DBASE = "DCUST   ";
        TA1REC.TA1TBLVU = "VCMPNY01";
        TA1REC.TA1TBLKE = OS0MW01.OS0MW-POST-KEY2;
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0MS-GET-KUCREC2

// GET KUKREC VIA IO FOR KUKPCOID
Function OS0MS-GET-KUKREC()
  ;
  ;
  set SQLCA empty;
  set KUKREC empty;
  ;
  KUKREC.KUKPCOID = OS0MM001.KUKPCOID;
  OS0MW01.OS0MW-POST-KEY2 = OS0MM001.KUKPCOID;
  ;
  call "IO0030" ("S ", SQLCA, KUKREC) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0)
    /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == 100)
      set OS0MM001.KUKPCOID cursor, bold;
      converseLib.validationFailed(836);
      OSWWREC.OSWWERFL = "Y";
    else
      if (SQLCA.VAGen_SQLCODE == -911)
        OSWWREC.OSWWERFL = "Y";
        converseLib.validationFailed(010);
        set OS0MM001.KUKPCOID cursor;
      else
        if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
          OS0MS-PRG-TMP-STOR(); /* purge os0l temp storage*/
        end
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0M    ";
        TA1REC.TA1LOCAT[1] = "OS0MS-GE";
        TA1REC.TA1LOCAT[2] = "T-KUKREC";
        TA1REC.TA1LOCAT[3] = " IO0030 ";
        TA1REC.TA1LOCAT[4] = "S       ";
        TA1REC.TA1DBASE = "DCUST   ";
        TA1REC.TA1TBLVU = "VPARNT01";
        TA1REC.TA1TBLKE = OS0MW01.OS0MW-POST-KEY2;
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0MS-GET-KUKREC

// GET VBASGN01 / OB-BULK-ASGN-ID
Function OS0MS-GET-VBASGN01()
  ;
  ;
  set SQLCA empty;
  set VBASGN01 empty;
  ;
  VBASGN01.OB-BULK-ASGN-ID = OSWWREC.OB-BULK-ASGN-ID;
  OS0MW01.OS0MW-POST-KEY = OSWWREC.OB-BULK-ASGN-ID;
  ;
  call "IO7200" ("S ", SQLCA, VBASGN01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0
   || SQLCA.VAGen_SQLCODE == 100)
    /* continue*/
  else
    if (SQLCA.VAGen_SQLCODE == -911)
      OSWWREC.OSWWERFL = "Y"; /* set error flag*/
      converseLib.validationFailed(010); /* database busy*/
      set OS0MM001.KUCGRPID cursor; /* position cursor*/
    else
      if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
        OS0MS-PRG-TMP-STOR(); /* purge os0l temp stor*/
      end
      TA1REC.TA1TYPE = "DB2 ";
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1PGMNM = "OS0M    ";
      TA1REC.TA1LOCAT[1] = "OS0MS-GE";
      TA1REC.TA1LOCAT[2] = "T-VBASGN";
      TA1REC.TA1LOCAT[3] = "01 IO720";
      TA1REC.TA1LOCAT[4] = "0 S     ";
      TA1REC.TA1DBASE = "DORDB   ";
      TA1REC.TA1TBLVU = "VBASGN01";
      TA1REC.TA1TBLKE = OS0MW01.OS0MW-POST-KEY;
      ;
      call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
      ;
      COMMAREA.CAUSERA = " ";
      ;
      XSPF4();
      exit program;
    end
  end
  ;
  ;
end // end OS0MS-GET-VBASGN01

// INITIALIZE OS0M APPLICATION
Function OS0MS-INIT-OS0M()
  ;
  set KUCREC empty; /* set customer record empty*/
  set KUKREC empty; /* set parent record empty*/
  set OSWWREC empty; /* bulk assignment system working storage*/
  set OSRREC empty; /* temp storage record from os0l appl*/
  set SQLCA empty; /* return code from DB2*/
  set ERRSQLCA empty; /* return code from non-db2*/
  set TAEREC empty; /* diags for non db2*/
  set TA1REC empty; /* diagnostic record*/
  set TA2REC empty; /* temp storage record*/
  set TA5REC empty; /* temp storage record*/
  set VBASGN01 empty; /* bulk assignment record*/
  set OS0MW01 empty; /* working storage*/
  ;
  ;
  OSWWREC.OSWWGRP = COMMAREA.CAUSERA; /* format system working store*/
  ;
    /* verify that they came from os0k application*/
  ;
  if (OSWWREC.OSWWINIT != "OS0K" && 
  OSWWREC.OSWWINIT != "OS02")
    transfer to program "OS0K" passing COMMAREA;
    exit program;
  end
  ;
  OSWWREC.OSWWCDAT = VGVar.currentShortGregorianDate;
  ;
  TA1REC.TA1MAP = "OS0MM001"; /* map name for diags*/
  ;
  ;
end // end OS0MS-INIT-OS0M

// LOAD MAP USING VBASGN01
Function OS0MS-LOAD-MAP()
  ;
  ;
  OS0MM001.OB-BULK-ASGN-ID = VBASGN01.OB-BULK-ASGN-ID;
  OS0MM001.OB-BULK-ASGN-DESC = VBASGN01.OB-BULK-ASGN-DESC;
  ;
  if (OS0MW01.OS0MW-MAINT-CD == "A")
    OS0MM001.XXX-STAT = "A";
    OSWWREC.OSWWDT8 = OSWWREC.OSWWCDAT;
    OSWWREC.OSWWDT6Y = OSWWREC.OSWWDT8Y;
    OSWWREC.OSWWDT6M = OSWWREC.OSWWDT8M;
    OSWWREC.OSWWDT6D = OSWWREC.OSWWDT8D;
    OS0MM001.ZZZCHGDT = OSWWREC.OSWWDT6;
    OS0MM001.KUCGRPID = 0;
    OS0MM001.KUKPCOID = 0;
    OS0MM001.KUCCOID = 0;
    OS0MM001.XOTPROPF = "Y";
    OS0MM001.XOTFUTRF = "Y";
  else
    OSWWREC.OSWWDT8 = VBASGN01.OB-BULK-ASGN-EBDT;
    OS0MS-CCYYMMDD-MAP();
    OS0MM001.OB-BULK-ASGN-EBDT = OSWWREC.OSWWDT6;
    ;
    OSWWREC.OSWWDT8 = VBASGN01.OB-BULK-ASGN-EXDT;
    OS0MS-CCYYMMDD-MAP();
    OS0MM001.OB-BULK-ASGN-EXDT = OSWWREC.OSWWDT6;
    ;
    OS0MM001.XXX-STAT = VBASGN01.XXX-STAT;
    ;
    OSWWREC.OSWWDT8 = VBASGN01.ZZZCHGDT;
    OS0MS-CCYYMMDD-MAP();
    OS0MM001.ZZZCHGDT = OSWWREC.OSWWDT6;
    ;
    OS0MM001.KUCGRPID = VBASGN01.KUCGRPID;
    OS0MM001.KUKPCOID = VBASGN01.KUKPCOID;
    OS0MM001.KUCCOID = VBASGN01.KUCCOID;
    OS0MM001.XOTPROPF = VBASGN01.XOTPROPF;
    OS0MM001.XOTFUTRF = VBASGN01.XOTFUTRF;
    OS0MM001.XGPCD = VBASGN01.XGPCD;
    OS0MM001.XSOCD = VBASGN01.XSOCD;
    ;
    OSWWREC.OSWWDT8 = VBASGN01.OB-NEED-DRAW-BDT;
    OS0MS-CCYYMMDD-MAP();
    OS0MM001.OB-NEED-DRAW-BDT = OSWWREC.OSWWDT6;
    ;
    OSWWREC.OSWWDT8 = VBASGN01.OB-NEED-DRAW-XDT;
    OS0MS-CCYYMMDD-MAP();
    OS0MM001.OB-NEED-DRAW-XDT = OSWWREC.OSWWDT6;
  end
  ;
  ;
end // end OS0MS-LOAD-MAP

// MMDDYY TO COMP - NO VALIDATE
Function OS0MS-MMDDYY-COMP()
    /* convert MMDDYY date to comp (DB2 date)*/
  ;
  ;
  ;
   /* the calling stmt group must move the MMDDYY date*/
   /* to OSWWREC.OSWWDT6 before entering this routine*/
  ;
  if (OSWWREC.OSWWDT6 == 0)
    OSWWREC.OSWWDT8 = 0;
    return;
  end
  ;
  ;
  OSWWREC.OSWWDT8Y = OSWWREC.OSWWDT6Y;
  OSWWREC.OSWWDT8M = OSWWREC.OSWWDT6M;
  OSWWREC.OSWWDT8D = OSWWREC.OSWWDT6D;
  ;
  if (OSWWREC.OSWWDT6Y <= 51)
    OSWWREC.OSWWDT8C = 20;
  else
    OSWWREC.OSWWDT8C = 19;
  end
  ;
   /* the calling stmt group needs to move*/
   /* OSWWREC.OSWWDT8 to the comp date field.*/
  ;
end // end OS0MS-MMDDYY-COMP

// Non-DB2 Post Routine TA0020
Function OS0MS-POST-NO-ROLL()
       /* Non-DB2 post routine*/
  ;
  ;
   /* the following fields will be filled in by the*/
   /* calling stmt group before entering this routine*/
     /* ta1locat(1) = transaction type  ie: 'ss' 'sn'*/
     /* ta1locat(2) = i/o mod name*/
     /* ta1locat(3) = calling stmt group name*/
     /* ta1locat(4) = programmers option(extra key data)*/
     /* taerec.taedesc1 = programmers opiton (additional key data*/
     /* taerec.taedesc2 = messages*/
     /* ta1map = appl's mapname and should be initilized*/
              /* in the programs init process.*/
   /* return code processing will also be handled by the*/
   /* calling stmt group.*/
  ;
  TA1REC.TA1TYPE = "APPL";
  TA1REC.TA1FUNC = "POST";
  TA1PGMNM = COMMAREA.CACURRAP; /* current application*/
   /* MOVE OS0LW01.OS0LW-POST-KEY TO TA1REC.TA1TBLKE; /* move system key*/
  try
    call "TA0020" (TA1REC, TAEREC) {isExternal = yes};
  end
  ;
end // end OS0MS-POST-NO-ROLL

// Purge Bulk Asgnmnt Temp Storag
Function OS0MS-PRG-TMP-STOR()
  ;
  ;
  ;
   /* purge temporary storage 1*/
  ;
  TA5REC.TA5APPID = "OSFL"; /* appl identification*/
  TA5REC.TA5FNCCD = "P"; /* function code*/
  call "TA0050" (OSRREC, TA5REC) {isNoRefresh = yes, isExternal = yes}; /* temp storage subroutine*/
  ;
  if (TA5REC.TA5RTNCD == 0)
    OSWWREC.OSWWTF1P = 1;
    OSWWREC.OSWWTF1S = 1;
    OSWWREC.OSWWTF1M = 1;
  else
    TA1REC.TA1LOCAT[1] = "PRGE TS1";
    TA1REC.TA1LOCAT[2] = "TA0050"; /* io mod called*/
    TA1REC.TA1LOCAT[3] = TA5REC.TA5RTNCD; /* return code*/
    TA1REC.TA1TBLKE = OSRREC.OSRTSROW[1]; /* first row, first rec*/
    TAEREC.TAEDESC1 = TA5REC.TA5DATA; /* subroutine parms*/
    OS0MS-POST-NO-ROLL(); /* post,  no rollback, non db2*/
    ;
    ;
  end
end // end OS0MS-PRG-TMP-STOR

// Read Bulk Asgnmnt Temp Storage
Function OS0MS-RED-TMP-STOR()
  ;
  ;
  ;
   /* read temporary storage 1*/
  ;
  set OSRREC empty;
  ;
  TA5REC.TA5APPID = "OSFL"; /* appl identification*/
  TA5REC.TA5FNCCD = "R"; /* function code*/
  TA5REC.TA5TSQIX = OSWWREC.OSWWTF1P; /* current page*/
  OSRREC.OSRTSLEN = 566; /* length of record*/
  ;
  call "TA0050" (OSRREC, TA5REC) {isNoRefresh = yes, isExternal = yes}; /* temp storage subroutine*/
  ;
  if (TA5REC.TA5RTNCD == 0)
    /* next sentence*/
  else
    TA1REC.TA1LOCAT[1] = "READ TS1";
    TA1REC.TA1LOCAT[2] = "TA0050"; /* io mod called*/
    TA1REC.TA1LOCAT[3] = TA5REC.TA5RTNCD; /* return code*/
    TA1REC.TA1TBLKE = OSRREC.OSRTSROW[1]; /* first row, first rec*/
    TAEREC.TAEDESC1 = TA5REC.TA5DATA; /* subroutine parms*/
    OS0MS-POST-NO-ROLL(); /* post, no rollback, non db2 diags*/
    ;
    ;
  end
end // end OS0MS-RED-TMP-STOR

// RESET FIELD ATTRIBUTES
Function OS0MS-RESET-ATTRIB()
  ;
     /* set heading attributes*/
  ;
  if (OS0MW01.OS0MW-MAINT-CD == "C") /* bulk assignment exists*/
   /* SET OS0MM001.OB-BULK-ASGN-ID AUTOSKIP,BLUE;*/
   /* SET OS0MM001.OB-BULK-ASGN-DESC AUTOSKIP,BLUE;*/
    set OS0MM001.KUCGRPID cursor, initialAttributes; /* COMPANY GROUP & set cursor*/
  else
    set OS0MM001.OB-BULK-ASGN-EBDT initialAttributes;
    set OS0MM001.OB-BULK-ASGN-EXDT initialAttributes;
    set OS0MM001.OB-BULK-ASGN-ID cursor, initialAttributes; /* Bulk Asgnmnt & set csr*/
    set OS0MM001.OB-BULK-ASGN-DESC initialAttributes;
    set OS0MM001.OB-BULK-ASGN-EBDT initialAttributes;
    set OS0MM001.OB-BULK-ASGN-EXDT initialAttributes;
    set OS0MM001.KUCGRPID initialAttributes; /* COMPANY GROUP*/
  end
  ;
  set OS0MM001.XXX-STAT initialAttributes;
  set OS0MM001.ZZZCHGDT initialAttributes;
  ;
  set OS0MM001.KUKPCOID initialAttributes; /* PARENT COMPANY*/
  set OS0MM001.KUCCOID initialAttributes; /* CUSTOMER ID*/
  ;
  set OS0MM001.XOTPROPF initialAttributes; /* PROP FLAG*/
  set OS0MM001.XOTFUTRF initialAttributes; /* FUTURE FLAG*/
  set OS0MM001.XGPCD initialAttributes; /* GPC CODE*/
  set OS0MM001.OB-NEED-DRAW-BDT initialAttributes; /* BEGIN NEED DATE*/
  set OS0MM001.OB-NEED-DRAW-XDT initialAttributes; /* END NEED DATE*/
  ;
  ;
end // end OS0MS-RESET-ATTRIB

// TRANSFER CNTL FOR PFKEYS/ENTER
Function OS0MS-TRNSFR-CNTL()
  ;
  COMMAREA.CAUSERA = OSWWREC.OSWWGRP;
  ;
  if (converseVar.eventKey is pf3)
    if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
      OS0MS-PRG-TMP-STOR();
    end
    COMMAREA.CATOAP = "OS0K"; /* Order Inquiry parms*/
    XSEXIT();
  end
  ;
  if (converseVar.eventKey is pf4)
    if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
      OS0MS-PRG-TMP-STOR();
    end
    COMMAREA.CAUSERA = " ";
    XSPF4();
  end
  ;
    /* check for invalid pfkey*/
  ;
  if (converseVar.eventKey is enter
   || converseVar.eventKey is pf12)
     /* next sentence - there may be errors*/
  else
    converseLib.validationFailed(002); /* invalid pf key*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
  end
  ;
    /* continue to OS0N Application*/
  ;
  if (converseVar.eventKey is enter
   && OSWWREC.OSWWERFL == "N")
    COMMAREA.CATOAP = "OS0N";
    XSEXIT();
  end
  ;
  ;
end // end OS0MS-TRNSFR-CNTL

// UPDATE OS0M MAP
Function OS0MS-UPD-MAP()
  ;
  ;
  OS0MS-GET-CURR-DTE(); /* get current date/time*/
  OS0MS-FMT-VBASGN01(); /* format VBASGN01 record*/
  ;
  ;
  if (OS0MW01.OS0MW-MAINT-CD == "A") /* adding new bulk assignment*/
    OS0MS-ADD-VBASGN01();
  else
    ;
    if (OS0MW01.OS0MW-KEY-CHG-FLAG == "Y") /* key changed*/
      VBASGN01.OB-BULK-ASGN-ID = OS0MW01.OS0MW-OLD-OB-BULK-ASGN-ID;
      OS0MS-DLT-VBASGN01(); /* delete asgnment record*/
      VBASGN01.OB-BULK-ASGN-ID = OS0MM001.OB-BULK-ASGN-ID;
      OS0MS-ADD-VBASGN01();
    else
      OS0MS-UPD-VBASGN01(); /* update existing bulk asgnmnt*/
      if (OS0MW01.OS0MW-UPD-TEMP == "Y") /* update temp storage*/
        if (OSWWREC.OSWWFRMAP == "OS0L") /* came from os0l appl*/
          OS0MS-RED-TMP-STOR();
          OSRREC.XXX-STAT[OSWWTF1S] = VBASGN01.XXX-STAT;
          OSRREC.OB-BULK-ASGN-EBDT[OSWWTF1S] = VBASGN01.OB-BULK-ASGN-EBDT;
          OSRREC.OB-BULK-ASGN-EXDT[OSWWTF1S] = VBASGN01.OB-BULK-ASGN-EXDT;
          OS0MS-UPD-TMP-STOR();
        end
      end
    end
  end
  ;
  ;
end // end OS0MS-UPD-MAP

// Update Bulk Asgnmnt Temp Stora
Function OS0MS-UPD-TMP-STOR()
  ;
  ;
  ;
   /* update temporary storage 1*/
  ;
  TA5REC.TA5APPID = "OSFL"; /* appl identification*/
  TA5REC.TA5FNCCD = "U"; /* function code*/
  TA5REC.TA5TSQIX = OSWWREC.OSWWTF1P; /* current page*/
  OSRREC.OSRTSLEN = 566; /* length of record*/
  ;
  call "TA0050" (OSRREC, TA5REC) {isNoRefresh = yes, isExternal = yes}; /* temp storage subroutine*/
  ;
  if (TA5REC.TA5RTNCD == 0)
    /* next sentence*/
  else
    TA1REC.TA1LOCAT[1] = "UPD TS1";
    TA1REC.TA1LOCAT[2] = "TA0050"; /* io mod called*/
    TA1REC.TA1LOCAT[3] = TA5REC.TA5RTNCD; /* return code*/
    TA1REC.TA1TBLKE = OSRREC.OSRTSROW[1]; /* first row, first rec*/
    TAEREC.TAEDESC1 = TA5REC.TA5DATA; /* subroutine parms*/
    OS0MS-POST-NO-ROLL(); /* post, no rollback, non db2*/
    ;
    ;
  end
end // end OS0MS-UPD-TMP-STOR

// UPDATE VBASGN01 RECORD
Function OS0MS-UPD-VBASGN01()
  ;
  ;
  set SQLCA empty;
  ;
  call "IO7200" ("U ", SQLCA, VBASGN01) {isNoRefresh = yes, isExternal = yes};
  ;
  if (SQLCA.VAGen_SQLCODE == 0)
    /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == 100)
      OSWWREC.OSWWERFL = "Y"; /* set error flag*/
      converseLib.validationFailed(330); /* reenter changes again*/
      set OS0MM001.KUCGRPID cursor; /* position cursor*/
      OS0MS-GET-VBASGN01(); /* get vbasgn01 again*/
    else
      if (SQLCA.VAGen_SQLCODE == -911)
        OSWWREC.OSWWERFL = "Y"; /* set error flag*/
        converseLib.validationFailed(010); /* database busy*/
        set OS0MM001.KUCGRPID cursor; /* position cursor*/
      else
        TA1REC.TA1TYPE = "DB2 ";
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1PGMNM = "OS0M";
        TA1REC.TA1LOCAT[1] = "OS0MS-UP";
        TA1REC.TA1LOCAT[2] = "D-VBASGN";
        TA1REC.TA1LOCAT[3] = "01 U    ";
        TA1REC.TA1LOCAT[4] = "IO7200  ";
        TA1REC.TA1DBASE = "DORDB   ";
        TA1REC.TA1TBLVU = "VBASGN01";
        TA1REC.TA1TBLKE = VBASGN01.OB-BULK-ASGN-ID;
        ;
        call "TA0020" (TA1REC, SQLCA) {isExternal = yes};
        ;
        COMMAREA.CAUSERA = " ";
        ;
        XSPF4();
        exit program;
      end
    end
  end
  ;
  ;
end // end OS0MS-UPD-VBASGN01

// VALIDIATE DATE
Function OS0MS-VALIDATE-DT()
  ;
  ;
    /* Edit MMDDYY Map Date*/
  ;
  OS0MS-EDT-MMDDYY();
  ;
  if (TA2REC.TA2RTNCD == 0) /* good return*/
    OS0MS-MMDDYY-COMP(); /* convert MMDDYY to comp*/
  else
    converseLib.validationFailed(849); /* date entered is invalid*/
    OSWWREC.OSWWERFL = "Y"; /* set error flag*/
  end
  ;
  ;
end // end OS0MS-VALIDATE-DT

//*** RECORD=OS0MW01 ****
//     Working Storage Record for OS0M Application.
// 
// ************************************************************
// *    MAINTENANCE LOG
// ************************************************************
// 
//   05/02/94    schase     initial creation
//   11/25/97    KLEE       added chg key flag and asgn id
// ***********************
Record OS0MW01 type basicRecord
  10 OS0MW-MAINT-CD OS0MW-MAINT-CD ; 
  10 OS0MW-POST-KEY OS0MW-POST-KEY ; 
  10 OS0MW-POST-KEY2 OS0MW-POST-KEY2 ; 
  10 OS0MW-CHG-FLAG OS0MW-CHG-FLAG ; 
  10 OS0MW-KEY-CHG-FLAG OS0MW-KEY-CHG-FLAG ; 
  10 OS0MW-UPD-TEMP OS0MW-UPD-TEMP ; 
  10 OS0MW-OLD-OB-BULK-ASGN-ID OS0MW-OLD-OB-BULK-ASGN-ID ; 
end // end OS0MW01

// Map Field Changed Flag
DataItem OS0MW-CHG-FLAG char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Map Field Changed Flag
DataItem OS0MW-KEY-CHG-FLAG char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// add/chg maint code
DataItem OS0MW-MAINT-CD char(1)  {
  align = right, fillCharacter = "0", inputRequired = no
}
end

// Status field change flag
DataItem OS0MW-OLD-OB-BULK-ASGN-ID char(10)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// ob-bulk-asgn-id key
DataItem OS0MW-POST-KEY char(10)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// kucgrpid/kukpcoid/kuccoid key
DataItem OS0MW-POST-KEY2 num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Status field change flag
DataItem OS0MW-UPD-TEMP char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

