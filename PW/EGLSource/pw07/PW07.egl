package pw07;
import corpcom1.*;
import corpcom2.*;
import corpcom3.*;
import corpcom4.*;
import corpcom5.*;
import corpcom6.*;
import corpcom7.*;
import corpx1.*;
import corpx2.*;
import corpy2.*;
import corpz3.*;
import in1.common.*;
import ku.common.*;
import op.common.*;
import pk.common.*;
import pw.common.*;
import sm.common.*;
import sp.common.*;
import ta.common.*;
import tf.common.*;
import ts.common.*;
//*** PROGRAM=PW07 ****
// This application will display B-grade or Closeout orders.
// It is called from PW06, B-grade or Closeouts quantity
// selection screen.  The user may narrow the orders displayed
// by changing the selection option: 'A' = all, 'N' = not
// selected to pick, 'S' = selected to pick.
// 
// The user may enter a 'S', 'D', 'I', or 'H' to select order,
// de-select an order, inquiry on the order, or put the order
// on hold.
// 
// The user can transfer out of this application by using one
// of the PF keys displayed at the bottom of the map, or by
// entering fast-path information (also at the bottom of the
// map).
// 
// 
// -------  --------  ------ ----------------------------------
// CONTROL    DATE     NAME  DESCRIPTION OF CHANGE
// -------  --------  ------ ----------------------------------
// NEW      11/12/91  SHENDE New application.
//          12/18/91  SHENDE Added index to select fl field.
//          03/09/92  SHENDE Added xbc-brand-cd (XBCCD) for
//                           March table changes.
//          04/23/92  SCLEME Omit processing in-store promo.
//                           Format GPC for 'S7' IO1720.
// ColeHan  07/20/92  SHENDE Display brand code.
//          12/14/92  SHENDE Move '*' to spcl hndl fl for
//                           poolh cursor.
//          08/02/93  RCREAM Added a second map for Picking.
//                           Changed the logic in the 7100, 710
//                           7300, 7400, 7410, 7510, 7530, 7600
//                           7611, 7612, 7620 & all the SGRPs.
//                           Also added 200-conv-map1 & map2,
//                           210-data-map1 & map2, 500-edit-
//                           map1 & map2, 520-data-map1 & map2,
//                           521-hldt-map1 & map2, 522-hlcd-
//                           map1 & map2.
//          10/14/93  kande1 renamed new procs for standards
// Canada   10/25/95  PSTROE Pick-up new version of XPPK003
// PK#00    12/22/95  OVAZQU use carrier code when using dbsb
//                           date.
//                           Also, when doing "planning" do not
//                           display orders selected under
//                           "picking".
// BG@QD    01/06/97  OVAZQU For whse 51. Do not select b-grd
//                           orders unless they are "normal".
// 08/20/97  DGERLT Recompiled to pick up the new
//                           version of XPPK005 which fixes
//                           a b-grade/closeout problem.
// Y2KFIX   02/17/98  DKENNY Y2K MODIFICATIONS MADE TO PW07-613
//                           PW07M001 and PW07M002.
// *********************
Program PW07 type textUIProgram //VAGen Info - main text program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes, 
  msgTablePrefix = "PK00", inputRecord = COMMAREA, segmented = yes
  }

  // Data Declarations
  COMMAREA COMMAREA ; // record
  PK4REC PK4REC; // record
  PK9REC PK9REC; // record
  PKBREC PKBREC; // record
  PKHREC PKHREC; // record
  PKWREC PKWREC; // record
  PW07W00 PW07W00; // record
  PW07W01 PW07W01; // record
  PWFREC PWFREC; // record
  PWJREC PWJREC; // record
  PWKREC PWKREC; // record
  SQLCA SQLCA; // record
  TA1REC TA1REC; // record
  TA5REC TA5REC; // record
  TA9REC TA9REC; // record
  TAEREC TAEREC; // record
  XX0XW01 XX0XW01; // record
  XX0XW02 XX0XW02; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use XOTTBL; // table
  use XHRTBL; // table
  use XDVTBL; // table
  use XWHTBL; // table
  use XBCTBL; // table
  use PW07M.PW07M001,  // forms
      PW07M.PW07M002, 
      PW07M.XX0XM001
   {
    pfKeyEquate = no
  };

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    XPPK001: XPPK001();
     /* ----------------------------------------------------------------*/
     /* Initialize working storage and display storage areas.*/
     /* ----------------------------------------------------------------*/

    set PW07M001 initial; /* M001 input/output*/
    set PW07M002 initial; /* M002 input/output*/
    set PW07W00 empty; /* Working storage*/
    set PW07W01 empty; /* M001 display storage*/
    set XX0XW01 empty; /* Convert time storage*/
    set PK4REC empty; /* DPICK.VPOOLH01 record*/
    set PK9REC empty; /* DPICK.VCUHLD01 record*/
    set PKBREC empty; /* DPICK.VORHLD01 record*/
    set PKHREC empty; /* DPICK.VSELOR01 record*/
    set PWFREC empty; /* DPICK.VCAHLD01 record*/
    set PWJREC empty; /* picking order array*/
    set PWKREC empty; /* DNSB date array*/
    set SQLCA empty; /* SQL communications area*/
    set TAEREC empty; /* Error diagnosis information*/
    set TA1REC empty; /* Error diagnosis parameters*/
    set TA5REC empty; /* Temporary storage parameters*/


     /* ----------------------------------------------------------------*/
     /* Initialize work areas*/
     /* ----------------------------------------------------------------*/

     /* ---------- switches --------------------*/
    PW07W00.PW07W-FRMT-SCRN-SW = "Y"; /* Format screen switch*/
    PW07W00.PW07W-PROCESS-SW = "Y"; /* Process order switch*/
    PW07W00.PW07W-MORE-DNSB-SW = "Y"; /* Passed dates*/
    PW07W00.PW07W-REQST-DAT-SW = "N"; /* Request data switch*/
    PW07W00.PW07W-UPD-OK-SW = "N"; /* Update successful switch*/
    PW07W00.PW07W-BD-FSTPTH-SW = "N"; /* Bad fast path switch*/
    PW07W00.PW07W-MAP-DIS-SW = "N"; /* Map display switch*/
    PW07W00.PW07W-STOR-UPD-SW = "N"; /* Request update switch*/
    PW07W00.PW07W-SCRN-MDFY-SW = "N"; /* Screen modified switch*/
    PW07W00.PW07W-ORD-HLD-SW = "N"; /* Order on hold switch*/
     /* ---------- index -----------------------*/
    PW07W00.PW07W-MAP-IDX = 1; /* Map line index*/
    PW07W00.PW07W-DNSB-IDX = 1; /* DNSB date index (pwkrec)*/
    PW07W00.PW07W-ORD-INQ-IDX = 1; /* Order inquiry index*/
    PKWREC.PKWINDEX = 1; /* DNSB array index*/
     /* ---------- indicator -------------------*/
    PW07W00.PW07W-SEL-IND = "A"; /* Default "select all"*/


     /* ----------------------------------------------------------------*/
     /* Get first occruance of 25 DNSB dates from COMMAREA*/
     /* ----------------------------------------------------------------*/

    PWKREC.PWKARRAY = PKWREC.PKWARRAY[PKWINDEX];

    if (PWKREC.PWKARMAX > 0) /* Found data to process*/
      PW07W00.PW07W-REQST-DAT-SW = "Y";

    else
      PW07W00.PW07W-MORE-DNSB-SW = "N";
      PWKREC.OP1DSBDT[PW07W-DNSB-IDX] = 0;
      PW07W00.XXXMODID = "XPPK001";
      converseLib.validationFailed(339);
    end

     /* ----------------------------------------------------------------*/
     /* Build map heading area*/
     /* ----------------------------------------------------------------*/

     /* ------- map fields -----------------------*/

    if (PKWREC.PKWSELSW == "PK") /* picking*/

      PW07M002.XWHCD = PKWREC.XWHCD;
      PW07M002.XDVCD = PKWREC.XDVCD[1];
      PW07M002.XBCCD = PKWREC.XBCCD[1];
      PW07M002.XWHABRV = PKWREC.XWHABRV;
      PW07M002.PW07M-SEL-IND = PW07W00.PW07W-SEL-IND;
    else
      PW07M001.XWHCD = PKWREC.XWHCD;
      PW07M001.XDVCD = PKWREC.XDVCD[1];
      PW07M001.XBCCD = PKWREC.XBCCD[1];
      PW07M001.XWHABRV = PKWREC.XWHABRV;
      PW07M001.PW07M-SEL-IND = PW07W00.PW07W-SEL-IND;
    end

     /* ------- working storage fields - W00 -----*/
    PW07W00.XWHCD = PKWREC.XWHCD;
    PW07W00.XDVCD = PKWREC.XDVCD[1];
    PW07W00.XBCCD = PKWREC.XBCCD[1];
    PW07W00.XWHABRV = PKWREC.XWHABRV;
    PW07W00.PW07W-PREV-DNSB-DT = PWKREC.OP1DSBDT[PW07W-DNSB-IDX];
    PW07W00.PW07W-PREV-TF1CARCD = PWKREC.TF1CARCD[PW07W-DNSB-IDX];

     /* ------- display storage fields - W01 -----*/
    PW07W01.XWHCD = PKWREC.XWHCD;
    PW07W01.XDVCD = PKWREC.XDVCD[1];
    PW07W01.XBCCD = PKWREC.XBCCD[1];
    PW07W01.XWHABRV = PKWREC.XWHABRV;
    PW07W01.PW07W-DNSB-DT = PWKREC.OP1DSBDT[PW07W-DNSB-IDX];
    PW07W01.TF1CARCD = PWKREC.TF1CARCD[PW07W-DNSB-IDX];

    if (PKWREC.XDVCD[1] == "*")
      PW07M001.XDVDESC = "ALL DIVISIONS";
      PW07M002.XDVDESC = "ALL DIVISIONS";
      PW07W01.XDVDESC = "ALL DIVISIONS";
      PW07W00.XDVDESC = "ALL DIVISIONS";
    else
      if (PKWREC.XDVCD[1] in XDVTBL.XDVCD)
        PW07M001.XDVDESC = XDVTBL.XDVDESC[sysVar.arrayIndex];
      end
      if (PKWREC.XDVCD[1] in XDVTBL.XDVCD)
        PW07M002.XDVDESC = XDVTBL.XDVDESC[sysVar.arrayIndex];
      end
      if (PKWREC.XDVCD[1] in XDVTBL.XDVCD)
        PW07W01.XDVDESC = XDVTBL.XDVDESC[sysVar.arrayIndex];
      end
      if (PKWREC.XDVCD[1] in XDVTBL.XDVCD)
        PW07W00.XDVDESC = XDVTBL.XDVDESC[sysVar.arrayIndex];
      end
    end

    if (PKWREC.XBCCD[1] == "*")
      PW07M001.XBCABRV = " ";
      PW07M002.XBCABRV = " ";
      PW07W01.XBCABRV = " ";
      PW07W00.XBCABRV = " ";
    else
      if (PKWREC.XBCCD[1] in XBCTBL.XBCCD)
        PW07M001.XBCABRV = XBCTBL.XBCABRV[sysVar.arrayIndex];
      end
      if (PKWREC.XBCCD[1] in XBCTBL.XBCCD)
        PW07M002.XBCABRV = XBCTBL.XBCABRV[sysVar.arrayIndex];
      end
      if (PKWREC.XBCCD[1] in XBCTBL.XBCCD)
        PW07W01.XBCABRV = XBCTBL.XBCABRV[sysVar.arrayIndex];
      end
      if (PKWREC.XBCCD[1] in XBCTBL.XBCCD)
        PW07W00.XBCABRV = XBCTBL.XBCABRV[sysVar.arrayIndex];
      end
    end

     /* ----------------------------------------------------------------*/
     /* Set run-mode based on picking selection code*/
     /* ----------------------------------------------------------------*/

    if (PKWREC.PKWSELSW == "PP") /* Selection code*/
      PW07W00.PW07W-RUN-MODE = "P";
    else
      PW07W00.PW07W-RUN-MODE = " ";
    end

     /* ----------------------------------------------------------------*/
     /* Set map title based on picking order type indicator*/
     /* ----------------------------------------------------------------*/

    PW07W00.PW07W-ORDER-TYP-IND = PKWREC.PKW-ORDER-TYP-IND;
    PW07W00.PW07W-ORDER-TYP-SV = PKWREC.PKW-ORDER-TYP-IND;

    if (PKWREC.PKW-ORDER-TYP-IND == "B") /* - B-grade*/
      PW07M001.PW07M-APPL-TITLE = "B-GRADE";
      PW07M002.PW07M-APPL-TITLE = "B-GRADE";
    else
      if (PKWREC.PKW-ORDER-TYP-IND == "C") /* - Closeout*/
        PW07M001.PW07M-APPL-TITLE = "CLOSEOUT";
        PW07M002.PW07M-APPL-TITLE = "CLOSEOUT";
      end
    end


     /* ----------------------------------------------------------------*/
     /* Flow to converse the main process used to display map*/
     /* ----------------------------------------------------------------*/

    goto PW07-000; /* Converse the main process*/


    PW07-000: PW07-000();
     /* -----------------------------------------------------------*/
     /* Flow to converse the main process used to display a map*/
     /* -----------------------------------------------------------*/

    goto PW07-001; /* Converse the main process*/

    PW07-001: PW07-001();
     /* ---------------------------------------------------------------*/
     /* Flow to converse the main process used to display a map*/
     /* ---------------------------------------------------------------*/

    goto PW07-001; /* Converse the main process*/

  end // end main
end // end PW07

// Check the FROM application
Function PW07-000()
   /* ------------------------------------------------------------*/
   /* Determine whether control came from an allowed application.*/
   /* ------------------------------------------------------------*/

  if (COMMAREA.CAFROMAP == "PW06" /* From allowed application*/
   || COMMAREA.CAFROMAP == "PW0I" 
   || COMMAREA.CAFROMAP == "PW0R" 
   || COMMAREA.CAFROMAP == "GD00")

    COMMAREA.CAFROMAP = COMMAREA.CACURRAP; /* save curr application*/

    XPPK003(); /* Validate passed warehouse*/

  else

    COMMAREA.CATOAPP = COMMAREA.CAFROMAP;

    XSNOWAY(); /* Invalid transfer was attempted*/

  end


end // end PW07-000

// Main process to display a map
Function PW07-001()
   /* ------------------------------------------------------------*/
   /* This is the main process used to display a map.  Processing*/
   /* always returns to the top of this process and falls through*/
   /* subordinate processes until an error is found or a valid*/
   /* request is processed.  Processing sequence is as follows:*/

   /* 1) Obtain the data to display.*/
   /* 2) Format the map output area and display the map.*/
   /* 3) Check the attention identifier used to respond.*/
   /* 4) Reset highlighted fields to normal intensity.*/
   /* 5) Verify the data that was entered.*/
   /* 6) Process a valid input request.*/

   /* In all subordinate processes, "EZEFLO" is used to exit to*/
   /* redisplay the map when an error is found.  This is done to*/
   /* minimize the coding effort required to skip subsequent*/
   /* processing under error conditions.*/
   /* ------------------------------------------------------------*/

  PW07-100(); /* Obtain the data to display*/

  PW07-200(); /* Format and display the map*/

  PW07-300(); /* Check attention identifier*/

  PW07-400(); /* Reset fields to normal intensity*/

  PW07-500(); /* Verify the entered data*/

  PW07-600(); /* Process valid input request*/


end // end PW07-001

// Obtain the Data to Display
Function PW07-100()
   /* ------------------------------------------------------------*/
   /* If data was not requested or an error was found, return to*/
   /* the previous process.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.PW07W-REQST-DAT-SW == "N" /* Data was not requested*/
   || converseVar.validationMsgNum > 0) /* or an error was found*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Establish the temporary storage queue page length.*/
   /* ------------------------------------------------------------*/

  PW07W00.XXXTSLEN = 648; /* Temporary storage page length*/

   /* ------------------------------------------------------------*/
   /* Get system date*/
   /* ------------------------------------------------------------*/

  XX0XS01();
  PW07W00.PW07W-CURRENT-DT = XX0XW01.XX0XWDAT;

   /* ------------------------------------------------------------*/
   /* If no message to display, reset the page number to display.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.XXXMSGNO == 0) /* No message to display*/

    PW07W00.XXXTSPAG = 1; /* Page number to display*/

  end

   /* ------------------------------------------------------------*/
   /* Purge any pages from temporary storage and save key fields.*/
   /* ------------------------------------------------------------*/

  PW07S-P-TEMP-STOR(); /* Purge any temporary storage*/

  if (PKWREC.PKWSELSW == "PK") /* picking*/

    PW07W00.PW07W-SEL-IND = PW07M002.PW07M-SEL-IND;
    PW07W01.PW07W-SEL-IND = PW07M002.PW07M-SEL-IND;
    PW07W01.XDVCD = PW07M002.XDVCD; /* -division code*/
    PW07W01.XDVDESC = PW07M002.XDVDESC; /* -division desc*/
    PW07W01.XBCCD = PW07M002.XBCCD; /* -brand code*/
    PW07W01.XBCABRV = PW07M002.XBCABRV; /* -brand abrv*/
    PW07W01.XWHCD = PW07M002.XWHCD; /* -warehouse code*/
    PW07W01.XWHABRV = PW07M002.XWHABRV; /* -warehouse abrv*/
  else
    PW07W00.PW07W-SEL-IND = PW07M001.PW07M-SEL-IND;
    PW07W01.PW07W-SEL-IND = PW07M001.PW07M-SEL-IND;
    PW07W01.XDVCD = PW07M001.XDVCD; /* -division code*/
    PW07W01.XDVDESC = PW07M001.XDVDESC; /* -division desc*/
    PW07W01.XBCCD = PW07M001.XBCCD; /* -brand code*/
    PW07W01.XBCABRV = PW07M001.XBCABRV; /* -brand abrv*/
    PW07W01.XWHCD = PW07M001.XWHCD; /* -warehouse code*/
    PW07W01.XWHABRV = PW07M001.XWHABRV; /* -warehouse abrv*/
  end

   /* ------------------------------------------------------------*/
   /* OPEN CURSOR*/
   /* Open DPICK.VPOOLH01 cursor*/
   /* ------------------------------------------------------------*/


  PW07W00.PW07W-MAP-IDX = 1; /* -Display line index*/
  PW07W00.PW07W-POOLH-CSR-SW = "N"; /* -End of cursor switch*/

  PW07S-OPEN-POOLH(); /* -Open pool header cursor*/

   /* ------------------------------------------------------------*/
   /* FETCH CURSOR*/
   /* FETCH row from DPICK.VPOOLH01 and format pages until end*/
   /* of cursor.*/
   /*  */
   /* The flag PW07W-PROCESS-SW will be set to 'N' when there*/
   /* are orders found which are not valid.*/
   /* ------------------------------------------------------------*/

  while (PW07W00.PW07W-POOLH-CSR-SW == "N") /* -Until end of cursor*/

    /* ------- Assume that process order sw = yes ----------*/
    PW07W00.PW07W-PROCESS-SW = "Y";

    PW07S-FETCH-POOLH(); /* Fetch row in the cursor*/

     /* ---------------------------------------------------------*/
     /* See if it is ok to process the order*/
     /* ---------------------------------------------------------*/

     /* ------ poolh row found and okay to process --------------*/
    if (PW07W00.PW07W-POOLH-CSR-SW == "N"
     && PW07W00.PW07W-PROCESS-SW == "Y")

       /* ------------------------------------------------------*/
       /* Verify order - no stock transfers*/
       /* - valid select indicator*/
       /* - valid order type indicator*/
       /* ------------------------------------------------------*/

      if (PW07W-PROCESS-SW == "Y")
        PW07-110();
      end

       /* ------------------------------------------------------*/
       /* Check order hold status & order hold release date.*/
       /* ------------------------------------------------------*/

      if (PW07W-PROCESS-SW == "Y")
        PW07-120();
      end

       /* ------------------------------------------------------*/
       /* Check customer hold status & customer hold release date.*/
       /* ------------------------------------------------------*/

      if (PW07W-PROCESS-SW == "Y")
        PW07-130();
      end

       /* ------------------------------------------------------*/
       /* Check carrier code & carrier's release date.*/
       /* ------------------------------------------------------*/

      if (PW07W-PROCESS-SW == "Y")
        PW07-140();
      end

       /* --------------------------------------------------*/
       /* See if it is still ok to process the order*/
       /* --------------------------------------------------*/

      if (PW07W00.PW07W-PROCESS-SW == "Y")

         /* --------------------------------------------------*/
         /* Save the data in display storage.*/
         /* --------------------------------------------------*/

        PW07-150(); /* Save data in display storage*/

         /* ------------------------------------------------------*/
         /* If the page is full, add the page to the storage queue.*/
         /* ------------------------------------------------------*/

        if (PW07W00.PW07W-MAP-IDX > 12) /* -Page is full*/

          PW07S-A-TEMP-STOR(); /* -Add page to temp stor*/
          PW07W00.PW07W-MAP-IDX = 1; /* -Display line index*/

        end
      end
    end
  end

   /* ------------------------------------------------------------*/
   /* Add any partially formatted last page to the queue.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.PW07W-MAP-IDX > 1) /* Page was formatted*/

    PW07S-A-TEMP-STOR(); /* Add page to temporary storage*/

  end

   /* ------------------------------------------------------------*/
   /* Close the cursor for the selected set.*/
   /* ------------------------------------------------------------*/

  PW07S-CLOSE-POOLH(); /* Close the selected set cursor*/

   /* ------------------------------------------------------------*/
   /* If no pages were formatted, indicate no data to display.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.TA5TSQIX > 0) /* Pages formatted*/
    PW07W00.PW07W-FRMT-SCRN-SW = "Y";

  else
    PW07W00.XXXMODID = "100"; /* Module identification*/
    PW07W00.XXXMSGNO = 31; /* No data was found to display*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Indicate that the request for data is complete.*/
   /* ------------------------------------------------------------*/

  PW07W00.PW07W-REQST-DAT-SW = "N"; /* Request for data switch*/


end // end PW07-100

// VERIFY POOL HEADER ORDER
Function PW07-110()
   /* ------------------------------------------------------------*/
   /* See if ok to process this order.*/
   /* ------------------------------------------------------------*/

   /* ---- Do not process "in-store promo" orders -------------------*/
  if (PK4REC.XGPCD == "01"
   && PK4REC.XDVCD == "01")
    PW07W00.PW07W-PROCESS-SW = "N";
    return;
  end


   /* ---- Do not process "ColeHaan" orders -------------------------*/
  if (PW07M001.XBCCD == "*"
   && PK4REC.XBCCD == "08")
    PW07W00.PW07W-PROCESS-SW = "N";
    return;
  end


   /* ---- Do not process "stock transfer" orders -------------------*/
  if (PK4REC.PK4STKTF == "Y")
    PW07W00.PW07W-PROCESS-SW = "N";
    return;
  end


   /* ------------------------------------------------------------*/
   /* Determine b-grade and closeout, process only those orders*/
   /* which are equal to pkwrec.pkw-ord-typ-ind.*/
   /* ------------------------------------------------------------*/
  XPPK005();

   /* ---- Process ONLY b-grade or closeouts ------------------------*/
  if (PKWREC.PKW-ORDER-TYP-IND != PW07W00.PW07W-ORDER-TYP-IND)
    PW07W00.PW07W-PROCESS-SW = "N";
    return; /* Return to previous process*/
  end

   /* ---- Process ONLY "normal" b-grades for whse 51 ---------------*/
  if (PKWREC.XWHCD == "51"
   && PKWREC.PKW-ORDER-TYP-IND == "B")
    if (PK4REC.XPPCD == "30"
     || PK4REC.XPPCD == "  "
    ) /* next sentence*/
    else
      PW07W00.PW07W-PROCESS-SW = "N";
      return; /* Return to previous process*/
    end
  end


   /* ------------------------------------------------------------*/
   /* Check for valid select indicator*/
   /*  */
   /* PICKING                     PICK PLANNING*/
   /* Sel-ind  pk4rec.pkslind      Sel-ind  pk4rec.pkslind*/
   /* -------  --------------      -------  --------------*/
   /* 'a'    blank, 's'            'a'    blank, 'p'*/
   /* 'n'    blank only            'n'    blank only*/
   /* 's'    's' only              's'    'p' only*/
   /* ------------------------------------------------------------*/

   /* -------- Picking ---------------------------------------------*/
  if (PW07W00.PW07W-RUN-MODE == " ")

    if (PW07M002.PW07M-SEL-IND == "A") /* All orders to be processed*/
      if (PK4REC.PK4SLIND != " "
       && PK4REC.PK4SLIND != "S")
        PW07W00.PW07W-PROCESS-SW = "N"; /* do not process order*/
      end
    else
      if (PW07M002.PW07M-SEL-IND == "S") /* Sel'd orders to be processed*/
        if (PK4REC.PK4SLIND != "S")
          PW07W00.PW07W-PROCESS-SW = "N"; /* do not process order*/
        end
      else /* Non-sel'd orders to be processed*/
        if (PK4REC.PK4SLIND != " ")
          PW07W00.PW07W-PROCESS-SW = "N"; /* do not process order*/
        end
      end
    end

   /* -------- Pick Planning ---------------------------------------*/
  else
    if (PW07M001.PW07M-SEL-IND == "A") /* All orders to be processed*/
      if (PK4REC.PK4SLIND != " "
       && PK4REC.PK4SLIND != "P")
        PW07W00.PW07W-PROCESS-SW = "N"; /* do not process order*/
      end
    else
      if (PW07M001.PW07M-SEL-IND == "S") /* Selected orders to be processed*/
        if (PK4REC.PK4SLIND != "P")
          PW07W00.PW07W-PROCESS-SW = "N"; /* do not process order*/
        end
      else /* Non-selected orders to be processed*/
        if (PK4REC.PK4SLIND != " ")
          PW07W00.PW07W-PROCESS-SW = "N"; /* do not process order*/
        end
      end
    end
  end


end // end PW07-110

// Check order hold
Function PW07-120()
   /* ------------------------------------------------------------*/
   /* Check order hold status  - select unique vorhld01*/
   /* - verify release date*/
   /* ------------------------------------------------------------*/

  if (PK4REC.PK4ORHLD == "Y")

    /* ----- format PKBREC -----------------*/
    set PKBREC empty;

    PKBREC.XWHCD = PW07W01.XWHCD;
    PKBREC.PK1CUOID = PK4REC.PK1CUOID;
    PKBREC.PK1NORID = PK4REC.PK1NORID;
    PKBREC.XHRCD = "*";

    PW07S-SELECT-ORHLD(); /* Select 'S ' - vorhld01*/

     /* ---------------------------------------------------------*/
     /* Validate the appropriate order hold release date, based*/
     /* on whether user is in 'picking' or 'pick planning' mode.*/
     /* ---------------------------------------------------------*/

     /* ------- Picking ---------------*/
    if (PW07W00.PW07W-RUN-MODE == " ")
      if (PKBREC.PKBRELDT > PW07W00.PW07W-CURRENT-DT)

        PW07W00.PW07W-PROCESS-SW = "N"; /* Not ok to process order*/

      end
    else
      /* ------- Pick Planning ---------*/
      if (PKBREC.PKBPLRDT > PW07W00.PW07W-CURRENT-DT)

        PW07W00.PW07W-PROCESS-SW = "N"; /* Not ok to process order*/

      end
    end
  end


end // end PW07-120

// Check customer hold
Function PW07-130()
   /* ------------------------------------------------------------*/
   /* Check customer hold status - select unique vcuhld01*/
   /* - verify release date*/
   /* ------------------------------------------------------------*/

  if (PK4REC.PK4CUHLD == "Y")

    PW07S-SELECT-CUHLD();

    /* ------------------------------------------------------------*/
    /* Validate the appropriate customer hold release date, based*/
    /* on whether user is in 'picking' or 'pick planning' mode.*/
    /* ------------------------------------------------------------*/

    /* ------- Picking ---------------------------------*/
    if (PW07W00.PW07W-RUN-MODE == " ")

      if (PK9REC.PK9RELDT > PW07W00.PW07W-CURRENT-DT)

        PW07W00.PW07W-PROCESS-SW = "N"; /* Do not process order*/

      end
    else
    /* ------- Picking ---------------------------------*/
      if (PK9REC.PK9PLRDT > PW07W00.PW07W-CURRENT-DT)

        PW07W00.PW07W-PROCESS-SW = "N"; /* Do not process order*/

      end
    end
  end

end // end PW07-130

// Check carrier code
Function PW07-140()
   /* ------------------------------------------------------------*/
   /* Check carrier code status*/
   /* ------------------------------------------------------------*/

  PW07S-SELECT-CAHLD();

   /* ------------------------------------------------------------*/
   /* Validate the appropriate carrier hold release date, based*/
   /* on whether user is in 'picking' or 'pick planning' mode.*/
   /* ------------------------------------------------------------*/

   /* ----- Picking --------------------------*/
  if (PW07W00.PW07W-RUN-MODE == " ")

    if (PWFREC.PKBRELDT > PW07W00.PW07W-CURRENT-DT)

      PW07W00.PW07W-PROCESS-SW = "N"; /* Do not process order*/

    end
  else

    /* ----- Picking --------------------------*/
    if (PWFREC.PKBPLRDT > PW07W00.PW07W-CURRENT-DT)

      PW07W00.PW07W-PROCESS-SW = "N"; /* Do not process order*/

    end
  end


end // end PW07-140

// Save data in display storage
Function PW07-150()
   /* ------------------------------------------------------------*/
   /* Save the data from the table row in display storage.*/
   /* ------------------------------------------------------------*/

   /* ------ format header ----------------------------------------*/
  PW07W01.XWHCD = PW07W00.XWHCD;
  PW07W01.XWHABRV = PW07W00.XWHABRV;
  PW07W01.PW07W-SEL-IND = PKWREC.PKWSLTYP[PKWINDEX];

  PW07W01.XDVCD = PW07W00.XDVCD;
  if (PW07W00.XDVCD == "*")
    PW07W01.XDVDESC = "ALL DIVISIONS";
  else
    PW07W01.XDVDESC = PW07W00.XDVDESC;
  end

  PW07W01.XBCCD = PW07W00.XBCCD;
  if (PW07W00.XBCCD == "*")
    PW07W00.XXXMSGNO = 421;
    PW07W01.XBCABRV = " ";
  else
    PW07W01.XBCABRV = PW07W00.XBCABRV;
  end


   /* ------ format detail lines ----------------------------------*/
  PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = " ";
  PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX] = PK4REC.PK1CUOID;
  PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX] = PK4REC.PK1NORID;
  PW07W01.PW07W-FC-QTY[PW07W-MAP-IDX] = PK4REC.PK4ORDFC;
  PW07W01.PW07W-RP-QTY[PW07W-MAP-IDX] = PK4REC.PK4ORDRP;
  PW07W01.PW07W-TOT-QTY[PW07W-MAP-IDX] = PK4REC.PK4OTUNT;
  PW07W01.PW07W-SP-HNDL-FL[PW07W-MAP-IDX] = PK4REC.OP1SPHDF;

  if (PK4REC.PK4SLIND != " ") /* If order has been selected*/
    PW07W01.PW07W-SELECT-FL[PW07W-MAP-IDX] = "Y";

  else
    PW07W01.PW07W-SELECT-FL[PW07W-MAP-IDX] = "N";

  end

  PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX + 1; /* Increment line index*/


end // end PW07-150

// Format and converse the map
Function PW07-200()
   /* ------------------------------------------------------------*/
   /* If an error was found, save the error message number.*/
   /* ------------------------------------------------------------*/

  if (converseVar.validationMsgNum != 0) /* Error was found*/

    PW07W00.XXXMSGNO = converseVar.validationMsgNum; /* Message number*/

  end

   /* ------------------------------------------------------------*/
   /* If obtain data failed or no error, format data to display.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.PW07W-REQST-DAT-SW == "Y" /* Obtain data failed*/
   || converseVar.validationMsgNum == 0) /* or no error found*/

    if (PW07W00.PW07W-FRMT-SCRN-SW == "Y") /* Map must be formatted*/

      if (PKWREC.PKWSELSW == "PK")
        PW07-21002(); /* Format picking data on map2*/
      else
        PW07-21001(); /* Format planning data on map1*/
      end
    end
  end

   /* ------------------------------------------------------------*/
   /* Set cursor, if needed*/
   /* ------------------------------------------------------------*/

  if (PW07W00.TA5TSQIX == 0) /* If no pages were formatted*/
    if (PKWREC.PKWSELSW == "PK") /* PICKING*/

      if (PWKREC.PWKARMAX > 0) /* At least one DNSB existed*/
        set PW07M002.PW07M-SEL-IND cursor; /* Set cursor on selection cd*/
      else
        set PW07M002.PW07M-SEL-IND cursor, skip, invisible; /* No entry allowed*/
      end

    else

      if (PWKREC.PWKARMAX > 0) /* At least one DNSB existed*/
        set PW07M001.PW07M-SEL-IND cursor; /* Set cursor on selection cd*/
      else
        set PW07M001.PW07M-SEL-IND cursor, skip, invisible; /* No entry allowed*/
      end
    end
  end

  if (PKWREC.PKWSELSW == "PK") /* picking*/
    PW07-20002();
  else
    PW07-20001(); /* pick planning*/
  end


end // end PW07-200

// Format and converse the map
Function PW07-20001()

   /* ------------------------------------------------------------*/
   /* Note: Apply the same changes to pw07-20002 also.*/
   /* ------------------------------------------------------------*/
   /* ------------------------------------------------------------*/
   /* Format the current date and any FAST PATH information.*/
   /* ------------------------------------------------------------*/

  PW07M001.XXXCURDT = VGVar.currentShortGregorianDate; /* Current date*/
  PW07M001.CATOAP = COMMAREA.CATOAP; /* TO application*/
  PW07M001.CAITEM = COMMAREA.CAITEM; /* Application data*/

   /* ------------------------------------------------------------*/
   /* If a message to display, indicate sound audible alarm.*/
   /* ------------------------------------------------------------*/

  if (converseVar.validationMsgNum == 0)
    if (PW07W00.XXXMSGNO != 0 /* Message to display*/
     || COMMAREA.CAMSG != " ") /* or message text*/

      if (PW07W00.XXXMSGNO != 0) /* Message to display*/

        if (PW07W00.XXXTSPAG == 1) /* First page*/
          if (PW07W00.XXXMSGNO == 9999)
            converseLib.validationFailed();
          else
            converseLib.validationFailed(PW07W00.XXXMSGNO);
          end /* Message number*/
          PW07M001.XXXMODID = PW07W00.XXXMODID; /* Module id*/
          set PW07M001 alarm; /* Indicate sound alarm*/
        end
      else
        PW07M001.VAGen_EZEMSG = COMMAREA.CAMSG; /* Message text*/
        PW07M001.XXXMODID = PW07W00.XXXMODID; /* Module id*/
        set PW07M001 alarm; /* Indicate sound alarm*/
      end

      /* -------- Fast path entered, but was in error ----------------*/
      if (PW07M001.CATOAP > " "
       && PW07W00.PW07W-BD-FSTPTH-SW == "Y")

        set PW07M001.CATOAP cursor, bold; /* Highlight*/
      end

    end
  else
    PW07M001.XXXMODID = PW07W00.XXXMODID; /* Module id*/
    set PW07M001 alarm; /* Indicate sound alarm*/
  end

  converse PW07M001 ;
   /* ------------------------------------------------------------*/
   /* Clear the message fields and save FAST PATH information.*/
   /* ------------------------------------------------------------*/

  converseLib.validationFailed(0); /* Message number*/
  PW07W00.XXXMSGNO = 0; /* Message number*/
  COMMAREA.CAMSG = " "; /* Message text*/
  PW07W00.XXXMODID = " "; /* Module identification*/
  PW07W00.PW07W-BD-FSTPTH-SW = "N";
  PW07W00.PW07W-ORD-HLD-SW = "N";

  COMMAREA.CATOAP = PW07M001.CATOAP; /* TO application*/
  COMMAREA.CAITEM = PW07M001.CAITEM; /* Application data*/


end // end PW07-20001

// Format and converse the map
Function PW07-20002()

   /* ------------------------------------------------------------*/
   /* Note: Apply the same changes to pw07-20001 also.*/
   /* ------------------------------------------------------------*/
   /* ------------------------------------------------------------*/
   /* Format the current date and any FAST PATH information.*/
   /* ------------------------------------------------------------*/

  PW07M002.XXXCURDT = VGVar.currentShortGregorianDate; /* Current date*/
  PW07M002.CATOAP = COMMAREA.CATOAP; /* TO application*/
  PW07M002.CAITEM = COMMAREA.CAITEM; /* Application data*/

   /* ------------------------------------------------------------*/
   /* If a message to display, indicate sound audible alarm.*/
   /* ------------------------------------------------------------*/

  if (converseVar.validationMsgNum == 0)
    if (PW07W00.XXXMSGNO != 0 /* Message to display*/
     || COMMAREA.CAMSG != " ") /* or message text*/

      if (PW07W00.XXXMSGNO != 0) /* Message to display*/

        if (PW07W00.XXXTSPAG == 1) /* First page*/
          if (PW07W00.XXXMSGNO == 9999)
            converseLib.validationFailed();
          else
            converseLib.validationFailed(PW07W00.XXXMSGNO);
          end /* Message number*/
          PW07M002.XXXMODID = PW07W00.XXXMODID; /* Module id*/
          set PW07M002 alarm; /* Indicate sound alarm*/
        end
      else
        PW07M002.VAGen_EZEMSG = COMMAREA.CAMSG; /* Message text*/
        PW07M002.XXXMODID = PW07W00.XXXMODID; /* Module id*/
        set PW07M002 alarm; /* Indicate sound alarm*/
      end

      /* -------- Fast path entered, but was in error ----------------*/
      if (PW07M002.CATOAP > " "
       && PW07W00.PW07W-BD-FSTPTH-SW == "Y")

        set PW07M002.CATOAP cursor, bold; /* Highlight*/
      end
    end
  else
    PW07M002.XXXMODID = PW07W00.XXXMODID; /* Module id*/
    set PW07M002 alarm; /* Indicate sound alarm*/
  end


  converse PW07M002 ;
   /* ------------------------------------------------------------*/
   /* Clear the message fields and save FAST PATH information.*/
   /* ------------------------------------------------------------*/

  converseLib.validationFailed(0); /* Message number*/
  PW07W00.XXXMSGNO = 0; /* Message number*/
  COMMAREA.CAMSG = " "; /* Message text*/
  PW07W00.XXXMODID = " "; /* Module identification*/
  PW07W00.PW07W-BD-FSTPTH-SW = "N";
  PW07W00.PW07W-ORD-HLD-SW = "N";

  COMMAREA.CATOAP = PW07M002.CATOAP; /* TO application*/
  COMMAREA.CAITEM = PW07M002.CAITEM; /* Application data*/


end // end PW07-20002

// Format the display data
Function PW07-21001()
   /* ------------------------------------------------------------*/
   /* Note: Apply the same changes to pw07-21002 also.*/
   /* ------------------------------------------------------------*/
   /* ------------------------------------------------------------*/
   /* Clear the fields in the map storage area to be formatted.*/
   /* ------------------------------------------------------------*/

  set PW07M001 initial; /* M001 input/output area*/

  PW07W00.PW07W-FRMT-SCRN-SW = "N"; /* Format the map switch*/

   /* ------------------------------------------------------------*/
   /* If the page in storage is not the page to be displayed,*/
   /* obtain the desired page from temporary storage.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.TA5TSQIX > 0) /* Pages were formatted*/

    if (PW07W00.XXXTSPAG != TA5REC.TA5TSQIX) /* Desired page not current*/

      /* ------------------------------------------------------------*/
      /* If the current page has been changed, update the page in*/
      /* storage before obtaining the next one to display.*/
      /* ------------------------------------------------------------*/

      if (PW07W00.PW07W-STOR-UPD-SW == "Y")

        PW07S-U-TEMP-STOR(); /* Update temporary storage page*/
        PW07W00.PW07W-STOR-UPD-SW = "N"; /* Reset switch*/
      end

      /* ------------------------------------------------------------*/
      /* If the desired page number is greater than the highest page*/
      /* in storage, default to the highest page number.*/
      /* ------------------------------------------------------------*/

      if (PW07W00.XXXTSPAG > PW07W00.TA5TSQIX) /* Desired greater highest*/

        PW07W00.XXXTSPAG = PW07W00.TA5TSQIX; /* Default to highest*/
      end

      PW07S-R-TEMP-STOR(); /* Read temporary storage page*/
    end

    /* ------------------------------------------------------------*/
    /* Display the page information on the screen.*/
    /* ------------------------------------------------------------*/

    set PW07M001.XXXLITPG skip;
    PW07M001.XXXLITPG = "PAGE"; /* "page" constant*/
    set PW07M001.XXXLITOF skip;
    PW07M001.XXXLITOF = "OF"; /* "of" constant*/
    PW07M001.XXXTSPAG = PW07W00.XXXTSPAG; /* Current page*/
    PW07M001.XXXTSQIX = PW07W00.TA5TSQIX; /* Highest page*/

    PW07W00.PW07W-MAP-IDX = 1; /* Initialize line index*/

    /* ----- Until screen is full & data exists ---------------*/
    while (PW07W00.PW07W-MAP-IDX <= 12
     && PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX] != 0)

      PW07M001.PW07M-MAP-DOT[PW07W-MAP-IDX] = ".";
      PW07M001.PW07M-ACTION[PW07W-MAP-IDX] = PW07W01.PW07W-ACTION[PW07W-MAP-IDX];
      PW07M001.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] = PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX];
      PW07M001.PW07M-NIKE-ORD-ID[PW07W-MAP-IDX] = PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX];
      PW07M001.PW07M-FC-QTY[PW07W-MAP-IDX] = PW07W01.PW07W-FC-QTY[PW07W-MAP-IDX];
      PW07M001.PW07M-RP-QTY[PW07W-MAP-IDX] = PW07W01.PW07W-RP-QTY[PW07W-MAP-IDX];
      PW07M001.PW07M-TOT-QTY[PW07W-MAP-IDX] = PW07W01.PW07W-TOT-QTY[PW07W-MAP-IDX];
      PW07M001.PW07M-SP-HNDL-FL[PW07W-MAP-IDX] = PW07W01.PW07W-SP-HNDL-FL[PW07W-MAP-IDX];
      PW07M001.PW07M-SELECT-FL[PW07W-MAP-IDX] = PW07W01.PW07W-SELECT-FL[PW07W-MAP-IDX];
      PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] = PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX];
      PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] = PW07W01.PW07W-REL-MM[PW07W-MAP-IDX];
      PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] = PW07W01.PW07W-REL-DD[PW07W-MAP-IDX];
      PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] = PW07W01.PW07W-REL-YY[PW07W-MAP-IDX];

      /* -------- set fields to normal -------------------------*/
      if (PW07W00.PW07W-MAP-IDX == 1) /* First select field*/
        set PW07M001.PW07M-ACTION[PW07W-MAP-IDX] cursor, normal;
      else
        set PW07M001.PW07M-ACTION[PW07W-MAP-IDX] normal;
      end

      set PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] normal;
      set PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] normal;
      set PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] normal;
      set PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] normal;

      PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX + 1;

    end
  end


   /* ------------------------------------------------------------*/
   /* Display the header information on the screen.*/
   /* ------------------------------------------------------------*/

  PW07M001.XWHCD = PW07W01.XWHCD; /* Whse cd*/
  PW07M001.XWHABRV = PW07W01.XWHABRV;

  PW07M001.XDVCD = PW07W01.XDVCD; /* Division code*/
  if (PW07W01.XDVCD == "*")
    PW07M001.XDVDESC = "ALL DIVISIONS";
  else
    PW07M001.XDVDESC = PW07W01.XDVDESC;
  end

  PW07M001.XBCCD = PW07W01.XBCCD;
  if (PW07W01.XBCCD == "*")
    PW07M001.XBCABRV = " ";
    if (PW07W00.XXXMSGNO == 0) /* no other msg to display*/
      PW07W00.XXXMSGNO = 421;
    end
  else
    PW07M001.XBCABRV = PW07W01.XBCABRV;
  end

  PW07M001.PW07M-SEL-IND = PW07W00.PW07W-SEL-IND;
  PW07W01.PW07W-DNSB-DT = PWKREC.OP1DSBDT[PW07W-DNSB-IDX];
  PW07M001.PW07M-DNSB-MM = PW07W01.PW07W-DNSB-MM;
  PW07M001.PW07M-DNSB-DD = PW07W01.PW07W-DNSB-DD;
  PW07M001.PW07M-DNSB-YY = PW07W01.PW07W-DNSB-YY;
  PW07M001.TF1CARCD = PWKREC.TF1CARCD[PW07W-DNSB-IDX];


   /* ------- format run mode -------------------------*/
  if (PW07W00.PW07W-RUN-MODE == "P")
    PW07M001.PW07M-MAP-APPL = "PICK PLANNING";
  end

   /* ------- format map title ------------------------*/
  if (PW07W00.PW07W-ORDER-TYP-IND == "B")
    PW07M001.PW07M-APPL-TITLE = " B-GRADE";
  else
    PW07M001.PW07M-APPL-TITLE = "CLOSEOUT";
  end


  if (PW07W00.PW07W-SEL-IND <= " ") /* Selection code not present*/
    set PW07M001.PW07M-SEL-IND cursor; /* Position cursor*/
  end


end // end PW07-21001

// Format the display data
Function PW07-21002()
   /* ------------------------------------------------------------*/
   /* Note: Apply the same changes to pw07-21001 also.*/
   /* ------------------------------------------------------------*/
   /* ------------------------------------------------------------*/
   /* Clear the fields in the map storage area to be formatted.*/
   /* ------------------------------------------------------------*/

  set PW07M002 initial; /* M002 input/output area*/

  PW07W00.PW07W-FRMT-SCRN-SW = "N"; /* Format the map switch*/

   /* ------------------------------------------------------------*/
   /* If the page in storage is not the page to be displayed,*/
   /* obtain the desired page from temporary storage.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.TA5TSQIX > 0) /* Pages were formatted*/

    if (PW07W00.XXXTSPAG != TA5REC.TA5TSQIX) /* Desired page not current*/

      /* ------------------------------------------------------------*/
      /* If the current page has been changed, update the page in*/
      /* storage before obtaining the next one to display.*/
      /* ------------------------------------------------------------*/

      if (PW07W00.PW07W-STOR-UPD-SW == "Y")

        PW07S-U-TEMP-STOR(); /* Update temporary storage page*/
        PW07W00.PW07W-STOR-UPD-SW = "N"; /* Reset switch*/
      end

      /* ------------------------------------------------------------*/
      /* If the desired page number is greater than the highest page*/
      /* in storage, default to the highest page number.*/
      /* ------------------------------------------------------------*/

      if (PW07W00.XXXTSPAG > PW07W00.TA5TSQIX) /* Desired greater highest*/

        PW07W00.XXXTSPAG = PW07W00.TA5TSQIX; /* Default to highest*/
      end

      PW07S-R-TEMP-STOR(); /* Read temporary storage page*/
    end

    /* ------------------------------------------------------------*/
    /* Display the page information on the screen.*/
    /* ------------------------------------------------------------*/

    set PW07M002.XXXLITPG skip;
    PW07M002.XXXLITPG = "PAGE"; /* "page" constant*/
    set PW07M002.XXXLITOF skip;
    PW07M002.XXXLITOF = "OF"; /* "of" constant*/
    PW07M002.XXXTSPAG = PW07W00.XXXTSPAG; /* Current page*/
    PW07M002.XXXTSQIX = PW07W00.TA5TSQIX; /* Highest page*/

    PW07W00.PW07W-MAP-IDX = 1; /* Initialize line index*/

    /* ----- Until screen is full & data exists ---------------*/
    while (PW07W00.PW07W-MAP-IDX <= 12
     && PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX] != 0)

      PW07M001.PW07M-MAP-DOT[PW07W-MAP-IDX] = ".";
      PW07M002.PW07M-ACTION[PW07W-MAP-IDX] = PW07W01.PW07W-ACTION[PW07W-MAP-IDX];
      PW07M002.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] = PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX];
      PW07M002.PW07M-NIKE-ORD-ID[PW07W-MAP-IDX] = PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX];
      PW07M002.PW07M-FC-QTY[PW07W-MAP-IDX] = PW07W01.PW07W-FC-QTY[PW07W-MAP-IDX];
      PW07M002.PW07M-RP-QTY[PW07W-MAP-IDX] = PW07W01.PW07W-RP-QTY[PW07W-MAP-IDX];
      PW07M002.PW07M-TOT-QTY[PW07W-MAP-IDX] = PW07W01.PW07W-TOT-QTY[PW07W-MAP-IDX];
      PW07M002.PW07M-SP-HNDL-FL[PW07W-MAP-IDX] = PW07W01.PW07W-SP-HNDL-FL[PW07W-MAP-IDX];
      PW07M002.PW07M-SELECT-FL[PW07W-MAP-IDX] = PW07W01.PW07W-SELECT-FL[PW07W-MAP-IDX];
      PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] = PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX];
      PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] = PW07W01.PW07W-REL-MM[PW07W-MAP-IDX];
      PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] = PW07W01.PW07W-REL-DD[PW07W-MAP-IDX];
      PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] = PW07W01.PW07W-REL-YY[PW07W-MAP-IDX];

      /* -------- set fields to normal -------------------------*/
      if (PW07W00.PW07W-MAP-IDX == 1) /* First select field*/
        set PW07M002.PW07M-ACTION[PW07W-MAP-IDX] cursor, normal;
      else
        set PW07M002.PW07M-ACTION[PW07W-MAP-IDX] normal;
      end

      set PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] normal;
      set PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] normal;
      set PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] normal;
      set PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] normal;

      PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX + 1;

    end
  end


   /* ------------------------------------------------------------*/
   /* Display the header information on the screen.*/
   /* ------------------------------------------------------------*/

  PW07M002.XWHCD = PW07W01.XWHCD; /* Whse cd*/
  PW07M002.XWHABRV = PW07W01.XWHABRV;

  PW07M002.XDVCD = PW07W01.XDVCD; /* Division code*/
  if (PW07W01.XDVCD == "*")
    PW07M002.XDVDESC = "ALL DIVISIONS";
  else
    PW07M002.XDVDESC = PW07W01.XDVDESC;
  end

  PW07M002.XBCCD = PW07W01.XBCCD;
  if (PW07W01.XBCCD == "*")
    PW07M002.XBCABRV = " ";
    if (PW07W00.XXXMSGNO == 0) /* no other msg to display*/
      PW07W00.XXXMSGNO = 421;
    end
  else
    PW07M002.XBCABRV = PW07W01.XBCABRV;
  end

  PW07M002.PW07M-SEL-IND = PW07W00.PW07W-SEL-IND;
  PW07W01.PW07W-DNSB-DT = PWKREC.OP1DSBDT[PW07W-DNSB-IDX];
  PW07M002.PW07M-DNSB-MM = PW07W01.PW07W-DNSB-MM;
  PW07M002.PW07M-DNSB-DD = PW07W01.PW07W-DNSB-DD;
  PW07M002.PW07M-DNSB-YY = PW07W01.PW07W-DNSB-YY;
  PW07M002.TF1CARCD = PWKREC.TF1CARCD[PW07W-DNSB-IDX];


   /* ------- format run mode -------------------------*/
  if (PW07W00.PW07W-RUN-MODE == "P")
     /* NEXT SENTENCE;*/
  else
    PW07M002.PW07M-MAP-APPL = "   PICKING   ";
  end

   /* ------- format map title ------------------------*/
  if (PW07W00.PW07W-ORDER-TYP-IND == "B")
    PW07M002.PW07M-APPL-TITLE = " B-GRADE";
  else
    PW07M002.PW07M-APPL-TITLE = "CLOSEOUT";
  end


  if (PW07W00.PW07W-SEL-IND <= " ") /* Selection code not present*/
    set PW07M002.PW07M-SEL-IND cursor; /* Position cursor*/
  end


end // end PW07-21002

// Check Attention Identifier
Function PW07-300()
   /* ------------------------------------------------------------*/
   /* If CANCEL was requested, clear the map fields and exit.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pa2) /* PA2 was pressed*/

    if (PW07W00.PW07W-REQST-DAT-SW == "Y") /* Request for data*/

      set PW07W01 empty; /* M001 display storage*/
    end

    PW07W00.PW07W-FRMT-SCRN-SW = "Y"; /* Format map sw on*/
    PW07W00.PW07W-REQST-DAT-SW = "N"; /* Request for data sw off*/

    COMMAREA.CATOAP = " "; /* TO application*/
    COMMAREA.CAITEM = " "; /* Application data*/
    exit stack; /* Exit to display map*/

  end

   /* ------------------------------------------------------------*/
   /* If FAST PATH was requested, this is an error.*/
   /* ------------------------------------------------------------*/

  if (PW07M001.CATOAP > " ") /* FAST PATH was requested*/
    if (converseVar.eventKey is enter) /* ENTER was pressed*/
      if (PW07M001.CATOAP != "PW07") /* FAST PATH not to itself*/
        PW07S-P-TEMP-STOR(); /* Purge temporary storage*/
        XSPKS01(); /* Exit to another application*/
        PW07W00.PW07W-REQST-DAT-SW = "Y"; /* recreate t/s*/
        PW07W00.PW07W-FRMT-SCRN-SW = "Y"; /* format screen*/
        PW07W00.PW07W-BD-FSTPTH-SW = "Y"; /* bad fastpath on*/
      end
      converseLib.validationFailed(1); /* Invalid FAST PATH*/
    else
      converseLib.validationFailed(13); /* PA/PF key may not be used*/
    end
    PW07W00.XXXMODID = "300"; /* Module identification*/
    set PW07M001.CATOAP cursor, bold; /* Highlight*/
    exit stack; /* Exit to display map*/
  else
    if (PW07M002.CATOAP > " ") /* FAST PATH was requested*/
      if (converseVar.eventKey is enter) /* ENTER was pressed*/
        if (PW07M002.CATOAP != "PW07") /* FAST PATH not to itself*/
          PW07S-P-TEMP-STOR(); /* Purge temporary storage*/
          XSPKS01(); /* Exit to another application*/
          PW07W00.PW07W-REQST-DAT-SW = "Y"; /* recreate t/s*/
          PW07W00.PW07W-FRMT-SCRN-SW = "Y"; /* format screen*/
          PW07W00.PW07W-BD-FSTPTH-SW = "Y"; /* bad fastpath on*/
        end
        converseLib.validationFailed(1); /* Invalid FAST PATH*/
      else
        converseLib.validationFailed(13); /* PA/PF key may not be used*/
      end
      PW07W00.XXXMODID = "300"; /* Module identification*/
      set PW07M002.CATOAP cursor, bold; /* Highlight*/
      exit stack; /* Exit to display map*/
    end
  end

   /* ------------------------------------------------------------*/
   /* If PF1, PF3, PF4, or PF5 exit to another application*/
   /* If HELP, exit to the previous level or exit to the Master*/
   /* Menu was requested.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf1 /* PF1 was pressed*/
   || converseVar.eventKey is pf3 /* or PF3 was pressed*/
   || converseVar.eventKey is pf4 /* or PF4 was pressed*/
   || converseVar.eventKey is pf5) /* or PF5 was pressed*/

    if (converseVar.eventKey is pf1) /* PF1 was pressed*/
      if (PKWREC.PKWSELSW == "PK") /* picking*/
        COMMAREA.CAITEM = "PW07M002"; /* Application find code*/
      else
        COMMAREA.CAITEM = "PW07M001"; /* Application find code*/
      end

    else
      if (converseVar.eventKey is pf3) /* PF3 was pressed*/

        COMMAREA.CATOAP = "PW06"; /* TO application*/

      else
        if (converseVar.eventKey is pf5) /* PF5 was pressed*/

          COMMAREA.CATOAP = "PW0R"; /* TO application*/

        end
      end
    end

    PW07S-P-TEMP-STOR(); /* Purge temporary storage*/

    PKWREC.PKW-ORDER-TYP-IND = PW07W00.PW07W-ORDER-TYP-IND;
    PKWREC.PKWARRAY[PKWINDEX] = PWKREC.PWKARRAY;
    XSPKS01(); /* Exit to another application*/


    PW07W00.XXXMODID = "300"; /* Module identification*/
    PW07W00.PW07W-REQST-DAT-SW = "Y"; /* recreate t/s*/
    PW07W00.PW07W-FRMT-SCRN-SW = "Y"; /* format screen*/

    exit stack; /* Exit to display map*/

  end

   /* ------------------------------------------------------------*/
   /* Determine whether a valid attention identifier was used to*/
   /* invoke the transaction.  Display an error message to the*/
   /* user if the PF key used is not supported.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey not enter /* ENTER was not pressed*/
   && converseVar.eventKey not pf7   /* and PF7 was not pressed*/
   && converseVar.eventKey not pf8)  /* and PF8 was not pressed*/

    PW07W00.XXXMODID = "300"; /* Module identification*/
    converseLib.validationFailed(12); /* PA/PF key pressed is not valid*/

    if (converseVar.eventKey is pakey) /* PA key was pressed*/
      converseLib.clearScreen();
       /* Clear screen before display*/
      converseLib.clearScreen();
       /* Clear screen before display*/
    end

    exit stack; /* Exit to display map*/

  end

   /* ------------------------------------------------------------*/
   /* If no more DNSB Dates, do not allow ENTER, PF7, or PF8.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.PW07W-MORE-DNSB-SW == "N") /* No more dnsb dates*/

    PW07W00.XXXMODID = "300"; /* Module identification*/
    converseLib.validationFailed(339); /* No more DNSB to display*/

    exit stack; /* Exit to display map*/

  end


end // end PW07-300

// Reset Highlighted Fields
Function PW07-400()
   /* ------------------------------------------------------------*/
   /* Reset all modifiable field attributes to normal intensity.*/
   /* ------------------------------------------------------------*/

  if (PKWREC.PKWSELSW == "PK") /* picking*/
    set PW07M002.PW07M-SEL-IND initialAttributes; /* select code*/
    set PW07M002.XWHCD initialAttributes; /* warehouse code*/
    set PW07M002.XWHABRV initialAttributes; /* warehouse abrv*/
    set PW07M002.XDVCD initialAttributes; /* division code*/
    set PW07M002.XDVDESC initialAttributes; /* division desc*/
    set PW07M002.XBCCD initialAttributes; /* brand code*/
    set PW07M002.XBCABRV initialAttributes; /* brand abrv*/

  else
    set PW07M001.PW07M-SEL-IND initialAttributes; /* select code*/
    set PW07M001.XWHCD initialAttributes; /* warehouse code*/
    set PW07M001.XWHABRV initialAttributes; /* warehouse abrv*/
    set PW07M001.XDVCD initialAttributes; /* division code*/
    set PW07M001.XDVDESC initialAttributes; /* division desc*/
    set PW07M001.XBCCD initialAttributes; /* brand code*/
    set PW07M001.XBCABRV initialAttributes; /* brand abrv*/

  end
  PW07W00.PW07W-MAP-IDX = 1; /* Initialize line index*/

   /* ----- Until end of line or no more data -------------*/
  while (PW07W00.PW07W-MAP-IDX <= 12
   && PW07M001.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] > 0
   && PW07M002.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] > 0)

    /* ------- reset attributes ------------------*/

    if (PKWREC.PKWSELSW == "PK") /* picking*/
      set PW07M002.PW07M-ACTION[PW07W-MAP-IDX] normal;
      set PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] normal;
      set PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] normal;
      set PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] normal;
      set PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] normal;

      PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX + 1;

    else

      set PW07M001.PW07M-ACTION[PW07W-MAP-IDX] normal;
      set PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] normal;
      set PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] normal;
      set PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] normal;
      set PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] normal;

      PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX + 1;

    end
  end

  set PW07M001.CATOAP initialAttributes; /* TO application*/
  set PW07M002.CATOAP initialAttributes; /* TO application*/
  set PW07M001.CAITEM initialAttributes; /* Application data*/
  set PW07M002.CAITEM initialAttributes; /* Application data*/

   /* ------------------------------------------------------------*/
   /* If any '?' found in hold cd, display pop-up window for cds*/
   /* ------------------------------------------------------------*/

  if ("?" in PW07M001.PW07M-HOLD-CD /* If a '?' in any of the hold codes*/
   || "?" in PW07M002.PW07M-HOLD-CD)

    if (converseVar.eventKey is enter)

        /* ------- display pop-up window ---------------------*/
      PW07W00.PW07W-MAP-IDX = sysVar.arrayIndex; /* set index*/
      PW07-410();

    else

        /* ------- option only valid with ENTER --------------*/
      set PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] bold; /* Highlight*/
      set PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] bold; /* Highlight*/
      PW07W00.XXXMODID = "400"; /* Module id*/
      converseLib.validationFailed(320); /* Error message*/

      exit stack; /* Exit to display map*/

    end
  end


end // end PW07-400

// Display pop-up window for hold
Function PW07-410()
   /* ------------------------------------------------------------*/
   /* Display pop-up window for hold codes.*/
   /* ------------------------------------------------------------*/

  XPXX001(); /* pop-up window initialization*/

  XX0XW02.XX0XWHDR = "        HOLD REASON CODES"; /* set window title*/

  while (XX0XW02.XX0XWEND == "N") /* Until end of request*/

    XPXHR01(); /* display the list*/

  end


  if (PKWREC.PKWSELSW == "PK") /* picking*/

    if (XX0XW02.XX0XWPIX == 0) /* no selection made*/
      PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] = PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX];
    else
      PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] = XHRTBL.XHRCD[XX0XWPIX];
    end
  else
    if (XX0XW02.XX0XWPIX == 0) /* no selection made*/
      PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] = PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX];
    else
      PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] = XHRTBL.XHRCD[XX0XWPIX];
    end
  end


  converseLib.clearScreen();
  
  converseLib.clearScreen();
  
  PW07W00.XXXMODID = "410"; /* Module id*/


end // end PW07-410

// Verify the Entered Data
Function PW07-500()
   /* ------------------------------------------------------------*/
   /* main module to control processing for both map1 and map2*/
   /* ------------------------------------------------------------*/

  if (PKWREC.PKWSELSW == "PK") /* PICKING*/
    PW07-50002();
  else
    PW07-50001();
  end


end // end PW07-500

// Verify the Entered Data
Function PW07-50001()
   /* ------------------------------------------------------------*/
   /* NOTE:  When making changes, they must be done in both modules*/
   /* ------------------------------------------------------------*/
   /* ------------------------------------------------------------*/
   /* Check for item in fast path*/
   /* ------------------------------------------------------------*/

  if (PW07M001.CAITEM > " " /* Application data was entered*/
  )                        
    PW07W00.XXXMODID = "500"; /* Module identification*/
    set PW07M001.CAITEM cursor, bold; /* Highlight*/
    converseLib.validationFailed(16); /* Item invalid w/o FAST PATH*/

  end

   /* ------------------------------------------------------------*/
   /* Determine whether a valid request to scroll was entered.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf7 /* Scroll back request*/
   || converseVar.eventKey is pf8) /* or scroll forward request*/

    PW07-510(); /* Verify scroll request*/

  end

   /* ------------------------------------------------------------*/
   /* If selection code was entered, validate it.*/
   /* ------------------------------------------------------------*/

  if (PW07M001.PW07M-SEL-IND != PW07W00.PW07W-SEL-IND)
    if (PW07M001.PW07M-SEL-IND == "A"
     || PW07M001.PW07M-SEL-IND == "N"
     || PW07M001.PW07M-SEL-IND == "S")

      PW07W-REQST-DAT-SW = "Y"; /* request data switch*/

    else
      set PW07M001.PW07M-SEL-IND cursor, bold; /* Highlight*/
      PW07W00.XXXMODID = "500"; /* Module identification*/
      converseLib.validationFailed(322); /* Invalid selection code*/
    end
  end

   /* ------------------------------------------------------------*/
   /* If page was formatted, verify action and data in line.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.TA5TSQIX > 0) /* Page was formatted*/

    PW07W00.PW07W-MAP-IDX = 12; /* Initialize line index*/

    while (PW07W00.PW07W-MAP-IDX > 0) /* Until end of lines*/

      /* -------- if there is data ------------------------------*/
      if (PW07M001.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] > 0)

         /* ----- if map not equal to w/s W01 ------------------*/
        if (PW07M001.PW07M-ACTION[PW07W-MAP-IDX] != 
        PW07W01.PW07W-ACTION[PW07W-MAP-IDX]  /* -action*/
                                             
         || PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] != 
        PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX] /* -hold code*/
                                             
         || PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] != 
        PW07W01.PW07W-REL-MM[PW07W-MAP-IDX]  /* -release mm*/
                                             
         || PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] != 
        PW07W01.PW07W-REL-DD[PW07W-MAP-IDX]  /* -release dd*/
                                             
         || PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] != 
        PW07W01.PW07W-REL-YY[PW07W-MAP-IDX]) /* -release yy*/

          PW07-52001(); /* Verify data in the line*/

        end
      end

      PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX - 1;

    end
  end

   /* ------------------------------------------------------------*/
   /* If any errors were found, exit to display the map.*/
   /* ------------------------------------------------------------*/

  if (converseVar.validationMsgNum != 0) /* Errors were found*/

    exit stack; /* Exit to display map*/

  end

   /* ---- if no enter key hit, get out of routine --------------*/
  if (converseVar.eventKey is enter)
     /* next sentence*/
  else
    return;
  end

   /* ------------------------------------------------------------*/
   /* ENTER key hit -- Is there more inquirys to display*/
   /*  */
   /* If any changes, get out of routine.*/
   /* ------------------------------------------------------------*/

  if (PW07M001.PW07M-SEL-IND != PW07W00.PW07W-SEL-IND
   || PW07W00.PW07W-STOR-UPD-SW == "Y")

    return;

  end

   /* ------------------------------------------------------------*/
   /* A new DNSB date is needed.*/
   /* ------------------------------------------------------------*/

  PW07-530();


end // end PW07-50001

// Verify the Entered Data
Function PW07-50002()
   /* ------------------------------------------------------------*/
   /* NOTE:  When making changes, they must be done in both modules*/
   /* ------------------------------------------------------------*/
   /* ------------------------------------------------------------*/
   /* Check for item in fast path*/
   /* ------------------------------------------------------------*/

  if (PW07M002.CAITEM > " " /* Application data was entered*/
  )                        
    PW07W00.XXXMODID = "500"; /* Module identification*/
    set PW07M002.CAITEM cursor, bold; /* Highlight*/
    converseLib.validationFailed(16); /* Item invalid w/o FAST PATH*/

  end

   /* ------------------------------------------------------------*/
   /* Determine whether a valid request to scroll was entered.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf7 /* Scroll back request*/
   || converseVar.eventKey is pf8) /* or scroll forward request*/

    PW07-510(); /* Verify scroll request*/

  end

   /* ------------------------------------------------------------*/
   /* If selection code was entered, validate it.*/
   /* ------------------------------------------------------------*/

  if (PW07M002.PW07M-SEL-IND != PW07W00.PW07W-SEL-IND)
    if (PW07M002.PW07M-SEL-IND == "A"
     || PW07M002.PW07M-SEL-IND == "N"
     || PW07M002.PW07M-SEL-IND == "S")

      PW07W-REQST-DAT-SW = "Y"; /* request data switch*/

    else
      set PW07M002.PW07M-SEL-IND cursor, bold; /* Highlight*/
      PW07W00.XXXMODID = "500"; /* Module identification*/
      converseLib.validationFailed(322); /* Invalid selection code*/
    end
  end

   /* ------------------------------------------------------------*/
   /* If page was formatted, verify action and data in line.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.TA5TSQIX > 0) /* Page was formatted*/

    PW07W00.PW07W-MAP-IDX = 12; /* Initialize line index*/

    while (PW07W00.PW07W-MAP-IDX > 0) /* Until end of lines*/

      /* -------- if there is data ------------------------------*/
      if (PW07M002.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] > 0)

         /* ----- if map not equal to w/s W01 ------------------*/
        if (PW07M002.PW07M-ACTION[PW07W-MAP-IDX] != 
        PW07W01.PW07W-ACTION[PW07W-MAP-IDX]  /* -action*/
                                             
         || PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] != 
        PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX] /* -hold code*/
                                             
         || PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] != 
        PW07W01.PW07W-REL-MM[PW07W-MAP-IDX]  /* -release mm*/
                                             
         || PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] != 
        PW07W01.PW07W-REL-DD[PW07W-MAP-IDX]  /* -release dd*/
                                             
         || PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] != 
        PW07W01.PW07W-REL-YY[PW07W-MAP-IDX]) /* -release yy*/

          PW07-52002(); /* Verify data in the line*/

        end
      end

      PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX - 1;

    end
  end

   /* ------------------------------------------------------------*/
   /* If any errors were found, exit to display the map.*/
   /* ------------------------------------------------------------*/

  if (converseVar.validationMsgNum != 0) /* Errors were found*/

    exit stack; /* Exit to display map*/

  end

   /* ---- if no enter key hit, get out of routine --------------*/
  if (converseVar.eventKey is enter)
     /* next sentence*/
  else
    return;
  end

   /* ------------------------------------------------------------*/
   /* ENTER key hit -- Is there more inquirys to display*/
   /*  */
   /* If any changes, get out of routine.*/
   /* ------------------------------------------------------------*/

  if (PW07M002.PW07M-SEL-IND != PW07W00.PW07W-SEL-IND
   || PW07W00.PW07W-STOR-UPD-SW == "Y")

    return;

  end

   /* ------------------------------------------------------------*/
   /* A new DNSB date is needed.*/
   /* ------------------------------------------------------------*/

  PW07-530();


end // end PW07-50002

// Verify scroll request
Function PW07-510()
   /* ------------------------------------------------------------*/
   /* If scroll back was requested, ensure that pages exist.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf7 /* Scroll back request*/
   && PW07W00.XXXTSPAG < 2)       /* and no previous pages*/

    PW07W00.XXXMODID = "510"; /* Module identification*/
    converseLib.validationFailed(37); /* No previous page to display*/

  end

   /* ------------------------------------------------------------*/
   /* If scroll forward was requested, ensure that pages exist.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf8 /* Scroll forward request*/
   && PW07W00.XXXTSPAG >= PW07W00.TA5TSQIX) /* and no more pages*/

    PW07W00.XXXMODID = "510"; /* Module identification*/
    converseLib.validationFailed(38); /* No more pages to display*/

  end

   /* ------------------------------------------------------------*/
   /* Indicate an error if selection cd was changed.*/
   /* ------------------------------------------------------------*/

  if (PKWREC.PKWSELSW == "PK") /* picking*/
    if (PW07M002.PW07M-SEL-IND != PW07W00.PW07W-SEL-IND) /* Sel cd changed*/

      set PW07M002.PW07M-SEL-IND cursor, bold; /* Highlight*/
      PW07W00.XXXMODID = "510"; /* Module identification*/
      converseLib.validationFailed(39); /* No change allowed when scrolling*/

    end
  else
    if (PW07M001.PW07M-SEL-IND != PW07W00.PW07W-SEL-IND) /* Sel cd changed*/

      set PW07M001.PW07M-SEL-IND cursor, bold; /* Highlight*/
      PW07W00.XXXMODID = "510"; /* Module identification*/
      converseLib.validationFailed(39); /* No change allowed when scrolling*/

    end
  end

   /* ------------------------------------------------------------*/
   /* If any errors, go to display map.*/
   /* ------------------------------------------------------------*/

  if (converseVar.validationMsgNum > 0)

    exit stack; /* Exit to display map*/

  end


end // end PW07-510

// Verify data in the line
Function PW07-52001()
   /* ------------------------------------------------------------*/
   /* If action code entered, edit it.*/
   /* ------------------------------------------------------------*/

   /* ------ action changed and not 's', 'd', 'i', 'h', or ' '-----*/
  if (PW07M001.PW07M-ACTION[PW07W-MAP-IDX] != 
  PW07W01.PW07W-ACTION[PW07W-MAP-IDX]
   && PW07M001.PW07M-ACTION[PW07W-MAP-IDX] != "S"
   && PW07M001.PW07M-ACTION[PW07W-MAP-IDX] != "D"
   && PW07M001.PW07M-ACTION[PW07W-MAP-IDX] != "I"
   && PW07M001.PW07M-ACTION[PW07W-MAP-IDX] != "H"
   && PW07M001.PW07M-ACTION[PW07W-MAP-IDX] != " ")

    set PW07M001.PW07M-ACTION[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
    PW07W00.XXXMODID = "520"; /* Module identification*/
    converseLib.validationFailed(35); /* Only valid codes may be entered*/

    return; /* Go back to previous routine*/

  end

   /* ------------------------------------------------------------*/
   /* If order has previously been put on hold, no more changes*/
   /* are allowed.*/
   /* ------------------------------------------------------------*/

   /* ----- map not equal to display storage -----*/
  if (PW07M001.PW07M-ACTION[PW07W-MAP-IDX] != 
  PW07W01.PW07W-ACTION[PW07W-MAP-IDX]
  
   || PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] != 
  PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX]
  
   || PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] != 
  PW07W01.PW07W-REL-MM[PW07W-MAP-IDX]
  
   || PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] != 
  PW07W01.PW07W-REL-DD[PW07W-MAP-IDX]
  
   || PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] != 
  PW07W01.PW07W-REL-YY[PW07W-MAP-IDX])

    /* ----- order has been put on hold ---------*/
    if (PW07W00.PW07W-ORD-HLD-SW == "Y")
      PW07M001.PW07M-ACTION[PW07W-MAP-IDX] = PW07W01.PW07W-ACTION[PW07W-MAP-IDX];
      PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] = PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX];
      PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] = PW07W01.PW07W-REL-MM[PW07W-MAP-IDX];
      PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] = PW07W01.PW07W-REL-DD[PW07W-MAP-IDX];
      PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] = PW07W01.PW07W-REL-YY[PW07W-MAP-IDX];
      set PW07M001.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] bold;
      set PW07M001.PW07M-NIKE-ORD-ID[PW07W-MAP-IDX] bold;
      converseLib.validationFailed(169); /* no more chgs allowed - order on hold*/

      return; /* Go back to previous routine*/

    end
  end

   /* ------------------------------------------------------------*/
   /* Validate rest of data entered based on action code.*/
   /* ------------------------------------------------------------*/
   /* ----- if action code is ' ', 's', 'd', or 'i'----------------*/


  if (PW07M001.PW07M-ACTION[PW07W-MAP-IDX] == " "
   || PW07M001.PW07M-ACTION[PW07W-MAP-IDX] == "S"
   || PW07M001.PW07M-ACTION[PW07W-MAP-IDX] == "D"
   || PW07M001.PW07M-ACTION[PW07W-MAP-IDX] == "I")

      /* ------ if hold code or release date not blank -------------*/
    if (PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] > " "
     || PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] > 0
     || PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] > 0
     || PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] > 0)

      set PW07M001.PW07M-ACTION[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
      set PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] bold;
      set PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] bold;
      set PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] bold;
      set PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] bold;
      PW07W00.XXXMODID = "520"; /* Module identification*/
      converseLib.validationFailed(331); /* Invalid action code*/

    end
  else
      /* ------- hold action code ---------------------*/
    if (PW07M001.PW07M-ACTION[PW07W-MAP-IDX] == "H")

      PW07-52101(); /* Edit hold date*/
      PW07-52201(); /* Edit hold reason code*/
    end
  end

   /* -----------------------------------------------------------*/
   /* If error found, return to previous routine*/
   /* -----------------------------------------------------------*/

  if (converseVar.validationMsgNum > 0) /* Errors found*/
    return; /* Go back to previous routine*/
  end

  PW07W00.PW07W-SCRN-MDFY-SW = "Y"; /* Screen modify switch*/
  PW07W00.PW07W-STOR-UPD-SW = "Y"; /* Update requested*/


end // end PW07-52001

// Verify data in the line
Function PW07-52002()
   /* ------------------------------------------------------------*/
   /* If action code entered, edit it.*/
   /* ------------------------------------------------------------*/

   /* ------ action changed and not 's', 'd', 'i', 'h', or ' '-----*/
  if (PW07M002.PW07M-ACTION[PW07W-MAP-IDX] != 
  PW07W01.PW07W-ACTION[PW07W-MAP-IDX]
   && PW07M002.PW07M-ACTION[PW07W-MAP-IDX] != "S"
   && PW07M002.PW07M-ACTION[PW07W-MAP-IDX] != "D"
   && PW07M002.PW07M-ACTION[PW07W-MAP-IDX] != "I"
   && PW07M002.PW07M-ACTION[PW07W-MAP-IDX] != "H"
   && PW07M002.PW07M-ACTION[PW07W-MAP-IDX] != " ")

    set PW07M002.PW07M-ACTION[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
    PW07W00.XXXMODID = "520"; /* Module identification*/
    converseLib.validationFailed(35); /* Only valid codes may be entered*/

    return; /* Go back to previous routine*/

  end

   /* ------------------------------------------------------------*/
   /* If order has previously been put on hold, no more changes*/
   /* are allowed.*/
   /* ------------------------------------------------------------*/

   /* ----- map not equal to display storage -----*/
  if (PW07M002.PW07M-ACTION[PW07W-MAP-IDX] != 
  PW07W01.PW07W-ACTION[PW07W-MAP-IDX]
  
   || PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] != 
  PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX]
  
   || PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] != 
  PW07W01.PW07W-REL-MM[PW07W-MAP-IDX]
  
   || PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] != 
  PW07W01.PW07W-REL-DD[PW07W-MAP-IDX]
  
   || PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] != 
  PW07W01.PW07W-REL-YY[PW07W-MAP-IDX])

    /* ----- order has been put on hold ---------*/
    if (PW07W00.PW07W-ORD-HLD-SW == "Y")

      PW07M002.PW07M-ACTION[PW07W-MAP-IDX] = PW07W01.PW07W-ACTION[PW07W-MAP-IDX];
      PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] = PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX];
      PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] = PW07W01.PW07W-REL-MM[PW07W-MAP-IDX];
      PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] = PW07W01.PW07W-REL-DD[PW07W-MAP-IDX];
      PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] = PW07W01.PW07W-REL-YY[PW07W-MAP-IDX];
      set PW07M002.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] bold;
      set PW07M002.PW07M-NIKE-ORD-ID[PW07W-MAP-IDX] bold;
      converseLib.validationFailed(169); /* no more chgs allowed - order on hold*/

      return; /* Go back to previous routine*/

    end
  end

   /* ------------------------------------------------------------*/
   /* Validate rest of data entered based on action code.*/
   /* ------------------------------------------------------------*/
   /* ----- if action code is ' ', 's', 'd', or 'i'----------------*/


  if (PW07M002.PW07M-ACTION[PW07W-MAP-IDX] == " "
   || PW07M002.PW07M-ACTION[PW07W-MAP-IDX] == "S"
   || PW07M002.PW07M-ACTION[PW07W-MAP-IDX] == "D"
   || PW07M002.PW07M-ACTION[PW07W-MAP-IDX] == "I")

      /* ------ if hold code or release date not blank -------------*/
    if (PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] > " "
     || PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] > 0
     || PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] > 0
     || PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] > 0)

      set PW07M002.PW07M-ACTION[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
      set PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] bold;
      set PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] bold;
      set PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] bold;
      set PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] bold;
      PW07W00.XXXMODID = "520"; /* Module identification*/
      converseLib.validationFailed(331); /* Invalid action code*/

    end
  else
      /* ------- hold action code ---------------------*/
    if (PW07M002.PW07M-ACTION[PW07W-MAP-IDX] == "H")

      PW07-52102(); /* Edit hold date*/
      PW07-52202(); /* Edit hold reason code*/
    end
  end

   /* -----------------------------------------------------------*/
   /* If error found, return to previous routine*/
   /* -----------------------------------------------------------*/

  if (converseVar.validationMsgNum > 0) /* Errors found*/
    return; /* Go back to previous routine*/
  end

  PW07W00.PW07W-SCRN-MDFY-SW = "Y"; /* Screen modify switch*/
  PW07W00.PW07W-STOR-UPD-SW = "Y"; /* Update requested*/


end // end PW07-52002

// Edit release date
Function PW07-52101()
   /* ------------------------------------------------------------*/
   /* See if release date was entered.*/
   /* ------------------------------------------------------------*/

     /* --------- release date exists ---------------*/
  if (PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] > 0
   || PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] > 0
   || PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] > 0)

       /* next sentence*/

  else
       /* ------- release date doesn't exist --------*/
    converseLib.validationFailed(61); /* Release date is required msg*/
    PW07W00.XXXMODID = "521";
    set PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
    set PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] bold;
    set PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] bold;

    return;

  end

   /* ------------------------------------------------------------*/
   /* Validate a keyed release date.*/
   /* ------------------------------------------------------------*/

  if (PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] != 99
   || PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] != 99
   || PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] != 99)




    set TA9REC empty; /* clear date routine record*/
    TA9REC.TA9BEGMM = PW07M001.PW07M-REL-MM[PW07W-MAP-IDX];
    TA9REC.TA9BEGDD = PW07M001.PW07M-REL-DD[PW07W-MAP-IDX];
    TA9REC.TA9BEGYY = PW07M001.PW07M-REL-YY[PW07W-MAP-IDX];

   /* ------ format century ----------------------*/
    if (PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] > 80)
      TA9REC.TA9BEGCC = 19;
    else
      TA9REC.TA9BEGCC = 20;
    end

   /* ------ validate release date ---------------*/
    call "TA0190" (TA9REC) {isNoRefresh = yes, isExternal = yes};

    if (sysVar.errorCode == "00000000") /* Successful call*/
      if (TA9REC.TA9RTNFL == 0) /* If date routine ok*/

        PW07W01.PW07W-REL-MM = PW07M001.PW07M-REL-MM[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-DD = PW07M001.PW07M-REL-DD[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-YY = PW07M001.PW07M-REL-YY[PW07W-MAP-IDX];

        if (TA9REC.TA9BEGDT < PW07W00.PW07W-CURRENT-DT)
          converseLib.validationFailed(55); /* Date in past msg*/
          PW07W00.XXXMODID = "521"; /* Module id*/
           /* ---- highlight map fields ---------------------------*/
          set PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] cursor, bold;
          set PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] bold;
          set PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] bold;
        end
      else /* Routine error*/

        PW07W00.XXXMODID = "521"; /* Module id*/
       /* ---- highlight map fields ---------------------------*/
        set PW07M001.PW07M-REL-MM[PW07W-MAP-IDX] cursor, bold;
        set PW07M001.PW07M-REL-DD[PW07W-MAP-IDX] bold;
        set PW07M001.PW07M-REL-YY[PW07W-MAP-IDX] bold;

        if (TA9REC.TA9RTNFL == 3) /* Invalid work date*/
          converseLib.validationFailed(56); /* Not work date msg*/
        else
          converseLib.validationFailed(158); /* Invalid date msg*/
        end
      end
      return;
    end

   /* ------------------------------------------------------------*/
   /* Unsuccessful call.*/
   /* ------------------------------------------------------------*/

    TAEREC.TAEDESC1 = sysVar.errorCode; /* CSP return code*/
    TAEREC.TAEDESC2 = TA9REC.TA9GRP; /* Subroutine parameters*/

    PW07W00.XXXMODID = "521"; /* Module id*/
    converseLib.validationFailed(29); /* Unexpected error*/

    TA1REC.TA1FUNC = "RETN"; /* Termination function*/
    TA1REC.TA1TYPE = "APPL"; /* Type of error*/
    TA1REC.TA1LOC = "VERIFY RELEASE DATE";
    TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
    TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
    TA1REC.TA1MAPAP = COMMAREA.CACURRAP; /* Map application*/
    TA1REC.TA1MAPNO = "M001"; /* Map number*/

    call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

    exit stack;

  end


end // end PW07-52101

// Edit release date
Function PW07-52102()
   /* ------------------------------------------------------------*/
   /* See if release date was entered.*/
   /* ------------------------------------------------------------*/

     /* --------- release date exists ---------------*/
  if (PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] > 0
   || PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] > 0
   || PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] > 0)

       /* next sentence*/

  else
       /* ------- release date doesn't exist --------*/
    converseLib.validationFailed(61); /* Release date is required msg*/
    PW07W00.XXXMODID = "521";
    set PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
    set PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] bold;
    set PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] bold;

    return;

  end

   /* ------------------------------------------------------------*/
   /* Validate a keyed release date.*/
   /* ------------------------------------------------------------*/

  if (PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] != 99
   || PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] != 99
   || PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] != 99)




    set TA9REC empty; /* clear date routine record*/
    TA9REC.TA9BEGMM = PW07M002.PW07M-REL-MM[PW07W-MAP-IDX];
    TA9REC.TA9BEGDD = PW07M002.PW07M-REL-DD[PW07W-MAP-IDX];
    TA9REC.TA9BEGYY = PW07M002.PW07M-REL-YY[PW07W-MAP-IDX];

   /* ------ format century ----------------------*/
    if (PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] > 80)
      TA9REC.TA9BEGCC = 19;
    else
      TA9REC.TA9BEGCC = 20;
    end

   /* ------ validate release date ---------------*/
    call "TA0190" (TA9REC) {isNoRefresh = yes, isExternal = yes};

    if (sysVar.errorCode == "00000000") /* Successful call*/
      if (TA9REC.TA9RTNFL == 0) /* If date routine ok*/

        PW07W01.PW07W-REL-MM = PW07M002.PW07M-REL-MM[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-DD = PW07M002.PW07M-REL-DD[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-YY = PW07M002.PW07M-REL-YY[PW07W-MAP-IDX];

        if (TA9REC.TA9BEGDT < PW07W00.PW07W-CURRENT-DT)
          converseLib.validationFailed(55); /* Date in past msg*/
          PW07W00.XXXMODID = "521"; /* Module id*/
           /* ---- highlight map fields ---------------------------*/
          set PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] cursor, bold;
          set PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] bold;
          set PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] bold;
        end
      else /* Routine error*/

        PW07W00.XXXMODID = "521"; /* Module id*/
       /* ---- highlight map fields ---------------------------*/
        set PW07M002.PW07M-REL-MM[PW07W-MAP-IDX] cursor, bold;
        set PW07M002.PW07M-REL-DD[PW07W-MAP-IDX] bold;
        set PW07M002.PW07M-REL-YY[PW07W-MAP-IDX] bold;

        if (TA9REC.TA9RTNFL == 3) /* Invalid work date*/
          converseLib.validationFailed(56); /* Not work date msg*/
        else
          converseLib.validationFailed(158); /* Invalid date msg*/
        end
      end
      return;
    end

   /* ------------------------------------------------------------*/
   /* Unsuccessful call.*/
   /* ------------------------------------------------------------*/

    TAEREC.TAEDESC1 = sysVar.errorCode; /* CSP return code*/
    TAEREC.TAEDESC2 = TA9REC.TA9GRP; /* Subroutine parameters*/

    PW07W00.XXXMODID = "521"; /* Module id*/
    converseLib.validationFailed(29); /* Unexpected error*/

    TA1REC.TA1FUNC = "RETN"; /* Termination function*/
    TA1REC.TA1TYPE = "APPL"; /* Type of error*/
    TA1REC.TA1LOC = "VERIFY RELEASE DATE";
    TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
    TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
    TA1REC.TA1MAPAP = COMMAREA.CACURRAP; /* Map application*/
    TA1REC.TA1MAPNO = "M002"; /* Map number*/

    call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

    exit stack;

  end


end // end PW07-52102

// Edit hold reason code
Function PW07-52201()
   /* ------------------------------------------------------------*/
   /* Edit the hold reason code entered.*/
   /* ------------------------------------------------------------*/
   /* ------ no hold code entered -------*/

  if (PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] <= " ")

    set PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
    PW07W00.XXXMODID = "522"; /* Module identification*/
    converseLib.validationFailed(60); /* Reason code required*/

    return; /* Return to previous process*/
  end
   /* ------------------------------------------------------------*/
   /* Check the hold reason code corporate table.*/
   /* ------------------------------------------------------------*/

   /* ---- if hold code exists and active ----------*/
  if (PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] in XHRTBL.XHRCD
   && XHRTBL.XXXSTAT[sysVar.arrayIndex] == "A")

      /* next sentence*/

  else

    set PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
    PW07W00.XXXMODID = "522"; /* Module identification*/
    converseLib.validationFailed(57); /* Invalid reason code*/

  end

end // end PW07-52201

// Edit hold reason code
Function PW07-52202()
   /* ------------------------------------------------------------*/
   /* Edit the hold reason code entered.*/
   /* ------------------------------------------------------------*/
   /* ------ no hold code entered -------*/

  if (PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] <= " ")

    set PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
    PW07W00.XXXMODID = "522"; /* Module identification*/
    converseLib.validationFailed(60); /* Reason code required*/

    return; /* Return to previous process*/
  end
   /* ------------------------------------------------------------*/
   /* Check the hold reason code corporate table.*/
   /* ------------------------------------------------------------*/

   /* ---- if hold code exists and active ----------*/
  if (PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] in XHRTBL.XHRCD
   && XHRTBL.XXXSTAT[sysVar.arrayIndex] == "A")

      /* next sentence*/

  else

    set PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX] cursor, bold; /* Highlight*/
    PW07W00.XXXMODID = "522"; /* Module identification*/
    converseLib.validationFailed(57); /* Invalid reason code*/

  end

end // end PW07-52202

// Format next DNSB date, If any
Function PW07-530()
   /* ------------------------------------------------------------*/
   /* A new DNSB Date is needed, look for it.*/
   /* ------------------------------------------------------------*/

  PW07W00.PW07W-MORE-DNSB-SW = "Y"; /* Assume more DNSB Dates*/

   /* ----- More DNSB dates and not the same as previous ----------*/
  while (PW07W00.PW07W-MORE-DNSB-SW == "Y"
   && PWKREC.OP1DSBDT[PW07W-DNSB-IDX] == PW07W00.PW07W-PREV-DNSB-DT
   && PWKREC.TF1CARCD[PW07W-DNSB-IDX] == PW07W00.PW07W-PREV-TF1CARCD)

    PW07W00.PW07W-DNSB-IDX = PW07W00.PW07W-DNSB-IDX + 1;

    /* --------------------------------------------------------------*/
    /* Determine if there are more DNSB dates passed.  There are*/
    /* 3 occurances of array 25.*/
    /*  */
    /* PKWINDEX varies from 1 to 3.*/
    /* PW07W-DNSB-IDX varies from 1 to 25.*/
    /* PWKARMAX is the # of DNSB dates passed from last application.*/
    /* --------------------------------------------------------------*/
    if (PW07W00.PW07W-DNSB-IDX > PWKREC.PWKARMAX)

      if (PW07W00.PW07W-DNSB-IDX > 25 /* Array was full,*/
       && PKWREC.PKWINDEX < 3)        /* but there are other arrays*/

        PKWREC.PKWINDEX = PKWREC.PKWINDEX + 1;
        PWKREC.PWKARRAY = PKWREC.PKWARRAY[PKWINDEX]; /* Get next 25*/
        PW07W00.PW07W-DNSB-IDX = 1;

        if (PW07W00.PW07W-DNSB-IDX > PWKREC.PWKARMAX)
          PW07W00.PW07W-MORE-DNSB-SW = "N"; /* No more dates*/

        end
      else
        PW07W00.PW07W-MORE-DNSB-SW = "N"; /* No more dates*/

      end
    end
  end

   /* ------------------------------------------------------------*/
   /* See if new DNSB Date was found.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.PW07W-MORE-DNSB-SW == "Y") /* More DNSB Dates in array*/

    /* ----- save new DNSB date ------------------------*/
    PW07W00.PW07W-PREV-DNSB-DT = PWKREC.OP1DSBDT[PW07W-DNSB-IDX];
    PW07W00.PW07W-PREV-TF1CARCD = PWKREC.TF1CARCD[PW07W-DNSB-IDX];

    return; /* Get out of this routine*/

  end

   /* ------------------------------------------------------------*/
   /* No more DNSB Dates found.*/
   /* ------------------------------------------------------------*/

  set PW07M001 initial;
  set PW07M002 initial;

  PW07M001.XWHCD = PKWREC.XWHCD; /* Warehouse cd to map*/
  PW07M002.XWHCD = PKWREC.XWHCD; /* Warehouse cd to map*/
  PW07M001.XWHABRV = PKWREC.XWHABRV; /* Warehouse abrv*/
  PW07M002.XWHABRV = PKWREC.XWHABRV; /* Warehouse abrv*/

  PW07M001.XDVCD = PKWREC.XDVCD[1]; /* Division code*/
  PW07M002.XDVCD = PKWREC.XDVCD[1]; /* Division code*/
  if (PKWREC.XDVCD[1] == "*")
    PW07M001.XDVDESC = "ALL DIVISIONS";
    PW07M002.XDVDESC = "ALL DIVISIONS";
  else
    if (PKWREC.XDVCD[1] in XDVTBL.XDVCD)
      PW07M001.XDVDESC = XDVTBL.XDVDESC[sysVar.arrayIndex];
    end
    if (PKWREC.XDVCD[1] in XDVTBL.XDVCD)
      PW07M002.XDVDESC = XDVTBL.XDVDESC[sysVar.arrayIndex];
    end
  end

  PW07M001.XBCCD = PKWREC.XBCCD[1]; /* Brand code*/
  PW07M002.XBCCD = PKWREC.XBCCD[1]; /* Brand code*/
  if (PKWREC.XBCCD[1] == "*")
    PW07W00.XXXMSGNO = 421;
    PW07M001.XBCABRV = " ";
  else
    if (PKWREC.XBCCD[1] in XBCTBL.XBCCD)
      PW07M001.XBCABRV = XBCTBL.XBCABRV[sysVar.arrayIndex];
    end
    if (PKWREC.XBCCD[1] in XBCTBL.XBCCD)
      PW07M002.XBCABRV = XBCTBL.XBCABRV[sysVar.arrayIndex];
    end
  end

  set PW07M001.PW07M-SEL-IND cursor, skip;
  set PW07M002.PW07M-SEL-IND cursor, skip;
  PW07M001.PW07M-SEL-IND = PW07W01.PW07W-SEL-IND;
  PW07M002.PW07M-SEL-IND = PW07W01.PW07W-SEL-IND;
  PW07M001.PW07M-DNSB-MM = PW07W01.PW07W-DNSB-MM;
  PW07M002.PW07M-DNSB-MM = PW07W01.PW07W-DNSB-MM;
  PW07M001.PW07M-DNSB-DD = PW07W01.PW07W-DNSB-DD;
  PW07M002.PW07M-DNSB-DD = PW07W01.PW07W-DNSB-DD;
  PW07M001.PW07M-DNSB-YY = PW07W01.PW07W-DNSB-YY;
  PW07M002.PW07M-DNSB-YY = PW07W01.PW07W-DNSB-YY;
  PW07M001.TF1CARCD = PW07W01.TF1CARCD;
  PW07M002.TF1CARCD = PW07W01.TF1CARCD;

  PW07W00.PW07W-REQST-DAT-SW = "N"; /* Reset request data switch*/
  PW07W00.XXXMODID = "530"; /* Module identification*/
  converseLib.validationFailed(339); /* No more dnsb dates*/

  exit stack; /* Exit to display map*/


end // end PW07-530

// Process valid input request
Function PW07-600()
   /* ------------------------------------------------------------*/
   /* Indicate that the map must be formatted before display.*/
   /* ------------------------------------------------------------*/

  PW07W00.PW07W-FRMT-SCRN-SW = "Y"; /* Format the map switch*/

   /* ------------------------------------------------------------*/
   /* Save the entered data, save and update t/s.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.PW07W-SCRN-MDFY-SW == "Y" /* Screen modified*/
  )                                    
    PW07W00.PW07W-SCRN-MDFY-SW = "N"; /* Reset switch*/
    PW07W00.PW07W-MAP-IDX = 1; /* Initialize line index*/

    /* ------- until end of lines and data exists ----------*/
    if (PKWREC.PKWSELSW == "PK") /* picking*/

      while (PW07W00.PW07W-MAP-IDX <= 12
       && PW07M002.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] > 0)

        PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = PW07M002.PW07M-ACTION[PW07W-MAP-IDX];
        PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX] = PW07M002.PW07M-HOLD-CD[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-MM[PW07W-MAP-IDX] = PW07M002.PW07M-REL-MM[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-DD[PW07W-MAP-IDX] = PW07M002.PW07M-REL-DD[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-YY[PW07W-MAP-IDX] = PW07M002.PW07M-REL-YY[PW07W-MAP-IDX];

        PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX + 1;
      end

    else /* pick planning*/

      while (PW07W00.PW07W-MAP-IDX <= 12
       && PW07M001.PW07M-ORD-STKTF-ID[PW07W-MAP-IDX] > 0)

        PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = PW07M001.PW07M-ACTION[PW07W-MAP-IDX];
        PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX] = PW07M001.PW07M-HOLD-CD[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-MM[PW07W-MAP-IDX] = PW07M001.PW07M-REL-MM[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-DD[PW07W-MAP-IDX] = PW07M001.PW07M-REL-DD[PW07W-MAP-IDX];
        PW07W01.PW07W-REL-YY[PW07W-MAP-IDX] = PW07M001.PW07M-REL-YY[PW07W-MAP-IDX];

        PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX + 1;
      end
    end

    TA5REC.TA5TSQIX = PW07W00.XXXTSPAG; /* Page# to update*/
    PW07S-U-TEMP-STOR(); /* Update t/s page*/

  end

   /* ------------------------------------------------------------*/
   /* If a scroll backward was requested, decrement the page*/
   /* number and return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf7) /* Scroll back requested*/

    PW07W00.XXXTSPAG = PW07W00.XXXTSPAG - 1; /* Decrement page number*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* If a scroll forward was requested, increment the page*/
   /* number and return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf8) /* Scroll forward requested*/

    PW07W00.XXXTSPAG = PW07W00.XXXTSPAG + 1; /* Increment page number*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* If the selection cd was changed, go back to rebuild data.*/
   /* ------------------------------------------------------------*/

  if (PKWREC.PKWSELSW == "PK") /* picking*/
    if (PW07M002.PW07M-SEL-IND != PW07W00.PW07W-SEL-IND)

      PW07W00.PW07W-REQST-DAT-SW = "Y"; /* Request for data switch*/

      return; /* Return to previous process*/

    end
  else
    if (PW07M001.PW07M-SEL-IND != PW07W00.PW07W-SEL-IND)

      PW07W00.PW07W-REQST-DAT-SW = "Y"; /* Request for data switch*/

      return; /* Return to previous process*/

    end
  end

   /* ------------------------------------------------------------*/
   /* If action requested, perform them.*/
   /* ------------------------------------------------------------*/

  if (PW07W00.PW07W-STOR-UPD-SW == "Y") /* Data updates found*/

    XX0XS01(); /* Get system date and time*/

    PW07W00.PW07W-UPD-OK-SW = "N"; /* clr successful updates*/

    PW07-610(); /* Process action (S,D,H,I)*/

    PW07W00.PW07W-STOR-UPD-SW = "N"; /* clr updates requested sw*/

    VGVar.handleSysLibraryErrors = 0;
    sysLib.commit(); /* Commit all changes*/

     /* ------ Successful updates -----------*/
    if (PW07W00.PW07W-UPD-OK-SW == "Y")

      if (PW07W00.XXXMSGNO == 0) /* If no warnings*/

        PW07W00.XXXMSGNO = 32; /* Updates successful*/
        PW07W00.XXXMODID = "600"; /* Module identification*/

      end
    end

     /* ------ Orders to inquiry on ---------*/
    if (PW07W00.PW07W-ORD-INQ-IDX > 1)
      PW07-620(); /* Xfer to PW0I*/

    else
      PW07W00.XXXTSPAG = 1; /* Force display to first page*/

    end
    return; /* Go back to previous routine*/
  end

   /* ------------------------------------------------------------*/
   /* ***** Finished processing current DNSB date ******/

   /* Go get the next one*/
   /* ------------------------------------------------------------*/

  PW07W00.PW07W-REQST-DAT-SW = "Y"; /* Request for data switch*/


end // end PW07-600

// Process action (S,D,H,I)
Function PW07-610()
   /* ------------------------------------------------------------*/
   /* Process action (Select, De-select, Hold, Inquiry)*/
   /* ------------------------------------------------------------*/

  PW07W00.PW07W-MAP-IDX = 1; /* -Initialize map index*/
  PW07W00.PW07W-ORD-INQ-IDX = 1; /* -Init order inquiry array idx*/
  PW07W00.XXXTSPAG = 1; /* -Start at first page of t/s*/

  PW07S-R-TEMP-STOR(); /* -Read first t/s page*/

  while (PW07W00.XXXTSPAG <= PW07W00.TA5TSQIX) /* While there is still data*/

    /* ------- Data present on line ---------*/
    if (PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX] > 0)

       /* ------ Select to pick -----------------*/
      if (PW07W01.PW07W-ACTION[PW07W-MAP-IDX] == "S")

        PW07-611();
        PW07W00.PW07W-UPD-OK-SW = "Y"; /* Successful update*/

      end

       /* ------ De-Select to pick --------------*/
      if (PW07W01.PW07W-ACTION[PW07W-MAP-IDX] == "D")

        PW07-612();
        PW07W00.PW07W-UPD-OK-SW = "Y"; /* Successful update*/

      end

       /* ------ Place order on hold ------------*/
      if (PW07W01.PW07W-ACTION[PW07W-MAP-IDX] == "H")

        PW07-613();
        PW07W00.PW07W-UPD-OK-SW = "Y"; /* Successful update*/

      end

       /* ------ Inquiry on order ---------------*/
      if (PW07W01.PW07W-ACTION[PW07W-MAP-IDX] == "I")

        PW07-614();
        PW07W00.PW07W-UPD-OK-SW = "Y"; /* Successful update*/

      end
    end

    PW07W00.PW07W-MAP-IDX = PW07W00.PW07W-MAP-IDX + 1; /* Increment index*/

    /* ------------------------------------------------------------*/
     /* If t/s page processed, update & get next page.*/
    /* ------------------------------------------------------------*/

    if (PW07W00.PW07W-MAP-IDX > 12) /* If index > 12*/

      PW07S-U-TEMP-STOR(); /* Update current t/s page*/

      PW07W00.XXXTSPAG = PW07W00.XXXTSPAG + 1; /* Increment t/s page number*/

      if (PW07W00.XXXTSPAG <= PW07W00.TA5TSQIX) /* Still have more t/s pages*/

        VGVar.handleSysLibraryErrors = 0;
        sysLib.commit(); /* Commit DB updates for prior page data*/

        PW07S-R-TEMP-STOR(); /* Read next t/s page*/

        PW07W00.PW07W-MAP-IDX = 1; /* Reset index*/

      end
    end
  end


end // end PW07-610

// Select order for picking
Function PW07-611()
   /* ------------------------------------------------------------*/
   /* Select order for picking*/
   /* ------------------------------------------------------------*/

  PW07S-SELECT-POOLH(); /* select unique pool header*/

  if (PW07W00.PW07W-RUN-MODE == " ") /* if run mode is picking*/
    PK4REC.PK4SLIND = "S"; /* set status to 's'*/

  else
    PK4REC.PK4SLIND = "P"; /* otherwise, set to 'p'*/

  end

  PW07W01.PW07W-SELECT-FL[PW07W-MAP-IDX] = "Y";
  PW07M001.PW07M-SELECT-FL[PW07W-MAP-IDX] = "Y";
  PW07M002.PW07M-SELECT-FL[PW07W-MAP-IDX] = "Y";

  PK4REC.ZZZCHGDT = XX0XW01.XX0XWDAT;
  PK4REC.ZZZCHGTM = XX0XW01.XX0XWTIM;

  PW07S-UPDATE-POOLH(); /* update pool header*/

   /* ------------------------------------------------------------*/
   /* See if row already exists in Dpick.Vselor01*/
   /* ------------------------------------------------------------*/

  set PKHREC empty; /* clear record*/

  PKHREC.XWHCD = PW07W01.XWHCD;
  PKHREC.PK1CUOID = PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX];
  PKHREC.PK1NORID = PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX];
  PKHREC.PKURUNMD = PW07W00.PW07W-RUN-MODE;

  PW07S-SELECT-SELOR(); /* select unique Dpick.Vselor01*/

  if (SQLCA.VAGen_SQLCODE == 0) /* row already exists*/

    if (PW07W00.XXXMSGNO == 0) /* if no other warning msgs*/
      PW07W00.XXXMSGNO = 44; /* warning msg*/
      PW07W00.XXXMODID = "   "; /* module id*/
    end

    PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = " "; /* clear action*/

    return; /* return to prev process, don't need to add rec*/
  end

   /* ------------------------------------------------------------*/
   /* Insert row into Dpick.Vselor01*/
   /* ------------------------------------------------------------*/

  set PKHREC empty; /* clear record*/

  PW07S-FRMT-SEL-IND(); /* determine sel type indicator*/

   /* ------ Format record from w/s -------------------------------*/
  PKHREC.XWHCD = PW07W01.XWHCD;
  PKHREC.PK1CUOID = PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX];
  PKHREC.PK1NORID = PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX];
  PKHREC.PKHPVSFC = PW07W01.PW07W-FC-QTY[PW07W-MAP-IDX];
  PKHREC.PKHPVSRP = PW07W01.PW07W-RP-QTY[PW07W-MAP-IDX];
  PKHREC.OP1DSBDT = PW07W01.PW07W-DNSB-DT;
  PKHREC.PKURUNMD = PW07W00.PW07W-RUN-MODE;
  PKHREC.PK-SEL-TYP-CD = PW07W00.PW07W-SEL-TYP-CD;

   /* ------ Format record from pool header -----------------------*/
  PKHREC.XDVCD = PK4REC.XDVCD;
  PKHREC.XBCCD = PK4REC.XBCCD;
  PKHREC.PK1PRTN = PK4REC.PK1PRTN; /* part char*/
  PKHREC.TF1CARCD = PK4REC.TF1CARCD; /* carrier cd*/
  PKHREC.XPPCD = PK4REC.XPPCD; /* pick prior cd*/
  PKHREC.PKHPVSMM = PK4REC.PK4ORDTM; /* sel wrk min*/

   /* ------ Format record with current date/time -----------------*/
  PKHREC.ZZZCHGDT = XX0XW01.XX0XWDAT;
  PKHREC.ZZZCHGTM = XX0XW01.XX0XWTIM;
  PKHREC.ZZZCHGCT = 0;

  PW07S-INSERT-SELOR(); /* insert Dpick.Vselor01*/


end // end PW07-611

// De-select order
Function PW07-612()
   /* ------------------------------------------------------------*/
   /* De-select order - Change sel-ind to ' '*/
   /* - Delete order from selected order table*/
   /* ------------------------------------------------------------*/

  PW07S-SELECT-POOLH(); /* Select unique pool header*/

  PK4REC.PK4SLIND = " "; /* Set status to 'deselected'*/
  PW07W01.PW07W-SELECT-FL[PW07W-MAP-IDX] = "N";
  PW07M001.PW07M-SELECT-FL[PW07W-MAP-IDX] = "N";
  PW07M002.PW07M-SELECT-FL[PW07W-MAP-IDX] = "N";

  PK4REC.ZZZCHGDT = XX0XW01.XX0XWDAT;
  PK4REC.ZZZCHGTM = XX0XW01.XX0XWTIM;

  PW07S-UPDATE-POOLH(); /* Update pool header*/

   /* ------------------------------------------------------------*/
    /* Delete row from Dpick.Vselor01*/
   /* ------------------------------------------------------------*/

  set PKHREC empty; /* Clear record*/

  PKHREC.XWHCD = PW07W01.XWHCD;
  PKHREC.PK1CUOID = PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX];
  PKHREC.PK1NORID = PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX];
  PKHREC.PKURUNMD = PW07W00.PW07W-RUN-MODE;

  PW07S-DELETE-SELOR(); /* Delete Dpick.Vselor01*/


end // end PW07-612

// Put order on hold
Function PW07-613()
   /* ------------------------------------------------------------*/
   /* Update pool header row for order on hold*/
   /* ------------------------------------------------------------*/

  PW07S-SELECT-POOLH(); /* Select unique pool header*/

  PK4REC.PK4ORHLD = "Y"; /* Set order hold flag to yes*/
  PK4REC.ZZZCHGDT = XX0XW01.XX0XWDAT;
  PK4REC.ZZZCHGTM = XX0XW01.XX0XWTIM;

  PW07S-UPDATE-POOLH(); /* Update pool header*/

   /* ------------------------------------------------------------*/
   /* Put order on hold*/
   /* ------------------------------------------------------------*/

  set PKBREC empty; /* Clear record*/

  PKBREC.XWHCD = PW07W01.XWHCD;
  PKBREC.PK1CUOID = PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX];
  PKBREC.PK1NORID = PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX];
  PKBREC.XHRCD = PW07W01.PW07W-HOLD-CD[PW07W-MAP-IDX];
  PKBREC.PK1PRTN = PK4REC.PK1PRTN;

  PW07S-SELECT-ORHLD(); /* Select unique Dpick.Vorhld01*/

   /* ------------------------------------------------------------*/
   /* Prepare release order from map to be moved into pkbrec.*/
   /* ------------------------------------------------------------*/

  PW07W00.PW07W-WRK-MM = PW07W01.PW07W-REL-MM[PW07W-MAP-IDX];
  PW07W00.PW07W-WRK-DD = PW07W01.PW07W-REL-DD[PW07W-MAP-IDX];
  PW07W00.PW07W-WRK-YY = PW07W01.PW07W-REL-YY[PW07W-MAP-IDX];

  if (PW07W00.PW07W-WRK-YY > 80) /* If year > 80*/
    PW07W00.PW07W-WRK-CC = 19; /* set century to 19*/

  else
    PW07W00.PW07W-WRK-CC = 20; /* else, set to 20*/

  end

  PKBREC.PKBRELDT = PW07W00.PW07W-WRK-DT; /* store as release date*/

   /* ---------------------------------------------------------------*/
   /* If release date is not '999999', subtract 1 from release date*/
    /* and move to the plan release date.*/
   /* ---------------------------------------------------------------*/

  if (PW07W00.PW07W-WRK-MM != 99
   || PW07W00.PW07W-WRK-DD != 99
   || PW07W00.PW07W-WRK-YY != 99)

    set TA9REC empty;
    TA9REC.TA9BEGDT = PW07W00.PW07W-WRK-DT;
    TA9REC.TA9OFSET = -1;

    try
      call "TA0190" (TA9REC) {isNoRefresh = yes, isExternal = yes};
    end /* subract 1 from date*/

    /* -----------------------------------------------------------------*/
     /* if successful, move date and continue through process*/
    /* -----------------------------------------------------------------*/

    if (sysVar.errorCode == "00000000" /* call successful*/
     && TA9REC.TA9RTNFL == 0)          /* and normal return code*/

      PKBREC.PKBPLRDT = TA9REC.TA9RTNDT;

    else
      /* ---------------------------------------------------------------*/
       /* otherwise, indicate that a system error has occurred*/
      /* ---------------------------------------------------------------*/

      TAEREC.TAEDESC1 = sysVar.errorCode; /* csp return code*/
      TAEREC.TAEDESC2 = TA9REC.TA9GRP; /* subroutine parameters*/
      converseLib.validationFailed(29); /* fatal error*/
      TA1REC.TA1FUNC = "RETN"; /* termination function*/
      TA1REC.TA1TYPE = "APPL"; /* type of error*/
      TA1REC.TA1LOC = "UPDATE PLAN RELEASE DATE";
      TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* program appl*/
      TA1REC.TA1PGMNO = "613"; /* program number*/
      TA1REC.TA1MAPAP = COMMAREA.CACURRAP; /* map appl*/

   /* error diagnosis routine*/
      call "TA0020" (TA1REC, TAEREC) {isExternal = yes};
      exit stack; /* exit to display map*/

    end
  else

  /* -----------------------  Y2K IN BEGIN  -------------------------*/
  /*  */
    PW07W00.PW07W-WRK-CC = 99; /* set to 99 for indefinite hold*/
    PKBREC.PKBRELDT = PW07W00.PW07W-WRK-DT;
  /*  */
  /* ------------------------  Y2K IN END  --------------------------*/

    PKBREC.PKBPLRDT = PW07W00.PW07W-WRK-DT;

  end

  /* -----------------------  Y2K OUT BEGIN  ------------------------*/
  /*  */
  /* IF PKBREC.PKBRELDT GT 19991231;*/
  /*  */
  /* ------------------------  Y2K OUT END  -------------------------*/

  /* -----------------------  Y2K IN BEGIN  -------------------------*/
  /*  */
  if (PKBREC.PKBRELDT > 20431231)
  /*  */
  /* ------------------------  Y2K IN END  --------------------------*/

    PKBREC.PKBRELDT = 99999999;
    PKBREC.PKBPLRDT = 99999999;
  end

   /* ------------------------------------------------------------*/
    /* If order hold row found, update it, otherwise, add it.*/
   /* ------------------------------------------------------------*/

  PKBREC.XXXUSRID = COMMAREA.CAUSERID;
  PKBREC.ZZZCHGDT = XX0XW01.XX0XWDAT;
  PKBREC.ZZZCHGTM = XX0XW01.XX0XWTIM;

  if (SQLCA.VAGen_SQLCODE == 0) /* Row was found*/
    PW07S-UPDATE-ORHLD(); /* Update Dpick.Vorhld01 row*/

  else
    PKBREC.ZZZCHGCT = 0;
    PW07S-INSERT-ORHLD(); /* Insert Dpick.Vorhld01 row*/

  end


end // end PW07-613

// Process order for inquiry
Function PW07-614()
   /* ------------------------------------------------------------*/
   /* Order was requested for inquiry - add to pwjrec array*/
   /* ------------------------------------------------------------*/

  if (PW07W00.PW07W-ORD-INQ-IDX > 65)

    PW07W00.XXXMSGNO = 346; /* order inquiry limit exceeded*/

    return;

  end

   /* ------ Format order inquiry record --------------------------*/
  PWJREC.PWJORACT[PW07W-ORD-INQ-IDX] = "I";
  PWJREC.XWHCD = PW07W01.XWHCD;
  PWJREC.XWHABRV = PW07W01.XWHABRV;
  PWJREC.PK1CUOID[PW07W-ORD-INQ-IDX] = PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX];
  PWJREC.PK1NORID[PW07W-ORD-INQ-IDX] = PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX];

  PW07W00.PW07W-ORD-INQ-IDX = PW07W00.PW07W-ORD-INQ-IDX + 1;


end // end PW07-614

// Transfer to PW0I
Function PW07-620()
   /* ------------------------------------------------------------*/
   /* Orders are in PWJREC for inquiry, xfer to PW0I.*/
   /* ------------------------------------------------------------*/

  PW07S-P-TEMP-STOR(); /* Purge temporary storage*/

  COMMAREA.CATOAP = "PW0I"; /* Set target application*/
  PW07W00.PW07W-ORD-INQ-IDX = PW07W00.PW07W-ORD-INQ-IDX - 1;
  PWJREC.PWJARMAX = PW07W00.PW07W-ORD-INQ-IDX;
  PKWREC.PKWUSERB = PWJREC.PKWUSERB;
  PKWREC.PKW-ORDER-TYP-IND = PW07W00.PW07W-ORDER-TYP-SV;

  XSPKS01(); /* Exit to another application*/

  set PW07M001.CATOAP cursor, bold; /* Highlight*/
  set PW07M002.CATOAP cursor, bold; /* Highlight*/

  exit stack; /* Exit to display map*/


end // end PW07-620

// Add Page to Temporary Storage
Function PW07S-A-TEMP-STOR()
   /* ------------------------------------------------------------*/
   /* Add the next page to temporary storage.*/
   /* ------------------------------------------------------------*/

  PW07W01.XXXTSLEN = PW07W00.XXXTSLEN; /* Temporary storage length*/

  TA5REC.TA5APPID = COMMAREA.CACURRAP; /* Application identification*/
  TA5REC.TA5FNCCD = "A"; /* Function code*/

  try
    call "TA0050" (PW07W01, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* Temporary storage*/

   /* ------------------------------------------------------------*/
   /* If successful, initialize the storage area and indicators*/
   /* to be used.  Return to the previous process.*/
   /* ------------------------------------------------------------*/

  set PW07W01 empty; /* M001 display storage*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return code*/

    PW07W00.TA5TSQIX = TA5REC.TA5TSQIX; /* Highest page number*/
    TA5REC.TA5TSQIX = 0; /* Current page number*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TAEREC.TAEDESC1 = sysVar.errorCode; /* CSP return code*/
  TAEREC.TAEDESC2 = TA5REC.TA5DATA; /* Subroutine parameters*/

  PW07W00.XXXMODID = "   "; /* Module identification*/
  converseLib.validationFailed(29); /* Unexpected error occurred*/

  TA1REC.TA1FUNC = "RETN"; /* Termination function*/
  TA1REC.TA1TYPE = "APPL"; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-A-TEMP-STOR";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1MAPAP = COMMAREA.CACURRAP; /* Map application*/
  TA1REC.TA1MAPNO = "M001"; /* Map number*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-A-TEMP-STOR

// CLOSE CURSOR - DPICK.VPOOLH01
Function PW07S-CLOSE-POOLH()
   /* ------------------------------------------------------------*/
   /* Close the selected set of table rows.*/
   /* ------------------------------------------------------------*/

  try
    call "IO1720" ("C7", SQLCA, PK4REC) {isNoRefresh = yes, isExternal = yes};
  end /* Close table set*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == 0)      /* and normal return code*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/
  converseLib.validationFailed(29); /* Unexpected error occurred*/

  TA1REC.TA1FUNC = "RETN"; /* Termination function*/
  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-CLOSE-POOLH";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VPOOLH01"; /* Table view name*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-CLOSE-POOLH

// Delete - DPICK.VSELOR01
Function PW07S-DELETE-SELOR()
   /* ------------------------------------------------------------*/
   /* Delete the row in the table.*/
   /* ------------------------------------------------------------*/

  try
    call "IO1740" ("D ", SQLCA, PKHREC) {isNoRefresh = yes, isExternal = yes};
  end /* Insert row*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/
    if (SQLCA.VAGen_SQLCODE == 0) /* Normal return code*/

      PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = "*"; /* processed*/
      return; /* Return to previous process*/

    end

    if (SQLCA.VAGen_SQLCODE == 100) /* Row not found*/

      PW07W00.XXXMSGNO = 201; /* Row to be deleted not found*/
      PW07W00.XXXMODID = "   "; /* Module identification*/
      PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = " "; /* processed*/

      return; /* Return to previous process*/

    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* Roll back all changes*/

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-DELETE-SELOR";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VSELOR01"; /* Table view name*/
  TA1REC.TA1TBLKE = PKHREC.PKHKEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-DELETE-SELOR

// FETCH CURSOR - DPICK.VPOOLH01
Function PW07S-FETCH-POOLH()
   /* ------------------------------------------------------------*/
   /* Fetch the next row to display from the table.*/
   /* ------------------------------------------------------------*/

  try
    call "IO1720" ("N7", SQLCA, PK4REC) {isNoRefresh = yes, isExternal = yes};
  end /* Fetch next row*/

   /* ------------------------------------------------------------*/
   /* If the call was successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/

    if (SQLCA.VAGen_SQLCODE == 0) /* Normal return code*/

      return; /* Return to previous process*/

    end

    /* ------------------------------------------------------------*/
     /* If end of the selected set, indicate end of cursor.*/
    /* ------------------------------------------------------------*/

    if (SQLCA.VAGen_SQLCODE == 100) /* End of selected set*/

      PW07W00.PW07W-POOLH-CSR-SW = "Y";

      return; /* Return to previous process*/

    end

  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-FETCH-POOLH";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VPOOLH01"; /* Table view name*/
  TA1REC.TA1TBLKE = PK4REC.PK4KEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-FETCH-POOLH

// Format select type indicator
Function PW07S-FRMT-SEL-IND()
   /* -------------------------------------------------------------*/
   /* Determine the selection type indicator ( 10, 11, 12, & 13)*/
   /* depending on special handling and order type.*/
   /* -------------------------------------------------------------*/

   /* -------- B-grade Special Handling ------------*/
  if (PK4REC.OP1SPHDF == "Y"
   && PW07W00.PW07W-ORDER-TYP-IND == "B")

    PW07W00.PW07W-SEL-TYP-CD = "10";
  else
    /* -------- B-grade Non-Special Handling -------*/
    if (PK4REC.OP1SPHDF == "N"
     && PW07W00.PW07W-ORDER-TYP-IND == "B")

      PW07W00.PW07W-SEL-TYP-CD = "11";
    else
      /* -------- Closeout Special Handling -----------*/
      if (PK4REC.OP1SPHDF == "Y"
       && PW07W00.PW07W-ORDER-TYP-IND == "C")

        PW07W00.PW07W-SEL-TYP-CD = "12";
      else
        /* -------- Closeout Non-Special Handling -------*/
        if (PK4REC.OP1SPHDF == "N"
         && PW07W00.PW07W-ORDER-TYP-IND == "C")

          PW07W00.PW07W-SEL-TYP-CD = "13";
        end
      end
    end
  end

end // end PW07S-FRMT-SEL-IND

// Insert - DPICK.VORHLD01
Function PW07S-INSERT-ORHLD()
   /* ------------------------------------------------------------*/
   /* Insert the row in the table.*/
   /* ------------------------------------------------------------*/

  try
    call "IO1770" ("A ", SQLCA, PKBREC) {isNoRefresh = yes, isExternal = yes};
  end /* Insert row*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/
    if (SQLCA.VAGen_SQLCODE == 0) /* Normal return code*/

      PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = "*";
      PW07W00.PW07W-ORD-HLD-SW = "Y";

      return; /* Return to previous process*/

    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* Roll back all changes*/

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-INSERT-ORHLD";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VORHLD01"; /* Table view name*/
  TA1REC.TA1TBLKE = PKBREC.PKBKEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-INSERT-ORHLD

// Insert - DPICK.VSELOR01
Function PW07S-INSERT-SELOR()
   /* ------------------------------------------------------------*/
   /* Insert the row in the table.*/
   /* ------------------------------------------------------------*/

  try
    call "IO1740" ("A ", SQLCA, PKHREC) {isNoRefresh = yes, isExternal = yes};
  end /* Insert row*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/

    if (SQLCA.VAGen_SQLCODE == 0) /* Normal return code*/

      PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = "*"; /* processed*/
      return; /* Return to previous process*/

    end

    if (SQLCA.VAGen_SQLCODE == -803) /* Row already exists*/

      PW07W00.XXXMSGNO = 44; /* Warning msg*/
      PW07W00.XXXMODID = "   "; /* module id*/
      PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = " "; /* clear*/

      return;

    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* Roll back all changes*/

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-INSERT-SELOR";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VSELOR01"; /* Table view name*/
  TA1REC.TA1TBLKE = PKHREC.PKHKEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-INSERT-SELOR

// Open cursor - DPICK.VPOOLH01
Function PW07S-OPEN-POOLH()
   /* ------------------------------------------------------------*/
   /* Select the requested set of rows from Pool Header table.*/
   /* ------------------------------------------------------------*/

  set PK4REC empty; /* -Clear row storage area*/

  PK4REC.XWHCD = PKWREC.XWHCD; /* -Key*/
  PK4REC.XDVCD = PKWREC.XDVCD; /* -Division code*/
  PK4REC.XBCCD = PKWREC.XBCCD; /* -Brand code*/
  PK4REC.OP1DSBDT = PWKREC.OP1DSBDT[PW07W-DNSB-IDX];
  PK4REC.TF1CARCD = PWKREC.TF1CARCD[PW07W-DNSB-IDX];
  PK4REC.PK4ORHLD = "*"; /* -Order hold*/
  PK4REC.PK4CUHLD = "*"; /* -Customer hold*/
  PK4REC.OP1SPHDF = "*"; /* -Special handle*/
  PK4REC.XGPCD = "*"; /* -general product code*/

  if (PKWREC.PKWSELSW == "PK") /* ---- picking ----*/
    if (PW07M002.PW07M-SEL-IND == "S") /* -Select only "selected" orders*/
      PK4REC.PK4SLIND = "S";
    else
      if (PW07M002.PW07M-SEL-IND == "N") /* -Select only "not selected"*/
        PK4REC.PK4SLIND = " ";
      else /* Select all*/
        PK4REC.PK4SLIND = "*";
      end
    end
  else /* ----  pick planning -----*/
    if (PW07M001.PW07M-SEL-IND == "S") /* -Select only "selected" orders*/
      PK4REC.PK4SLIND = "P";
    else
      if (PW07M001.PW07M-SEL-IND == "N") /* -Select only "not selected"*/
        PK4REC.PK4SLIND = " ";
      else /* Select all*/
        PK4REC.PK4SLIND = "*";
      end
    end
  end

  try
    call "IO1720" ("S7", SQLCA, PK4REC) {isNoRefresh = yes, isExternal = yes};
  end /* Select table set*/

   /* ------------------------------------------------------------*/
   /* If successful, go back to previous routine.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == 0)      /* and normal return code*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-OPEN-POOLH";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VPOOLH01"; /* Table view name*/
  TA1REC.TA1TBLKE = PK4REC.PK4KEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-OPEN-POOLH

// Purge any temporary storage
Function PW07S-P-TEMP-STOR()
   /* ------------------------------------------------------------*/
   /* Initialize the storage areas and indicators to be used.*/
   /* ------------------------------------------------------------*/

  set PW07W01 empty; /* M001 display storage*/

  PW07W00.PW07W-STOR-UPD-SW = "N"; /* Storage update switch*/

  TA5REC.TA5TSQIX = 0; /* Current page number*/
  PW07W00.TA5TSQIX = 0; /* Highest page number*/

   /* ------------------------------------------------------------*/
   /* Purge any temporary storage for this application.*/
   /* ------------------------------------------------------------*/

  TA5REC.TA5APPID = COMMAREA.CACURRAP; /* Application identification*/
  TA5REC.TA5FNCCD = "P"; /* Function code*/

  try
    call "TA0050" (PW07W01, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* Temporary storage*/

   /* ------------------------------------------------------------*/
   /* If successful, return to previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return code*/

    return; /* Return to previous process*/
  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TAEREC.TAEDESC1 = sysVar.errorCode; /* CSP return code*/
  TAEREC.TAEDESC2 = TA5REC.TA5DATA; /* Subroutine parameters*/

  PW07W00.XXXMODID = "   "; /* Module identification*/
  converseLib.validationFailed(29); /* Unexpected error occurred*/

  TA1REC.TA1FUNC = "RETN"; /* Termination function*/
  TA1REC.TA1TYPE = "APPL"; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-P-TEMP-STOR";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1MAPAP = COMMAREA.CACURRAP; /* Map application*/
  TA1REC.TA1MAPNO = "M001"; /* Map number*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-P-TEMP-STOR

// Read temporary storage page
Function PW07S-R-TEMP-STOR()
   /* ------------------------------------------------------------*/
   /* Obtain the next page of data to display.*/
   /* ------------------------------------------------------------*/

  PW07W01.XXXTSLEN = PW07W00.XXXTSLEN; /* Temporary storage length*/

  TA5REC.TA5APPID = COMMAREA.CACURRAP; /* Application identification*/
  TA5REC.TA5TSQIX = PW07W00.XXXTSPAG; /* Page number*/
  TA5REC.TA5FNCCD = "R"; /* Function code*/

  try
    call "TA0050" (PW07W01, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* Temporary storage*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return code*/

    return; /* Return to previous process*/
  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TAEREC.TAEDESC1 = sysVar.errorCode; /* CSP return code*/
  TAEREC.TAEDESC2 = TA5REC.TA5DATA; /* Subroutine parameters*/

  PW07W00.XXXMODID = "   "; /* Module identification*/
  converseLib.validationFailed(29); /* Unexpected error occurred*/

  TA1REC.TA1FUNC = "RETN"; /* Termination function*/
  TA1REC.TA1TYPE = "APPL"; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-R-TEMP-STOR";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1MAPAP = COMMAREA.CACURRAP; /* Map application*/
  TA1REC.TA1MAPNO = "M001"; /* Map number*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-R-TEMP-STOR

// SELECT UNIQUE - DPICK.VCAHLD01
Function PW07S-SELECT-CAHLD()
   /* ------------------------------------------------------------*/
   /* Select 'S ' - DPICK.VCAHLD01*/
   /* ------------------------------------------------------------*/

  set PWFREC empty; /* -Row storage area*/

  PWFREC.XWHCD = PKWREC.XWHCD; /* -Warehouse code*/
  PWFREC.TF1CARCD = PK4REC.TF1CARCD; /* -Carrier code*/
  PWFREC.XHRCD = "*"; /* -hold reason code*/

  try
    call "IO3190" ("S ", SQLCA, PWFREC) {isNoRefresh = yes, isExternal = yes};
  end /* Select row*/

   /* ------------------------------------------------------------*/
   /* If successful, initialize the line index and cursor switch.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/

    if (SQLCA.VAGen_SQLCODE == 0 /* and normal return code*/
     || SQLCA.VAGen_SQLCODE == 100)

      return; /* Return to previous process*/
    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-SELECT-VCAHLD";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VCAHLD01"; /* Table view name*/
  TA1REC.TA1TBLKE = PWFREC.PWFKEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-SELECT-CAHLD

// SELECT 'S ' - DPICK.VCUHLD01
Function PW07S-SELECT-CUHLD()
   /* ------------------------------------------------------------*/
   /* Select unique vcuhld01*/
   /* ------------------------------------------------------------*/

  set PK9REC empty; /* Row storage area*/

  PK9REC.XWHCD = PKWREC.XWHCD; /* Warehouse code*/
  PK9REC.KUCCOID = PK4REC.KUCCOID;
  PK9REC.KUMSTRID = PK4REC.KUMSTRID;
  PK9REC.XNXCD = PK4REC.XNXCD;
  PK9REC.XHRCD = "*";

  try
    call "IO1790" ("S ", SQLCA, PK9REC) {isNoRefresh = yes, isExternal = yes};
  end /* Select row*/

   /* ------------------------------------------------------------*/
   /* If successful, initialize the line index and cursor switch.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/

    if (SQLCA.VAGen_SQLCODE == 0 /* and normal return code*/
     || SQLCA.VAGen_SQLCODE == 100) /* and normal return code*/

      return; /* Return to previous process*/
    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that a system error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL Commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Indicate not available*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Indicate system error*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-SELECT-CUHLD";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VCUHLD01"; /* Table view name*/
  TA1REC.TA1TBLKE = PK9REC.PK9KEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-SELECT-CUHLD

// SELECT - DPICK.VORHLD01
Function PW07S-SELECT-ORHLD()
   /* ------------------------------------------------------------*/
   /* Select 'S ' - Dpick.Vorhld01*/
   /* ------------------------------------------------------------*/

  try
    call "IO1770" ("S ", SQLCA, PKBREC) {isNoRefresh = yes, isExternal = yes};
  end /* Select row*/

   /* ------------------------------------------------------------*/
   /* If successful, initialize the line index and cursor switch.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/

    if (SQLCA.VAGen_SQLCODE == 0 /* and normal return code*/
     || SQLCA.VAGen_SQLCODE == 100) /* and normal return code*/

      return; /* Return to previous process*/
    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that a system error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL Commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Indicate not available*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Indicate system error*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-SELECT-ORHLD";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VORHLD01"; /* Table view name*/
  TA1REC.TA1TBLKE = PKBREC.PKBKEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-SELECT-ORHLD

// Select unique Dpick.Vpoolh01
Function PW07S-SELECT-POOLH()
   /* ------------------------------------------------------------*/
   /* Select unique for Dpick.Vpoolh01*/
   /* ------------------------------------------------------------*/

  set PK4REC empty; /* Clear row storage area*/

   /* ----- Warehouse, Cust ord num, Nike ord num ----------------*/
  PK4REC.XWHCD = PW07W01.XWHCD;
  PK4REC.PK1CUOID = PW07W01.PW07W-ORD-STKTF-ID[PW07W-MAP-IDX];
  PK4REC.PK1NORID = PW07W01.PW07W-NIKE-ORD-ID[PW07W-MAP-IDX];

  try
    call "IO1720" ("S ", SQLCA, PK4REC) {isNoRefresh = yes, isExternal = yes};
  end /* Select table set*/

   /* ------------------------------------------------------------*/
   /* If successful, exit.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == 0)      /* and normal return code*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-SELECT-POOLH";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VPOOLH01"; /* Table view name*/
  TA1REC.TA1TBLKE = PK4REC.PK4KEY; /* Table key*/

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* rollback changes*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-SELECT-POOLH

// Select unique - DPICK.VSELOR01
Function PW07S-SELECT-SELOR()
   /* ------------------------------------------------------------*/
   /* Select unique from selected order table.*/
   /* ------------------------------------------------------------*/

  try
    call "IO1740" ("S ", SQLCA, PKHREC) {isNoRefresh = yes, isExternal = yes};
  end /* Select unique*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /*  */
   /* SQLCODE 100 -  acceptable because the order has been sel'd*/
   /* and needs to be added to table.*/
   /* SQLCODE   0 -  the order is already in the table, EZEMNO*/
   /* (044) "rcd to be added exists" is displayed.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/

    if (SQLCA.VAGen_SQLCODE == 0 /* Normal return code*/
     || SQLCA.VAGen_SQLCODE == 100) /* Not found is good!!*/

      return; /* Return to previous process*/

    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/
    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* Roll back all changes*/

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-SELECT-SELOR";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VSELOR01"; /* Table view name*/
  TA1REC.TA1TBLKE = PKHREC.PKHKEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-SELECT-SELOR

// Update temporary storage page
Function PW07S-U-TEMP-STOR()
   /* ------------------------------------------------------------*/
   /* Update the page in temporary storage.*/
   /* ------------------------------------------------------------*/

  TA5REC.TA5FNCCD = "U"; /* Function code*/

  try
    call "TA0050" (PW07W01, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* Temporary storage*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return code*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TAEREC.TAEDESC1 = sysVar.errorCode; /* CSP return code*/
  TAEREC.TAEDESC2 = TA5REC.TA5DATA; /* Subroutine parameters*/

  PW07W00.XXXMODID = "   "; /* Module identification*/
  converseLib.validationFailed(29); /* Unexpected error occurred*/

  TA1REC.TA1FUNC = "RETN"; /* Termination function*/
  TA1REC.TA1TYPE = "APPL"; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-U-TEMP-STOR";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1MAPAP = COMMAREA.CACURRAP; /* Map application*/
  TA1REC.TA1MAPNO = "M001"; /* Map number*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-U-TEMP-STOR

// Update - DPICK.VORHLD01
Function PW07S-UPDATE-ORHLD()
   /* ------------------------------------------------------------*/
   /* Insert the row in the table.*/
   /* ------------------------------------------------------------*/

  try
    call "IO1770" ("U ", SQLCA, PKBREC) {isNoRefresh = yes, isExternal = yes};
  end /* Update row*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/

    if (SQLCA.VAGen_SQLCODE == 0) /* Normal return code*/

      PW07W01.PW07W-ACTION[PW07W-MAP-IDX] = "*"; /* processed*/
      PW07W00.PW07W-ORD-HLD-SW = "Y";

      return; /* Return to previous process*/

    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else


    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* Roll back all changes*/

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-UPDATE-ORHLD";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VORHLD01"; /* Table view name*/
  TA1REC.TA1TBLKE = PKBREC.PKBKEY; /* Table key*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-UPDATE-ORHLD

// Update Dpick.Vpoolh01
Function PW07S-UPDATE-POOLH()
   /* ------------------------------------------------------------*/
   /* Update the changed row in the table.*/
   /* ------------------------------------------------------------*/

  try
    call "IO1720" ("U ", SQLCA, PK4REC) {isNoRefresh = yes, isExternal = yes};
  end /* Update row*/

   /* ------------------------------------------------------------*/
   /* If successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000") /* Call successful*/
    if (SQLCA.VAGen_SQLCODE == 0) /* Normal return code*/

      return; /* Return to previous process*/

    end

    /* ------------------------------------------------------------*/
     /* If row not found, indicate the data was updated by another.*/
    /* ------------------------------------------------------------*/

    if (SQLCA.VAGen_SQLCODE == 100) /* Row not found*/

      VGVar.handleSysLibraryErrors = 0;
      sysLib.rollback(); /* Roll back all changes*/

      PW07W00.PW07W-REQST-DAT-SW = "Y"; /* Request data switch*/

      PW07W00.XXXMODID = "   "; /* Module identification*/
      PW07W00.XXXMSGNO = 105; /* Data was updated by another*/

      exit stack; /* Exit to display map*/

    end
  end

   /* ------------------------------------------------------------*/
   /* If data not available, return an error message to the user.*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.SQLCAREC = SQLCA.SQLCAREC; /* SQL commarea*/

  PW07W00.XXXMODID = "   "; /* Module identification*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && SQLCA.VAGen_SQLCODE == -911)   /* and resource not available*/

    converseLib.validationFailed(28); /* Data in use by another*/
    TA1REC.TA1FUNC = "POST"; /* Termination function*/

  else

    converseLib.validationFailed(29); /* Unexpected error occurred*/
    TA1REC.TA1FUNC = "RETN"; /* Termination function*/

    converseLib.clearScreen();
     /* Clear screen before display*/
    converseLib.clearScreen();
     /* Clear screen before display*/

  end

  TA1REC.TA1TYPE = "DB2 "; /* Type of error*/
  TA1REC.TA1LOC = "PW07S-UPDATE-POOLH";
  TA1REC.TA1PGMAP = COMMAREA.CACURRAP; /* Program application*/
  TA1REC.TA1PGMNO = PW07W00.XXXMODID; /* Program number*/
  TA1REC.TA1DBASE = "DPICK   "; /* Data base name*/
  TA1REC.TA1TBLVU = "VPOOLH01"; /* Table view name*/
  TA1REC.TA1TBLKE = PK4REC.PK4KEY; /* Table key*/

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* Roll back all changes*/

  call "TA0020" (TA1REC, TAEREC) {isNoRefresh = yes, isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end PW07S-UPDATE-POOLH

//*** RECORD=PW07W00 ****
// Application Working Storage
// ***********************
Record PW07W00 type basicRecord
  5 PW07W-REQST-DAT-SW PW07W-REQST-DAT-SW ; 
  5 PW07W-STOR-UPD-SW PW07W-STOR-UPD-SW ; 
  5 PW07W-BD-FSTPTH-SW PW07W-BD-FSTPTH-SW ; 
  5 PW07W-MAP-DIS-SW PW07W-MAP-DIS-SW ; 
  5 PW07W-UPD-OK-SW PW07W-UPD-OK-SW ; 
  5 PW07W-MORE-DNSB-SW PW07W-MORE-DNSB-SW ; 
  5 PW07W-FRMT-SCRN-SW PW07W-FRMT-SCRN-SW ; 
  5 PW07W-SCRN-MDFY-SW PW07W-SCRN-MDFY-SW ; 
  5 PW07W-PROCESS-SW PW07W-PROCESS-SW ; 
  5 PW07W-ORD-HLD-SW PW07W-ORD-HLD-SW ; 
  5 PW07W-POOLH-CSR-SW PW07W-POOLH-CSR-SW ; 
  5 PW07W-SELOR-CSR-SW PW07W-SELOR-CSR-SW ; 
  5 PW07W-WORK-CSR-SW PW07W-WORK-CSR-SW ; 
  5 * char(1) ; 
  5 PW07W-MAP-IDX PW07W-MAP-IDX ; 
  5 PW07W-ORD-INQ-IDX PW07W-ORD-INQ-IDX ; 
  5 PW07W-DNSB-IDX PW07W-DNSB-IDX ; 
  5 * char(1) ; 
  5 PW07W-CURRENT-DT PW07W-CURRENT-DT ; 
  5 PW07W-WRK-DT PW07W-WRK-DT ; 
    10 PW07W-WRK-CC PW07W-WRK-CC ; 
    10 PW07W-WRK-YY PW07W-WRK-YY ; 
    10 PW07W-WRK-MM PW07W-WRK-MM ; 
    10 PW07W-WRK-DD PW07W-WRK-DD ; 
  5 PW07W-PREV-DNSB-DT PW07W-PREV-DNSB-DT ; 
  5 * char(1) ; 
  5 PW07W-PREV-TF1CARCD PW07W-PREV-TF1CARCD ; 
  5 PW07W-RUN-MODE PW07W-RUN-MODE ; 
  5 PW07W-SEL-IND PW07W-SEL-IND ; 
  5 PW07W-ORDER-TYP-IND PW07W-ORDER-TYP-IND ; 
  5 PW07W-ORDER-TYP-SV PW07W-ORDER-TYP-SV ; 
  5 PW07W-SEL-TYP-CD PW07W-SEL-TYP-CD ; 
  5 XDVCD XDVCD ; 
  5 XDVDESC XDVDESC ; 
  5 XBCCD XBCCD ; 
  5 XBCABRV XBCABRV ; 
  5 XWHCD XWHCD ; 
  5 XWHABRV XWHABRV ; 
  5 * char(1) ; 
  5 XXXTSLEN XXXTSLEN ; 
  5 XXXTSPAG XXXTSPAG ; 
  5 XXXMODID XXXMODID ; 
  5 XXXMSGNO XXXMSGNO ; 
  5 TA5TSQIX TA5TSQIX ; 
end // end PW07W00

//*** RECORD=PW07W01 ****
// Map 001 Display Storage
// ***********************
Record PW07W01 type basicRecord
  5 XXXTSLEN XXXTSLEN ; 
  5 * char(652) ; 
    10 XWHCD XWHCD ; 
    10 XWHABRV XWHABRV ; 
    10 XDVCD XDVCD ; 
    10 XDVDESC XDVDESC ; 
    10 XBCCD XBCCD ; 
    10 XBCABRV XBCABRV ; 
    10 PW07W-SEL-IND PW07W-SEL-IND ; 
    10 PW07W-DNSB-DT PW07W-DNSB-DT ; 
      15 PW07W-DNSB-CC PW07W-DNSB-CC ; 
      15 PW07W-DNSB-YY PW07W-DNSB-YY ; 
      15 PW07W-DNSB-MM PW07W-DNSB-MM ; 
      15 PW07W-DNSB-DD PW07W-DNSB-DD ; 
    10 TF1CARCD TF1CARCD ; 
    10 PW07W-MAP PW07W-MAP [12] ; 
      15 PW07W-ACTION PW07W-ACTION ; 
      15 PW07W-ORD-STKTF-ID PW07W-ORD-STKTF-ID ; 
      15 PW07W-NIKE-ORD-ID PW07W-NIKE-ORD-ID ; 
      15 PW07W-FC-QTY PW07W-FC-QTY ; 
      15 PW07W-RP-QTY PW07W-RP-QTY ; 
      15 PW07W-TOT-QTY PW07W-TOT-QTY ; 
      15 PW07W-SP-HNDL-FL PW07W-SP-HNDL-FL ; 
      15 PW07W-SELECT-FL PW07W-SELECT-FL ; 
      15 PW07W-HOLD-CD PW07W-HOLD-CD ; 
      15 PW07W-REL-MM PW07W-REL-MM ; 
      15 PW07W-REL-DD PW07W-REL-DD ; 
      15 PW07W-REL-YY PW07W-REL-YY ; 
end // end PW07W01

// Action code
DataItem PW07W-ACTION char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Bad fast path switch
DataItem PW07W-BD-FSTPTH-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Current date (CCYYMMDD)
DataItem PW07W-CURRENT-DT num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// DNSB century
DataItem PW07W-DNSB-CC num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// DNSB day
DataItem PW07W-DNSB-DD num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// DNSB date
DataItem PW07W-DNSB-DT num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// DNSB date index (pwkrec)
DataItem PW07W-DNSB-IDX num(3)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// DNSB month
DataItem PW07W-DNSB-MM num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// DNSB year
DataItem PW07W-DNSB-YY num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Full case qty
DataItem PW07W-FC-QTY num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Format screen switch
DataItem PW07W-FRMT-SCRN-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Hold code
DataItem PW07W-HOLD-CD char(2)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem PW07W-MAP char(50)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Map display switch
DataItem PW07W-MAP-DIS-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Map line index
DataItem PW07W-MAP-IDX num(3)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Passed DNSB dates to process
DataItem PW07W-MORE-DNSB-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// PK-NIKE-ORD-ID
DataItem PW07W-NIKE-ORD-ID num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Order on hold switch
DataItem PW07W-ORD-HLD-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Order inquiry index
DataItem PW07W-ORD-INQ-IDX num(3)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// PK-ORD-STKTF-ID
DataItem PW07W-ORD-STKTF-ID num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Order type ('B', 'C', ' ')
DataItem PW07W-ORDER-TYP-IND char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Save order type
DataItem PW07W-ORDER-TYP-SV char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Pool header cursor (PK4REC)
DataItem PW07W-POOLH-CSR-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Previous DNSB date (CCYYMMDD)
DataItem PW07W-PREV-DNSB-DT num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// tf-carr-cd
DataItem PW07W-PREV-TF1CARCD char(4)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Process order switch
DataItem PW07W-PROCESS-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Hold release day
DataItem PW07W-REL-DD num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Hold release month
DataItem PW07W-REL-MM num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Hold release year
DataItem PW07W-REL-YY num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Request for data switch
DataItem PW07W-REQST-DAT-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Repack qty
DataItem PW07W-RP-QTY num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// PK-RUN-MODE
DataItem PW07W-RUN-MODE char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Screen modified switch
DataItem PW07W-SCRN-MDFY-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Sel'd, N-sel'd, & All indicate
DataItem PW07W-SEL-IND char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Selection type code
DataItem PW07W-SEL-TYP-CD char(2)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Selection flag
DataItem PW07W-SELECT-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Selected order cursor (PKHREC)
DataItem PW07W-SELOR-CSR-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Special handle flag
DataItem PW07W-SP-HNDL-FL char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Storage update switch
DataItem PW07W-STOR-UPD-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Total qty
DataItem PW07W-TOT-QTY num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Update successful switch
DataItem PW07W-UPD-OK-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Work cursor switch
DataItem PW07W-WORK-CSR-SW char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// Century work area
DataItem PW07W-WRK-CC num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Day work area
DataItem PW07W-WRK-DD num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Date work area (CCYYMMDD)
DataItem PW07W-WRK-DT num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Month work area
DataItem PW07W-WRK-MM num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// Year work area
DataItem PW07W-WRK-YY num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

