package kf0b;

import corpcom3.XPTA0P;
import corpcom4.XSENTRY;
import corpcom4.XSEXIT;
import corpcom4.XSKFS-CHK-SECURITY;
import corpcom4.XSPF1;
import corpcom4.XSPF4;
import corpcom4.XSSEGTR;
import corpcom5.CO-CUST-SESN-SLS;
import corpcom5.CO-CUST-STAT-IND;
import corpcom5.COMMAREA;
import corpcom5.CU-CO-ID;
import corpcom5.CU-STOR-ID;
import corpcom5.CU-STOR-NM;
import corpcom5.ERRSQLCA;
import corpcom6.SQLCA;
import corpx2.XNX-DEPT-ID-XREF;
import corpx2.XSE-SESN-CD;
import corpy2.YNS-BUS-FUNC-ID;
import corpy2.YNSTBL;
import corpy2.YSB-SLS-RESP-CD;
import kf.common.KFATBL;
import kf.common.KFWREC;
import ku.common.KUMREC;
import sm.common.SM1REC;
import sm.common.SM4REC;
import sm.common.SM5REC;
import ta.common.TA1REC;
import ta.common.TA3REC;
import ta.common.TA5APPID;
import ta.common.TA5REC;
import ta.common.TA6REC;
import ta.common.TAEREC;
import vv.common.VKOCTL01;
import vv.common.VREPOS01;
import vv.common.VSNADJ01;
import vv.common.VSNSLS01;
//*** PROGRAM=KF0B ****
// KF0B shows seasonal sales detail by customer for a given
// agency and rep.
// 
// The user enters the agency ID and rep ID.  KF internal
// security is checked to see if the user is authorized to
// access the information for that agency and rep.  If the user
// is not authorized, no information is displayed.
// 
// If the user has entered KF0B from another KF system program,
// the agency and rep that were browsed on that screen will be
// used to build the KF0B map (after security is checked).
// 
// Data from the prior season is displayed first.  The user can
// user PF20 and PF19 to scroll to previous or next seasons.
// 
// If the user presses PF15, JCL statements for job KF1221 are
// formatted and submitted through the background job request
// subprogram (TP0A).  This job executes in batch and prints
// a report of the same data as what is displayed on the map.
// The user can specify the location and printer for the
// output.
// 
// The JCL is stored as a table in four different formats:
//     1.  Production JCL for a remote printer.
//     2.  Test JCL for a remote printer.
//     3.  Production JCL for the local printer.
//     4.  Test JCL for the local printer.
// 
// The user can exit this screen by pressing PF1, PF3 or PF4;
// or by entering a valid fast path option.
// 
// The screen is cleared if the user presses PA2.
// 
// ************************************************************
// *                MAINENANCE HISTORY                        *
// ************************************************************
// 
// Log #    Date     Name   Description
// -----  --------  ------  -----------------------------------
// 
//  001   09/23/92  JBECKE  Created new program.
//  002   11/09/92  DLIDDL  Changed all table, map and WS refs
//                          to column XSN_SESN_YR_RNG to
//                          YNS_SESN_YR.
//  026   17/12/92  DLIDDL  Rate forecasting enhancements.
//  032   05/24/93  GCALKI  Changed so that opening screen is
//                          two seasons back from current sesn.
//  033   09/22/93 ISCHMI   Changed call to IO5610 to come from
//                          a four byte record instead of a
//                          literal, which will prevent over-
//                          laying of storage in subsequent
//                          calls to other subroutines.
// 
// 
// *********************
Program KF0B type textUIProgram //VAGen Info - main text program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes, 
  msgTablePrefix = "KF00", inputRecord = COMMAREA, segmented = yes
  }

  // Data Declarations
  COMMAREA COMMAREA ; // record
  ERRSQLCA ERRSQLCA; // record
  KF0BW01 KF0BW01; // record
  KF0BW02 KF0BW02; // record
  KF0BW03 KF0BW03; // record
  KF0BW04 KF0BW04; // record
  KF0BW05 KF0BW05; // record
  KFWREC KFWREC; // record
  KUMREC KUMREC; // record
  SM1REC SM1REC; // record
  SM4REC SM4REC; // record
  SM5REC SM5REC; // record
  SQLCA SQLCA; // record
  TA1REC TA1REC; // record
  TA3REC TA3REC; // record
  TA5REC TA5REC; // record
  TA6REC TA6REC; // record
  TAEREC TAEREC; // record
  VKOCTL01 VKOCTL01; // record
  VREPOS01 VREPOS01; // record
  VSNADJ01 VSNADJ01; // record
  VSNSLS01 VSNSLS01; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use KFATBL {deleteAfterUse = yes}; // table
  use KF0BT01 {deleteAfterUse = yes}; // table
  use KF0BT02 {deleteAfterUse = yes}; // table
  use KF0BT03 {deleteAfterUse = yes}; // table
  use KF0BT04 {deleteAfterUse = yes}; // table
  use YNSTBL {deleteAfterUse = yes}; // table
  use KF0BM.KF0BM001, // form
  		KF0BM.TA0PM001
   {
    pfKeyEquate = no
  };

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    KF0B-00000: KF0B-00000();
    KF0B-10000: KF0B-10000();
    ;
     /* always loop through the converse*/
    goto KF0B-10000;
  end // end main
end // end KF0B

Function KF0B-00000()
   /* initial processesing*/
  ;
  XSENTRY(); /* check goal security*/
  ;
  XSSEGTR(); /* set segmented tran id*/
  ;
  KF0BS-INITIALIZE(); /* initialize process*/
  ;
  if (KFWREC.SM-SAGCY-ID != " " /* agency id and/or rep id passed*/
   || KFWREC.SM-SREP-ID != 0)   /* from previous program*/
    KF0BM001.KF0BM-SM-SAGCY-ID = KFWREC.SM-SAGCY-ID;
    KF0BM001.KF0BM-SM-SREP-ID = KFWREC.SM-SREP-ID;
    KF0BS-BUILD-MAP(); /* use them to build map*/
    ;
  end
  ;
end // end KF0B-00000

// converse kf0bm001 map
Function KF0B-10000()
  ;
  ;
                   /* nothing to do in the before stage*/
  ;
  ;
  ;
  converse KF0BM001 ;
  ;
  ;
             /* set the error flag off and edit the attention key*/
  ;
  ;
  KF0BW01.KF0BW-ERROR-IND = "N";
  KF0BM001.KF0BM-MESSAGE = " "; /* clear message*/
  set KF0BM001.KF0BM-SM-SAGCY-ID initialAttributes; /* set map entry fields*/
  set KF0BM001.KF0BM-SM-SREP-ID initialAttributes;
  ;
  if (converseVar.eventKey is enter) /* user pressed enter*/
    KF0BS-EDIT-ENTRY();
  else
    if (converseVar.eventKey is pf1 /* user pressed a valid pf key*/
     || converseVar.eventKey is pf3 
     || converseVar.eventKey is pf4 
     || converseVar.eventKey is pf7 
     || converseVar.eventKey is pf8 
     || converseVar.eventKey is pf15
     || converseVar.eventKey is pf19
     || converseVar.eventKey is pf20)
      KF0BS-EDIT-PF-KEYS();
    else
      if (converseVar.eventKey is pa2) /* user pressed PA2*/
        KF0BS-CLEAR-MAP();
      else
        converseLib.validationFailed(2); /* invalid key pressed*/
      end
    end
  end
  ;
end // end KF0B-10000

// add ws to temp storage
Function KF0BS-ADD-TMP-STR()
  ;
  ;
             /* when the working storage table becomes full*/
             /* add the working storage array to the*/
             /* temporary storage queue*/
             /* and clear out working storage*/
  ;
             /* if an error occurs, post an error message*/
  ;
  ;
  set TA5REC empty; /* clear ts parms*/
  ;
  TA5REC.TA5FNCCD = "A"; /* add record*/
  TA5REC.TA5APPID = KF0BW01.TA5APPID; /* application ID*/
  KF0BW02.KF0BW-LENGTH = KF0BW01.KF0BW-MAX-QUEUE-LENGTH;
  TA5REC.TA5TSQIX = KF0BW01.KF0BW-TS-REC-COUNT + 1;
  ;
  try
    call "TA0050" (KF0BW02, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* temp storage*/
  ;
  if (sysVar.errorCode == "00000000" /* call was successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return*/
    KF0BW01.KF0BW-TS-REC-COUNT = TA5REC.TA5TSQIX; /* count rec*/
  else /* an error occurred*/
    KF0BW01.KF0BW-ERROR-IND = "Y"; /* set error flag*/
    set TAEREC empty;
    TAEREC.TAEDESC1 = sysVar.errorCode; /* csp return code*/
    TAEREC.TAEDESC2 = TA5REC.TA5DATA; /* subroutine parameters*/
    TA1REC.TA1TYPE = "APPL"; /* application error*/
    TA1REC.TA1FUNC = "POST"; /* post, no abend*/
    TA1REC.TA1LOCAT[1] = "ADD TS  "; /* location*/
    TA1REC.TA1LOCAT[2] = "TA0050  "; /* subroutine*/
    try
      call "TA0020" (TA1REC, TAEREC) {isExternal = yes};
    end /* message formatter*/
    converseLib.validationFailed(34); /* set error message*/
  end
  ;
end // end KF0BS-ADD-TMP-STR

// build map detail
Function KF0BS-BUILD-DTL()
  /* ***********************************************************************/
  /* *  MODULE: BUILD MAP DETAIL                                          **/
  /* * PURPOSE: Builds the map detail based on seasonal and adjusted      **/
  /* *          sales.                                                    **/
  /* ***********************************************************************/
  ;
  KF0BS-OPEN-SLS-CSR(); /* open seasonal sales cursor*/
  KF0BS-OPEN-ADJ-CSR(); /* open adjustments cursor*/
  ;
  KF0BS-FTCH-SLS-ROW(); /* fetch a seasonal sales row*/
  KF0BS-FTCH-ADJ-ROW(); /* fetch an adjustments row*/
  ;
  KF0BW02.KF0BW-WS-LOAD-COUNT = 0;
  ;
  while (KF0BW01.KF0BW-SESN-CUST-KEY != "9999999999999999999"
   || KF0BW01.KF0BW-ADJ-CUST-KEY != "9999999999999999999"
  )
  /* ***********************************************************************/
  /* * If the customer key from the seasonal sales row is less than or    **/
  /* * equal to the customer key from the adjustments row, process the    **/
  /* * seasonal sales row.                                                **/
  /* ***********************************************************************/
    ;
    if (KF0BW01.KF0BW-SESN-CUST-KEY <= 
    KF0BW01.KF0BW-ADJ-CUST-KEY)
      KF0BS-PROC-SLS-ROW(); /* process seasonal sales row*/
    else
      ;
  /* ***********************************************************************/
  /* * If the customer key from the seasonal sales row is greater than the**/
  /* * customer key from the adjustments row, process the adjustments     **/
  /* * row.                                                               **/
  /* ***********************************************************************/
      ;
      if (KF0BW01.KF0BW-SESN-CUST-KEY > 
      KF0BW01.KF0BW-ADJ-CUST-KEY)
        KF0BS-PROC-ADJ-ROW(); /* process adjustments row*/
      end
    end
  end
  ;
  KF0BS-CLSE-SLS-CSR(); /* close seasonal sales cursor*/
  KF0BS-CLSE-ADJ-CSR(); /* close adjustments cursor*/
  ;
  if (KF0BW02.KF0BW-WS-LOAD-COUNT > 0) /* rows in working storage*/
    KF0BS-ADD-TMP-STR(); /* add to temp storage*/
  end
  ;
  set KF0BW02 empty; /* clear table*/
  ;
end // end KF0BS-BUILD-DTL

// build kf0bm001 map
Function KF0BS-BUILD-MAP()
  ;
           /* validate fields the user entered - agency ID and rep ID*/
           /* build map if fields are valid*/
           /* send back error message if fields are not valid*/
  ;
  ;
  KFWREC.SM-SAGCY-ID = KF0BM001.KF0BM-SM-SAGCY-ID;
  KFWREC.SM-SREP-ID = KF0BM001.KF0BM-SM-SREP-ID;
  KF0BS-CLEAR-MAP();
  ;
  KF0BM001.KF0BM-SM-SAGCY-ID = KFWREC.SM-SAGCY-ID;
  KF0BM001.KF0BM-SM-SREP-ID = KFWREC.SM-SREP-ID;
  ;
  KF0BW01.KF0BW-ERROR-IND = "N";
  ;
  set SM1REC empty;
  set SM4REC empty;
  set SM5REC empty;
  ;
  if (KF0BM001.KF0BM-SM-SREP-ID == 0) /* validate rep id*/
    converseLib.validationFailed(13); /* must enter rep id*/
    KF0BW01.KF0BW-ERROR-IND = "Y";
    set KF0BM001.KF0BM-SM-SREP-ID cursor, bold;
  else
    SM4REC.SM4REPID = KF0BM001.KF0BM-SM-SREP-ID;
    call "IO0020" ("S ", SQLCA, SM4REC) {isNoRefresh = yes, isExternal = yes}; /* fetch rep row*/
  /*  */
    if (SQLCA.VAGen_SQLCODE == 0) /* if rep is found*/
      KF0BM001.KF0BM-XXX-LAST-NM = SM4REC.XXXLSTNM; /* move to map*/
      KF0BM001.KF0BM-XXX-FRST-NM = SM4REC.XXXFSTNM;
    else /* an error occurred*/
      if (SQLCA.VAGen_SQLCODE == 100) /* rep not found*/
        converseLib.validationFailed(7); /* rep does not exist*/
        KF0BW01.KF0BW-ERROR-IND = "Y";
        set KF0BM001.KF0BM-SM-SREP-ID cursor, bold;
      else /* an error occurred*/
        KF0BS-PURGE-TMP-ST();
        KF0BW01.KF0BW-ERROR-IND = "Y";
        set ERRSQLCA empty;
        move SQLCA to ERRSQLCA withV60Compat;
        TA1REC.TA1TYPE = "DB2"; /* db2 error*/
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1DBASE = "DSLSMN  "; /* data base name*/
        TA1REC.TA1TBLVU = "VREPS001"; /* table view name*/
        TA1REC.TA1LOCAT[3] = "BUILD  1"; /* error location*/
        TA1REC.TA1LOCAT[4] = "IO0020"; /* i/o mod*/
        try
          call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
        end /* message formatter*/
        COMMAREA.CAUSERA = " "; /* clear commarea*/
        XSPF4(); /* pass to goal menu*/
        exit program; /* goal memu failure*/
      end
    end
  end
  ;
  if (KF0BM001.KF0BM-SM-SAGCY-ID == " ") /* validate agency id*/
    converseLib.validationFailed(12); /* must enter agency id*/
    KF0BW01.KF0BW-ERROR-IND = "Y";
    set KF0BM001.KF0BM-SM-SAGCY-ID cursor, bold;
  else
    SM1REC.SM1AGYID = KF0BM001.KF0BM-SM-SAGCY-ID;
    call "IO0050" ("S ", SQLCA, SM1REC) {isNoRefresh = yes, isExternal = yes}; /* fetch agency row*/
  /*  */
    if (SQLCA.VAGen_SQLCODE == 0) /* if agency is found*/
      KF0BM001.KF0BM-SM-SAGCY-NM = SM1REC.SM1AGYNM; /* move to map*/
    else /* agency not found*/
      if (SQLCA.VAGen_SQLCODE == 100)
        converseLib.validationFailed(5); /* agency doesn't exist*/
        KF0BW01.KF0BW-ERROR-IND = "Y";
        set KF0BM001.KF0BM-SM-SAGCY-ID cursor, bold;
      else /* an error occurred*/
        KF0BS-PURGE-TMP-ST();
        KF0BW01.KF0BW-ERROR-IND = "Y";
        set ERRSQLCA empty;
        move SQLCA to ERRSQLCA withV60Compat;
        TA1REC.TA1TYPE = "DB2"; /* db2 error*/
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1DBASE = "DSLSMN  "; /* data base name*/
        TA1REC.TA1TBLVU = "VSAGCY01"; /* table view name*/
        TA1REC.TA1LOCAT[3] = "BUILD  2"; /* error location*/
        TA1REC.TA1LOCAT[4] = "IO0020"; /* i/o mod*/
        try
          call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
        end /* message formatter*/
        COMMAREA.CAUSERA = " "; /* clear commarea*/
        XSPF4(); /* pass to goal menu*/
        exit program; /* goal memu failure*/
      end
    end
  end
  ;
  KF0BW01.KF0BW-TERM-DATE = 0;
  ;
  if (KF0BW01.KF0BW-ERROR-IND == "N") /* if no errors*/
                                                  /* validate agency/rep*/
    SM5REC.SM1AGYID = KF0BM001.KF0BM-SM-SAGCY-ID;
    SM5REC.SM4REPID = KF0BM001.KF0BM-SM-SREP-ID;
    SM5REC.XXXSTAT = "A";
    ;
    call "IO0160" ("S ", SQLCA, SM5REC) {isNoRefresh = yes, isExternal = yes}; /* fetch agency row*/
    ;
    if (SQLCA.VAGen_SQLCODE == 0) /* rep found*/
      KF0BW01.KF0BW-HOLD-PSTN-ID = SM5REC.SM-SREP-PSTN-ID;
    else
      if (SQLCA.VAGen_SQLCODE == 100) /* look for inactive*/
        SM5REC.XXXSTAT = " ";
        call "IO0160" ("S3", SQLCA, SM5REC) {isNoRefresh = yes, isExternal = yes};
        if (SQLCA.VAGen_SQLCODE == 0)
          call "IO0160" ("N3", SQLCA, SM5REC) {isNoRefresh = yes, isExternal = yes};
          if (SQLCA.VAGen_SQLCODE == 0) /* inactive found*/
            KF0BW01.KF0BW-TERM-DATE = SM5REC.SM5TDT;
            KF0BM001.KF0BM-SM-SREP-PSTN-ID = SM5REC.SM-SREP-PSTN-ID;
          else
            if (SQLCA.VAGen_SQLCODE == 100)
              converseLib.validationFailed(14); /* rep not in agency*/
              KF0BW01.KF0BW-ERROR-IND = "Y";
              set KF0BM001.KF0BM-SM-SAGCY-ID cursor, bold;
              set KF0BM001.KF0BM-SM-SREP-ID bold;
            end
          end
          call "IO0160" ("C3", SQLCA, SM5REC) {isNoRefresh = yes, isExternal = yes};
          if (SQLCA.VAGen_SQLCODE != 0)
            KF0BW01.KF0BW-ERROR-IND = "D";
          end
        else
          KF0BW01.KF0BW-ERROR-IND = "D";
        end
      else
        KF0BW01.KF0BW-ERROR-IND = "D";
      end
    end
    if (KF0BW01.KF0BW-ERROR-IND == "D") /* db2 error occurred*/
      KF0BS-PURGE-TMP-ST();
      KF0BW01.KF0BW-ERROR-IND = "Y";
      set ERRSQLCA empty;
      move SQLCA to ERRSQLCA withV60Compat;
      TA1REC.TA1TYPE = "DB2"; /* db2 error*/
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1DBASE = "DSLSMN  "; /* data base name*/
      TA1REC.TA1TBLVU = "VSAGCY01"; /* table view name*/
      TA1REC.TA1LOCAT[3] = "BUILD  2"; /* error location*/
      TA1REC.TA1LOCAT[4] = "IO0020"; /* i/o mod*/
      try
        call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
      end /* message formatter*/
      COMMAREA.CAUSERA = " "; /* clear commarea*/
      XSPF4(); /* pass to goal menu*/
      exit program; /* goal memu failure*/
    end
  end
  ;
  if (KF0BW01.KF0BW-ERROR-IND == "N") /* if no errors*/
    XSKFS-CHK-SECURITY(); /* check security*/
    ;
    if (KFW-ACCESS-IND == "Y") /* access ok'd*/
      KF0BS-NEW-SEASON(); /* start new season*/
    else
      if (KFWREC.KFW-SCRTY-LVL-CD == 0) /* no access allowed*/
        set KF0BM001.KF0BM-SM-SAGCY-ID bold;
        set KF0BM001.KF0BM-SM-SREP-ID bold;
      else
        if (KFWREC.KFW-SCRTY-LVL-CD == 2) /* no access to agency*/
          set KF0BM001.KF0BM-SM-SAGCY-ID bold;
        else
          if (KFWREC.KFW-SCRTY-LVL-CD == 3) /* no access to rep*/
            set KF0BM001.KF0BM-SM-SREP-ID cursor, bold;
          else
            if (KFWREC.KFW-SCRTY-LVL-CD == 4 /* no access to agency*/
             && converseVar.validationMsgNum == 6)
              set KF0BM001.KF0BM-SM-SAGCY-ID bold;
            else
              if (KFWREC.KFW-SCRTY-LVL-CD == 4 /* no access to rep*/
               && converseVar.validationMsgNum == 32)
                set KF0BM001.KF0BM-SM-SREP-ID cursor, bold;
              end
            end
          end
        end
      end
    end
    ;
  end
end // end KF0BS-BUILD-MAP

// calculate realign dt boundary
Function KF0BS-CALC-STRT-DT()
  /*  */
  /* the date required is the 20th day of the previous month*/
  /*  */
  KF0BW01.KF0BW-DATE-STRT-CCYYMMDD = VGVar.currentShortGregorianDate;
  ;
  if (KF0BW01.KF0BW-DATE-STRT-YY > 90)
    KF0BW01.KF0BW-DATE-STRT-CC = 19;
  else
    KF0BW01.KF0BW-DATE-STRT-CC = 20;
  end
  ;
  KF0BW01.KF0BW-CURR-DATE-CCYYMMDD = KF0BW01.KF0BW-DATE-STRT-CCYYMMDD;
  ;
  KF0BW01.KF0BW-DATE-STRT-CCYYMMDD = KF0BW01.KF0BW-DATE-STRT-CCYYMMDD - 100;
  ;
  if (KF0BW01.KF0BW-DATE-STRT-MM == 0) /* year change*/
    KF0BW01.KF0BW-DATE-STRT-CCYYMMDD = KF0BW01.KF0BW-DATE-STRT-CCYYMMDD - 8800;
  end
  ;
  KF0BW01.KF0BW-DATE-STRT-DD = 20;
  ;
  KF0BW01.KF0BW-DATE-FRST-CCYYMMDD = KF0BW01.KF0BW-CURR-DATE-CCYYMMDD;
  KF0BW01.KF0BW-DATE-FRST-DD = 01;
  ;
end // end KF0BS-CALC-STRT-DT

// get cics region info
Function KF0BS-CICS-INFO()
  ;
  ;
           /* Determine if the program is running on the production*/
           /* or development machine.*/
  ;
  try
    call "TA0230" (TA3REC) {isNoRefresh = yes, isExternal = yes};
  end /* get CICS info*/
  ;
  if (sysVar.errorCode != "00000000" /* call was not good*/
   || TA3REC.TA3RTNCD != 0)          /* or bad return code*/
    KF0BW01.KF0BW-ERROR-IND = "Y"; /* set error flag*/
    set TAEREC empty;
    TAEREC.TAEDESC1 = sysVar.errorCode; /* csp return code*/
    TAEREC.TAEDESC2 = TA3REC.TA3GROUP; /* subroutine parameters*/
    TA1REC.TA1TYPE = "APPL"; /* application error*/
    TA1REC.TA1FUNC = "POST"; /* post, no abend*/
    TA1REC.TA1LOCAT[1] = "CICS INF"; /* location*/
    TA1REC.TA1LOCAT[2] = "TA0230  "; /* subroutine*/
    try
      call "TA0020" (TA1REC, TAEREC) {isExternal = yes};
    end /* message formatter*/
    converseLib.validationFailed(35); /* set error message*/
    KF0BW01.KF0BW-ERROR-IND = "Y";
  end
  ;
end // end KF0BS-CICS-INFO

// clear kf0bm001 map
Function KF0BS-CLEAR-MAP()
  ;
     /* Clear the map.  Set the season and*/
     /* last realign date headings dark.*/
     /* Move the current date to the map.*/
  ;
  set KF0BM001 initial; /* clear map*/
  ;
  set KF0BM-SEASON-HEADING skip, invisible;
  set KF0BM-SEASON-YR-DESC skip, invisible;
  set KF0BM-UPDATE-DATE-HEADING skip, invisible;
  set KF0BM-CO-LST-RALGN-DT skip, invisible;
  set KF0BM-TERM-HEADING skip, invisible;
  set KF0BM-SM-SREP-TDT skip, invisible;
  ;
  KF0BM-DATE = VGVar.currentShortGregorianDate; /* move date to map*/
  ;
end // end KF0BS-CLEAR-MAP

// close the DCOMM.VSNADJ01 csr
Function KF0BS-CLSE-ADJ-CSR()
  /* ***********************************************************************/
  /* *  MODULE: CLOSE THE ADJUSTMENTS CURSOR                              **/
  /* * PURPOSE: Closes the adjustments cursor.                            **/
  /* ***********************************************************************/
  ;
  KF0BW05.KF0BW-IO-TASK = "C1"; /* set up call parms*/
  KF0BW05.KF0BW-IO-IND1 = 0;
  call "IO5610" (KF0BW05, SQLCA, VSNADJ01) {isNoRefresh = yes, isExternal = yes}; /* close  cursor*/
  ;
  if (SQLCA.VAGen_SQLCODE != 0) /* if an error occured*/
    KF0BS-PURGE-TMP-ST();
    KF0BW01.KF0BW-ERROR-IND = "Y";
    set ERRSQLCA empty;
    move SQLCA to ERRSQLCA withV60Compat;
    TA1REC.TA1TYPE = "DB2"; /* db2 error*/
    TA1REC.TA1FUNC = "RETN";
    TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
    TA1REC.TA1TBLVU = "VSNADJ01"; /* table view name*/
    TA1REC.TA1LOCAT[3] = "CLOSE C1"; /* error location*/
    TA1REC.TA1LOCAT[4] = "IO3960"; /* i/o mod*/
    try
      call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
    end /* message formatter*/
    COMMAREA.CAUSERA = " "; /* clear commarea*/
    XSPF4(); /* pass to goal menu*/
    exit program; /* goal menu failure*/
  end
  ;
end // end KF0BS-CLSE-ADJ-CSR

// close the DCOMM.VSNSLS01 csr
Function KF0BS-CLSE-SLS-CSR()
  /* ***********************************************************************/
  /* *  MODULE: CLOSE THE SEASONAL SALES CURSOR                           **/
  /* * PURPOSE: Closes the seasonal sales cursor.                         **/
  /* ***********************************************************************/
  ;
  call "IO3960" ("C1", SQLCA, VSNSLS01) {isNoRefresh = yes, isExternal = yes}; /* close  cursor*/
  ;
  if (SQLCA.VAGen_SQLCODE != 0) /* if an error occured*/
    KF0BS-PURGE-TMP-ST();
    KF0BW01.KF0BW-ERROR-IND = "Y";
    set ERRSQLCA empty;
    move SQLCA to ERRSQLCA withV60Compat;
    TA1REC.TA1TYPE = "DB2"; /* db2 error*/
    TA1REC.TA1FUNC = "RETN";
    TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
    TA1REC.TA1TBLVU = "VSNSLS01"; /* table view name*/
    TA1REC.TA1LOCAT[3] = "CLOSE C1"; /* error location*/
    TA1REC.TA1LOCAT[4] = "IO3960"; /* i/o mod*/
    try
      call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
    end /* message formatter*/
    COMMAREA.CAUSERA = " "; /* clear commarea*/
    XSPF4(); /* pass to goal menu*/
    exit program; /* goal menu failure*/
  end
  ;
end // end KF0BS-CLSE-SLS-CSR

Function KF0BS-EDIT-ENTRY()
  ;
      /* if a fast path has been entered, pass control to that program*/
      /* otherwise, build the map*/
  ;
  ;
  if (KF0BM001.CATOAP > " ") /* fastpath requested*/
    KF0BS-PURGE-TMP-ST(); /* purge temp storage*/
    COMMAREA.CATOAP = KF0BM001.CATOAP;
    COMMAREA.CAITEM = KF0BM001.CAITEM;
    COMMAREA.CAUSERA = " "; /* clear user area*/
    if (COMMAREA.CATOSYS == COMMAREA.CACURSYS) /* transfer in KF system*/
      COMMAREA.CAUSERA = KFWREC.KFW-GROUP; /* pass common w/s rec*/
    end
    XSEXIT(); /* transfer control*/
    KF0BM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* an error was found*/
  else /* new agency or rep ?*/
    if (KF0BM001.KF0BM-SM-SAGCY-ID != KFWREC.SM-SAGCY-ID
     || KF0BM001.KF0BM-SM-SREP-ID != KFWREC.SM-SREP-ID)
      KF0BW01.KF0BW-NEW-SEASON = YNSTBL.XSE-SESN-CD[KF0BW-SESN-PNTR];
      KF0BW01.KF0BW-NEW-YEAR = YNSTBL.YNS-SESN-YR[KF0BW-SESN-PNTR];
      KF0BW01.KF0BW-SESN-INDEX = KF0BW01.KF0BW-SESN-PNTR;
                                   /* reset index*/
    end
    KF0BS-BUILD-MAP(); /* build map*/
  end
  ;
end // end KF0BS-EDIT-ENTRY

Function KF0BS-EDIT-PF-KEYS()
       /* user pressed a PF key*/
       /* edit for valid options and pass control as requested*/
  ;
       /* valid PF keys are:*/
             /* 1 - pass control to help system*/
             /* 3 - pass control to KF0A*/
             /* 4 - pass control to GOAL main menu*/
             /* 7 - scroll up*/
             /* 8 - scroll down*/
             /* 15 - submit the online report*/
             /* 19 - display the prior season's data*/
             /* 20 - display the next season's data*/
  ;
  ;
  if (KF0BM001.CATOAP > " ") /* fastpath entered*/
    converseLib.validationFailed(4); /* can't fastpath and PF key*/
  else
    if (converseVar.eventKey is pf1) /* PF1*/
      KF0BS-PURGE-TMP-ST(); /* purge temp storage*/
      XSPF1();
      KF0BM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* an error occurred*/
    else
      if (converseVar.eventKey is pf3) /* pf3*/
        KF0BS-PURGE-TMP-ST(); /* purge temp storage*/
        COMMAREA.CAUSERA = " "; /* pass working storage*/
        COMMAREA.CAUSERA = KFWREC.KFW-GROUP;
        COMMAREA.CATOAP = "KF0A";
        COMMAREA.CAITEM = " ";
        XSEXIT();
        KF0BM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* an error occurred*/
      else
        if (converseVar.eventKey is pf4) /* PF 4*/
          KF0BS-PURGE-TMP-ST(); /* purge temp storage*/
          XSPF4();
          KF0BM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* an error occurred*/
        else
          if (converseVar.eventKey is pf7) /* PF 7*/
            KF0BS-SCROLL-UP(); /* scroll up*/
          else
            if (converseVar.eventKey is pf8) /* pf 8*/
              KF0BS-SCROLL-DOWN(); /* scroll down*/
            else
              if (converseVar.eventKey is pf15) /* pf 15*/
                KF0BS-SUBMIT-RPT(); /* submit report*/
              else
                if (converseVar.eventKey is pf19 /* pf 19*/
                 || converseVar.eventKey is pf20) /* or pf 20*/
                  if (KFWREC.KFW-ACCESS-IND == "Y")
                    KF0BS-GET-SEASON(); /* determine new season*/
                    if (KF0BW01.KF0BW-ERROR-IND != "Y") /* No errors*/
                      KF0BS-NEW-SEASON(); /* start new season*/
                    end
                  else
                    KF0BS-BUILD-MAP(); /* access not allowed*/
                  end
                end
              end
            end
          end
        end
      end
    end
  end
  ;
end // end KF0BS-EDIT-PF-KEYS

// fetch an adjustments row
Function KF0BS-FTCH-ADJ-ROW()
  /* ***********************************************************************/
  /* *  MODULE: FETCH ADJUSTMENTS ROW                                     **/
  /* * PURPOSE: Fetches the next row from the adjustments cursor.         **/
  /* ***********************************************************************/
  ;
  KF0BW05.KF0BW-IO-TASK = "N1"; /* set up call parms*/
  KF0BW05.KF0BW-IO-IND1 = 0;
  call "IO5610" (KF0BW05, SQLCA, VSNADJ01) {isNoRefresh = yes, isExternal = yes}; /* fetch row*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* no errors*/
    ;
  /* ***********************************************************************/
  /* * Move customer fields to a group customer key in working storage.   **/
  /* * This will make comparisons between the seasonal and adjustments    **/
  /* * customer keys easier to perform.                                   **/
  /* ***********************************************************************/
    ;
    KF0BW01.KF0BW-ADJ-CU-CO-ID = VSNADJ01.CU-CO-ID;
    KF0BW01.KF0BW-ADJ-CU-STOR-ID = VSNADJ01.CU-STOR-ID;
    KF0BW01.KF0BW-ADJ-DEPT-ID-XREF = VSNADJ01.XNX-DEPT-ID-XREF;
    KF0BW01.KF0BW-ADJ-YSB-SLS-RESP-CD = VSNADJ01.YSB-SLS-RESP-CD;
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* no record found*/
      ;
  /* ***********************************************************************/
  /* * Move all 9's to the group customer key in working storage. This    **/
  /* * will allow the program to continue processing the seasonal sales   **/
  /* * cursor when all the adjustment cursor rows have been processed.    **/
  /* ***********************************************************************/
      ;
      KF0BW01.KF0BW-ADJ-CUST-KEY = "9999999999999999999";
    else /* serious error*/
      KF0BS-PURGE-TMP-ST();
      KF0BW01.KF0BW-ERROR-IND = "Y";
      set ERRSQLCA empty;
      move SQLCA to ERRSQLCA withV60Compat;
      TA1REC.TA1TYPE = "DB2"; /* db2 error*/
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
      TA1REC.TA1TBLVU = "VSNADJ01"; /* table view name*/
      TA1REC.TA1LOCAT[3] = "FETCH N1"; /* error location*/
      TA1REC.TA1LOCAT[4] = "IO5610"; /* i/o mod*/
      try
        call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
      end /* message formatter*/
      COMMAREA.CAUSERA = " "; /* clear commarea*/
      XSPF4(); /* pass to goal menu*/
      exit program; /* goal menu failure*/
    end
  end
  ;
end // end KF0BS-FTCH-ADJ-ROW

// fetch a seasonal sales row
Function KF0BS-FTCH-SLS-ROW()
  /* ***********************************************************************/
  /* *  MODULE: FETCH SEASONAL SALES ROW                                  **/
  /* * PURPOSE: Fetches the next row from the seasonal sales cursor.      **/
  /* ***********************************************************************/
  ;
  call "IO3960" ("N1", SQLCA, VSNSLS01) {isNoRefresh = yes, isExternal = yes}; /* fetch row*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* no errors*/
    ;
  /* ***********************************************************************/
  /* * Move customer fields to a group customer key in working storage.   **/
  /* * This will make comparisons between the seasonal and adjustments    **/
  /* * customer keys easier to perform.                                   **/
  /* ***********************************************************************/
    ;
    KF0BW01.KF0BW-SESN-CU-CO-ID = VSNSLS01.CU-CO-ID;
    KF0BW01.KF0BW-SESN-CU-STOR-ID = VSNSLS01.CU-STOR-ID;
    KF0BW01.KF0BW-SESN-DEPT-ID-XREF = VSNSLS01.XNX-DEPT-ID-XREF;
    KF0BW01.KF0BW-SESN-YSB-SLS-RESP-CD = VSNSLS01.YSB-SLS-RESP-CD;
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* no record found*/
      ;
  /* ***********************************************************************/
  /* * Move all 9's to the group customer key in working storage. This    **/
  /* * will allow the program to continue processing the adjustments      **/
  /* * cursor when all the seasonal sales cursor rows have been processed.**/
  /* ***********************************************************************/
      ;
      KF0BW01.KF0BW-SESN-CUST-KEY = "9999999999999999999";
    else /* serious error*/
      KF0BS-PURGE-TMP-ST();
      KF0BW01.KF0BW-ERROR-IND = "Y";
      set ERRSQLCA empty;
      move SQLCA to ERRSQLCA withV60Compat;
      TA1REC.TA1TYPE = "DB2"; /* db2 error*/
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
      TA1REC.TA1TBLVU = "VSNSLS01"; /* table view name*/
      TA1REC.TA1LOCAT[3] = "FETCH N1"; /* error location*/
      TA1REC.TA1LOCAT[4] = "IO3960"; /* i/o mod*/
      try
        call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
      end /* message formatter*/
      COMMAREA.CAUSERA = " "; /* clear commarea*/
      XSPF4(); /* pass to goal menu*/
      exit program; /* goal menu failure*/
    end
  end
  ;
end // end KF0BS-FTCH-SLS-ROW

// get data for map
Function KF0BS-GET-DATA()
  /* ***********************************************************************/
  /* *  MODULE: GET DATA                                                  **/
  /* * PURPOSE: Gets the map data. More specifically, gets the total sales**/
  /* *          for active and inactive customers and the grand total     **/
  /* *          sales. Also gets the total adjustments and calculates the **/
  /* *          net sales. If the sales totals were found, loads the      **/
  /* *          working storage and temp storage tables.                  **/
  /* ***********************************************************************/
  ;
  KF0BW01.KF0BW-DATA-FOUND-IND = "N"; /* set found to no*/
  KF0BW01.KF0BW-DATE-WORK = 0; /* clear ws fields*/
  ;
  set VSNSLS01 empty;
  set SQLCA empty;
                                  /* set up DB2 fields*/
  VSNSLS01.SM-SAGCY-ID = KFWREC.SM-SAGCY-ID;
  VSNSLS01.SM-SREP-ID = KFWREC.SM-SREP-ID;
  VSNSLS01.XSE-SESN-CD = KF0BW01.KF0BW-NEW-SEASON;
  VSNSLS01.YNS-SESN-YR = KF0BW01.KF0BW-NEW-YEAR;
  VSNSLS01.CU-CO-ID = 0;
  VSNSLS01.CU-STOR-ID = 0;
  VSNSLS01.XNX-DEPT-ID-XREF = 0;
  ;
  VSNSLS01.CO-CUST-STAT-IND = "A"; /* active customers*/
  ;
  call "IO3960" ("S ", SQLCA, VSNSLS01) {isNoRefresh = yes, isExternal = yes}; /* fetch sales row*/
  /*  */
  if (SQLCA.VAGen_SQLCODE == 0) /* if row is found*/
    KF0BM001.KF0BM-TOT-ACTIVE-SLS = VSNSLS01.CO-CUST-SESN-SLS; /* move data to map*/
    KF0BM001.KF0BM-SM-SREP-PSTN-ID = VSNSLS01.SM-SREP-PSTN-ID;
    KF0BW01.KF0BW-DATE-WORK = VSNSLS01.CO-LST-RALGN-DT;
  else /* an error occurred*/
    if (SQLCA.VAGen_SQLCODE != 100)
      KF0BS-PURGE-TMP-ST();
      KF0BW01.KF0BW-ERROR-IND = "Y";
      set ERRSQLCA empty;
      move SQLCA to ERRSQLCA withV60Compat;
      TA1REC.TA1TYPE = "DB2"; /* db2 error*/
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
      TA1REC.TA1TBLVU = "VSNSLS01"; /* table view name*/
      TA1REC.TA1LOCAT[3] = "GETDATA1"; /* error location*/
      TA1REC.TA1LOCAT[4] = "IO3960"; /* i/o mod*/
      try
        call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
      end /* message formatter*/
      COMMAREA.CAUSERA = " "; /* clear commarea*/
      XSPF4(); /* pass to goal menu*/
      exit program; /* goal memu failure*/
    end
  end
  ;
  ;
  VSNSLS01.CO-CUST-STAT-IND = "I"; /* inactive customers*/
  ;
  call "IO3960" ("S ", SQLCA, VSNSLS01) {isNoRefresh = yes, isExternal = yes}; /* fetch sales row*/
  /*  */
  if (SQLCA.VAGen_SQLCODE == 0) /* if row is found*/
    KF0BM001.KF0BM-TOT-INACTIVE-SLS = VSNSLS01.CO-CUST-SESN-SLS; /* move data to map*/
    KF0BM001.KF0BM-SM-SREP-PSTN-ID = VSNSLS01.SM-SREP-PSTN-ID;
    KF0BW01.KF0BW-DATE-WORK = VSNSLS01.CO-LST-RALGN-DT;
  else /* an error occurred*/
    if (SQLCA.VAGen_SQLCODE != 100)
      KF0BS-PURGE-TMP-ST();
      KF0BW01.KF0BW-ERROR-IND = "Y";
      set ERRSQLCA empty;
      move SQLCA to ERRSQLCA withV60Compat;
      TA1REC.TA1TYPE = "DB2"; /* db2 error*/
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
      TA1REC.TA1TBLVU = "VSNSLS01"; /* table view name*/
      TA1REC.TA1LOCAT[3] = "GETDATA2"; /* error location*/
      TA1REC.TA1LOCAT[4] = "IO3960"; /* i/o mod*/
      try
        call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
      end /* message formatter*/
      COMMAREA.CAUSERA = " "; /* clear commarea*/
      XSPF4(); /* pass to goal menu*/
      exit program; /* goal memu failure*/
    end
  end
  ;
  ;
  VSNSLS01.CO-CUST-STAT-IND = " "; /* grand total sales*/
  ;
  call "IO3960" ("S ", SQLCA, VSNSLS01) {isNoRefresh = yes, isExternal = yes}; /* fetch sales row*/
  /*  */
  if (SQLCA.VAGen_SQLCODE == 0) /* if row is found*/
    KF0BM001.KF0BM-TOT-SALES = VSNSLS01.CO-CUST-SESN-SLS; /* move data to map*/
    KF0BM001.KF0BM-SM-SREP-PSTN-ID = VSNSLS01.SM-SREP-PSTN-ID;
    KF0BW01.KF0BW-DATE-WORK = VSNSLS01.CO-LST-RALGN-DT;
  else /* an error occurred*/
    if (SQLCA.VAGen_SQLCODE != 100)
      KF0BS-PURGE-TMP-ST();
      KF0BW01.KF0BW-ERROR-IND = "Y";
      set ERRSQLCA empty;
      move SQLCA to ERRSQLCA withV60Compat;
      TA1REC.TA1TYPE = "DB2"; /* db2 error*/
      TA1REC.TA1FUNC = "RETN";
      TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
      TA1REC.TA1TBLVU = "VSNSLS01"; /* table view name*/
      TA1REC.TA1LOCAT[3] = "GETDATA3"; /* error location*/
      TA1REC.TA1LOCAT[4] = "IO3960"; /* i/o mod*/
      try
        call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
      end /* message formatter*/
      COMMAREA.CAUSERA = " "; /* clear commarea*/
      XSPF4(); /* pass to goal menu*/
      exit program; /* goal memu failure*/
    end
  end
  ;
  /* ***********************************************************************/
  /* * Gets the total adjustments and moves the total to the map header.  **/
  /* * Calculates the net sales based on the grand sales total - total    **/
  /* * adjustments and moves the result to the map header.                **/
  /* ***********************************************************************/
  ;
  KF0BS-GET-TOT-ADJ(); /* get total adjustments*/
  ;
  KF0BM001.KF0BM-TOT-ADJUSTMENTS = VSNADJ01.CO-CUST-SLS-ADJAMT;
  KF0BM001.KF0BM-NET-SALES = KF0BM001.KF0BM-TOT-SALES + KF0BM001.KF0BM-TOT-ADJUSTMENTS;
                                  /* get rep position description*/
  if (KF0BM001.KF0BM-SM-SREP-PSTN-ID > " "
   && KF0BM001.KF0BM-SM-SREP-PSTN-ID > "0000")
                                  /* get rep position description*/
    VREPOS01.SM-SREP-PSTN-ID = KF0BM001.KF0BM-SM-SREP-PSTN-ID;
    ;
    call "IO0660" ("S ", SQLCA, VREPOS01) {isNoRefresh = yes, isExternal = yes}; /* fetch pstn row*/
    ;
    if (SQLCA.VAGen_SQLCODE == 0) /* if row is found*/
      KF0BM001.KF0BM-SM-SREP-PSTN-DESC = VREPOS01.SM-SREP-PSTN-DESC; /* move data to map*/
    else /* an error occurred*/
      if (SQLCA.VAGen_SQLCODE == 100) /* if row is not found*/
        KF0BM001.KF0BM-SM-SREP-PSTN-DESC = "UNKNOWN";
      else /* an error occurred*/
        KF0BS-PURGE-TMP-ST();
        KF0BW01.KF0BW-ERROR-IND = "Y";
        set ERRSQLCA empty;
        move SQLCA to ERRSQLCA withV60Compat;
        TA1REC.TA1TYPE = "DB2"; /* db2 error*/
        TA1REC.TA1FUNC = "RETN";
        TA1REC.TA1DBASE = "DSLSMN  "; /* data base name*/
        TA1REC.TA1TBLVU = "VREPOS01"; /* table view name*/
        TA1REC.TA1LOCAT[3] = "GETDATA4"; /* error location*/
        TA1REC.TA1LOCAT[4] = "IO0660"; /* i/o mod*/
        try
          call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
        end /* message formatter*/
        COMMAREA.CAUSERA = " "; /* clear commarea*/
        XSPF4(); /* pass to goal menu*/
        exit program; /* goal memu failure*/
      end
    end
  else /* no postion id*/
    KF0BM001.KF0BM-SM-SREP-PSTN-ID = " ";
    KF0BM001.KF0BM-SM-SREP-PSTN-DESC = "NONE";
  end
  ;
  KF0BW01.KF0BW-WS-INDEX = 0; /* initialize index*/
  KF0BW02.KF0BW-WS-LOAD-COUNT = 0;
  KF0BW01.KF0BW-TOP-OF-SCREEN = 1;
  KF0BW01.KF0BW-BOTTOM-OF-SCREEN = KF0BW01.KF0BW-MAX-LINES-SCREEN;
  ;
  KF0BS-BUILD-DTL(); /* get detail rows*/
  ;
end // end KF0BS-GET-DATA

// determine processing season
Function KF0BS-GET-SEASON()
        /*  */
        /* Determine the new season code & year by decrementing*/
        /* (PF19) or incrementing (PF20) the season index.*/
        /*  */
  ;
  if (converseVar.eventKey is pf19)
    KF0BW01.KF0BW-SESN-INDEX = KF0BW01.KF0BW-SESN-INDEX - 1;
    if (KF0BW01.KF0BW-SESN-INDEX == 0
     || YNSTBL.YNS-BUS-FUNC-ID[KF0BW-SESN-INDEX] != "COM")
      KF0BW01.KF0BW-ERROR-IND = "Y";
      converseLib.validationFailed(10); /* season boundary reached*/
      KF0BW01.KF0BW-SESN-INDEX = KF0BW01.KF0BW-SESN-INDEX + 1;
    else
      KF0BW01.KF0BW-NEW-SEASON = YNSTBL.XSE-SESN-CD[KF0BW-SESN-INDEX];
      KF0BW01.KF0BW-NEW-YEAR = YNSTBL.YNS-SESN-YR[KF0BW-SESN-INDEX];
    end
  end
  ;
  if (converseVar.eventKey is pf20)
    KF0BW01.KF0BW-SESN-INDEX = KF0BW01.KF0BW-SESN-INDEX + 1;
    if (YNSTBL.XSE-SESN-CD[KF0BW-SESN-INDEX] == "99"
     || YNSTBL.YNS-BUS-FUNC-ID[KF0BW-SESN-INDEX] != "COM")
      KF0BW01.KF0BW-ERROR-IND = "Y";
      converseLib.validationFailed(11); /* season boundary reached*/
      KF0BW01.KF0BW-SESN-INDEX = KF0BW01.KF0BW-SESN-INDEX - 1;
    else
      KF0BW01.KF0BW-NEW-SEASON = YNSTBL.XSE-SESN-CD[KF0BW-SESN-INDEX];
      KF0BW01.KF0BW-NEW-YEAR = YNSTBL.YNS-SESN-YR[KF0BW-SESN-INDEX];
    end
  end
end // end KF0BS-GET-SEASON

// get store detail data
Function KF0BS-GET-STOR-DTL()
  /* ***********************************************************************/
  /* *  MODULE: GET STORE DETAIL                                          **/
  /* * PURPOSE: Get store detail information.                             **/
  /* ***********************************************************************/
  ;
  call "IO0340" ("S ", SQLCA, KUMREC) {isNoRefresh = yes, isExternal = yes}; /* get store name*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0 /* name found*/
   || SQLCA.VAGen_SQLCODE == 100) /* not found*/
  /* next sentence*/
  else /* an error occurred*/
    KF0BS-PURGE-TMP-ST();
    KF0BW01.KF0BW-ERROR-IND = "Y";
    set ERRSQLCA empty;
    move SQLCA to ERRSQLCA withV60Compat;
    TA1REC.TA1TYPE = "DB2"; /* db2 error*/
    TA1REC.TA1FUNC = "RETN";
    TA1REC.TA1DBASE = "DCUST   "; /* data base name*/
    TA1REC.TA1TBLVU = "VSTORE01"; /* table view name*/
    TA1REC.TA1LOCAT[3] = "GET NAME"; /* error location*/
    TA1REC.TA1LOCAT[4] = "IO0340"; /* i/o mod*/
    try
      call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
    end /* message formatter*/
    COMMAREA.CAUSERA = " "; /* clear commarea*/
    XSPF4(); /* pass to goal menu*/
    exit program; /* goal menu failure*/
  end
  ;
end // end KF0BS-GET-STOR-DTL

// add ws to temp storage
Function KF0BS-GET-TMP-STR()
  ;
  ;
             /* retrieve the temporary storage queue record*/
  ;
             /* NOTE:  TA5REC.TA5TSQIX - the record number to retrieve*/
             /* must be set before calling this statement group*/
  ;
             /* if an error occurs, post an error message*/
  ;
  ;
  TA5REC.TA5FNCCD = "R"; /* retrieve temp storage*/
  TA5REC.TA5APPID = KF0BW01.TA5APPID; /* application ID*/
  KF0BW02.KF0BW-LENGTH = KF0BW01.KF0BW-MAX-QUEUE-LENGTH;
  ;
  try
    call "TA0050" (KF0BW02, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* temp storage*/
  ;
  if (sysVar.errorCode == "00000000" /* call was successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return*/
    KF0BW01.KF0BW-CURRENT-WS-ARRAY = TA5REC.TA5TSQIX;
  else /* an error occurred*/
    KF0BW01.KF0BW-ERROR-IND = "Y"; /* set error flag*/
    set TAEREC empty;
    TAEREC.TAEDESC1 = sysVar.errorCode; /* csp return code*/
    TAEREC.TAEDESC2 = TA5REC.TA5DATA; /* subroutine parameters*/
    TA1REC.TA1TYPE = "APPL"; /* application error*/
    TA1REC.TA1FUNC = "POST"; /* post, no abend*/
    TA1REC.TA1LOCAT[1] = "GET TS  "; /* location*/
    TA1REC.TA1LOCAT[2] = "TA0050  "; /* subroutine*/
    try
      call "TA0020" (TA1REC, TAEREC) {isExternal = yes};
    end /* message formatter*/
    converseLib.validationFailed(34); /* set error message*/
  end
  ;
end // end KF0BS-GET-TMP-STR

// get total adjustments
Function KF0BS-GET-TOT-ADJ()
  /* ***********************************************************************/
  /* *  MODULE: GET TOTAL ADJUSTMENTS                                     **/
  /* * PURPOSE: Get the total sales adjustments for the agency and rep    **/
  /* *          from the database.                                        **/
  /* ***********************************************************************/
  ;
  set VSNADJ01 empty; /* initialise record*/
  set SQLCA empty;
                                  /* set up DB2 fields*/
  VSNADJ01.CO-MGMT-SAGCY-ID = KFWREC.SM-SAGCY-ID;
  VSNADJ01.CO-MGMT-SREP-ID = KFWREC.SM-SREP-ID;
  VSNADJ01.XSE-SESN-CD = KF0BW01.KF0BW-NEW-SEASON;
  VSNADJ01.YNS-SESN-YR = KF0BW01.KF0BW-NEW-YEAR;
  VSNADJ01.XXX-STAT = "A";
  VSNADJ01.CO-ADJ-MGR-SLS-FL = "*";
  VSNADJ01.CO-SLS-ADJ-EDT = KF0BW01.KF0BW-DATE-FRST-CCYYMMDD;
  VSNADJ01.CO-SLS-ADJ-XDT = KF0BW01.KF0BW-DATE-FRST-CCYYMMDD;
  ;
  KF0BW05.KF0BW-IO-TASK = "SM"; /* set up call parms*/
  KF0BW05.KF0BW-IO-IND1 = 0;
  call "IO5610" (KF0BW05, SQLCA, VSNADJ01) {isNoRefresh = yes, isExternal = yes}; /* fetch sales row*/
  /*  */
  if (SQLCA.VAGen_SQLCODE != 0) /* errors*/
    KF0BS-PURGE-TMP-ST();
    KF0BW01.KF0BW-ERROR-IND = "Y";
    set ERRSQLCA empty;
    move SQLCA to ERRSQLCA withV60Compat;
    TA1REC.TA1TYPE = "DB2"; /* db2 error*/
    TA1REC.TA1FUNC = "RETN";
    TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
    TA1REC.TA1TBLVU = "VSNADJ01"; /* table view name*/
    TA1REC.TA1LOCAT[3] = "SUM ADJ"; /* error location*/
    TA1REC.TA1LOCAT[4] = "IO5610"; /* i/o mod*/
    try
      call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
    end /* message formatter*/
    COMMAREA.CAUSERA = " "; /* clear commarea*/
    XSPF4(); /* pass to goal menu*/
    exit program; /* goal memu failure*/
  end
  ;
  ;
end // end KF0BS-GET-TOT-ADJ

// initialize application fields
Function KF0BS-INITIALIZE()
  ;
      /* Clear files.  Initialize working storage counters and indexes.*/
      /* Fetch the Commissions System control card.*/
  ;
  set KFWREC empty;
  set KF0BW01 empty;
  set KF0BW02 empty;
  set KF0BW03 empty;
  set KF0BW05 empty;
  set VKOCTL01 empty;
  ;
  KF0BS-CLEAR-MAP();
  ;
  if (COMMAREA.CAFRMSYS == "KF") /* from same system*/
    KFWREC.KFW-GROUP = COMMAREA.CAUSERA; /* pass common record*/
  end
  ;
  KF0BW01.TA5APPID = "KF0B"; /* application id*/
  KF0BW01.KF0BW-MAX-TS-ADDS = 9998;
                                   /* max size of temporary storage*/
  KF0BW01.KF0BW-MAX-QUEUE-LENGTH = 2900; /* temp str rec length*/
  KF0BW01.KF0BW-MAX-LINES-SCREEN = 7;
                                   /* max lines on screen display*/
  KF0BW01.KF0BW-MAX-WS-LINES = 63; /* max size of work str array*/
  KF0BW01.KF0BW-TS-REC-COUNT = 0;
                                   /* number of temp str rec adds*/
  KF0BW01.KF0BW-CURRENT-WS-ARRAY = 1; /* current array in ws table*/
  ;
  KF0BW01.KF0BW-TOP-OF-SCREEN = 1;
                                   /* work str array entry at top*/
  KF0BW01.KF0BW-BOTTOM-OF-SCREEN = 7; /* work str entry at bottom*/
  KF0BW01.KF0BW-SCREEN-INDEX = 0; /* index for screen array*/
  KF0BW01.KF0BW-WS-INDEX = 0; /* working storage index*/
  ;
  KF0BW01.KF0BW-DATA-FOUND-IND = "N"; /* no data on screen*/
  ;
  KF0BS-CALC-STRT-DT(); /* realign date boundary*/
  ;
  call "IO3970" ("S ", SQLCA, VKOCTL01) {isNoRefresh = yes, isExternal = yes}; /* fetch control card*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* control card found*/
                                  /* set up key*/
    KF0BW01.KF0BW-YNS-SESN-YR-DISP = VKOCTL01.CO-CURR-YNS-YR;
    KF0BW01.XSE-SESN-CD = VKOCTL01.CO-CURR-XSE-CD;
    KF0BW01.YNS-BUS-FUNC-ID = "COM";
    ;
    if (KF0BW01.KF0BW-SEASON-KEY in YNSTBL.YNS-RECORD-KEY)
      KF0BW01.KF0BW-SESN-INDEX = sysVar.arrayIndex;
      KF0BW01.KF0BW-SESN-INDEX = KF0BW01.KF0BW-SESN-INDEX - 2;
      KF0BW01.KF0BW-SESN-PNTR = KF0BW01.KF0BW-SESN-INDEX; /* 2bak ssn*/
      KF0BW01.KF0BW-SESN-PNTR-1 = KF0BW01.KF0BW-SESN-PNTR - 1; /* 2bak ssn-1*/
      KF0BW01.KF0BW-NEW-YEAR = YNSTBL.YNS-SESN-YR[KF0BW-SESN-PNTR];
      KF0BW01.KF0BW-NEW-SEASON = YNSTBL.XSE-SESN-CD[KF0BW-SESN-PNTR];
    else
      KF0BS-PURGE-TMP-ST(); /* purge temp storage*/
      COMMAREA.CAUSERA = " "; /* pass working storage*/
      KFWREC.KFW-MSGNO = 45; /* pass msg no*/
      COMMAREA.CAUSERA = KFWREC.KFW-GROUP;
      COMMAREA.CATOAP = "KF0A";
      COMMAREA.CAITEM = " ";
      XSEXIT();
      KF0BM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* an error occurred*/
    end
  else /* an error occurred*/
    set ERRSQLCA empty;
    move SQLCA to ERRSQLCA withV60Compat;
    TA1REC.TA1TYPE = "DB2"; /* db2 error*/
    TA1REC.TA1FUNC = "RETN";
    TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
    TA1REC.TA1TBLVU = "VKOCTL01"; /* table view name*/
    TA1REC.TA1LOCAT[3] = "INITIAL "; /* error location*/
    TA1REC.TA1LOCAT[4] = "IO3970"; /* i/o mod*/
    try
      call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
    end /* message formatter*/
    COMMAREA.CAUSERA = " "; /* clear commarea*/
    XSPF4(); /* pass to goal menu*/
    exit program; /* goal memu failure*/
  end
  ;
end // end KF0BS-INITIALIZE

// move data to map
Function KF0BS-MOVE-TO-MAP()
  ;
             /* move the working storage fields to the screen map*/
  ;
             /* If there is no data to move, set the screen map fields*/
             /* dark.*/
  ;
             /* NOTE:  the working storage index should be set before*/
             /* entering this statement group.*/
  ;
  ;
  ;
  KF0BW01.KF0BW-SCREEN-INDEX = 1; /* initialize the screen index*/
  ;
  while (KF0BW01.KF0BW-SCREEN-INDEX <= KF0BW01.KF0BW-MAX-LINES-SCREEN)
                                  /* until the screen is full*/
    if (KF0BW02.CU-CO-ID[KF0BW-WS-INDEX] > 0) /* move to screen*/
      set KF0BM001.KF0BM-YSB-SLS-RESP-CD[KF0BW-SCREEN-INDEX] initialAttributes;
      set KF0BM001.KF0BM-CU-CO-ID[KF0BW-SCREEN-INDEX] initialAttributes;
      set KF0BM001.KF0BM-CU-STOR-ID[KF0BW-SCREEN-INDEX] initialAttributes;
      set KF0BM001.KF0BM-XNX-DEPT-ID-XREF[KF0BW-SCREEN-INDEX] initialAttributes;
      set KF0BM001.KF0BM-CU-STOR-NM[KF0BW-SCREEN-INDEX] initialAttributes;
      set KF0BM001.KF0BM-CO-CUST-SESN-SLS[KF0BW-SCREEN-INDEX] initialAttributes;
      set KF0BM001.KF0BM-ADJUST-IND[KF0BW-SCREEN-INDEX] initialAttributes;
      set KF0BM001.KF0BM-CO-CUST-STAT-IND[KF0BW-SCREEN-INDEX] initialAttributes;
      KF0BM001.KF0BM-YSB-SLS-RESP-CD[KF0BW-SCREEN-INDEX] = KF0BW02.YSB-SLS-RESP-CD[KF0BW-WS-INDEX];
      KF0BM001.KF0BM-CU-CO-ID[KF0BW-SCREEN-INDEX] = KF0BW02.CU-CO-ID[KF0BW-WS-INDEX];
      KF0BM001.KF0BM-CU-STOR-ID[KF0BW-SCREEN-INDEX] = KF0BW02.CU-STOR-ID[KF0BW-WS-INDEX];
      KF0BM001.KF0BM-XNX-DEPT-ID-XREF[KF0BW-SCREEN-INDEX] = KF0BW02.XNX-DEPT-ID-XREF[KF0BW-WS-INDEX];
      KF0BM001.KF0BM-CU-STOR-NM[KF0BW-SCREEN-INDEX] = KF0BW02.CU-STOR-NM[KF0BW-WS-INDEX];
      KF0BM001.KF0BM-CO-CUST-SESN-SLS[KF0BW-SCREEN-INDEX] = KF0BW02.CO-CUST-SESN-SLS[KF0BW-WS-INDEX];
      KF0BM001.KF0BM-ADJUST-IND[KF0BW-SCREEN-INDEX] = KF0BW02.KF0BW-SALES-ADJ-IND[KF0BW-WS-INDEX];
      KF0BM001.KF0BM-CO-CUST-STAT-IND[KF0BW-SCREEN-INDEX] = KF0BW02.CO-CUST-STAT-IND[KF0BW-WS-INDEX];
    else /* set fields dark*/
      set KF0BM001.KF0BM-YSB-SLS-RESP-CD[KF0BW-SCREEN-INDEX] skip, invisible;
      set KF0BM001.KF0BM-CU-CO-ID[KF0BW-SCREEN-INDEX] skip, invisible;
      set KF0BM001.KF0BM-CU-STOR-ID[KF0BW-SCREEN-INDEX] skip, invisible;
      set KF0BM001.KF0BM-XNX-DEPT-ID-XREF[KF0BW-SCREEN-INDEX] skip, invisible;
      set KF0BM001.KF0BM-CU-STOR-NM[KF0BW-SCREEN-INDEX] skip, invisible;
      set KF0BM001.KF0BM-CO-CUST-SESN-SLS[KF0BW-SCREEN-INDEX] skip, invisible;
      set KF0BM001.KF0BM-ADJUST-IND[KF0BW-SCREEN-INDEX] skip, invisible;
      set KF0BM001.KF0BM-CO-CUST-STAT-IND[KF0BW-SCREEN-INDEX] skip, invisible;
    end /* bump up indexes*/
    KF0BW01.KF0BW-SCREEN-INDEX = KF0BW01.KF0BW-SCREEN-INDEX + 1;
    KF0BW01.KF0BW-WS-INDEX = KF0BW01.KF0BW-WS-INDEX + 1;
  end
end // end KF0BS-MOVE-TO-MAP

// initial process for sesn chng
Function KF0BS-NEW-SEASON()
  ;
  ;
          /* purge the temporary storage queue*/
          /* clear the map*/
          /* clear the working storage table*/
          /* start the new season*/
  ;
  ;
  ;
  KF0BS-PURGE-TMP-ST(); /* purge the ts queue*/
  ;
  KF0BS-CLEAR-MAP(); /* clear the map*/
  ;
  KF0BM001.KF0BM-SM-SAGCY-ID = KFWREC.SM-SAGCY-ID;
  KF0BM001.KF0BM-SM-SREP-ID = KFWREC.SM-SREP-ID;
  KF0BM001.KF0BM-SM-SAGCY-NM = SM1REC.SM1AGYNM;
  KF0BM001.KF0BM-XXX-LAST-NM = SM4REC.XXXLSTNM;
  KF0BM001.KF0BM-XXX-FRST-NM = SM4REC.XXXFSTNM;
  ;
  if (KF0BW01.KF0BW-TERM-DATE > 0)
    set KF0BM001.KF0BM-TERM-HEADING skip, bold;
    set KF0BM001.KF0BM-SM-SREP-TDT skip, bold;
    KF0BM001.KF0BM-SM-SREP-TDT = KF0BW01.KF0BW-TERM-DATE;
  else
    set KF0BM001.KF0BM-TERM-HEADING initialAttributes;
    set KF0BM001.KF0BM-SM-SREP-TDT initialAttributes;
  end
  ;
  set KF0BW02 empty; /* clear the ws table*/
  ;
  KF0BW01.KF0BW-CURRENT-WS-ARRAY = 1;
  ;
  KF0BS-START-SEASON(); /* start the season*/
  ;
end // end KF0BS-NEW-SEASON

// open the DCOMM.VSNADJ01 cursor
Function KF0BS-OPEN-ADJ-CSR()
  /* ***********************************************************************/
  /* *  MODULE: OPEN ADJUSTMENTS CURSOR                                   **/
  /* * PURPOSE: Opens the adjustments cursor.                             **/
  /* ***********************************************************************/
  ;
  set VSNADJ01 empty; /* initialize record*/
  ;
  VSNADJ01.XSE-SESN-CD = KF0BW01.KF0BW-NEW-SEASON;
  VSNADJ01.YNS-SESN-YR = KF0BW01.KF0BW-NEW-YEAR;
  VSNADJ01.CO-MGMT-SAGCY-ID = KFWREC.SM-SAGCY-ID;
  VSNADJ01.CO-MGMT-SREP-ID = KFWREC.SM-SREP-ID;
  VSNADJ01.XXX-STAT = "A";
  VSNADJ01.CO-SLS-ADJ-EDT = KF0BW01.KF0BW-DATE-FRST-CCYYMMDD;
  VSNADJ01.CO-SLS-ADJ-XDT = KF0BW01.KF0BW-DATE-FRST-CCYYMMDD;
  ;
  KF0BW05.KF0BW-IO-TASK = "S1"; /* set call parms*/
  KF0BW05.KF0BW-IO-IND1 = 0;
  call "IO5610" (KF0BW05, SQLCA, VSNADJ01) {isNoRefresh = yes, isExternal = yes}; /* open cursor*/
  /*  */
  if (SQLCA.VAGen_SQLCODE != 0) /* if an error occured*/
    KF0BS-PURGE-TMP-ST();
    KF0BW01.KF0BW-ERROR-IND = "Y";
    set ERRSQLCA empty;
    move SQLCA to ERRSQLCA withV60Compat;
    TA1REC.TA1TYPE = "DB2"; /* db2 error*/
    TA1REC.TA1FUNC = "RETN";
    TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
    TA1REC.TA1TBLVU = "VSNADJ01"; /* table view name*/
    TA1REC.TA1LOCAT[3] = "OPEN S1 "; /* error location*/
    TA1REC.TA1LOCAT[4] = "IO3960"; /* i/o mod*/
    try
      call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
    end /* message formatter*/
    COMMAREA.CAUSERA = " "; /* clear commarea*/
    XSPF4(); /* pass to goal menu*/
    exit program; /* goal menu failure*/
  end
  ;
end // end KF0BS-OPEN-ADJ-CSR

// open the DCOMM.VSNSLS01 cursor
Function KF0BS-OPEN-SLS-CSR()
  /* ***********************************************************************/
  /* *  MODULE: OPEN SEASONAL SALES CURSOR                                **/
  /* * PURPOSE: Opens the seasonal sales cursor.                          **/
  /* ***********************************************************************/
  ;
  set VSNSLS01 empty; /* initialize record*/
  ;
  VSNSLS01.SM-SAGCY-ID = KFWREC.SM-SAGCY-ID;
  VSNSLS01.SM-SREP-ID = KFWREC.SM-SREP-ID;
  VSNSLS01.XSE-SESN-CD = KF0BW01.KF0BW-NEW-SEASON;
  VSNSLS01.YNS-SESN-YR = KF0BW01.KF0BW-NEW-YEAR;
  ;
  call "IO3960" ("S1", SQLCA, VSNSLS01) {isNoRefresh = yes, isExternal = yes}; /* open cursor*/
  /*  */
  if (SQLCA.VAGen_SQLCODE != 0) /* if an error occured*/
    KF0BS-PURGE-TMP-ST();
    KF0BW01.KF0BW-ERROR-IND = "Y";
    set ERRSQLCA empty;
    move SQLCA to ERRSQLCA withV60Compat;
    TA1REC.TA1TYPE = "DB2"; /* db2 error*/
    TA1REC.TA1FUNC = "RETN";
    TA1REC.TA1DBASE = "DCOMM   "; /* data base name*/
    TA1REC.TA1TBLVU = "VSNSLS01"; /* table view name*/
    TA1REC.TA1LOCAT[3] = "OPEN S1 "; /* error location*/
    TA1REC.TA1LOCAT[4] = "IO3960"; /* i/o mod*/
    try
      call "TA0020" (TA1REC, ERRSQLCA) {isExternal = yes};
    end /* message formatter*/
    COMMAREA.CAUSERA = " "; /* clear commarea*/
    XSPF4(); /* pass to goal menu*/
    exit program; /* goal menu failure*/
  end
  ;
end // end KF0BS-OPEN-SLS-CSR

// Process adjustments row
Function KF0BS-PROC-ADJ-ROW()
  /* ***********************************************************************/
  /* *  MODULE: PROCESS ADJUSTMENTS ROW                                   **/
  /* * PURPOSE: Retrieve the corresponding store name for the customer,   **/
  /* *          move the customer detail to working storage and if we have**/
  /* *          a full page, move to temp storage.                        **/
  /* ***********************************************************************/
  ;
  KF0BW01.KF0BW-DATA-FOUND-IND = "Y";
  ;
  KF0BW02.KF0BW-WS-LOAD-COUNT = KF0BW02.KF0BW-WS-LOAD-COUNT + 1;
  ;
  KF0BW01.KF0BW-WS-INDEX = KF0BW02.KF0BW-WS-LOAD-COUNT;
  ;
  /* ***********************************************************************/
  /* * Format the KUMREC record and get the store name from the database. **/
  /* ***********************************************************************/
  ;
  KUMREC.KUCCOID = VSNADJ01.CU-CO-ID;
  KUMREC.KUMSTRID = VSNADJ01.CU-STOR-ID;
  ;
  KF0BS-GET-STOR-DTL(); /* get the store name*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* store name found*/
    KF0BW02.CU-STOR-NM[KF0BW-WS-INDEX] = KUMREC.KUMSTRNM;
  else /* store name not found*/
    KF0BW02.CU-STOR-NM[KF0BW-WS-INDEX] = "UNKNOWN";
  end
  ;
  /* ***********************************************************************/
  /* * Move the customer information to working storage.                  **/
  /* ***********************************************************************/
  ;
  KF0BW02.YSB-SLS-RESP-CD[KF0BW-WS-INDEX] = VSNADJ01.YSB-SLS-RESP-CD;
  KF0BW02.CU-CO-ID[KF0BW-WS-INDEX] = VSNADJ01.CU-CO-ID;
  KF0BW02.CU-STOR-ID[KF0BW-WS-INDEX] = VSNADJ01.CU-STOR-ID;
  KF0BW02.XNX-DEPT-ID-XREF[KF0BW-WS-INDEX] = VSNADJ01.XNX-DEPT-ID-XREF;
  KF0BW02.CO-CUST-SESN-SLS[KF0BW-WS-INDEX] = VSNADJ01.CO-CUST-SLS-ADJAMT;
  KF0BW02.CO-CUST-STAT-IND[KF0BW-WS-INDEX] = " ";
  KF0BW02.KF0BW-SALES-ADJ-IND[KF0BW-WS-INDEX] = "*";
  ;
  /* ***********************************************************************/
  /* * If the working storage area is full, add to temp storage and reset **/
  /* * indexes and counters.                                              **/
  /* ***********************************************************************/
  ;
  if (KF0BW02.KF0BW-WS-LOAD-COUNT == KF0BW01.KF0BW-MAX-WS-LINES)
    KF0BS-ADD-TMP-STR(); /* add page to temp storage*/
    set KF0BW02 empty;
    KF0BW01.KF0BW-CURRENT-WS-ARRAY = KF0BW01.KF0BW-CURRENT-WS-ARRAY + 1;
    KF0BW01.KF0BW-TOP-OF-SCREEN = 1;
    KF0BW01.KF0BW-BOTTOM-OF-SCREEN = KF0BW01.KF0BW-MAX-LINES-SCREEN;
    KF0BW02.KF0BW-WS-LOAD-COUNT = 0;
  end
  ;
  KF0BS-FTCH-ADJ-ROW(); /* fetch next seasonal sales row*/
end // end KF0BS-PROC-ADJ-ROW

// Process seasonal sales row
Function KF0BS-PROC-SLS-ROW()
  /* ***********************************************************************/
  /* *  MODULE: PROCESS SEASONAL SALES ROW                                **/
  /* * PURPOSE: Retrieve the corresponding store name for the customer,   **/
  /* *          move the customer detail to working storage and if we have**/
  /* *          a full page, move to temp storage.                        **/
  /* ***********************************************************************/
  ;
  KF0BW01.KF0BW-DATA-FOUND-IND = "Y";
  KF0BW02.KF0BW-WS-LOAD-COUNT = KF0BW02.KF0BW-WS-LOAD-COUNT + 1;
  KF0BW01.KF0BW-WS-INDEX = KF0BW02.KF0BW-WS-LOAD-COUNT;
  ;
  /* ***********************************************************************/
  /* * Format the KUMREC record and get the store name from the database. **/
  /* ***********************************************************************/
  ;
  KUMREC.KUCCOID = VSNSLS01.CU-CO-ID;
  KUMREC.KUMSTRID = VSNSLS01.CU-STOR-ID;
  ;
  KF0BS-GET-STOR-DTL(); /* get the store name*/
  ;
  if (SQLCA.VAGen_SQLCODE == 0) /* store name found*/
    KF0BW02.CU-STOR-NM[KF0BW-WS-INDEX] = KUMREC.KUMSTRNM;
  else /* store name not found*/
    KF0BW02.CU-STOR-NM[KF0BW-WS-INDEX] = "UNKNOWN";
  end
  ;
  /* ***********************************************************************/
  /* * Move the customer information to working storage.                  **/
  /* ***********************************************************************/
  ;
  KF0BW02.YSB-SLS-RESP-CD[KF0BW-WS-INDEX] = VSNSLS01.YSB-SLS-RESP-CD;
  KF0BW02.CU-CO-ID[KF0BW-WS-INDEX] = VSNSLS01.CU-CO-ID;
  KF0BW02.CU-STOR-ID[KF0BW-WS-INDEX] = VSNSLS01.CU-STOR-ID;
  KF0BW02.XNX-DEPT-ID-XREF[KF0BW-WS-INDEX] = VSNSLS01.XNX-DEPT-ID-XREF;
  KF0BW02.CO-CUST-SESN-SLS[KF0BW-WS-INDEX] = VSNSLS01.CO-CUST-SESN-SLS;
  KF0BW02.CO-CUST-STAT-IND[KF0BW-WS-INDEX] = VSNSLS01.CO-CUST-STAT-IND;
  ;
  /* ***********************************************************************/
  /* * If the working storage area is full, add to temp storage and reset **/
  /* * indexes and counters.                                              **/
  /* ***********************************************************************/
  ;
  if (KF0BW02.KF0BW-WS-LOAD-COUNT == KF0BW01.KF0BW-MAX-WS-LINES)
    KF0BS-ADD-TMP-STR(); /* add page to temp storage*/
    set KF0BW02 empty;
    KF0BW01.KF0BW-CURRENT-WS-ARRAY = KF0BW01.KF0BW-CURRENT-WS-ARRAY + 1;
    KF0BW01.KF0BW-TOP-OF-SCREEN = 1;
    KF0BW01.KF0BW-BOTTOM-OF-SCREEN = KF0BW01.KF0BW-MAX-LINES-SCREEN;
    KF0BW02.KF0BW-WS-LOAD-COUNT = 0;
  end
  ;
  KF0BS-FTCH-SLS-ROW(); /* fetch next seasonal sales row*/
end // end KF0BS-PROC-SLS-ROW

// submit production JCL
Function KF0BS-PROD-JCL()
  ;
  ;
       /* move production JCL from KF0BT01 to TA6REC*/
       /* to be submitted by TA0P.*/
  ;
  ;
  KF0BW01.KF0BW-JCL-INDEX = 1; /* set indexes*/
  TA6REC.TA6INDEX = 1;
  ;
  if (TA6REC.XURDEST == "LOCAL " /* local printer*/
  )                             
    if ("/*EOF" in KF0BT03.TARJCL from KF0BW-JCL-INDEX) /* end of table*/
      KF0BW01.KF0BW-END-OF-JCL-TABLE = sysVar.arrayIndex;
      ;
      while (KF0BW01.KF0BW-JCL-INDEX <= KF0BW01.KF0BW-END-OF-JCL-TABLE)
        if (KF0BT03.TARTYPE[KF0BW-JCL-INDEX] == "P") /* parameter card*/
          TA6REC.TARJCL[TA6INDEX] = KF0BW03.KF0BW-PARAMETER-DATA; /* move to jcl*/
        else /* not parm card*/
          if (KF0BT03.TARTYPE[KF0BW-JCL-INDEX] == "C") /* number of copies*/
            KF0BW04.KF0BW-PRINT-PARMS = KF0BT03.TARJCL[KF0BW-JCL-INDEX];
            KF0BW04.KF0BW-NBR-COPIES = TA6REC.XURCOPY;
            TA6REC.TARJCL[TA6INDEX] = KF0BW04.KF0BW-PRINT-PARMS;
          else /* not parm card*/
            TA6REC.TARJCL[TA6INDEX] = KF0BT03.TARJCL[KF0BW-JCL-INDEX]; /* move jcl*/
            TA6REC.TARTYPE[TA6INDEX] = KF0BT03.TARTYPE[KF0BW-JCL-INDEX]; /* move type*/
          end
        end
        ;
        TA6REC.TA6INDEX = TA6REC.TA6INDEX + 1; /* increment index*/
        KF0BW01.KF0BW-JCL-INDEX = KF0BW01.KF0BW-JCL-INDEX + 1;
        ;
      end
    else /* bad jcl table*/
      converseLib.validationFailed(37);
      KF0BW01.KF0BW-ERROR-IND = "Y";
    end
    ;
  else /* remote printer*/
    ;
    if ("/*EOF" in KF0BT01.TARJCL from KF0BW-JCL-INDEX) /* end of table*/
      KF0BW01.KF0BW-END-OF-JCL-TABLE = sysVar.arrayIndex;
      ;
      while (KF0BW01.KF0BW-JCL-INDEX <= KF0BW01.KF0BW-END-OF-JCL-TABLE)
        if (KF0BT01.TARTYPE[KF0BW-JCL-INDEX] == "P") /* parameter card*/
          TA6REC.TARJCL[TA6INDEX] = KF0BW03.KF0BW-PARAMETER-DATA; /* move to jcl*/
        else /* not parm card*/
          TA6REC.TARJCL[TA6INDEX] = KF0BT01.TARJCL[KF0BW-JCL-INDEX]; /* move jcl*/
          TA6REC.TARTYPE[TA6INDEX] = KF0BT01.TARTYPE[KF0BW-JCL-INDEX]; /* move type*/
        end
        ;
        TA6REC.TA6INDEX = TA6REC.TA6INDEX + 1; /* increment index*/
        KF0BW01.KF0BW-JCL-INDEX = KF0BW01.KF0BW-JCL-INDEX + 1;
        ;
      end
    else /* bad jcl table*/
      converseLib.validationFailed(37);
      KF0BW01.KF0BW-ERROR-IND = "Y";
    end
    ;
  end
  ;
end // end KF0BS-PROD-JCL

// purge the temp storage queue
Function KF0BS-PURGE-TMP-ST()
  ;
  ;
             /* purge the temporary storage queue*/
  ;
             /* if an error occurs, post an error message*/
  ;
  ;
  set TA5REC empty; /* clear ts parms*/
  ;
  TA5REC.TA5FNCCD = "P"; /* purge queue*/
  TA5REC.TA5APPID = KF0BW01.TA5APPID; /* application ID*/
  ;
  try
    call "TA0050" (KF0BW02, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* temp storage*/
  ;
  if (sysVar.errorCode == "00000000" /* call was successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return*/
    KF0BW01.KF0BW-TS-REC-COUNT = 0; /* count rec*/
  else /* an error occurred*/
    KF0BW01.KF0BW-ERROR-IND = "Y"; /* set error flag*/
    set TAEREC empty;
    TAEREC.TAEDESC1 = sysVar.errorCode; /* csp return code*/
    TAEREC.TAEDESC2 = TA5REC.TA5DATA; /* subroutine parameters*/
    TA1REC.TA1TYPE = "APPL"; /* application error*/
    TA1REC.TA1FUNC = "POST"; /* post, no abend*/
    TA1REC.TA1LOCAT[1] = "PURGE TS"; /* location*/
    TA1REC.TA1LOCAT[2] = "TA0050  "; /* subroutine*/
    try
      call "TA0020" (TA1REC, TAEREC) {isExternal = yes};
    end /* message formatter*/
    converseLib.validationFailed(34); /* set error message*/
  end
  ;
end // end KF0BS-PURGE-TMP-ST

// display next 9 rows
Function KF0BS-SCROLL-DOWN()
  ;
  ;
          /* user pressed PF8 - scroll down*/
  ;
          /* if already at the bottom, post an error message*/
  ;
          /* if the next 9 detail rows are in working storage,*/
          /* clear the map and move them to the map fields.*/
  ;
          /* if the next 9 detail rows are in temporary storage, clear*/
          /* working storage, read the temporary storage record*/
          /* into working storage and move the rows to the map fields.*/
  ;
  ;
  if (KF0BW01.KF0BW-DATA-FOUND-IND == "N") /* no data to report*/
    converseLib.validationFailed(9); /* already at bottom*/
    KF0BW01.KF0BW-ERROR-IND = "Y";
  else
    if (KF0BW01.KF0BW-BOTTOM-OF-SCREEN
     < KF0BW02.KF0BW-WS-LOAD-COUNT) /* rows are in table*/
                                                  /* set first line*/
      KF0BW01.KF0BW-TOP-OF-SCREEN = KF0BW01.KF0BW-BOTTOM-OF-SCREEN + 1;
      KF0BW01.KF0BW-BOTTOM-OF-SCREEN = KF0BW01.KF0BW-BOTTOM-OF-SCREEN + KF0BW01.KF0BW-MAX-LINES-SCREEN;
    else /* not last array*/
      if (KF0BW01.KF0BW-CURRENT-WS-ARRAY
       < KF0BW01.KF0BW-TS-REC-COUNT) /* table in ts queue*/
        set KF0BW02 empty; /* initialize ws table*/
        TA5REC.TA5TSQIX = KF0BW01.KF0BW-CURRENT-WS-ARRAY + 1;
        KF0BS-GET-TMP-STR(); /* fetch ts queue rec*/
                                               /* set first line*/
        KF0BW01.KF0BW-BOTTOM-OF-SCREEN = KF0BW01.KF0BW-MAX-LINES-SCREEN;
        KF0BW01.KF0BW-TOP-OF-SCREEN = 1;
      else
        converseLib.validationFailed(9); /* already at bottom*/
        KF0BW01.KF0BW-ERROR-IND = "Y";
      end
    end
  end
  ;
  if (KF0BW01.KF0BW-ERROR-IND == "N")
    KF0BW01.KF0BW-WS-INDEX = KF0BW01.KF0BW-TOP-OF-SCREEN;
    KF0BS-MOVE-TO-MAP(); /* move table to map*/
  end
  ;
end // end KF0BS-SCROLL-DOWN

// display previous 9 rows
Function KF0BS-SCROLL-UP()
  ;
  ;
          /* user pressed PF7 - scroll up*/
  ;
          /* if already at the top, post an error message*/
  ;
          /* if the previous 9 detail rows are in working storage,*/
          /* clear the map and move them to the map fields.*/
  ;
          /* if the previous 9 detail rows are in temporary storage,*/
          /* write working storage to temporary storage, clear*/
          /* working storage, read the temporary storage record*/
          /* into working storage and move the rows to the map fields.*/
  ;
  ;
  if (KF0BW01.KF0BW-DATA-FOUND-IND == "N") /* no data*/
    converseLib.validationFailed(3); /* already at top*/
    KF0BW01.KF0BW-ERROR-IND = "Y";
  else /* not first screen*/
    if (KF0BW01.KF0BW-TOP-OF-SCREEN == 1 /* first screen in table*/
     && KF0BW01.KF0BW-CURRENT-WS-ARRAY == 1) /* first table*/
      converseLib.validationFailed(3); /* already at top*/
      KF0BW01.KF0BW-ERROR-IND = "Y";
    else /* not first screen*/
      if (KF0BW01.KF0BW-TOP-OF-SCREEN > 1) /* rows are in table*/
                                                /* set first line*/
        KF0BW01.KF0BW-BOTTOM-OF-SCREEN = KF0BW01.KF0BW-TOP-OF-SCREEN - 1;
        KF0BW01.KF0BW-TOP-OF-SCREEN = KF0BW01.KF0BW-TOP-OF-SCREEN - KF0BW01.KF0BW-MAX-LINES-SCREEN;
      else /* not first array*/
        set KF0BW02 empty; /* initialize ws table*/
        KF0BW02.KF0BW-LENGTH = KF0BW01.KF0BW-MAX-QUEUE-LENGTH;
        TA5REC.TA5TSQIX = KF0BW01.KF0BW-CURRENT-WS-ARRAY - 1; /* rec to get*/
        KF0BS-GET-TMP-STR(); /* fetch ts queue rec*/
                                              /* set first line*/
        KF0BW01.KF0BW-BOTTOM-OF-SCREEN = KF0BW01.KF0BW-MAX-WS-LINES;
        KF0BW01.KF0BW-TOP-OF-SCREEN = KF0BW01.KF0BW-MAX-WS-LINES - KF0BW01.KF0BW-MAX-LINES-SCREEN;
        KF0BW01.KF0BW-TOP-OF-SCREEN = KF0BW01.KF0BW-TOP-OF-SCREEN + 1;
      end
      KF0BW01.KF0BW-WS-INDEX = KF0BW01.KF0BW-TOP-OF-SCREEN;
      KF0BS-MOVE-TO-MAP(); /* move table to map*/
    end
  end
end // end KF0BS-SCROLL-UP

// start processing a new season
Function KF0BS-START-SEASON()
  ;
             /* Retrieve data for the agency/rep entered.*/
  ;
             /* If data is found, move the working storage fields to the*/
             /* screen map and display the headings.*/
  ;
             /* If no data is found, issue an error message.*/
  ;
  ;
  KF0BS-GET-DATA(); /* fetch the data*/
  ;
  set KF0BM001.KF0BM-SEASON-HEADING initialAttributes; /* display map fields*/
  set KF0BM001.KF0BM-SEASON-YR-DESC initialAttributes;
  set KF0BM001.KF0BM-UPDATE-DATE-HEADING initialAttributes;
  set KF0BM001.KF0BM-CO-LST-RALGN-DT initialAttributes;
  ;
  KF0BM001.KF0BM-SEASON-YR-DESC = YNSTBL.YNS-SESN-YR-DESC[KF0BW-SESN-INDEX];
  ;
  if (KF0BW01.KF0BW-DATA-FOUND-IND == "Y") /* if data is found*/
    ;
    KF0BM001.KF0BM-CO-LST-RALGN-DT = KF0BW01.KF0BW-DATE-WORK;
    ;
    set KF0BW02 empty;
    TA5REC.TA5TSQIX = 1;
    KF0BS-GET-TMP-STR(); /* get first array*/
    ;
    KF0BW01.KF0BW-WS-INDEX = 1; /* initialize work strg index*/
    KF0BW01.KF0BW-TOP-OF-SCREEN = 1; /* set first line*/
    KF0BW01.KF0BW-BOTTOM-OF-SCREEN = KF0BW01.KF0BW-MAX-LINES-SCREEN; /* set last line*/
    ;
    KF0BS-MOVE-TO-MAP();
    ;
  else /* set heading dark*/
    set KF0BM001.KF0BM-UPDATE-DATE-HEADING skip, invisible;
    set KF0BM001.KF0BM-CO-LST-RALGN-DT skip, invisible;
    converseLib.validationFailed(8); /* no data for season*/
  end
end // end KF0BS-START-SEASON

// submit kf1221 job
Function KF0BS-SUBMIT-RPT()
  ;
  ;
           /* If there is not enought information to print the report,*/
           /* issue an error message.*/
  ;
           /* Determine if the program is running on the production*/
           /* or development machine.*/
  ;
           /* Set up the parm record and move the JCL (either production*/
           /* or test, whichever applies) to the TA0P parameter table.*/
  ;
           /* Set up the TA0P execution parameters and execute TA0P.*/
  ;
           /* Determine if the job was submitted successfully, and*/
           /* issue an appropriate message.*/
  ;
  ;
  if (KF0BM001.KF0BM-SEASON-YR-DESC > " " /* season is present*/
   && KF0BM001.KF0BM-SM-SAGCY-ID > " "    /* agency is present*/
   && KF0BM001.KF0BM-SM-SREP-ID > 0)      /* and rep is present*/
                                  /* ok*/
  else /* no season / agency*/
    converseLib.validationFailed(33); /* no data to report*/
    KF0BW01.KF0BW-ERROR-IND = "Y"; /* error found*/
  end
  ;
  if (KF0BW01.KF0BW-ERROR-IND == "N") /* no error*/
    set TA3REC empty;
    TA3REC.TA3OPTN = "ASSIGN"; /* determine region*/
    ;
    KF0BS-CICS-INFO(); /* get cics info*/
    ;
  end
  ;
  if (KF0BW01.KF0BW-ERROR-IND == "N") /* no error*/
    set KF0BW03 empty; /* set up parameters*/
    KF0BW03.KF0BW-XSE-SESN-CD = KF0BW01.KF0BW-NEW-SEASON;
    KF0BW03.KF0BW-YNS-SESN-YR = KF0BW01.KF0BW-NEW-YEAR;
    KF0BW03.KF0BW-SEASON-YR-DESC = KF0BM001.KF0BM-SEASON-YR-DESC;
    KF0BW03.KF0BW-CO-LST-RALGN-DT = KF0BM001.KF0BM-CO-LST-RALGN-DT;
    KF0BW03.KF0BW-SM-SAGCY-ID = KF0BM001.KF0BM-SM-SAGCY-ID;
    KF0BW03.KF0BW-SM-SREP-ID = KF0BM001.KF0BM-SM-SREP-ID;
    KF0BW03.KF0BW-SM-SREP-PSTN-ID = KF0BM001.KF0BM-SM-SREP-PSTN-ID;
    KF0BW03.KF0BW-SM-SREP-TDT = KF0BW01.KF0BW-TERM-DATE;
  end
  ;
  if (KF0BW01.KF0BW-ERROR-IND == "N") /* no error*/
    set TA6REC empty; /* clear work area*/
    TA6REC.TA6RTNCD = " "; /* subtroutine return code*/
    TA6REC.TA6SUBSW = "N"; /* get info for jcl*/
    TA6REC.TA6MSGSW = "N"; /* issue message to terminal*/
    TA6REC.TA6-MAX-COND-CODE = 0; /* max valid return code*/
    ;
    while (TA6REC.TA6RTNCD < "0") /* until complete*/
      XPTA0P(); /* call print request*/
    end
    ;
    if (sysVar.errorCode == "00000000" /* good call*/
     && TA6REC.TA6RTNCD == "0")        /* good return / no cancel*/
      ;
      KF0BW03.KF0BW-XURDEST = TA6REC.XURDEST;
      ;
      if (TA3REC.TA3RGNID == "03") /* prod region*/
        KF0BS-PROD-JCL(); /* production jcl*/
      else
        KF0BS-TEST-JCL(); /* test jcl*/
      end
      ;
      TA6REC.TA6SUBSW = "S"; /* tailor & submit jcl*/
      TA6REC.TA6RTNCD = " ";
      ;
      while (TA6REC.TA6RTNCD < "0") /* until complete*/
        XPTA0P(); /* call print request*/
      end
      ;
      if (sysVar.errorCode == "00000000") /* good call*/
        if (TA6REC.TA6RTNCD == "0" /* good return*/
         || TA6REC.TA6RTNCD == "1") /* user cancelled*/
          set KF0BM001.KF0BM-MESSAGE normal; /* display message*/
          KF0BM001.KF0BM-MESSAGE = COMMAREA.CAMSG;
        else
          KF0BW01.KF0BW-ERROR-IND = "Y"; /* set error flag*/
        end
      else
        KF0BW01.KF0BW-ERROR-IND = "Y"; /* set error flag*/
      end
    else
      if (sysVar.errorCode != "00000000") /* bad call*/
        KF0BW01.KF0BW-ERROR-IND = "Y"; /* set error flag*/
      else
        if (TA6REC.TA6RTNCD == "1") /* user cancelled*/
          set KF0BM001.KF0BM-MESSAGE normal; /* display message*/
          KF0BM001.KF0BM-MESSAGE = COMMAREA.CAMSG;
        else
          KF0BW01.KF0BW-ERROR-IND = "Y"; /* set error flag*/
        end
      end
    end
    if (KF0BW01.KF0BW-ERROR-IND == "Y") /* an error occurred*/
      set KF0BM001.KF0BM-MESSAGE normal; /* display message*/
      set TAEREC empty;
      TAEREC.TAEDESC1 = sysVar.errorCode; /* csp return code*/
      TAEREC.TAEDESC2 = TA6REC.TA6RTNCD; /* subroutine parms*/
      TA1REC.TA1TYPE = "APPL"; /* application error*/
      TA1REC.TA1FUNC = "POST"; /* post, no abend*/
      TA1REC.TA1LOCAT[1] = "SUB RPT "; /* location*/
      TA1REC.TA1LOCAT[2] = "XPTA0P  "; /* subroutine*/
      try
        call "TA0020" (TA1REC, TAEREC) {isExternal = yes};
      end /* message formatter*/
      set KF0BM001.KF0BM-MESSAGE normal; /* display message*/
      KF0BM001.KF0BM-MESSAGE = COMMAREA.CAMSG;
      converseLib.validationFailed(36);
      KF0BW01.KF0BW-ERROR-IND = "Y";
    end
  end
  ;
end // end KF0BS-SUBMIT-RPT

// submit test JCL
Function KF0BS-TEST-JCL()
  ;
  ;
       /* move production JCL from KF0BT02 to TA6REC*/
       /* to be submitted by TA0P.*/
  ;
  KF0BW01.KF0BW-JCL-INDEX = 1; /* set indexes*/
  TA6REC.TA6INDEX = 1;
  ;
  if (TA6REC.XURDEST == "LOCAL ") /* local printer*/
    ;
    if ("/*EOF" in KF0BT04.TARJCL from KF0BW-JCL-INDEX) /* end of table*/
      KF0BW01.KF0BW-END-OF-JCL-TABLE = sysVar.arrayIndex;
      ;
      while (KF0BW01.KF0BW-JCL-INDEX <= KF0BW01.KF0BW-END-OF-JCL-TABLE)
        if (KF0BT04.TARTYPE[KF0BW-JCL-INDEX] == "P") /* parameter card*/
          TA6REC.TARJCL[TA6INDEX] = KF0BW03.KF0BW-PARAMETER-DATA; /* move to jcl*/
        else /* not parm card*/
          if (KF0BT04.TARTYPE[KF0BW-JCL-INDEX] == "C") /* number of copies*/
            KF0BW04.KF0BW-PRINT-PARMS = KF0BT04.TARJCL[KF0BW-JCL-INDEX];
            KF0BW-NBR-COPIES = TA6REC.XURCOPY;
            TA6REC.TARJCL[TA6INDEX] = KF0BW04.KF0BW-PRINT-PARMS;
          else
            TA6REC.TARJCL[TA6INDEX] = KF0BT04.TARJCL[KF0BW-JCL-INDEX]; /* move jcl*/
            TA6REC.TARTYPE[TA6INDEX] = KF0BT04.TARTYPE[KF0BW-JCL-INDEX]; /* move type*/
          end
        end
        ;
        TA6REC.TA6INDEX = TA6REC.TA6INDEX + 1; /* increment index*/
        KF0BW01.KF0BW-JCL-INDEX = KF0BW01.KF0BW-JCL-INDEX + 1;
        ;
      end
      ;
    else /* bad jcl table*/
      converseLib.validationFailed(37);
      KF0BW01.KF0BW-ERROR-IND = "Y";
    end
    ;
  else /* remote printer*/
    ;
    if ("/*EOF" in KF0BT02.TARJCL from KF0BW-JCL-INDEX) /* end of table*/
      KF0BW01.KF0BW-END-OF-JCL-TABLE = sysVar.arrayIndex;
      ;
      while (KF0BW01.KF0BW-JCL-INDEX <= KF0BW01.KF0BW-END-OF-JCL-TABLE)
        if (KF0BT02.TARTYPE[KF0BW-JCL-INDEX] == "P") /* parameter card*/
          TA6REC.TARJCL[TA6INDEX] = KF0BW03.KF0BW-PARAMETER-DATA; /* move to jcl*/
        else /* not parm card*/
          TA6REC.TARJCL[TA6INDEX] = KF0BT02.TARJCL[KF0BW-JCL-INDEX]; /* move jcl*/
          TA6REC.TARTYPE[TA6INDEX] = KF0BT02.TARTYPE[KF0BW-JCL-INDEX]; /* move type*/
        end
        ;
        TA6REC.TA6INDEX = TA6REC.TA6INDEX + 1; /* increment index*/
        KF0BW01.KF0BW-JCL-INDEX = KF0BW01.KF0BW-JCL-INDEX + 1;
        ;
      end
      ;
    else /* bad jcl table*/
      converseLib.validationFailed(37);
      KF0BW01.KF0BW-ERROR-IND = "Y";
    end
    ;
  end
end // end KF0BS-TEST-JCL

//*** RECORD=KF0BW01 ****
// this record contains working storage fields for program KF0B
// 
// ************************************************************
// *                  Maintenance History                     *
// ************************************************************
// 
// Log #    Date      Name    Description
// _____  ________  ________  _________________________________
//  001   09/22/92  JBECKE    Created record.
//  000   03/03/93  jbecke    added first of month fields.
// 
// ***********************
Record KF0BW01 type basicRecord
  5 KF0BW-WORKING-STORAGE KF0BW-WORKING-STORAGE ; 
    10 KF0BW-END-OF-JCL-TABLE KF0BW-END-OF-JCL-TABLE ; 
    10 KF0BW-DATA-FOUND-IND KF0BW-DATA-FOUND-IND ; 
    10 KF0BW-ERROR-IND KF0BW-ERROR-IND ; 
    10 TA5APPID TA5APPID ; 
    10 KF0BW-MAX-QUEUE-LENGTH KF0BW-MAX-QUEUE-LENGTH ; 
    10 KF0BW-MAX-TS-ADDS KF0BW-MAX-TS-ADDS ; 
    10 KF0BW-MAX-LINES-SCREEN KF0BW-MAX-LINES-SCREEN ; 
    10 KF0BW-MAX-WS-LINES KF0BW-MAX-WS-LINES ; 
    10 KF0BW-TS-REC-COUNT KF0BW-TS-REC-COUNT ; 
    10 KF0BW-CURRENT-WS-ARRAY KF0BW-CURRENT-WS-ARRAY ; 
    10 KF0BW-TOP-OF-SCREEN KF0BW-TOP-OF-SCREEN ; 
    10 KF0BW-BOTTOM-OF-SCREEN KF0BW-BOTTOM-OF-SCREEN ; 
    10 KF0BW-SCREEN-INDEX KF0BW-SCREEN-INDEX ; 
    10 KF0BW-WS-INDEX KF0BW-WS-INDEX ; 
    10 KF0BW-JCL-INDEX KF0BW-JCL-INDEX ; 
    10 KF0BW-SESN-INDEX KF0BW-SESN-INDEX ; 
    10 KF0BW-SESN-PNTR KF0BW-SESN-PNTR ; 
    10 KF0BW-SESN-PNTR-1 KF0BW-SESN-PNTR-1 ; 
    10 KF0BW-NEW-SEASON KF0BW-NEW-SEASON ; 
    10 KF0BW-NEW-YEAR KF0BW-NEW-YEAR ; 
    10 KF0BW-TERM-DATE KF0BW-TERM-DATE ; 
    10 KF0BW-DATE-WORK KF0BW-DATE-WORK ; 
      15 * num(1) ; 
      15 KF0BW-DATE-WORK-CC KF0BW-DATE-WORK-CC ; 
      15 KF0BW-DATE-WORK-YY KF0BW-DATE-WORK-YY ; 
      15 KF0BW-DATE-WORK-MM KF0BW-DATE-WORK-MM ; 
      15 KF0BW-DATE-WORK-DD KF0BW-DATE-WORK-DD ; 
    10 * char(3) ; 
    10 KF0BW-DATE-STRT-CCYYMMDD KF0BW-DATE-STRT-CCYYMMDD ; 
      15 KF0BW-DATE-STRT-CC KF0BW-DATE-STRT-CC ; 
      15 KF0BW-DATE-STRT-YY KF0BW-DATE-STRT-YY ; 
      15 KF0BW-DATE-STRT-MM KF0BW-DATE-STRT-MM ; 
      15 KF0BW-DATE-STRT-DD KF0BW-DATE-STRT-DD ; 
    10 * char(3) ; 
    10 KF0BW-DATE-FRST-CCYYMMDD KF0BW-DATE-FRST-CCYYMMDD ; 
      15 KF0BW-DATE-FRST-CC KF0BW-DATE-FRST-CC ; 
      15 KF0BW-DATE-FRST-YY KF0BW-DATE-FRST-YY ; 
      15 KF0BW-DATE-FRST-MM KF0BW-DATE-FRST-MM ; 
      15 KF0BW-DATE-FRST-DD KF0BW-DATE-FRST-DD ; 
    10 * char(3) ; 
    10 KF0BW-CURR-DATE-CCYYMMDD KF0BW-CURR-DATE-CCYYMMDD ; 
    10 * char(3) ; 
    10 KF0BW-SEASON-KEY KF0BW-SEASON-KEY ; 
      15 XSE-SESN-CD XSE-SESN-CD ; 
      15 KF0BW-YNS-SESN-YR-DISP KF0BW-YNS-SESN-YR-DISP ; 
      15 YNS-BUS-FUNC-ID YNS-BUS-FUNC-ID ; 
    10 * char(3) ; 
    10 KF0BW-SESN-CUST-KEY KF0BW-SESN-CUST-KEY ; 
      15 KF0BW-SESN-CU-CO-ID KF0BW-SESN-CU-CO-ID ; 
      15 KF0BW-SESN-CU-STOR-ID KF0BW-SESN-CU-STOR-ID ; 
      15 KF0BW-SESN-DEPT-ID-XREF KF0BW-SESN-DEPT-ID-XREF ; 
      15 KF0BW-SESN-YSB-SLS-RESP-CD KF0BW-SESN-YSB-SLS-RESP-CD ; 
    10 KF0BW-ADJ-CUST-KEY KF0BW-ADJ-CUST-KEY ; 
      15 KF0BW-ADJ-CU-CO-ID KF0BW-ADJ-CU-CO-ID ; 
      15 KF0BW-ADJ-CU-STOR-ID KF0BW-ADJ-CU-STOR-ID ; 
      15 KF0BW-ADJ-DEPT-ID-XREF KF0BW-ADJ-DEPT-ID-XREF ; 
      15 KF0BW-ADJ-YSB-SLS-RESP-CD KF0BW-ADJ-YSB-SLS-RESP-CD ; 
    10 KF0BW-HOLD-PSTN-ID KF0BW-HOLD-PSTN-ID ; 
end // end KF0BW01

//*** RECORD=KF0BW02 ****
// this record contains the working storage table that is moved
// to the screen map and saved in the temporary storage queue.
// 
// ************************************************************
// *                  Mainenance History                      *
// ************************************************************
// 
// Log #    Date      Name    Description
// _____  ________  ________  _________________________________
//  001   09/22/92  JBECKE    Created table.
// 
// ***********************
Record KF0BW02 type basicRecord
  5 KF0BW-LENGTH KF0BW-LENGTH ; 
  5 * char(2900) ; 
    10 KF0BW-WS-LOAD-COUNT KF0BW-WS-LOAD-COUNT ; 
    10 KF0BW-DETAIL-LINE KF0BW-DETAIL-LINE [63] ; 
      15 YSB-SLS-RESP-CD YSB-SLS-RESP-CD ; 
      15 CU-CO-ID CU-CO-ID ; 
      15 CU-STOR-ID CU-STOR-ID ; 
      15 XNX-DEPT-ID-XREF XNX-DEPT-ID-XREF ; 
      15 CU-STOR-NM CU-STOR-NM ; 
      15 CO-CUST-SESN-SLS CO-CUST-SESN-SLS ; 
      15 CO-CUST-STAT-IND CO-CUST-STAT-IND ; 
      15 KF0BW-SALES-ADJ-IND KF0BW-SALES-ADJ-IND ; 
end // end KF0BW02

//*** RECORD=KF0BW03 ****
// this record contains the SYSIN parameters for program kf1220
// the corresponding cobol copybook is WKF1221.
// 
// NOTE:  Any changes made to either WKF1221 or to KF0BW03
//        MUST be made to BOTH !!!
// 
// ************************************************************
// *                 Maintenance History                      *
// ************************************************************
// 
// Log #    Date      Name    Description
// _____  ________  ________  _________________________________
//  001   09/22/92  JBECKE    Created record.
// 
// ***********************
Record KF0BW03 type basicRecord
  5 KF0BW-PARAMETER-DATA KF0BW-PARAMETER-DATA ; 
    10 KF0BW-XSE-SESN-CD KF0BW-XSE-SESN-CD ; 
    10 KF0BW-YNS-SESN-YR KF0BW-YNS-SESN-YR ; 
    10 KF0BW-SEASON-YR-DESC KF0BW-SEASON-YR-DESC ; 
    10 KF0BW-CO-LST-RALGN-DT KF0BW-CO-LST-RALGN-DT ; 
    10 KF0BW-SM-SAGCY-ID KF0BW-SM-SAGCY-ID ; 
    10 KF0BW-SM-SREP-ID KF0BW-SM-SREP-ID ; 
    10 KF0BW-SM-SREP-PSTN-ID KF0BW-SM-SREP-PSTN-ID ; 
    10 KF0BW-SM-SREP-TDT KF0BW-SM-SREP-TDT ; 
    10 KF0BW-XURDEST KF0BW-XURDEST ; 
    10 * char(19) ; 
end // end KF0BW03

//*** RECORD=KF0BW04 ****
// this record contains the parameters for the batch report
// output proc TA0431.
// 
// ************************************************************
// *                 Maintenance History                      *
// ************************************************************
// 
// Log #    Date      Name    Description
// _____  ________  ________  _________________________________
//  001   09/22/92  JBECKE    Created record.
// 
// ***********************
Record KF0BW04 type basicRecord
  5 KF0BW-PRINT-PARMS KF0BW-PRINT-PARMS ; 
    10 * char(21) ; 
    10 KF0BW-NBR-COPIES KF0BW-NBR-COPIES ; 
    10 * char(58) ; 
end // end KF0BW04

//*** RECORD=KF0BW05 ****
// This record contains the working storage fields for the call
// to IO5610
// ************************************************************
// *                MAINTENANCE HISTORY                       *
// ************************************************************
// Log #     Date        Name    Description
// ---       ----        ----    -----------
// 001       09/22/93    ISCHMI  Created record.
// ***********************
Record KF0BW05 type basicRecord
  5 KF0BW-IO-PASS KF0BW-IO-PASS ; 
    10 KF0BW-IO-TASK KF0BW-IO-TASK ; 
    10 KF0BW-IO-IND1 KF0BW-IO-IND1 ; 
end // end KF0BW05

DataItem KF0BW-ADJ-CU-CO-ID num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

DataItem KF0BW-ADJ-CU-STOR-ID num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

DataItem KF0BW-ADJ-CUST-KEY char(19)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem KF0BW-ADJ-DEPT-ID-XREF num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

DataItem KF0BW-ADJ-YSB-SLS-RESP-CD char(2)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// ws rec on bottom of screen
DataItem KF0BW-BOTTOM-OF-SCREEN smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// date data last realigned
DataItem KF0BW-CO-LST-RALGN-DT char(8)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// test date for realign check
DataItem KF0BW-CURR-DATE-CCYYMMDD num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// current temp storage rec in ws
DataItem KF0BW-CURRENT-WS-ARRAY smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// detail data found in vsnsls01
DataItem KF0BW-DATA-FOUND-IND char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// first of current month century
DataItem KF0BW-DATE-FRST-CC num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// first of current month date
DataItem KF0BW-DATE-FRST-CCYYMMDD num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// first of current month day
DataItem KF0BW-DATE-FRST-DD num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// first of current month month
DataItem KF0BW-DATE-FRST-MM num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// first of current month year
DataItem KF0BW-DATE-FRST-YY num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// test date for realign century
DataItem KF0BW-DATE-STRT-CC num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// test date for realign check
DataItem KF0BW-DATE-STRT-CCYYMMDD num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// test date for realign day
DataItem KF0BW-DATE-STRT-DD num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// test date for realign month
DataItem KF0BW-DATE-STRT-MM num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// test date for realign year
DataItem KF0BW-DATE-STRT-YY num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// date work fields
DataItem KF0BW-DATE-WORK num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// century portion of date
DataItem KF0BW-DATE-WORK-CC num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// day portion of date
DataItem KF0BW-DATE-WORK-DD num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// month portion of date
DataItem KF0BW-DATE-WORK-MM num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// year portion of date
DataItem KF0BW-DATE-WORK-YY num(2)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// screen detail line
DataItem KF0BW-DETAIL-LINE char(46)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// end of the jcl table
DataItem KF0BW-END-OF-JCL-TABLE smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// an editing error encountered
DataItem KF0BW-ERROR-IND char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem KF0BW-HOLD-PSTN-ID char(10)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// unused
DataItem KF0BW-IO-IND1 smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// io5610 calling field
DataItem KF0BW-IO-PASS char(4)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// literal value
DataItem KF0BW-IO-TASK char(2)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// index to jcl
DataItem KF0BW-JCL-INDEX smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// temp storage record length
DataItem KF0BW-LENGTH num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// max lines on each map page
DataItem KF0BW-MAX-LINES-SCREEN smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// max length of ts queue rec
DataItem KF0BW-MAX-QUEUE-LENGTH smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// maximum temp storage adds
DataItem KF0BW-MAX-TS-ADDS smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// max lines in working storage
DataItem KF0BW-MAX-WS-LINES smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// number of copies requested
DataItem KF0BW-NBR-COPIES num(1)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = nullFill, inputRequired = no
}
end

// season to display
DataItem KF0BW-NEW-SEASON char(2)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// year of season to display
DataItem KF0BW-NEW-YEAR num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// kf working storage rec group
DataItem KF0BW-PARAMETER-DATA char(80)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// parms for batch print output
DataItem KF0BW-PRINT-PARMS char(80)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem KF0BW-SALES-ADJ-IND char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// screen line index
DataItem KF0BW-SCREEN-INDEX smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// yns table key fields
DataItem KF0BW-SEASON-KEY char(9)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// season description
DataItem KF0BW-SEASON-YR-DESC char(15)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem KF0BW-SESN-CU-CO-ID num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

DataItem KF0BW-SESN-CU-STOR-ID num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

DataItem KF0BW-SESN-CUST-KEY char(19)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem KF0BW-SESN-DEPT-ID-XREF num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// index for season
DataItem KF0BW-SESN-INDEX smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// yns table at previous season
DataItem KF0BW-SESN-PNTR smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// yns table - season before prev
DataItem KF0BW-SESN-PNTR-1 smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

DataItem KF0BW-SESN-YSB-SLS-RESP-CD char(2)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// agency id to report
DataItem KF0BW-SM-SAGCY-ID char(4)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// rep id to report
DataItem KF0BW-SM-SREP-ID char(4)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// sales rep position ID
DataItem KF0BW-SM-SREP-PSTN-ID char(10)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// sales rep term date
DataItem KF0BW-SM-SREP-TDT num(8)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// rep termination date
DataItem KF0BW-TERM-DATE num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// ws rec on top of screen
DataItem KF0BW-TOP-OF-SCREEN smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// number of temp storage adds
DataItem KF0BW-TS-REC-COUNT smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// kf working storage rec group
DataItem KF0BW-WORKING-STORAGE char(156)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// working storage index
DataItem KF0BW-WS-INDEX smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// tot recs in working storage
DataItem KF0BW-WS-LOAD-COUNT smallint {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// season code
DataItem KF0BW-XSE-SESN-CD char(2)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// remote printer destination
DataItem KF0BW-XURDEST char(6)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

DataItem KF0BW-YNS-SESN-YR char(4)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// season year
DataItem KF0BW-YNS-SESN-YR-DISP num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

