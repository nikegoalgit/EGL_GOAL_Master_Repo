package tp0e;
import corpcom1.*;
import corpcom2.*;
import corpcom3.*;
import corpcom4.*;
import corpcom5.*;
import corpcom6.*;
import corpcom7.*;
import corpx1.*;
import corpx2.*;
import corpz3.*;
import in1.common.*;
import pk.common.*;
import sy.common.*;
import ta.common.*;
import tf.common.*;
import tp.common.*;
import ts.common.*;
//*** PROGRAM=TP0E ****
// This application displays orders on the pool header.
// The user can then select orders to the fastpick plan.
// 
// 
// 
// -------  --------  ------  ---------------------------------
// CONTROL    DATE    USERID  DESCRIPTION OF CHANGE
// -------  --------  ------  ---------------------------------
// NEW      06/30/93  xxxxxx  New application.
// *********************
Program TP0E type textUIProgram //VAGen Info - main text program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes, 
  msgTablePrefix = "PK00", inputRecord = COMMAREA, segmented = yes
  }

  // Data Declarations
  COMMAREA COMMAREA ; // record
  SQLCA SQLCA; // record
  TA1REC TA1REC; // record
  TA2REC TA2REC; // record
  TA5REC TA5REC; // record
  TAEREC TAEREC; // record
  TP0EW00 TP0EW00; // record
  TP0EW01 TP0EW01; // record
  TP0EW02 TP0EW02; // record
  TP10REC TP10REC; // record
  TPWREC TPWREC; // record
  XX0XW01 XX0XW01; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use XWHTBL {deleteAfterUse = yes}; // table
  use TP0EM.TP0EM001 // form
   {
    pfKeyEquate = no
  };

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    TP0E0001: TP0E0001();
     /* ------------------------------------------------------------*/
     /* Initialize working storage and display storage areas.*/
     /* ------------------------------------------------------------*/

    set TP0EM001 initial; /* Map input/output*/
    set SQLCA empty; /* SQL communication area*/
    set TP0EW00 empty; /* application working storage*/
    set TP0EW01 empty; /* application working storage*/
    set TP0EW02 empty; /* temp storage page definition*/
    set TP10REC empty; /* nikeboth io pass data*/
    set TAEREC empty; /* Error diagnosis information*/
    set TA1REC empty; /* Error diagnosis parameters*/
    set TA5REC empty; /* Temporary storage parameters*/
    set XX0XW01 empty; /* Date/time subroutine parameters*/


    TP0EW02.XXX-TEMP-STG-LNTH = 1051; /* Temporary storage length*/
    TP0EW01.XXX-INX-LMT-NBR = 11; /* Number of lines on a page*/
    TP0EW01.XXX-RQT-DATA-FL = "Y"; /* Request for database access*/
    TP0EW01.XXX-MAP-FMAT-FL = "N"; /* Format the map flag*/
  
    /* ------------------------------------------------------------*/
    /* Format header info*/
    /* ------------------------------------------------------------*/
    if (TPWREC.TPWFRMAP == "TP0A")
      TP0EM001.XXXCURDT = VGVar.currentShortGregorianDate; /* Current date*/
      TP0EM001.XWHCD = TPWREC.XWH-WHSE-CD; /* warehouse code*/
    end

    TP0E0002: TP0E0002();
     /* ------------------------------------------------------------*/
     /* Flow to converse the main process used to display a map.*/
     /* ------------------------------------------------------------*/

    goto TP0E0002; /* Converse the main process*/

  end // end main
end // end TP0E

// Determine which map to display
Function TP0E0001()

   /* ------------------------------------------------------------*/
   /* This is the main process used to display a map.  Processing*/
   /* always returns to the top of this process and falls through*/
   /* subordinate processes until an error is found or a valid*/
   /* request is processed.  Processing sequence is as follows:*/
   /* ------------------------------------------------------------*/

  XPTP001(); /* application init*/

end // end TP0E0001

// Main process to display a map
Function TP0E0002()
  TP0ES100-GETDATA(); /* build pages in temp storage*/
  TP0ES200-FORMAT(); /* move page to map*/
  TP0ES250-RUNMODE(); /* planning or scheduling ?*/
  converse TP0EM001 ;
  TP0ES300-PFKEYS(); /* check pfkeys*/
  TP0ES500-INPUT(); /* verify selection criteria*/
  TP0ES600-SCROLL(); /* process pf7 and pf8*/
end // end TP0E0002

// Add page to temporary storage
Function TP0ES-TS-ADD()
  TA5REC.TA5APPID = COMMAREA.CACURRAP; /* Application identification*/

  TA5REC.TA5FNCCD = "A"; /* Function code*/
  XXX-TEMP-STG-LNTH = 1051; /* set tsq length*/

   /* ------------------------------------------------------------*/
   /* call subroutine to write page to temp-storage.*/
   /* ------------------------------------------------------------*/

  try
    call "TA0050" (TP0EW02, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* Add page*/

   /* ------------------------------------------------------------*/
   /* If the call was successful, initialize the storage area and*/
   /* indicators to be used and return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return code*/

    set TP0EW02 empty; /* M001 display storage*/

    XXX-HI-PAGE-NBR = TA5REC.TA5TSQIX;
    TA5REC.TA5TSQIX = 0; /* init tsq page index*/

    XXX-TEMP-STG-LNTH = 1051; /* set tsq length*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.TAEDESC1 = TA5REC.TA5DATA; /* Subroutine parameters*/

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* Roll back all changes*/

  converseLib.validationFailed(10); /* Unexpected error occurred*/
  TA1REC.TA1FUNC = "RETN"; /* Termination function*/

  TA1REC.TA1TYPE = "APPL"; /* Type of error*/
  TA1REC.TA1LOC = "ADD PAGE TO TEMPORARY STORAGE"; /* Description*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end TP0ES-TS-ADD

// Purge any temporary storage
Function TP0ES-TS-PURG()
   /* ------------------------------------------------------------*/
   /* Initialize the storage areas and indicators to be used.*/
   /* ------------------------------------------------------------*/

  TA5REC.TA5TSQIX = 0; /* Displayed page number*/
  XXX-HI-PAGE-NBR = 0; /* Highest page number*/

   /* ------------------------------------------------------------*/
   /* Purge any temporary storage for this application.*/
   /* ------------------------------------------------------------*/

  TA5REC.TA5APPID = COMMAREA.CACURRAP; /* Application identification*/

  TA5REC.TA5FNCCD = "P"; /* Function code*/

  try
    call "TA0050" (TP0EW02, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* Purge storage*/

   /* ------------------------------------------------------------*/
   /* If the call was successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return code*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.TAEDESC1 = TA5REC.TA5DATA; /* Subroutine parameters*/


  converseLib.validationFailed(10); /* Unexpected error occurred*/
  TA1REC.TA1FUNC = "RETN"; /* Termination function*/

  TA1REC.TA1TYPE = "APPL"; /* Type of error*/
  TA1REC.TA1LOC = "PURGE ANY TEMPORARY STORAGE"; /* Description*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end TP0ES-TS-PURG

// Read temporary storage page
Function TP0ES-TS-READ()
   /* ------------------------------------------------------------*/
   /* Read the next page from the temporary storage queue.*/
   /* ------------------------------------------------------------*/


  TA5REC.TA5APPID = COMMAREA.CACURRAP; /* Application identification*/

  TA5REC.TA5TSQIX = XXX-CURR-PAGE-NBR; /* Page number*/

  TA5REC.TA5FNCCD = "R"; /* Function code*/

  XXX-TEMP-STG-LNTH = 1051; /* tsq length*/

  try
    call "TA0050" (TP0EW02, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* Read page*/

   /* ------------------------------------------------------------*/
   /* If the call was successful, return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return code*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.TAEDESC1 = TA5REC.TA5DATA; /* Subroutine parameters*/


  converseLib.validationFailed(10); /* Unexpected error occurred*/
  TA1REC.TA1FUNC = "RETN"; /* Termination function*/

  TA1REC.TA1TYPE = "APPL"; /* Type of error*/
  TA1REC.TA1LOC = "READ TEMPORARY STORAGE PAGE"; /* Description*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end TP0ES-TS-READ

// Add page to temporary storage
Function TP0ES-TS-UPDATE()
  TA5REC.TA5APPID = COMMAREA.CACURRAP; /* Application identification*/

  TA5REC.TA5FNCCD = "U"; /* Function code*/
  XXX-TEMP-STG-LNTH = 1051; /* set tsq length*/
  TA5REC.TA5TSQIX = XXX-CURR-PAGE-NBR; /* Page number*/

   /* ------------------------------------------------------------*/
   /* call subroutine to re-write page to temp-storage.*/
   /* ------------------------------------------------------------*/

  try
    call "TA0050" (TP0EW02, TA5REC) {isNoRefresh = yes, isExternal = yes};
  end /* Add page*/

   /* ------------------------------------------------------------*/
   /* If the call was successful, initialize the storage area and*/
   /* indicators to be used and return to the previous process.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA5REC.TA5RTNCD == 0)          /* and normal return code*/

    XXX-TEMP-STG-LNTH = 1051; /* set tsq length*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* Otherwise, indicate that an unexpected error has occurred.*/
   /* ------------------------------------------------------------*/

  TA1REC.TA1MAP = sysVar.errorCode; /* CSP return code*/
  TAEREC.TAEDESC1 = TA5REC.TA5DATA; /* Subroutine parameters*/

  VGVar.handleSysLibraryErrors = 0;
  sysLib.rollback(); /* Roll back all changes*/

  converseLib.validationFailed(10); /* Unexpected error occurred*/
  TA1REC.TA1FUNC = "RETN"; /* Termination function*/

  TA1REC.TA1TYPE = "APPL"; /* Type of error*/
  TA1REC.TA1LOC = "UPDATE PAGE IN TEMPORARY STORAGE"; /* Description*/

  call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

  exit stack; /* Exit to display map*/


end // end TP0ES-TS-UPDATE

// obtain data to display
Function TP0ES100-GETDATA()
  if (converseVar.eventKey is enter)
    /* ------------------------------------------------------------*/
    /* If data was not requested or an error was found, return to*/
    /* the previous process.*/
    /* ------------------------------------------------------------*/

    if (XXX-RQT-DATA-FL != "Y" /* Data was not requested*/
     || converseVar.validationMsgNum != 0) /* or an error was found*/

      return; /* Return to previous process*/

    end

    /* ------------------------------------------------------------*/
    /* reset the page number to display.*/
    /* ------------------------------------------------------------*/
    XXX-CURR-PAGE-NBR = 1; /* Page number to display*/

    /* ------------------------------------------------------------*/
    /* Purge any pages from temporary storage and save key fields.*/
    /* ------------------------------------------------------------*/

    TP0ES-TS-PURG(); /* Purge any temporary storage*/

    /* ------------------------------------------------------------*/
    /* set flag to fromat the map*/
    /* ------------------------------------------------------------*/
    XXX-MAP-FMAT-FL = "Y"; /* Format the map flag*/

    TA5REC.TA5TSQIX = 0; /* init tsq page index*/
    XXX-HI-PAGE-NBR = 0; /* init page counter*/
    /* ------------------------------------------------------------*/
    /* restore selection criteria if coming from tp0f or tp0g*/
    /* ------------------------------------------------------------*/
    if (TPWREC.TPWFRMAP == "TP0F" || 
    TPWREC.TPWFRMAP == "TP0G")
      TP0ES110-RESTORE();
    end
    /* ------------------------------------------------------------*/
    /* set up io request information*/
    /* ------------------------------------------------------------*/
    TP0ES120-SETUP();

    call "TP0010" (TP10REC) {isNoRefresh = yes, isExternal = yes}; /* call nikeboth*/

    /* ------------------------------------------------------------*/
    /* check to see if there is any data to display.*/
    /* ------------------------------------------------------------*/
    if (TP10REC.TPW-RTRN-SQLCD != 0)
      return; /* Exit to display map*/
    end

    /* ------------------------------------------------------------*/
    /* if there is data to display -*/
    /* write data to temp-storage pages.*/
    /* ------------------------------------------------------------*/

    XXX-INX-FLD-NBR = 0; /* initialize line indexte*/

    TP10REC.TPW-RQST-TYP = "N1"; /* fetch first record*/
    call "TP0010" (TP10REC) {isNoRefresh = yes, isExternal = yes}; /* call nikeboth*/

    while (TP10REC.TPW-RTRN-SQLCD == 0) /* do until no more records*/
      if (TP10REC.TP10-PRODS > TP10REC.TPW-MAX-PRODS) /* if order has too many*/
                                  /* products - skip it*/
      else /* else move to temp storage*/
        XXX-INX-FLD-NBR = XXX-INX-FLD-NBR + 1;
        TP0EW02.TP10-ACTION[XXX-INX-FLD-NBR] = TP10REC.TP10-ACTION; /**/
        TP0EW02.TP10-DNSB[XXX-INX-FLD-NBR] = TP10REC.TP10-DNSB; /**/
        TP0EW02.TF1CARCD[XXX-INX-FLD-NBR] = TP10REC.TF1CARCD; /**/
        TP0EW02.TP10-ORDER-NBR[XXX-INX-FLD-NBR] = TP10REC.TP10-ORDER-NBR; /**/
        TP0EW02.PK1CUOID[XXX-INX-FLD-NBR] = TP10REC.PK1CUOID; /**/
        TP0EW02.PK1NORID[XXX-INX-FLD-NBR] = TP10REC.PK1NORID; /**/
        TP0EW02.CU-CO-NM[XXX-INX-FLD-NBR] = TP10REC.CU-CO-NM; /**/
        TP0EW02.TP10-EXISTS-IND[XXX-INX-FLD-NBR] = TP10REC.TP10-EXISTS-IND; /**/
        TP0EW02.TP10-STATUS-IND[XXX-INX-FLD-NBR] = TP10REC.TP10-STATUS-IND; /**/
        TP0EW02.TP10-FC-QTY[XXX-INX-FLD-NBR] = TP10REC.TP10-FC-QTY; /**/

        TP0EW02.TP10-RP-QTY[XXX-INX-FLD-NBR] = TP10REC.TP10-RP-QTY; /**/

        TP0EW02.TP10-PRODS[XXX-INX-FLD-NBR] = TP10REC.TP10-PRODS; /**/
        TP0EW02.TPW-XHDCD1[XXX-INX-FLD-NBR] = TP10REC.TPW-XHDCD1; /**/
        TP0EW02.TPW-XHDCD2[XXX-INX-FLD-NBR] = TP10REC.TPW-XHDCD2; /**/
        TP0EW02.TPW-XHDCD3[XXX-INX-FLD-NBR] = TP10REC.TPW-XHDCD3; /**/

        TP0EW02.TP10-UOM-FL[XXX-INX-FLD-NBR] = TP10REC.TP10-UOM-FL; /**/

        if (XXX-INX-FLD-NBR == 11) /* if page is full*/
          TP0EW02.TPW-LINES-ON-PAGE = 11;
          TP0ES-TS-ADD(); /* write full page to temp storage*/
          XXX-INX-FLD-NBR = 0; /* point to first item of new page*/
        end
      end
      call "TP0010" (TP10REC) {isNoRefresh = yes, isExternal = yes}; /* fetch next record*/
    end

    /* ------------------------------------------------------------*/
    /* add any partially formatted page.*/
    /* ------------------------------------------------------------*/
    if (XXX-INX-FLD-NBR > 0) /* if more items*/
      TP0EW02.TPW-LINES-ON-PAGE = XXX-INX-FLD-NBR;
      TP0ES-TS-ADD(); /* write partial page to temp storage*/
    end


    /* ------------------------------------------------------------*/
    /* Indicate that the request for data is complete.*/
    /* ------------------------------------------------------------*/

    XXX-CURR-PAGE-NBR = 1; /* set first page to display*/

    XXX-RQT-DATA-FL = "N"; /* dont rebuild tsq's*/

  end

end // end TP0ES100-GETDATA

// obtain data to display
Function TP0ES110-RESTORE()
   /* ------------------------------------------------------------------*/
   /* if returning from tp0f or tp0g - restore selection criteria*/
   /* ------------------------------------------------------------------*/
  TP0EM001.TPW-MIN-UNITS = TPWREC.TPW-MIN-UNITS; /**/
  TP0EM001.TPW-MAX-PRODS = TPWREC.TPW-MAX-PRODS; /**/
  TP0EW00.TPWFDT = TPWREC.TPW-FROM-DT; /* braek out date*/
  TP0EW00.TPWTDT = TPWREC.TPW-TO-DT; /* break out date*/

   /* ---------------------------------------------------------*/
   /* break out date for screen display*/
   /* ---------------------------------------------------------*/
  TP0EM001.TP0EMFMM = TP0EW00.TPWFMM;
  TP0EM001.TP0EMFDD = TP0EW00.TPWFDD;
  TP0EM001.TP0EMFYY = TP0EW00.TPWFYY;

  TP0EM001.TP0EMTMM = TP0EW00.TPWTMM;
  TP0EM001.TP0EMTDD = TP0EW00.TPWTDD;
  TP0EM001.TP0EMTYY = TP0EW00.TPWTYY;

  TPWREC.TPWFRMAP = "TP0E";
end // end TP0ES110-RESTORE

// initialize io module request d
Function TP0ES120-SETUP()
    /* ------------------------------------------------------------*/
    /* initialize tp10rec to read vpoolh01.*/
    /* ------------------------------------------------------------*/
  set TP10REC empty; /* io module pass area*/
  set TP0EW02 empty; /* tsq page*/

  if (TPWREC.TPW-SEL-RUN-MODE == "PP") /* picking or scheduling ?*/
    TP10REC.TP10-RUN-MODE = "P"; /* picking*/
  else
    TP10REC.TP10-RUN-MODE = "S"; /* scheduling*/
  end

  TP0EM001.XWHCD = TPWREC.XWH-WHSE-CD; /* map whse-cd*/
  TP10REC.XWHCD = TPWREC.XWH-WHSE-CD; /* io data*/
  TP10REC.TP10-CALLING-PGM = "TP0E"; /* io module*/
  TP10REC.TP10-XHDCDFL = "Y"; /* REQUEST SPECIAL HANDLING*/

  TP10REC.TPW-MIN-UNITS = TP0EM001.TPW-MIN-UNITS; /* io min units*/
  TPWREC.TPW-MIN-UNITS = TP0EM001.TPW-MIN-UNITS; /* commarea min units*/

  TP10REC.TPW-MAX-PRODS = TP0EM001.TPW-MAX-PRODS; /* io max units*/
  TPWREC.TPW-MAX-PRODS = TP0EM001.TPW-MAX-PRODS; /* commarea max units*/

    /* ------------------------------------------------------------*/
    /* if processing enter - use data in working storage*/
    /* ------------------------------------------------------------*/
  if (TPWREC.TPWFRMAP == "TP0E")
    TP10REC.TPW-FROM-DT = TP0EW00.TPWFDT;
    TPWREC.TPW-FROM-DT = TP0EW00.TPWFDT;
    TP0EW01.TPW-SAVE-FROM-DT = TP0EW00.TPWFRD;

    TP10REC.TPW-TO-DT = TP0EW00.TPWTDT;
    TPWREC.TPW-TO-DT = TP0EW00.TPWTDT;
    TP0EW01.TPW-SAVE-TO-DT = TP0EW00.TPWTOD;
  end

    /* ------------------------------------------------------------*/
    /* if coming from the menu - initialze selection criteria in*/
    /* the commarea (tpwrec) and in the io module pass record(tp10rec)*/
    /* ------------------------------------------------------------*/
  if (TPWREC.TPWFRMAP == "TP0A")
    TP10REC.TPW-RQST-TYP = "S1"; /* display all orders already*/
                                  /* in the fastpick plan*/
    TP10REC.TPW-MIN-UNITS = 01;
    TP10REC.TPW-MAX-PRODS = 9999;
    TP10REC.TPW-FROM-DT = 0;
    TP10REC.TPW-TO-DT = 19991231;

    TPWREC.TPW-MIN-UNITS = 0;
    TPWREC.TPW-MAX-PRODS = 0;
    TPWREC.TPW-FROM-DT = 0;
    TPWREC.TPW-TO-DT = 19991231;
    TP0EW01.TPW-SAVE-FROM-DT = 0;
    TP0EW01.TPW-SAVE-TO-DT = 991231;
  else
    if (TPWREC.TPW-MIN-UNITS == 0 &&  /* if no selection criteria entered*/
    TPWREC.TPW-MAX-PRODS == 0)        /**/
      TP10REC.TPW-RQST-TYP = "S1"; /* display all orders already*/
                                  /* in the fastpick plan*/
    else
      TP10REC.TPW-RQST-TYP = "S2"; /* request all orders*/
    end
  end
end // end TP0ES120-SETUP

// move data from temp-storage to
Function TP0ES200-FORMAT()
  if (XXX-MAP-FMAT-FL == "Y") /* Map must be formatted*/

    set TP0EM001 initial;
    /* ------------------------------------------------------------*/
    /* Format header info*/
    /* ------------------------------------------------------------*/
    TP0EM001.XXXCURDT = VGVar.currentShortGregorianDate; /* Current date*/
    TP0EM001.XXXPRCNM = "TP0EM001"; /* map name*/
    TP0EM001.XWHCD = TPWREC.XWH-WHSE-CD; /* warehouse code*/
    TP0ES110-RESTORE(); /* format selection criteria*/


    /* ------------------------------------------------------------*/
    /* perform process to read temp storage and move data to map.*/
    /* ------------------------------------------------------------*/

    TP0EM001.TOTPAGE = XXX-HI-PAGE-NBR; /* last page*/

    TP0ES210-MAPIT(); /* Format the data in the map*/
  end
end // end TP0ES200-FORMAT

// obtain data to display
Function TP0ES210-MAPIT()
  XXX-MAP-FMAT-FL = "N"; /* Format the map flag*/

   /* ------------------------------------------------------------*/
   /* If the page in storage is not the page to be displayed,*/
   /* obtain the desired page from temporary storage.*/
   /* ------------------------------------------------------------*/

  if (XXX-HI-PAGE-NBR > 0) /* Pages were formatted*/

    if (XXX-CURR-PAGE-NBR != TA5REC.TA5TSQIX)
                                   /* Desired page not current*/

      /* ------------------------------------------------------------*/
      /* If the desired page number is greater than the highest page*/
      /* in storage, default to the highest page number.*/
      /* ------------------------------------------------------------*/

      if (XXX-CURR-PAGE-NBR > TP0EW01.XXX-HI-PAGE-NBR)
                                   /* Desired greater highest*/
        TP0EW01.XXX-CURR-PAGE-NBR = XXX-HI-PAGE-NBR;
                                   /* Default to highest*/
      end

      TP0ES-TS-READ(); /* Read temporary storage page*/

    end

    /* ------------------------------------------------------------*/
    /* Display the page information on the screen.*/
    /* ------------------------------------------------------------*/

    TP0EM001.PAGE = XXX-CURR-PAGE-NBR;
                                   /* Current page*/
    TP0EM001.TOTPAGE = XXX-HI-PAGE-NBR;
                                   /* Highest page*/

  end
   /* ------------------------------------------------------------*/
   /* Format the map fields from the display storage area.*/
   /* ------------------------------------------------------------*/

  XXX-INX-FLD-NBR = 1; /* Initialize line index*/

  while (XXX-INX-FLD-NBR <= TP0EW02.TPW-LINES-ON-PAGE)
                                  /* Until screen is full*/
    TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR] = TP0EW02.TP10-ACTION[XXX-INX-FLD-NBR];
    set TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR] normal;
    TP0EM001.TP10-EXISTS-IND[XXX-INX-FLD-NBR] = TP0EW02.TP10-EXISTS-IND[XXX-INX-FLD-NBR];

    if (TP0EW02.TP10-EXISTS-IND[XXX-INX-FLD-NBR] == "*")
      if (TP0EW02.TP10-STATUS-IND[XXX-INX-FLD-NBR] == "1" ||  /* if untagged*/
      TP0EW02.TP10-STATUS-IND[XXX-INX-FLD-NBR] == "3")        /* if untagged*/
        set TP0EM001.TP10-EXISTS-IND[XXX-INX-FLD-NBR] red; /* set ind to red*/
      end
    end

    TP0EM001.TP10-DNSB[XXX-INX-FLD-NBR] = TP0EW02.TP10-DNSB[XXX-INX-FLD-NBR];
    TP0EM001.TP10-ORDER-NBR[XXX-INX-FLD-NBR] = TP0EW02.TP10-ORDER-NBR[XXX-INX-FLD-NBR];
    TP0EM001.TF1CARCD[XXX-INX-FLD-NBR] = TP0EW02.TF1CARCD[XXX-INX-FLD-NBR];
    TP0EM001.CU-CO-NM[XXX-INX-FLD-NBR] = TP0EW02.CU-CO-NM[XXX-INX-FLD-NBR];
    TP0EM001.TP10-PRODS[XXX-INX-FLD-NBR] = TP0EW02.TP10-PRODS[XXX-INX-FLD-NBR];
    TP0EM001.TP10-FC-QTY[XXX-INX-FLD-NBR] = TP0EW02.TP10-FC-QTY[XXX-INX-FLD-NBR];
    TP0EM001.TP10-RP-QTY[XXX-INX-FLD-NBR] = TP0EW02.TP10-RP-QTY[XXX-INX-FLD-NBR];

    TP0EM001.TPW-XHDCD1[XXX-INX-FLD-NBR] = TP0EW02.TPW-XHDCD1[XXX-INX-FLD-NBR];
    TP0EM001.TPW-XHDCD2[XXX-INX-FLD-NBR] = TP0EW02.TPW-XHDCD2[XXX-INX-FLD-NBR];
    TP0EM001.TPW-XHDCD3[XXX-INX-FLD-NBR] = TP0EW02.TPW-XHDCD3[XXX-INX-FLD-NBR];

    TP0EM001.TP10-UOM-FL[XXX-INX-FLD-NBR] = TP0EW02.TP10-UOM-FL[XXX-INX-FLD-NBR];

    XXX-INX-FLD-NBR = XXX-INX-FLD-NBR + 1;
                                   /* Increment line index*/
  end
end // end TP0ES210-MAPIT

// SET COLOR ATTRIBUTES
Function TP0ES250-RUNMODE()
  /* SET MAP COLOR and title*/
  if (TPWREC.TPW-SEL-RUN-MODE == "PK") /* If picking-selection mode*/
    TP0EM001.TP0EM-RUN-MODE-LIT = "P I C K I N G";
    set TP0EM-LIT1 magenta;
    set TP0EM-LIT2 magenta;
    set TP0EM-LIT3 magenta;
    set TP0EM-LIT4 magenta;
    set TP0EM-LIT5 magenta;
    set TP0EM-LIT6 magenta;
    set TP0EM-LIT7 magenta;
    set TP0EM-LIT8 magenta;
    set TP0EM-LIT9 magenta, underline;
    set TP0EM-LIT10 magenta, underline;
    set TP0EM-LIT11 magenta, underline;
    set TP0EM-LIT12 magenta, underline;
    set TP0EM-LIT13 magenta, underline;
    set TP0EM-LIT14 magenta, underline;
    set TP0EM-LIT15 magenta, underline;
    set TP0EM-LIT16 magenta, underline;
    set TP0EM-LIT17 magenta, underline;
    set TP0EM-LIT18 magenta, underline;
    set TP0EM-LIT19 magenta, underline;
  end


end // end TP0ES250-RUNMODE

// Check attention identifier
Function TP0ES300-PFKEYS()
   /* ------------------------------------------------------------*/
   /* Check attention identifier used to invoke the transaction.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf1) /* PF1 was pressed*/

    XSPF1(); /* Exit to the HELP facility*/

    TP0EM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* Returned error message*/
    converseLib.validationFailed(); /* Force alarm to sound*/

    exit stack; /* Exit to redisplay map*/

  end

  if (converseVar.eventKey is pf4) /* PF4 was pressed*/

    XSPF4(); /* Exit to system main menu*/

    TP0EM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* Returned error message*/
    converseLib.validationFailed(); /* Force alarm to sound*/

    exit stack; /* Exit to redisplay map*/

  end

  if (converseVar.eventKey is pf3) /* PF3 was pressed*/

    TP0ES350-DEL-UNTAG(); /* delete all untagged fastpick orders*/
                                   /* beforeexiting*/
    COMMAREA.CATOAP = "TP0A"; /* Fast Pick menu*/
    TPWREC.TPWFRMAP = "TP0E"; /* Fast Pick menu*/
    COMMAREA.CAUSERA = TPWREC.TPWGRPLV; /* COMMAREA user area*/

    XSEXIT(); /* Invoke selected application*/

    TP0EM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* Returned error message*/
    converseLib.validationFailed(); /* Force alarm to sound*/
    TP0EM001.XXXPRCNM = "TP0ES300"; /* Error location*/

    exit stack; /* EXIT TO DISPLAY SELECTION MENU*/

  end

  if (converseVar.eventKey is pf10) /* PF10 was pressed*/

    if (XXX-HI-PAGE-NBR > 0)
      TP0ES520-ACTION-CD(); /* PROCESS ACTION CODES ON CURRENT PAG*/
      TP0ES530-UPDATE(); /* spin thru all tsq pages and update*/
                                   /* fastpick table*/
    end
    COMMAREA.CATOAP = "TP0F"; /* Fast Pick menu*/
    COMMAREA.CAFROMAP = "TP0E"; /* Fast Pick menu*/
    TPWREC.TPWFRMAP = "TP0E"; /* Fast Pick menu*/
    COMMAREA.CAUSERA = TPWREC.TPWGRPLV; /* COMMAREA user area*/

    XSEXIT(); /* Invoke selected application*/

    TP0EM001.VAGen_EZEMSG = COMMAREA.CAMSG; /* Returned error message*/
    converseLib.validationFailed(); /* Force alarm to sound*/
    TP0EM001.XXXPRCNM = "TP0ES300"; /* Error location*/

    exit stack; /* EXIT TO DISPLAY SELECTION MENU*/

  end

  if (converseVar.eventKey not enter /* ENTER was not pressed*/
   && converseVar.eventKey not pf7   /* and PF7 was not pressed*/
   && converseVar.eventKey not pf8   /* and PF8 was not pressed*/
   && converseVar.eventKey not pf19  /* and PF19 was not pressed*/
   && converseVar.eventKey not pf20) /* and PF22 was not pressed*/

    converseLib.validationFailed(12); /* Indicate invalid attention key*/
    TP0EM001.XXXPRCNM = "TP0ES300"; /* Process name*/

    exit stack; /* EXIT TO REDISPLAY MAP*/

  end

   /* ------------------------------------------------------------*/
   /* If scroll requested, determine if valid.*/
   /* ------------------------------------------------------------*/
   /* If scroll back was requested, ensure that pages exist.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf7 /* Scroll back request*/
   && XXX-CURR-PAGE-NBR < 2)      /* and no previous pages*/

    converseLib.validationFailed(37); /* No previous page to display*/

  end

   /* ------------------------------------------------------------*/
   /* If scroll forward was requested, ensure that pages exist.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf8 /* Scroll forward request*/
   && XXX-CURR-PAGE-NBR >= XXX-HI-PAGE-NBR)
    converseLib.validationFailed(38); /* No more pages to display*/

  end

   /* ------------------------------------------------------------*/
   /* If err - display.*/
   /* ------------------------------------------------------------*/
  if (converseVar.validationMsgNum != 0) /* Error was found*/
    exit stack; /* Exit to display map*/
  end


end // end TP0ES300-PFKEYS

// UPDATE FASTPICK
Function TP0ES350-DEL-UNTAG()
     /* -----------------------------------------------------------*/
     /* initialize tp10rec to delete untagged orders on fastpick*/
     /* -----------------------------------------------------------*/
  set TP10REC empty; /* io module pass area*/

  if (TPWREC.TPW-SEL-RUN-MODE == "PP") /* picking or scheduling ?*/
    TP10REC.TP10-RUN-MODE = "P"; /* picking*/
  else
    TP10REC.TP10-RUN-MODE = "S"; /* scheduling*/
  end

  TP10REC.XWHCD = TPWREC.XWH-WHSE-CD; /* io data*/
  TP10REC.TP10-CALLING-PGM = "TP0E"; /* io module*/
  TP10REC.TP10-XHDCDFL = "N"; /* request non-special handling*/
  TP10REC.TPW-RQST-TYP = "DU"; /* delete request*/
  call "TP0010" (TP10REC) {isNoRefresh = yes, isExternal = yes}; /* call nikeboth*/
    /* ------------------------------------------------------------*/
    /* check to see if delete was ok.*/
    /* ------------------------------------------------------------*/
  if (TP10REC.TPW-RTRN-SQLCD != 0)
    return; /* Exit to display map*/
  end
end // end TP0ES350-DEL-UNTAG

// EDIT INPUT DATA
Function TP0ES500-INPUT()
  /* -------------------------------------------------------------------*/
  /* COMARE WHAT'S BEEN SAVED TO WHAT'S COMING IN FROM SCREEN   ------*/
  /* IF IT'S CHANGED - VERIFY THE NEW DATA*/
  /* IF THE NEW DATA IS GOOD, A SWITCH GETS SET IN 410 TO ACCESS THE*/
  /* POOL HEADER AND GET NEW DATA FOR THE NEW CRITERIA.*/
  /* -------------------------------------------------------------------*/
  if (converseVar.eventKey is enter)
    TP0EW00.TPWFRD = TP0EW01.TPW-SAVE-FROM-DT;
    TP0EW00.TPWTOD = TP0EW01.TPW-SAVE-TO-DT;
    if (TP0EW00.TPWFYY != TP0EM001.TP0EMFYY || 
    TP0EW00.TPWFMM != TP0EM001.TP0EMFMM || 
    TP0EW00.TPWFDD != TP0EM001.TP0EMFDD || 
    TP0EW00.TPWTYY != TP0EM001.TP0EMTYY || 
    TP0EW00.TPWTMM != TP0EM001.TP0EMTMM || 
    TP0EW00.TPWTDD != TP0EM001.TP0EMTDD || 
    TPWREC.TPW-MIN-UNITS != TP0EM001.TPW-MIN-UNITS || 
    TPWREC.TPW-MAX-PRODS != TP0EM001.TPW-MAX-PRODS)

      TP0ES510-VERIFY-DT(); /* verify new dates entered*/
    else
      if (XXX-HI-PAGE-NBR > 0)
        TP0ES520-ACTION-CD(); /* edit action code for a's or d's*/
        TP0ES530-UPDATE(); /* process adds and deletes*/
      end
    end
  end
end // end TP0ES500-INPUT

// EDIT FROM AND TO DATES
Function TP0ES510-VERIFY-DT()
    /* -------------------------------------------*/
    /* Verify the to date.*/
    /* -------------------------------------------*/

  TP0EW00.TPWTMM = TP0EM001.TP0EMTMM;
  TP0EW00.TPWTDD = TP0EM001.TP0EMTDD;
  TP0EW00.TPWTYY = TP0EM001.TP0EMTYY;
  TP0EW00.TPWTCC = 0;

  set TA2REC empty;

  if (TP0EW00.TPWFDT != 0)
    if (TP0EW00.TPWTYY > 50
     && TP0EW00.TPWTYY <= 99)

      TP0EW00.TPWTCC = 19;
    else

      TP0EW00.TPWTCC = 20;
    end
    TA2REC.TA2GRGGN = TP0EW00.TPWTDT;
    TA2REC.TA2DTOPT = "GREGGREG"; /* Gregorian date*/
    TA2REC.TA2GRTYP = "G"; /* type*/
    TP0ES540-EDIT-DATE(); /* VALIDATE THE DATE*/
    if (TA2REC.TA2RTNCD != 0)
      TA1REC.TA1LOC = "520";
      converseLib.validationFailed(158);
      set TP0EM001.TP0EMTYY bold;
      set TP0EM001.TP0EMTMM bold;
      set TP0EM001.TP0EMTDD cursor, bold;
    end
  end

    /* ---------------------------------------------*/
    /* Verify the from date.*/
    /* ---------------------------------------------*/

  TP0EW00.TPWFMM = TP0EM001.TP0EMFMM;
  TP0EW00.TPWFDD = TP0EM001.TP0EMFDD;
  TP0EW00.TPWFYY = TP0EM001.TP0EMFYY;
  TP0EW00.TPWFCC = 0;

  if (TP0EW00.TPWFDT != 0)
    if (TP0EW00.TPWFYY > 50
     && TP0EW00.TPWFYY <= 99)

      TP0EW00.TPWFCC = 19;
    else

      TP0EW00.TPWFCC = 20;
    end
    TA2REC.TA2GRGGN = TP0EW00.TPWFDT;
    TA2REC.TA2DTOPT = "GREGGREG"; /* Gregorian date*/
    TA2REC.TA2GRTYP = "G"; /* type*/
    TP0ES540-EDIT-DATE(); /* VALIDATE THE DATE*/
    if (TA2REC.TA2RTNCD != 0)
      TA1REC.TA1LOC = "520";
      converseLib.validationFailed(158);
      set TP0EM001.TP0EMFYY bold;
      set TP0EM001.TP0EMFMM bold;
      set TP0EM001.TP0EMFDD cursor, bold;
    end
  end

    /* -------------------------------------------------*/
    /* Set up date for comparison. FROM date must be*/
    /* less than the TO date.*/
    /* -------------------------------------------------*/

  if (TP0EM001.TP0EMFMM == 0
   && TP0EM001.TP0EMFDD == 0
   && TP0EM001.TP0EMFYY == 0)

    TP0EW00.TPWFCC = 0;
  else

    if (TP0EW00.TPWFYY > 50 /* Set up 'FROM' century*/
     && TP0EW00.TPWFYY <= 99)

      TP0EW00.TPWFCC = 19;
    else

      TP0EW00.TPWFCC = 20;
    end
  end

  if (TP0EM001.TP0EMTMM == 0
   && TP0EM001.TP0EMTDD == 0
   && TP0EM001.TP0EMTYY == 0)

    TP0EW00.TPWTCC = 0;
  else

    if (TP0EW00.TPWTYY > 50 /* Set up 'TO' century*/
     && TP0EW00.TPWTYY <= 99)

      TP0EW00.TPWTCC = 19;
    else

      TP0EW00.TPWTCC = 20;
    end
  end

    /* -------------------------------------------------------*/
    /* Check that the beginning date is less than the to date*/
    /* -------------------------------------------------------*/

  if (TP0EW00.TPWFDT > TP0EW00.TPWTDT) /* FROM date > TO date*/

    TA1REC.TA1LOC = "520"; /* Module identification*/
    converseLib.validationFailed(286); /* From DNSB date must be < TO date*/
    set TP0EM001.TP0EMFMM cursor, bold;
    set TP0EM001.TP0EMFDD bold;
    set TP0EM001.TP0EMFYY bold;
    set TP0EM001.TP0EMTMM bold;
    set TP0EM001.TP0EMTDD bold;
    set TP0EM001.TP0EMTYY bold;

  else
    XXX-RQT-DATA-FL = "Y"; /* rebuild tsq pages*/
  end
end // end TP0ES510-VERIFY-DT

// obtain data to display
Function TP0ES520-ACTION-CD()
  /* -------------------------------------------*/
  /* edit the Action codes on the current page*/
  /* -------------------------------------------*/
  XXX-INX-FLD-NBR = 1;

  while (XXX-INX-FLD-NBR <= TP0EW02.TPW-LINES-ON-PAGE)
    if (TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR] == "A"
     || TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR] == "D"
     || TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR] <= " ")
      TP0EW02.TP10-ACTION[XXX-INX-FLD-NBR] = TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR]; /* next sentence;*/
    else
      set TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR] cursor, bold;
      TA1REC.TA1PGMNO = "514"; /* module identificAtion*/
      converseLib.validationFailed(35); /* invAlid Action*/
      exit stack; /* Exit to redisplAy mAp*/

    end
    XXX-INX-FLD-NBR = XXX-INX-FLD-NBR + 1;

  end
  TP0ES-TS-UPDATE();
end // end TP0ES520-ACTION-CD

// UPDATE FASTPICK
Function TP0ES530-UPDATE()
  /* ------------------------------------------------------------*/
  /* now, read all tsq pages and update the fastpick table*/
  /* per the action codes ( adds and deletes)*/
  /* ------------------------------------------------------------*/
  TP0EW00.TPW-CURR-PAGE-NBR-SV = XXX-CURR-PAGE-NBR;
  XXX-CURR-PAGE-NBR = 1; /* point to first page*/

  while (XXX-CURR-PAGE-NBR <= XXX-HI-PAGE-NBR)
    TP0ES-TS-READ();
    XXX-INX-FLD-NBR = 1; /* point to first line*/
    while (XXX-INX-FLD-NBR <= TP0EW02.TPW-LINES-ON-PAGE)
      if (TP0EW02.TP10-ACTION[XXX-INX-FLD-NBR] == "A") /* if Add to fAst*/
        set TP10REC empty;
  /* -------------------------------------------------*/
  /* set the run mode for the database updates*/
  /* -------------------------------------------------*/
        if (TPWREC.TPW-SEL-RUN-MODE == "PP")
          TP10REC.TP10-RUN-MODE = "P";
        else
          TP10REC.TP10-RUN-MODE = "S";
        end

        TP10REC.TPW-RQST-TYP = "A "; /* request type = A*/
        TP10REC.TP10-XHDCDFL = "Y";
        TP10REC.XWHCD = TP0EM001.XWHCD;
        TP10REC.PK1CUOID = TP0EW02.PK1CUOID[XXX-INX-FLD-NBR];
        TP10REC.PK1NORID = TP0EW02.PK1NORID[XXX-INX-FLD-NBR];
        call "TP0010" (TP10REC) {isNoRefresh = yes, isExternal = yes}; /* cAll nikeboth io routine*/

        if (TP10REC.TPW-RTRN-CD != 0)
          VAGen_EZEMSG = "TP0010 FAILED               ";
          exit stack; /* EXIT TO DISPLAY MAP*/
        end
        TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR] = " ";
        TP0EW02.TP10-ACTION[XXX-INX-FLD-NBR] = " ";
        TP0EM001.TP10-EXISTS-IND[XXX-INX-FLD-NBR] = "*";
        set TP0EM001.TP10-EXISTS-IND[XXX-INX-FLD-NBR] red;
        TP0EW02.TP10-EXISTS-IND[XXX-INX-FLD-NBR] = "*";
        TP0EW02.TP10-STATUS-IND[XXX-INX-FLD-NBR] = "1";
        VAGen_EZEMSG = "FASTPICK UPDATES PROCESSED  ";

        XXX-RQT-DATA-FL = "N"; /* don't rebuild tsq's*/
      else

        if (TP0EW02.TP10-ACTION[XXX-INX-FLD-NBR] == "D")
                                   /* if delete fastpick*/
          set TP10REC empty;
          if (TPWREC.TPW-SEL-RUN-MODE == "PP")
            TP10REC.TP10-RUN-MODE = "P";
          else
            TP10REC.TP10-RUN-MODE = "S";
          end

          TP10REC.TPW-RQST-TYP = "D "; /* request type = d*/
          TP10REC.TP10-XHDCDFL = "Y";
          TP10REC.XWHCD = TP0EM001.XWHCD;
          TP10REC.PK1CUOID = TP0EW02.PK1CUOID[XXX-INX-FLD-NBR];
          TP10REC.PK1NORID = TP0EW02.PK1NORID[XXX-INX-FLD-NBR];
          call "TP0010" (TP10REC) {isNoRefresh = yes, isExternal = yes}; /* cAll nikeboth io routine*/
          TP0EM001.TP10-ACTION[XXX-INX-FLD-NBR] = " ";
          TP0EW02.TP10-ACTION[XXX-INX-FLD-NBR] = " ";
          TP0EM001.TP10-EXISTS-IND[XXX-INX-FLD-NBR] = " ";
          TP0EW02.TP10-EXISTS-IND[XXX-INX-FLD-NBR] = " ";
          VAGen_EZEMSG = "FASTPICK UPDATES PROCESSED  ";

          XXX-RQT-DATA-FL = "N"; /* don't rebuild tsq's*/

        end
      end
      XXX-INX-FLD-NBR = XXX-INX-FLD-NBR + 1;
    end
    TP0ES-TS-UPDATE(); /* update the tsq page*/
    XXX-CURR-PAGE-NBR = XXX-CURR-PAGE-NBR + 1; /* point to the next*/
  end /* when done processing all pages*/
  XXX-CURR-PAGE-NBR = TP0EW00.TPW-CURR-PAGE-NBR-SV;
                                   /* reread curr page*/
  TP0ES-TS-READ();
end // end TP0ES530-UPDATE

// Read temporary storage page
Function TP0ES540-EDIT-DATE()
   /* ------------------------------------------------------------*/
   /* validate don't ship before date 'to'*/
   /* ------------------------------------------------------------*/

  TA2REC.TA2DTOPT = "GREGGREG"; /* gregorian date*/
  TA2REC.TA2GRTYP = "G"; /* type*/

  try
    call "TA0040" (TA2REC) {isNoRefresh = yes, isExternal = yes};
  end /* date routine*/

   /* ------------------------------------------------------------*/
   /* Indicate error if the date doesn't pass the verification.*/
   /* ------------------------------------------------------------*/

  if (sysVar.errorCode == "00000000" /* Call successful*/
   && TA2REC.TA2RTNCD < 888)         /* subroutine completed*/

    return; /* Normal return code*/

  else

    TAEREC.TAEDESC1 = sysVar.errorCode;
    TAEREC.TAEDESC2 = TA2REC.TA2GROUP;

    TA1REC.TA1FUNC = "RETN"; /* Termination function*/
    TA1REC.TA1TYPE = "APPL"; /* Type of error*/
    TA1REC.TA1LOC = "DNSB TO DATE";

    call "TA0020" (TA1REC, TAEREC) {isExternal = yes}; /* Error diagnosis routine*/

    TA1REC.TA1PGMNO = "S540"; /* MODULE IDENTIFICATION*/
    converseLib.validationFailed(29); /* System error occurred*/

    return; /* exit to display map*/

  end


end // end TP0ES540-EDIT-DATE

// PROCESS PAGING REQUEST
Function TP0ES600-SCROLL()
   /* ------------------------------------------------------------*/
   /* If scroll backward was requested, decrement the page number.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf7) /* Scroll back requested*/

    TP0ES520-ACTION-CD();
                  /* update current tsq page with any action codes entered*/
    XXX-CURR-PAGE-NBR = XXX-CURR-PAGE-NBR - 1;
                                   /* Decrement page number*/

    XXX-RQT-DATA-FL = "N"; /* DONT READ DATABASE*/
    XXX-MAP-FMAT-FL = "Y"; /* Format the map flag*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* If scroll forward was requested, increment the page number.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf8) /* Scroll forward requested*/

    TP0ES520-ACTION-CD();
              /* UPDATE CURRENT TSQ PAGE WITH ANY ACTION CODES ENTERED*/
    XXX-CURR-PAGE-NBR = XXX-CURR-PAGE-NBR + 1;
                                   /* Increment page number*/

    XXX-RQT-DATA-FL = "N"; /* DONT READ DATABASEP FLAG*/
    XXX-MAP-FMAT-FL = "Y"; /* Format the map flag*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* If first page was requested, move 1 to the page number.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf19) /* first page requested*/

    XXX-CURR-PAGE-NBR = 1;
                                   /* point to 1st page*/

    XXX-MAP-FMAT-FL = "Y"; /* Format the map flag*/

    return; /* Return to previous process*/

  end

   /* ------------------------------------------------------------*/
   /* If last  page was requested, move hi page to page nbr.*/
   /* ------------------------------------------------------------*/

  if (converseVar.eventKey is pf20) /* last  page requested*/

    move XXX-HI-PAGE-NBR to XXX-CURR-PAGE-NBR withV60Compat;
                                   /* point to last page*/

    XXX-MAP-FMAT-FL = "Y"; /* Format the map flag*/

    return; /* Return to previous process*/

  end

end // end TP0ES600-SCROLL

//*** RECORD=TP0EW00 ****
// ----------------------------
// Application working storage.
// ----------------------------
// ***********************
Record TP0EW00 type basicRecord
  3 * char(19) ; // Map from date-ccyymmdd
    10 TPWFDT TPWFDT ; 
      15 TPWFCC TPWFCC ; 
      15 TPWFRD TPWFRD ; 
        20 TPWFYY TPWFYY ; 
        20 TPWFMM TPWFMM ; 
        20 TPWFDD TPWFDD ; 
    10 TPWTDT TPWTDT ; 
      15 TPWTCC TPWTCC ; 
      15 TPWTOD TPWTOD ; 
        20 TPWTYY TPWTYY ; 
        20 TPWTMM TPWTMM ; 
        20 TPWTDD TPWTDD ; 
    10 TPW-CURR-PAGE-NBR-SV TPW-CURR-PAGE-NBR-SV ; 
    10 TPW-UPDT-TSQ-IND TPW-UPDT-TSQ-IND ; 
end // end TP0EW00

//*** RECORD=TP0EW01 ****
// ----------------------------
// Application working storage.
// ----------------------------
// ***********************
Record TP0EW01 type basicRecord
  3 TP0EW-WORK-STORAGE TP0EW-WORK-STORAGE ; 
    10 TPW-SAVE-FROM-DT TPW-SAVE-FROM-DT ; 
    10 TPW-SAVE-TO-DT TPW-SAVE-TO-DT ; 
    10 TPW-SAVE-UNITS TPW-SAVE-UNITS ; 
    10 TPW-SAVE-PRODS TPW-SAVE-PRODS ; 
    10 TPW-CNT TPW-CNT ; 
    10 XXX-CURR-PAGE-NBR XXX-CURR-PAGE-NBR ; 
    10 XXX-HI-PAGE-NBR XXX-HI-PAGE-NBR ; 
    10 XXX-INX-FLD-NBR XXX-INX-FLD-NBR ; 
    10 XXX-INX-LMT-NBR XXX-INX-LMT-NBR ; 
    10 XXX-MAP-FMAT-FL XXX-MAP-FMAT-FL ; 
    10 XXX-MSG-LOC-ID XXX-MSG-LOC-ID ; 
    10 XXX-RQT-DATA-FL XXX-RQT-DATA-FL ; 
end // end TP0EW01

//*** RECORD=TP0EW02 ****
// ----------------------------
// Application working storage.
// ----------------------------
// ***********************
Record TP0EW02 type basicRecord
  3 TP0EW-TSQ-PAGE TP0EW-TSQ-PAGE ; 
    10 XXX-TEMP-STG-LNTH XXX-TEMP-STG-LNTH ; 
    10 TPW-LINES-ON-PAGE TPW-LINES-ON-PAGE ; 
    10 TP0EW-TSQ-LINE TP0EW-TSQ-LINE [11] ; 
      15 TP10-ACTION TP10-ACTION ; 
      15 TP10-EXISTS-IND TP10-EXISTS-IND ; 
      15 TP10-STATUS-IND TP10-STATUS-IND ; 
      15 TP10-DNSB TP10-DNSB ; 
      15 TP10-ORDER-NBR TP10-ORDER-NBR ; 
      15 PK1CUOID PK1CUOID ; 
      15 PK1NORID PK1NORID ; 
      15 TF1CARCD TF1CARCD ; 
      15 CU-CO-NM CU-CO-NM ; 
      15 TP10-PRODS TP10-PRODS ; 
      15 TP10-FC-QTY TP10-FC-QTY ; 
      15 TP10-RP-QTY TP10-RP-QTY ; 
      15 TPW-XHDCD1 TPW-XHDCD1 ; 
      15 TPW-XHDCD2 TPW-XHDCD2 ; 
      15 TPW-XHDCD3 TPW-XHDCD3 ; 
      15 TP10-UOM-FL TP10-UOM-FL ; 
end // end TP0EW02

DataItem TP0EW-TSQ-LINE char(95)  {
  align = none, fillCharacter = nullFill, inputRequired = no
}
end

// SY_STY_NBR
DataItem TP0EW-TSQ-PAGE char(1051)  {
  align = none, fillCharacter = nullFill, inputRequired = no
}
end

DataItem TP0EW-WORK-STORAGE char(46)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

