package ob0i;
import corpcom1.*;
import corpcom2.*;
import corpcom4.*;
import corpcom5.*;
import corpcom6.*;
import corpcom7.*;
import corpx1.*;
import corpx2.*;
import corpy2.*;
import corpz3.*;
import dg.common.*;
import ku.common.*;
import ob.common.*;
import op.common.*;
import sm.common.*;
import sp.common.*;
import sy.common.*;
import ta.common.*;
import tf.common.*;
//*** PROGRAM=OB0I ****
// APPLICATION OVERVIEW:
// 
// This application is entered through the use of the PF16 key,
// from one of the following eight applications:
//     OB0C - Customer Identification
//     OB0D - Header
//     OB0E - Miscellaneous Header
//     OB0J - Instructions
//     OB0K - Comments
//     OB0L - Errors
//     OB0M - Hold/Release
//     OB0N - Add Product
// It will display address information for the customer being
// displayed when the PFkey is pressed.
// 
// It may also be entered from OB0L (Errors) and OB0M (Hold/
// Release) by selecting an error or hold that can be fixed by
// this application.
// 
// Three different addresses are displayed:
// 1.  Store Address, which is the default and cannot be
//     changed
// 2.  Bill To Address, which cannot be changed but may be a
//     default, an override or a one-time
// 3.  Ship To Address, which may be the default, an override
//     or a one-time, and can be modified.
// 
// 
//   DATE      NAME    DESCRIPTION OF CHANGE
// --------   ------   ----------------------------------------
// 06/05/90   ZLEFKO   Create Program
// 02/05/91   CRAINE   Chg to use KUCBLAID instead of KUABLGRP
//                     Removed KUAREC since it's being deinstal
//                     led. Chg'd map, S01, S12, S14, S16, S30
//                     and added OB0IWCID to OB0IW01
// 02/15/91   dmeier   regen for database changes
// 05/28/91   dharri   #642 -display dept self id on addr 1 for
//                     ship to address if default or override.
// 05/30/91   dharri   #642 -added dept = 0 edit
// 02/11/92   JSHANN   Enhanced to handle International addrs.
// 03/11/92   jwils1   db changes - removed  use  of op1bgrpo
//                     from map, s12, and s30.
// 03/20/92   tmorri   modified 000, 010, s30 - updates not
//                     allowed for order status 'ca' or 'cl'.
// 11/09/93   craine   db changes - kulrec addresses changed to
//                     38 char. See comment in s62. Changed
//                     OB0IW01 (added xxxaddr1,2,3) s14, s20,
//                     s28, s62.
// 05/19/94   scantr   virtual airspeed project: chgd obwrec,
//                     xsobs02, xsobs03, added xsobs10
// 05/24/94   scantr   changed xsobs03
// 06/15/94   CRAINE   REWRITE TO CALL RELATIONAL EDIT
// 08/18/94   craine   changes to xsobs-limited-edit,
//                     xsobs-full-edit.
// 08/30/94   craine   changes to xsobs-full-edit and block dl
//                     and ld orders from updating
// 09/06/94   craine   change to obwrec
// 10/06/94   craine   add new xsobs-add-new-oba
// 10/25/94   craine   change to obwrec
// 01/30/94   craine   chg to xsobs-upd-oba-edit
// 04/27/95   craine   allow for new yobcd 'pd' and 'lp'.
// 08/02/95   DLIDDL   Modified to incorporate Nike Canada into
//                     AIRSPEED - OB0IS14, OB0IS20, OB0IS27,
//                     OB0IS28, OB0IS40.
//                     Removed statement group OB0IS44 from
//                     OB0IS40 to prevent ship to state code
//                     edit. This will be processed by the
//                     AIRSPEED batch edits.
// 08/07/95   CRAINE   Database changes.
// 06/03/97   rgilli   YR2000 - Regen to ensure correct ver.
//                              of xx0xs01 is included.
// 10/28/97   SATYAM   Added edit in OB0IS73, before calling
//                     iomod IO5190 to check whether any rows
//                     exist with the same key values in
//                     dordb.vobadr01 table. If it exists then
//                     it skips inserting row in dordb.vobadr01
//                     instead it updates the row. And in the
//                     case of updation. A new statement group
//                     OB0IS18 has been introduced to call the
//                     IO mod IO5190 for selecting rows with
//                     new key fields (ie with BILL-IND).
// 01/14/00   SBHARA   TT#3655
//                     Modified the proc OB0I010  For the SPAIN
//                     Project.This is modified to call
//                     OB1600 with a super edit option
//                     instead of limited edit option
//                     Please see the ob1600 Documentation
//                     block for more details
//                     Also we added a new functionality to
//                     Edit the country code for onetime shipto
//                     Statement Groups OB0I010
//                     OB0IS27,OB0IS28,OB0IS30,OB0IS40,OB0IS41
//                     OB0IS62,OB0IS73,OB0IS-EDIT-SHIPTO
//                     were modified and new statement group
//                     added  ob0is-edit-state,ob0is42
// 
// 
// 
// *********************
Program OB0I type textUIProgram //VAGen Info - main text program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes, 
  msgTablePrefix = "OB00", inputRecord = COMMAREA, segmented = yes
  }

  // Data Declarations
  COMMAREA COMMAREA ; // record
  ERRSQLCA ERRSQLCA; // record
  KUCREC KUCREC; // record
  KUJREC KUJREC; // record
  KULREC KULREC; // record
  KUMREC KUMREC; // record
  OB0IW01 OB0IW01; // record
  OB1REC OB1REC; // record
  OB5REC OB5REC; // record
  OB8REC OB8REC; // record
  OBAREC OBAREC; // record
  OBBREC OBBREC; // record
  OBCREC OBCREC; // record
  OBDREC OBDREC; // record
  OBEREC OBEREC; // record
  OBFEREC OBFEREC; // record
  OBFREC OBFREC; // record
  OBLEREC OBLEREC; // record
  OBWREC OBWREC; // record
  SQLCA SQLCA; // record
  TA1REC TA1REC; // record
  TA5REC TA5REC; // record
  TAEREC TAEREC; // record
  XX0XW01 XX0XW01; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use XCTTBL {deleteAfterUse = yes}; // table
  use XSTTBL {deleteAfterUse = yes}; // table
  use OB0IM.OB0IM001 // form
   {
    pfKeyEquate = no
  };

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    OB0I000: OB0I000();
    goto OB0I010;
    OB0I010: OB0I010();
    goto OB0I010;
  end // end main
end // end OB0I

// OB0I EXECUTE STATEMENT
Function OB0I000()
     /* Check csp and order batch security*/

  XSENTRY();
  XSOBS01();

     /* Initialize application - init records, get zz date/time,*/
                              /* save map name for XSOBE## sgrp's*/
  OB0IS01();

     /* Set -911 processing flag*/

  OBWREC.OBWER911 = "N";

     /* Determine if batch edit is running*/

  XSOBS02();

     /* Read current order header*/

  XSOBS03();


     /* Display commarea message*/

  OB0IM001.CAMSG = OBWREC.CAMSG;
  OBWREC.CAMSG = " ";


     /* Build map for display*/

  OB0IS05();


     /* Edit map*/

  if (OB1REC.OB1PARLF != "Y" /* if not partial load*/
   && OB1REC.YOBCD != "XL"   /* if not cancelled*/
   && OB1REC.YOBCD != "CA"   /* if hasn't cleared availability*/
   && OB1REC.YOBCD != "LP"   /* if hasn't lost demand reported*/
   && OB1REC.YOBCD != "PD")  /* if hasn't postponed demand rptd*/
    OB0IS40();
  end

end // end OB0I000

// OB0I CONVERSE ROUTINE
Function OB0I010()
       /* ************************************************/
       /* *  MODIFIED FOR SPAIN TRADEMARK PROJECT      **/
       /* *  SBHARA 02/21/00                           **/
       /* ************************************************/

  converseLib.clearScreen();
  
  converseVar.segmentedMode = 1; /* force segmented converse mode*/
  OBWREC.OBWER911 = "Y"; /* -911 processing flag*/

  converse OB0IM001 ;

      /* init error stuff*/

  OBWREC.OBWERRFL = "N";
  converseLib.validationFailed(0);
  OBWREC.OBWHELP = OB0IM001.CAMSG; /* save for help screen*/
  OB0IM001.CAMSG = " ";

      /* Reset field attributes*/

  OB0IS30();

      /* Edit map (no matter what pfkey was used)*/

  if (OB1REC.YOBCD != "XL" /* if not cancelled*/
   && OB1REC.YOBCD != "CA" /* if hasn't cleared availability*/
   && OB1REC.YOBCD != "LP" /* if hasn't lost demand reported*/
   && OB1REC.YOBCD != "PD") /* if hasn't postponed demand*/
    OB0IS40(); /* edit map*/

    if (OBWREC.OBWERRFL == "N" /* no errors*/
     && converseVar.eventKey is enter) /* and ENTER key pressed*/
      OB0IS60(); /* update*/

      /* if something changed on the order*/
      /* call relational edit subprogram*/
      /* this edit option is been changed to superedit*/
      /* for spain project  sbhara 01/14/2000*/
       /* spain trademark project sbhara 02/21/00  changes begin*/
      if (OB0IW01.OB0IWUPD == "Y")
        /* MOVE '3' TO OBWREC.OBW-EDIT-FUNCTION;/* edit address info*/
        OBWREC.OBW-EDIT-FUNCTION = "1"; /* superedit spain project*/
        XSOBS-ONLINE-EDIT();
      end

    end

  end
       /* spain trademark project sbhara 02/21/00  changes end*/

      /* Edit PF keys*/

  OB0ISPF();

end // end OB0I010

// Edit International Shipto id
Function OB0IS-EDIT-SHIPTO()
       /* **************************************************/
       /* *       EDIT internatial SHIP TO ADDR ID        **/
       /* **************************************************/
       /* *Modified to handle the ship id change for NIL**/
       /* *spain trademark project sbhara 02/21/00**/
       /* **************************************************/
  if (OB0IM001.OP1SHAID != OB1REC.OP1SHAID) /* field is changed*/
    set KULREC empty;
    KULREC.KULAAID = OB0IM001.OP1SHAID;
    KULREC.KUCCOID = OB1REC.KUCCOID;
    OB0IS19(); /* call io0170 to read kulrec*/

    if (SQLCA.VAGen_SQLCODE == 100) /* kulrec not found*/
      if (OB0IM001.OP1SHAID == OB0IM001.KUMSTAID)
                                   /* shp aid = str aid, defaul*/
        converseLib.validationFailed(47); /* no default ship to addr found*/
        OBWREC.OBWERRFL = "Y"; /* set error flag*/
        set OB0IM001.OP1SHAID cursor, bold;
      else /* shpto addr id not = store addr id,*/
                                   /* override*/
        converseLib.validationFailed(48); /* ship to addr not found for rqstd addr*/
                                   /* id*/
        OBWREC.OBWERRFL = "Y"; /* set error flag*/
        set OB0IM001.OP1SHAID cursor, bold;
      end
    end
       /* spain trademark project sbhara 02/21/00  changes begin*/
       /* the following three lines of code  been commented*/
    /* MOVE 48 TO EZEMNO;           /* no default ship to addr found*/
    /* MOVE 'Y' TO OBWREC.OBWERRFL; /* set error flag*/
    /* SET OB0IM001.OB0IM-001-NIL-ADDRID CURSOR,BRIGHT;*/
    /* END;*/
     /*  */
       /* spain trademark project sbhara 02/21/00  changes end*/
     /* For international orders the store address is the same as the*/
     /* ship-to address.  The following move is to move the store address*/
     /* from the map to the shpid address on the ob1rec.  International*/
     /* users are allowed to change the address id for store on map*/
     /* OB0IM001.  International users are not allow enter a one-time*/
     /* ship-to address.  All international address must be in the*/
     /* address tables.*/
     /*  */
    if (OBWREC.OBWERRFL == "N")
      /* MOVE OB0IM001.OB0IM-001-NIL-ADDRID TO OB0IM001.OP1SHAID;*/
      OB0IW01.OB0IWUPD = "Y";
    end
  end


end // end OB0IS-EDIT-SHIPTO

// edit/save ship to name/addr
Function OB0IS-EDIT-STATE()



      /* *********************************************************/
      /* * this statement group edits the state code            **/
      /* * New statement group added for spain trademark project**/
      /* * sbhara 03/16/00                                      **/
      /* * to edit the shipto state code for usa and cana       **/
      /* *********************************************************/


  if (OB0IM001.XCTCD-1 == "USA") /* if shipto country code is usa*/
    if (OB0IM001.OB0IMSST in XSTTBL.XSTCD /* valid code*/
     && XSTTBL.XXXSTAT[sysVar.arrayIndex] == "A") /* active status*/
      /* next sentence*/
    else
      converseLib.validationFailed(043); /* state code is not valid*/
      OBWREC.OBWERRFL = "Y";
      set OB0IM001.OB0IMSST cursor, bold;
      return;
    end
  end
  if (OB0IM001.XCTCD-1 == "CANA") /* if shipto country code is cana*/
    if (OB0IM001.OB0IMSST != " " /* valid code*/
    )                            /* next sentence*/
    else
      converseLib.validationFailed(043); /* state code is not valid*/
      OBWREC.OBWERRFL = "Y";
      set OB0IM001.OB0IMSST cursor, bold;
      return;
    end
  end
end // end OB0IS-EDIT-STATE

// INITIALIZE OB0I APPLICATION
Function OB0IS01()
       /* ***************************************************/
       /* *  INITIALIZE OB0I APPLICATION.                  **/
       /* ***************************************************/

  set KUCREC empty;
  set KULREC empty;
  set KUMREC empty;
  set OBAREC empty;
  set OBBREC empty;
  set OBCREC empty;
  set OBDREC empty;
  set OBEREC empty;
  set OBFREC empty;
  set OB1REC empty;
  set OB5REC empty;
  set OB8REC empty;
  set OBFEREC empty;
  set OBLEREC empty;
  set TAEREC empty;
  set TA1REC empty;
  set TA5REC empty;
  set SQLCA empty;
  set ERRSQLCA empty;
  set XX0XW01 empty;

  set OB0IM001 empty;
  set OB0IW01 empty;

  XX0XS01();
  OBWREC.ZZZCHGDT = XX0XW01.XX0XWDAT;
  OBWREC.ZZZCHGTM = XX0XW01.XX0XWTIM;

  TA1REC.TA1MAP = "OB0IM001"; /* map name*/


end // end OB0IS01

// BUILD OB0I MAP
Function OB0IS05()
       /* ****************************************************/
       /* *  BUILD OB0I MAP.                                **/
       /* ****************************************************/

  OB0IS10(); /* move header data to map*/

  OB0IS12(); /* move bill-to addr data to map*/

  OB0IS20(); /* move store addr data to map*/

  OB0IS25(); /* move ship-to addr data to map*/

  OB0IS30(); /* reset field attributes*/


end // end OB0IS05

// MOVE HEADER DATA TO MAP
Function OB0IS10()
       /* ****************************************************/
       /* *  MOVE HEADER INFORMATION TO MAP.                **/
       /* ****************************************************/

  OB0IM001.OB0IMPRC = "OB0I010"; /* process name*/
  OB0IM001.OBWCDATE = OBWREC.OBWCDATE; /* current date*/

  OB0IM001.OBWORDER = OBWREC.OBWORDER; /* formatted order number*/
  OB0IM001.OBWCUST = OBWREC.OBWCUST; /* formatted customer number*/
  OB0IM001.OP1CUPO = OBWREC.OP1CUPO; /* purchase order number*/
  OB0IM001.KUMSTRNM = OBWREC.KUMSTRNM; /* customer store name*/


end // end OB0IS10

// MOVE BILL TO ADDRESS TO MAP
Function OB0IS12()
       /* ****************************************************/
       /* *    MOVE BILL TO ADDRESS TO MAP.                 **/
       /* ****************************************************/

  set KUCREC empty;

  KUCREC.KUCCOID = OB1REC.KUCCOID;
  OB0IS16(); /* call IO0240 to read KUCREC*/

  OB0IM001.KUCBLAID = KUCREC.KUCBLAID; /* address id*/
  OB0IM001.OP1BLAID = OB1REC.OP1BLAID; /* bill grp addr id*/

  if (OB1REC.OP11TMBF == "Y")
    OB0IS13(); /* build map from address record*/
  else
    OB0IS14(); /* build map from obwrec & kulrec*/
  end


end // end OB0IS12

// BUILD MAP FROM ADDRESS RECORD
Function OB0IS13()
       /* ****************************************************/
       /* *    BUILD MAP FROM ADDRESS RECORD                **/
       /* ****************************************************/

  OB5REC.OP1PARTN = OB1REC.OP1PARTN;
  OB5REC.OP1CUOID = OB1REC.OP1CUOID;
  OB5REC.OP1NORID = OB1REC.OP1NORID;
  OB5REC.OP5BILIN = "Y"; /* bill indicator*/
  OB5REC.OP5SHPIN = "N"; /* ship indicator*/
  OB0IS17(); /* call IO5190 to read OB5REC*/

  OB0IM001.OB0IMBNM = OB5REC.OP5ALTNM; /* billing grp name*/
  OB0IM001.OB0IMBA1 = OB5REC.XXXADDR[1]; /* bill addr line 1*/
  OB0IM001.OB0IMBA2 = OB5REC.XXXADDR[2]; /* bill addr line 2*/
  OB0IM001.OB0IMBA3 = OB5REC.XXXADDR[3]; /* bill addr line 3*/
  OB0IM001.OB0IMBCT = OB5REC.XXXCITY; /* bill city*/
  OB0IM001.OB0IMBST = OB5REC.XSTCD; /* bill state*/
  OB0IM001.OB0IMBZP = OB5REC.XXXZIP; /* bill zip code*/


end // end OB0IS13

// BUILD MAP FROM OBW & KULREC
Function OB0IS14()
       /* ****************************************************/
       /* *    BUILD MAP FROM OBWREC & KULREC               **/
       /* ****************************************************/

  set KULREC empty;

  KULREC.KUCCOID = OB1REC.KUCCOID;
  KULREC.KULAAID = KUCREC.KUCBLAID;
  OB0IS19(); /* call IO0170 to read KULREC*/

  OB0IM001.OB0IMBNM = OBWREC.KUMSTRNM;
  OB0IM001.OB0IMBA1 = KULREC.XXX-ADDR1;
  OB0IM001.OB0IMBA2 = KULREC.XXX-ADDR2;
  OB0IM001.OB0IMBA3 = KULREC.XXX-ADDR3;
  OB0IM001.OB0IMBCT = KULREC.XXXCITY;
  OB0IM001.OB0IMBST = KULREC.XSTCD;
  OB0IM001.OB0IMBZP = KULREC.XXXZIP;
   /*  */
   /* Move country fields to map for international orders.*/
   /*  */
   /* CANADA 08/02/95*/
   /*  */
   /* Move country fields to map for Canadian customers also.*/
   /*  */
  if (OB1REC.XDVCD == "02"
   || OB1REC.XDZ-DATA-DIST-CD == "CA") /* CANA Canadian order*/
    OB0IM001.XCTCD-3 = KULREC.XCTCD;
    if (KULREC.XCTCD in XCTTBL.XCTCD)
      OB0IM001.XCTDESC-3 = XCTTBL.XCTDESC[sysVar.arrayIndex];
    end
  end


end // end OB0IS14

// SELECT COMPANY RECORD
Function OB0IS16()
       /* **************************************************/
       /* *    READ COMPANY RECORD                        **/
       /* **************************************************/

  set SQLCA empty;

  call "IO0240" ("S ", SQLCA, KUCREC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue                    ;    OK*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* record not found*/
       /* continue*/
    else
      TA1REC.TA1LOCAT[1] = "S "; /* transaction*/
      TA1REC.TA1LOCAT[2] = "IO0240"; /* i/o mod*/
      TA1REC.TA1LOCAT[3] = "OB0IS16"; /* stmt group*/
      OB0IW01.OB0IWCID = KUCREC.KUCCOID;
      TA1REC.TA1LOCAT[4] = OB0IW01.OB0IWCID;
      TA1REC.TA1DBASE = "DCUST"; /* database name*/
      TA1REC.TA1TBLVU = "VCMPNY01"; /* database view name*/
      if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
        XSOBS04();
      else /* all other codes - abort*/
        XSOBEDC();
      end
    end
  end


end // end OB0IS16

// SELECT 1-TIME ORDER ADDRESS
Function OB0IS17()
       /* **************************************************/
       /* *    SELECT 1-TIME ORDER ADDRESS                **/
       /* **************************************************/

  set SQLCA empty;

  call "IO5190" ("S ", SQLCA, OB5REC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue                    ;    OK*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* record not found*/
       /* continue*/
    else
      TA1REC.TA1LOCAT[1] = "S "; /* transaction*/
      TA1REC.TA1LOCAT[2] = "IO5190"; /* i/o mod*/
      TA1REC.TA1LOCAT[3] = "OB0IS17"; /* stmt group*/
      TA1REC.TA1LOCAT[4] = OB5REC.OP5SHPIN; /* stmt group*/
      TA1REC.TA1DBASE = "DORDB"; /* database name*/
      TA1REC.TA1TBLVU = "VOBADR01"; /* database view name*/
      if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
        XSOBS04();
      else /* all other codes - abort*/
        XSOBEDC();
      end
    end
  end


end // end OB0IS17

// SELECT 1-TIME ORDER ADDRESS
Function OB0IS18()

       /* **************************************************/
       /* *    SELECT 1-TIME ORDER ADDRESS                **/
       /* **************************************************/

  set SQLCA empty;

  call "IO5190" ("SA", SQLCA, OB5REC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue                    ;    OK*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* record not found*/
       /* continue*/
    else
      TA1REC.TA1LOCAT[1] = "SA"; /* transaction*/
      TA1REC.TA1LOCAT[2] = "IO5190"; /* i/o mod*/
      TA1REC.TA1LOCAT[3] = "OB0IS17"; /* stmt group*/
      TA1REC.TA1LOCAT[4] = OB5REC.OP5SHPIN; /* stmt group*/
      TA1REC.TA1DBASE = "DORDB"; /* database name*/
      TA1REC.TA1TBLVU = "VOBADR01"; /* database view name*/
      if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
        XSOBS04();
      else /* all other codes - abort*/
        XSOBEDC();
      end
    end
  end


end // end OB0IS18

// SELECT CUSTOMER ADDR REC
Function OB0IS19()
       /* **************************************************/
       /* *    SELECT CUSTOMER ADDR REC                   **/
       /* **************************************************/

  set SQLCA empty;

  call "IO0170" ("S ", SQLCA, KULREC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue                    ;    OK*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* record not found*/
       /* continue*/
    else
      TA1REC.TA1LOCAT[1] = "S "; /* transaction*/
      TA1REC.TA1LOCAT[2] = "IO0170"; /* i/o mod*/
      TA1REC.TA1LOCAT[3] = "OB0IS19"; /* stmt group*/
      OB0IW01.OB0IWAID = KULREC.KULAAID; /* format addr id*/
      TA1REC.TA1LOCAT[4] = OB0IW01.OB0IWAID; /* stmt group*/
      TA1REC.TA1LOCAT[4] = " ";
      TA1REC.TA1DBASE = "DCUST"; /* database name*/
      TA1REC.TA1TBLVU = "VADDR001"; /* database view name*/
      if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
        XSOBS04();
      else /* all other codes - abort*/
        XSOBEDC();
      end
    end
  end


end // end OB0IS19

// MOVE STORE ADDRESS TO MAP
Function OB0IS20()
       /* ****************************************************/
       /* *  MOVE STORE ADDRESS TO MAP.                     **/
       /* *  modified for spain trademark project           **/
       /* *  sbhara 03/17/00                                **/
       /* ****************************************************/

  set KUMREC empty;

  KUMREC.KUCCOID = OB1REC.KUCCOID;
  KUMREC.KUMSTRID = OB1REC.KUMSTRID;
  OB0IS22(); /* call IO0340 to read KUMREC*/

  KULREC.KUCCOID = OB1REC.KUCCOID;
  KULREC.KULAAID = KUMREC.KUMSTAID;

   /* International orders, uses store from ob1rec. The store address is*/
   /* the ship-to address for international orders.*/
   /* spain trademark project sbhara 02/21/00  changes begin*/
   /* IF OB1REC.XDVCD = '02';*/
   /* MOVE OB1REC.OP1SHAID TO KULREC.KULAAID;*/
   /* END;*/

  OB0IS19(); /* call io0170 to read kulrec*/

   /*  */
   /* move store address from kulrec rather than kumrec; this change*/
   /* was made for international orders.  In eather case kulrec has*/
   /* the corrrect store address id.*/
   /*  */
   /* MOVE KUMREC.KUMSTAID TO OB0IM001.KUMSTAID;    /* store address id*/
       /* spain trademark project sbhara 02/21/00  changes end*/
  OB0IM001.OB0IMSTN = KUMREC.KUMSTRNM; /* short store name*/
  OB0IM001.OB0IMST1 = KULREC.XXX-ADDR1; /* store addr line 1*/
  OB0IM001.OB0IMST2 = KULREC.XXX-ADDR2; /* store addr line 2*/
  OB0IM001.OB0IMST3 = KULREC.XXX-ADDR3; /* store addr line 3*/
  OB0IM001.OB0IMSTC = KULREC.XXXCITY; /* store city*/
  OB0IM001.OB0IMSTS = KULREC.XSTCD; /* store state*/
  OB0IM001.OB0IMSTZ = KULREC.XXXZIP; /* store zip code*/
   /*  */
   /* Move the country code and description to the map for internatioanl*/
   /* orders.*/
   /*  */
   /* CANADA 08/02/95*/
   /*  */
   /* Move the country code and description for Canadian customers also.*/
       /* spain trademark project sbhara 02/21/00  changes begin*/
   /* IF OB1REC.XDVCD = '02';*/
   /* MOVE KULREC.KULAAID TO OB0IM001.OB0IM-001-NIL-ADDRID;/* ENTER ONLY*/
   /* MOVE KULREC.XCTCD TO OB0IM001.XCTCD-2;/* move country code*/
   /* IF KULREC.XCTCD IN XCTTBL.XCTCD;*/
   /* MOVE XCTTBL.XCTDESC(EZETST) TO OB0IM001.XCTDESC-2;*/
   /* END;*/
   /* ELSE;*/
  OB0IM001.KUMSTAID = KULREC.KULAAID; /* DISPLAY ONLY*/
   /* IF OB1REC.XDZ-DATA-DIST-CD = 'CA';/* CANA Canadian customer*/
  OB0IM001.XCTCD-2 = KULREC.XCTCD; /* move country code*/
  if (KULREC.XCTCD in XCTTBL.XCTCD)
    OB0IM001.XCTDESC-2 = XCTTBL.XCTDESC[sysVar.arrayIndex];
  end
   /* END;*/
   /* END;*/

       /* spain trademark project sbhara 02/21/00  changes end*/
end // end OB0IS20

// SELECT KUMREC
Function OB0IS22()
       /* **************************************************/
       /* *    READ KUMREC                                **/
       /* **************************************************/

  set SQLCA empty;

  call "IO0340" ("S ", SQLCA, KUMREC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue                    ;    OK*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* record not found*/
       /* continue*/
    else
      TA1REC.TA1LOCAT[1] = "S "; /* transaction*/
      TA1REC.TA1LOCAT[2] = "IO0340"; /* i/o mod*/
      TA1REC.TA1LOCAT[3] = "OB0IS22"; /* stmt group*/
      TA1REC.TA1DBASE = "DORDB"; /* database name*/
      TA1REC.TA1TBLVU = "VOBADR01"; /* database view name*/
      if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
        XSOBS04();
      else /* all other codes - abort*/
        XSOBEDC();
      end
    end
  end


end // end OB0IS22

// MOVE SHIP TO ADDRESS TO MAP
Function OB0IS25()
       /* ****************************************************/
       /* *  MOVE SHIP TO ADDRESS TO MAP.                   **/
       /* ****************************************************/

  OB0IM001.OP1SHAID = OB1REC.OP1SHAID; /* ship grp addr id*/

  if (OB1REC.OP1SGPAO == "Y")
    OB0IM001.OP1SGPAO = "*"; /* ship grp ovrd ind*/
  else
    OB0IM001.OP1SGPAO = " ";
  end

  if (OB1REC.OP11TMSF == "Y")
    OB0IS27(); /* build map from address record*/
  else
    OB0IS28(); /* build map from obwrec & kulrec*/
  end


end // end OB0IS25

// MOVE SHIP TO ADDRESS TO MAP
Function OB0IS27()
       /* ****************************************************/
       /* *  MOVE SHIP TO ADDRESS TO MAP.                   **/
       /* ****************************************************/
       /* * modified for spain trademark project            **/
       /* * sbhara 02/21/00                                 **/
       /* ****************************************************/

  set OB5REC empty;

  OB5REC.OP1PARTN = OB1REC.OP1PARTN;
  OB5REC.OP1CUOID = OB1REC.OP1CUOID;
  OB5REC.OP1NORID = OB1REC.OP1NORID;
  OB5REC.OP5BILIN = "N"; /* bill indicator*/
  OB5REC.OP5SHPIN = "Y"; /* ship indicator*/
  OB0IS17(); /* call IO5190 to read OB5REC*/

  OB0IM001.OB0IMSNM = OB5REC.OP5ALTNM; /* ship grp name*/
  OB0IM001.OB0IMSA1 = OB5REC.XXXADDR[1]; /* ship address 1*/
  OB0IM001.OB0IMSA2 = OB5REC.XXXADDR[2]; /* ship address 2*/
  OB0IM001.OB0IMSA3 = OB5REC.XXXADDR[3]; /* ship address 3*/
  OB0IM001.OB0IMSCT = OB5REC.XXXCITY; /* ship city*/
  OB0IM001.OB0IMSST = OB5REC.XSTCD; /* ship state*/
  OB0IM001.OB0IMSZP = OB5REC.XXXZIP; /* ship zip code*/

  /* CANADA 08/02/95*/
       /* spain trademark project sbhara 02/21/00  changes begin*/
   /* existing code commented and replaced with new code*/
   /* move country code to the map for all the countries*/

   /* IF OB1REC.XDZ-DATA-DIST-CD = 'CA';      /* CANA Canadian customer*/
   /* MOVE OB5REC.XCTCD TO OB0IM001.XCTCD-1;/* CANA move country code*/
   /* IF OB5REC.XCTCD IN XCTTBL.XCTCD;*/
   /* MOVE XCTTBL.XCTDESC(EZETST) TO OB0IM001.XCTDESC-1;*/
   /* /* CANA country description*/
   /* END;*/
   /* END;*/
  if (OB5REC.XCTCD in XCTTBL.XCTCD
   && XCTTBL.XXXSTAT[sysVar.arrayIndex] == "A") /* check country code is active*/
    OB0IM001.XCTCD-1 = XCTTBL.XCTCD[sysVar.arrayIndex]; /* country code*/
    if (XCTTBL.XCTDESC[sysVar.arrayIndex] == " ")
      OB0IM001.XCTDESC-1 = XCTTBL.XCTCD[sysVar.arrayIndex];
    else
      OB0IM001.XCTDESC-1 = XCTTBL.XCTDESC[sysVar.arrayIndex]; /* countrydesc*/
    end
  else
    if (OB5REC.XCTCD != " ")
      OB0IM001.XCTCD-1 = OB5REC.XCTCD; /* country code*/
      OB0IM001.XCTDESC-1 = "UNKNOWN"; /* country desc*/
    end
  end

       /* spain trademark project sbhara 02/21/00  changes end*/
end // end OB0IS27

// MOVE SHIP TO ADDRESS TO MAP
Function OB0IS28()
       /* ****************************************************/
       /* *  MOVE SHIP TO ADDRESS TO MAP.                   **/
       /* ****************************************************/
       /* * Modified for spain tarde amrk project           **/
       /* * sbhara 02/21/00                                 **/
       /* ****************************************************/

  set KULREC empty;

  KULREC.KUCCOID = OB1REC.KUCCOID;
  KULREC.KULAAID = OB1REC.OP1SHAID;
  OB0IS19(); /* call IO0170 to read KULREC*/

  OB0IM001.OB0IMSNM = OBWREC.KUMSTRNM;

       /* ****************************************************/
       /* *  GET SELF DEPT NUMBER FOR ADDRESS LINE 1        **/
       /* ****************************************************/

  if (OB1REC.XNXCD == 0)
    OB0IM001.OB0IMSA1 = KULREC.XXX-ADDR1;
  else
    set KUJREC empty;

    KUJREC.KUCCOID = OB1REC.KUCCOID;
    KUJREC.XNXCD = OB1REC.XNXCD;
    OB0IS29(); /* call IO0290 to read KUJREC*/

    if (SQLCA.VAGen_SQLCODE == 0) /* dept self id found*/
      OB0IM001.OB0IMSA1 = OB0IW01.OB0IWHD1;
                                   /* formatted dept to addr1*/
    else
      OB0IM001.OB0IMSA1 = KULREC.XXX-ADDR1;
    end
  end

  OB0IM001.OB0IMSA2 = KULREC.XXX-ADDR2;
  OB0IM001.OB0IMSA3 = KULREC.XXX-ADDR3;
  OB0IM001.OB0IMSCT = KULREC.XXXCITY;
  OB0IM001.OB0IMSST = KULREC.XSTCD;
  OB0IM001.OB0IMSZP = KULREC.XXXZIP;

   /* CANADA 08/02/95*/
       /* spain trademark project sbhara 02/21/00  changes begin*/
   /* existing code commented and replaced with new code*/
   /* move country code to the map all the countries*/

   /* IF OB1REC.XDZ-DATA-DIST-CD = 'CA';/* CANA Canadian order*/
   /* MOVE KULREC.XCTCD TO OB0IM001.XCTCD-1;/* CANA move country code*/
   /* IF KULREC.XCTCD IN XCTTBL.XCTCD;*/
   /* MOVE XCTTBL.XCTDESC(EZETST) TO OB0IM001.XCTDESC-1;*/
   /* /* CANA country description*/
   /* END;*/
   /* END;*/
  if (KULREC.XCTCD in XCTTBL.XCTCD
   && XCTTBL.XXXSTAT[sysVar.arrayIndex] == "A") /* /check country code is active*/
    OB0IM001.XCTCD-1 = XCTTBL.XCTCD[sysVar.arrayIndex];
    if (XCTTBL.XCTDESC[sysVar.arrayIndex] == " ")
      OB0IM001.XCTDESC-1 = XCTTBL.XCTCD[sysVar.arrayIndex];
    else
      OB0IM001.XCTDESC-1 = XCTTBL.XCTDESC[sysVar.arrayIndex];
    end
  else
    if (KULREC.XCTCD != " ")
      OB0IM001.XCTCD-1 = KULREC.XCTCD;
      OB0IM001.XCTDESC-1 = "UNKNOWN";
    end
  end
       /* spain trademark project sbhara 02/21/00  changes end*/
end // end OB0IS28

// GET DEPT SELF ID FROM KUJREC
Function OB0IS29()
       /* **************************************************/
       /* *    GET DEPT SELF ID FROM KUJREC               **/
       /* **************************************************/

  set SQLCA empty;

  call "IO0290" ("S ", SQLCA, KUJREC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
    OB0IW01.OB0IWLIT = "DEPT "; /* move lit to hold area*/
    OB0IW01.KUJSLFID = KUJREC.KUJSLFID; /* dept self id to hold*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* record not found*/
       /* continue*/
    else
      TA1REC.TA1LOCAT[1] = "S "; /* transaction*/
      TA1REC.TA1LOCAT[2] = "IO0290"; /* i/o mod*/
      TA1REC.TA1LOCAT[3] = "OB0IS29"; /* stmt group*/
      OB0IW01.OB0IWFD1 = KUJREC.KUCCOID; /* format cmpny id*/
      OB0IW01.OB0IWFD2 = " "; /* filler*/
      OB0IW01.OB0IWFD3 = KUJREC.XNXCD; /* format dept code*/
      TA1REC.TA1TBLKE = OB0IW01.OB0IWFLD; /* formatted key value*/
      TA1REC.TA1LOCAT[4] = OB0IW01.OB0IWAID; /* stmt group*/
      TA1REC.TA1LOCAT[4] = " ";
      TA1REC.TA1DBASE = "DCUST"; /* database name*/
      TA1REC.TA1TBLVU = "VCUST001"; /* database view name*/
      if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
        XSOBS04();
      else /* all other codes - abort*/
        XSOBEDC();
      end
    end
  end


end // end OB0IS29

// RESET FIELD ATTRIBUTES
Function OB0IS30()
       /* **************************************************/
       /* *      RESET FIELD ATTRIBUTES                   **/
       /* **************************************************/
       /* * modified for the spain trademark project      **/
       /* * sbhara 02/21/00                               **/
       /* **************************************************/

  set OB0IM001.OB0IMPRC initialAttributes;
  set OB0IM001.OBWCUST initialAttributes;
  set OB0IM001.OP1CUPO initialAttributes;
  set OB0IM001.KUMSTRNM initialAttributes;
  set OB0IM001.KUCBLAID initialAttributes;
  set OB0IM001.OP1BLAID initialAttributes;
  set OB0IM001.OB0IMBNM initialAttributes;
  set OB0IM001.OB0IMBA1 initialAttributes;
  set OB0IM001.OB0IMBA2 initialAttributes;
  set OB0IM001.OB0IMBA3 initialAttributes;
  set OB0IM001.OB0IMBCT initialAttributes;
  set OB0IM001.OB0IMBST initialAttributes;
  set OB0IM001.OB0IMBZP initialAttributes;

  set OB0IM001.KUMSTAID initialAttributes;
  set OB0IM001.KUMSTRNM initialAttributes;
  set OB0IM001.OB0IMST1 initialAttributes;
  set OB0IM001.OB0IMST2 initialAttributes;
  set OB0IM001.OB0IMST3 initialAttributes;
  set OB0IM001.OB0IMSTC initialAttributes;
  set OB0IM001.OB0IMSTS initialAttributes;
  set OB0IM001.OB0IMSTZ initialAttributes;

  set OB0IM001.OP1SGPAO skip;
  if (OB1REC.YOBCD == "XL" /* cancelled*/
   || OB1REC.YOBCD == "CA" /* cleared availability*/
   || OB1REC.YOBCD == "LP" /* lost demand reported*/
   || OB1REC.YOBCD == "PD") /* postponed demand reported*/
    set OB0IM001.OP1SHAID skip;
    set OB0IM001.OB0IMSNM skip;
    set OB0IM001.OB0IMSA1 skip;
    set OB0IM001.OB0IMSA2 skip;
    set OB0IM001.OB0IMSA3 skip;
    set OB0IM001.OB0IMSCT skip;
    set OB0IM001.OB0IMSST skip;
    set OB0IM001.OB0IMSZP skip;
         /* spain trademark project sbhara 02/21/00  changes begin*/
    set OB0IM001.XCTCD-1 skip;
    set OB0IM001.XCTDESC-1 skip;
         /* spain trademark project sbhara 02/21/00  changes end*/
  else
    set OB0IM001.OP1SHAID cursor, initialAttributes;
    set OB0IM001.OB0IMSNM initialAttributes;
    set OB0IM001.OB0IMSA1 initialAttributes;
    set OB0IM001.OB0IMSA2 initialAttributes;
    set OB0IM001.OB0IMSA3 initialAttributes;
    set OB0IM001.OB0IMSCT initialAttributes;
    set OB0IM001.OB0IMSST initialAttributes;
    set OB0IM001.OB0IMSZP initialAttributes;
         /* spain trademark project sbhara 02/21/00  changes begin*/
    set OB0IM001.XCTCD-1 initialAttributes;
    set OB0IM001.XCTDESC-1 initialAttributes;
         /* spain trademark project sbhara 02/21/00  changes end*/
  end

   /*  */
   /* For international orders do not display the one-time ship-to addr.*/
   /* International order processing is not allowed an one-time ship-to.*/
   /*  */
       /* spain trademark project sbhara 02/21/00  changes begin*/
   /* ading the functionality to add a one time shipment international*/
   /* commented the existing code and replaced*/
  if (OB1REC.XDVCD == "02")
    set OB0IM001.OB0IM-001-NIL-ADDRID skip, invisible; /* protect nil addid*/
    /* SET OB0IM001.KUMSTAID AUTOSKIP,DARK;*/
    /* SET OB0IM001.OP1SGPAO AUTOSKIP,DARK;  /*open the fields to*/
    /* SET OB0IM001.OP1SHAID AUTOSKIP,DARK;  /*enter shipto address*/
    /* SET OB0IM001.OB0IMSNM AUTOSKIP,DARK;  /*spain trade mark project*/
    /* SET OB0IM001.OB0IMSA1 AUTOSKIP,DARK;*/
    /* SET OB0IM001.OB0IMSA2 AUTOSKIP,DARK;*/
    /* SET OB0IM001.OB0IMSA3 AUTOSKIP,DARK;*/
    /* SET OB0IM001.OB0IMSCT AUTOSKIP,DARK;*/
    /* SET OB0IM001.OB0IMSST AUTOSKIP,DARK;*/
    /* SET OB0IM001.OB0IMSZP AUTOSKIP,DARK;*/
    /* SET OB0IM001.OB0IM-001-SHIPTO-LIT AUTOSKIP,DARK;*/
    OB0IM001.OB0IM-001-STORE-LIT = "STORE ADDR: ";
    OB0IM001.OB0IM-001-SHIPTO-LIT = "SHIPTO ADDR:";
  else
    OB0IM001.OB0IM-001-STORE-LIT = "STORE ADDR: ";
    OB0IM001.OB0IM-001-SHIPTO-LIT = "SHIPTO ADDR:";
    set OB0IM001.OB0IM-001-NIL-ADDRID skip, invisible;
    set OB0IM001.KUMSTAID initialAttributes;
  end

  if (OB1REC.YOBCD == "CA" /* cleared availability*/
   || OB1REC.YOBCD == "LP" /* lost demand reported*/
   || OB1REC.YOBCD == "PD") /* postponed demand reported*/
    if (OB0IM001.CAMSG == " ")
      OB0IM001.CAMSG = "ORDERS IN THIS STATUS ARE VIEW ONLY";
    end
  end
       /* spain trademark project sbhara 02/21/00  changes end*/
end // end OB0IS30

// EDIT MAP FIELDS
Function OB0IS40()
       /* **************************************************/
       /* *  EDIT MAP FIELDS.                             **/
       /* **************************************************/
       /* *modified for spain tardemark project           **/
       /* *sbhara 02/21/00                                **/
       /* **************************************************/

       /* spain trademark project sbhara 02/21/00  changes begin*/
  if (OB1REC.XDVCD == "02")
    if (OB0IM001.OP1SHAID != OB1REC.OP1SHAID) /* field is changed*/

      OB0IS-EDIT-SHIPTO(); /* edit shipto address id*/

    else
      OB0IS41(); /* EDIT SHIP TO COUNTRY CODE*/
      OB0IS46(); /* EDIT SHIP TO CITY*/
      OB0IS48(); /* EDIT SHIP TO ADDRESS LINE*/
      OB0IS50(); /* EDIT STORE NAME*/
      if (OB0IM001.XCTCD-1 == "USA"
       || OB0IM001.XCTCD-1 == "CANA") /* if the shipto country is usa/cana*/
        OB0IS42(); /* check zip code*/
        OB0IS-EDIT-STATE(); /* edit shipto code*/
      end
    end
  end
  if (OB1REC.XDVCD != "02")
    if (OB0IM001.OP1SHAID != OB1REC.OP1SHAID) /* field is changed*/
      OB0IS52(); /* EDIT SHIPTO ID*/

    else
      OB0IS41(); /* EDIT COUNTRY CODE*/
      OB0IS46(); /* EDIT SHIPTO CITY*/
      OB0IS48(); /* EDIT SHIP ADDRESS LINES*/
      OB0IS50(); /* EDIT SHIPTO STORE NAME*/
      if (OB0IM001.XCTCD-1 == "USA"
       || OB0IM001.XCTCD-1 == "CANA") /* if the shipto country is usa/cana*/
        OB0IS42(); /* check zip code*/
        OB0IS-EDIT-STATE(); /* edit shipto code*/
      end
    end
  end

       /* spain trademark project sbhara 02/21/00  changes end*/
end // end OB0IS40

// EDIT SHIP TO COUNTRY  CODE
Function OB0IS41()
       /* **************************************************/
       /* *          EDIT COUNTRY CODE                    **/
       /* **************************************************/
       /* *mofdified for spain trademark project          **/
       /* *sbhara 02/21/00                                **/
       /* **************************************************/

       /* spain trademark project sbhara 02/21/00  changes begin*/
   /* edit country code*/
  if (OB0IM001.XCTCD-1 == " ") /* if shipto country code is null*/
    converseLib.validationFailed(257); /* ctry cd invalid or missing*/
    OBWREC.OBWERRFL = "Y"; /* set error flag*/
    set OB0IM001.XCTCD-1 cursor, bold;
  else
    if (OB0IM001.XCTCD-1 in XCTTBL.XCTCD /* valid ctry cd?*/
     && XCTTBL.XXXSTAT[sysVar.arrayIndex] == "A")
      OB0IM001.XCTDESC-1 = XCTTBL.XCTDESC[sysVar.arrayIndex];
    else
      converseLib.validationFailed(257); /* ctry cd invalid or missing*/
      OBWREC.OBWERRFL = "Y"; /* set error flag*/
      set OB0IM001.XCTCD-1 cursor, bold;
    end
  end

       /* spain trademark project sbhara 02/21/00  changes end*/
end // end OB0IS41

// EDIT SHIP TO ZIP CODE
Function OB0IS42()
       /* **************************************************/
       /* *          EDIT SHIP TO ZIP CODE                **/
       /* **************************************************/
       /* * As part of spain project added logic to check **/
       /* * US ZIP codes are atleast 5 digits long and are**/
       /* * numeric.                                      **/
       /* * sbhara 02/21/00                               **/
       /* **************************************************/

       /* spain trademark project sbhara 02/21/00  changes begin*/
  if (OB0IM001.XCTCD-1 == "USA") /* if shipping within USA*/
    OB0IW-US-ZIP5 = OB0IM001.OB0IMSZP;
    OB0IW-SUB = 5; /* initialize*/
    while (OB0IW-SUB > 0) /* loop 5 times*/
      if (OB0IW-US-ZIP[OB0IW-SUB] is numeric) /* has to be number*/
        /* CONTINUE*/
      else /* not number*/
        OB0IW-SUB = 1; /* exit the loop*/
        converseLib.validationFailed(42); /* zip code is required*/
        OBWREC.OBWERRFL = "Y"; /* set error flag*/
        set OB0IM001.OB0IMSZP cursor, bold;
      end
      OB0IW-SUB = OB0IW-SUB - 1;
    end
  else /* if canada*/
    /* change end*/

    if (OB0IM001.OB0IMSZP == " ") /* field is blanks*/
      converseLib.validationFailed(42); /* zip code is required*/
      OBWREC.OBWERRFL = "Y"; /* set error flag*/
      set OB0IM001.OB0IMSZP cursor, bold;
    end
  end

       /* spain trademark project sbhara 02/21/00  changes end*/
end // end OB0IS42

// EDIT SHIP TO CITY
Function OB0IS46()
       /* **************************************************/
       /* *          EDIT SHIP TO CITY                    **/
       /* **************************************************/

  if (OB0IM001.OB0IMSCT == " ") /* field is blanks*/
    converseLib.validationFailed(44); /* city cannot be blanks*/
    OBWREC.OBWERRFL = "Y"; /* set error flag*/
    set OB0IM001.OB0IMSCT cursor, bold;
  end


end // end OB0IS46

// EDIT ADDRESS LINES
Function OB0IS48()
       /* **************************************************/
       /* *          EDIT ADDRESS LINES                   **/
       /* **************************************************/

  if (OB0IM001.OB0IMSA3 == " " /* addr line 3 is blanks*/
   && OB0IM001.OB0IMSA2 == " " /* addr line 2 is blanks*/
   && OB0IM001.OB0IMSA1 == " ") /* addr line 1 is blanks*/
    converseLib.validationFailed(45); /* at least 1 addr line required*/
    OBWREC.OBWERRFL = "Y"; /* set error flag*/
    set OB0IM001.OB0IMSA3 bold;
    set OB0IM001.OB0IMSA2 bold;
    set OB0IM001.OB0IMSA1 cursor, bold;
  end


end // end OB0IS48

// EDIT SHIP TO STORE NAME
Function OB0IS50()
       /* **************************************************/
       /* *        EDIT SHIP TO STORE NAME                **/
       /* **************************************************/

  if (OB0IM001.OB0IMSNM == " ") /* field is blanks*/
    converseLib.validationFailed(46); /* store name is required*/
    OBWREC.OBWERRFL = "Y"; /* set error flag*/
    set OB0IM001.OB0IMSNM cursor, bold;
  end


end // end OB0IS50

// EDIT SHIP GRP ADDR ID
Function OB0IS52()
       /* **************************************************/
       /* *       EDIT SHIP TO ADDR ID                    **/
       /* **************************************************/

  if (OB0IM001.OP1SHAID != OB1REC.OP1SHAID) /* field is changed*/
    set KULREC empty;
    KULREC.KULAAID = OB0IM001.OP1SHAID;
    KULREC.KUCCOID = OB1REC.KUCCOID;
    OB0IS19(); /* call io0170 to read kulrec*/

    if (SQLCA.VAGen_SQLCODE == 100) /* kulrec not found*/
      if (OB0IM001.OP1SHAID == OB0IM001.KUMSTAID) /* shp aid = str aid, default*/
        converseLib.validationFailed(47); /* no default ship to addr found*/
        OBWREC.OBWERRFL = "Y"; /* set error flag*/
        set OB0IM001.OP1SHAID cursor, bold;
      else /* shpto addr id not = store addr id, override*/
        converseLib.validationFailed(48); /* ship to addr not found for rqstd addr id*/
        OBWREC.OBWERRFL = "Y"; /* set error flag*/
        set OB0IM001.OP1SHAID cursor, bold;
      end
    end
  end







end // end OB0IS52

// UPDATE
Function OB0IS60()
       /* **************************************************/
       /* *       UPDATE ROUTINE                          **/
       /* **************************************************/

  if (OB0IM001.OP1SHAID != OB1REC.OP1SHAID) /* addr id is changed*/
    OB0IS61();
  else
    OB0IS62(); /* if addr id is not changed*/
  end


end // end OB0IS60

// UPDATE - ADDR ID IS CHG'D
Function OB0IS61()
       /* **************************************************/
       /* *    UPDATE RTN - ADDR ID IS CHG'D              **/
       /* **************************************************/

  if (OB0IM001.OP1SHAID == OB0IM001.KUMSTAID) /* addr id = store, default*/
    if (OB1REC.OP1SGPAO != "N"
     || OB1REC.OP11TMSF != "N"
     || OB0IM001.OP1SHAID != OB1REC.OP1SHAID)
      OB1REC.OP1SGPAO = "N";
      OB1REC.OP11TMSF = "N";
      OB1REC.OP1SHAID = OB0IM001.OP1SHAID;
      OBWREC.CAMSG = "CUSTOMER DEFAULT ADDRESS UPDATED";
      OB0IW01.OB0IWUPD = "Y";
    end
  else /* addr id not = store id, override*/
    if (OB1REC.OP1SGPAO != "Y"
     || OB1REC.OP11TMSF != "N"
     || OB0IM001.OP1SHAID != OB1REC.OP1SHAID)
      OB1REC.OP1SGPAO = "Y";
      OB1REC.OP11TMSF = "N";
      OB1REC.OP1SHAID = OB0IM001.OP1SHAID;
      OBWREC.CAMSG = "CUSTOMER OVERRIDE ADDRESS UPDATED";
      OB0IW01.OB0IWUPD = "Y";
    end
  end

  if (OB0IW01.OB0IWUPD == "Y")
    OB0IS63(); /* delete one-time address*/
    OB0IS65(); /* call IO5160 to update header*/
    XSOBT2C(); /* update temp storage for errors*/
  end

end // end OB0IS61

// UPDATE - ADDR ID NOT CHG'D
Function OB0IS62()
       /* **************************************************/
       /* *    UPDATE RTN - ADDR ID NOT CHG'D             **/
       /* **************************************************/
       /* *modified for spain trademark project           **/
       /* *sbhara 02/21/00                                **/
       /* **************************************************/

     /* remove the OM0IW01 XXXADDR1, 2, 3 fields from OM0IW01*/
     /* when the names are renamed & resized to 38 in OB5REC.*/
     /* USE OF THESE FIELDS IS A TEMPORARY FIX, IN ORDER TO AVOID*/
     /* A TRUE CONDITION, BECAUSE THE KULREC AND MAP FIELDS ARE*/
     /* DIFFERENT LENGTHS.  XXX-ADDR is 38 CHAR, XXXADDR and map*/
     /* address fields are 30 char. When the map address changes*/
     /* to 38 characters, replace the OB0IW01 address fields in*/
     /* the if statement with the KULREC address fields.*/
     /* added country code*/
     /* spain trademark project sbhara 02/21/00  changes begin*/
  OB0IW01.XXXADDR1 = KULREC.XXX-ADDR1;
  OB0IW01.XXXADDR2 = KULREC.XXX-ADDR2;
  OB0IW01.XXXADDR3 = KULREC.XXX-ADDR3;

  if (OB1REC.OP11TMSF == "Y") /* 1-time ship is yes*/
    if (OB0IM001.OB0IMSNM != OB5REC.OP5ALTNM /* if text changed*/
     || OB0IM001.OB0IMSA1 != OB5REC.XXXADDR[1]
     || OB0IM001.OB0IMSA2 != OB5REC.XXXADDR[2]
     || OB0IM001.OB0IMSA3 != OB5REC.XXXADDR[3]
     || OB0IM001.OB0IMSCT != OB5REC.XXXCITY  
     || OB0IM001.OB0IMSST != OB5REC.XSTCD    
     || OB0IM001.OB0IMSZP != OB5REC.XXXZIP   
     || OB0IM001.XCTCD-1 != OB5REC.XCTCD)    /* nike-spain changes*/
      OB0IS73(); /* process updates*/
    end
  else
    if (OB0IM001.OB0IMSNM != OBWREC.KUMSTRNM /* if text changed*/
     || OB0IM001.OB0IMSA1 != OB0IW01.XXXADDR1
     || OB0IM001.OB0IMSA2 != OB0IW01.XXXADDR2
     || OB0IM001.OB0IMSA3 != OB0IW01.XXXADDR3
     || OB0IM001.OB0IMSCT != KULREC.XXXCITY  
     || OB0IM001.OB0IMSST != KULREC.XSTCD    
     || OB0IM001.OB0IMSZP != KULREC.XXXZIP   
     || OB0IM001.XCTCD-1 != KULREC.XCTCD)    /* nike-spain changes*/
      OB0IS73(); /* process updates*/
    end
  end

       /* spain trademark project sbhara 02/21/00  changes end*/
end // end OB0IS62

// DELETE ONE-TIME ADDRESS
Function OB0IS63()
       /* **************************************************/
       /* *    DELETE ONE-TIME ADDRESS                    **/
       /* **************************************************/

  set OB5REC empty;

  OB5REC.OP1PARTN = OB1REC.OP1PARTN;
  OB5REC.OP1CUOID = OB1REC.OP1CUOID;
  OB5REC.OP1NORID = OB1REC.OP1NORID;
  OB5REC.OP5BILIN = "N"; /* bill indicator*/
  OB5REC.OP5SHPIN = "Y"; /* ship indicator*/
  OB0IS70(); /* call IO5190 to delete 1-time addr*/


end // end OB0IS63

// UPDATE CURRENT ORDER HEADER
Function OB0IS65()

      /* UPDATE HEADER*/

  OB1REC.YOBCD = "NC";


  set OBFREC empty;
  set SQLCA empty;
  OBFREC.OBFTASK = "U ";

  call "IO5160" (OBFREC, SQLCA, OB1REC) {isNoRefresh = yes, isExternal = yes}; /* i/o mod-update*/

   /* check db2 return code*/

  if (SQLCA.VAGen_SQLCODE == 0) /* successful update*/
     /* next sentence*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* record not found*/
      VGVar.handleSysLibraryErrors = 0;
      sysLib.rollback();
      OBWREC.CAMSG = "ORDER HAS BEEN MODIFIED BY ANOTHER SERVICE REP";
      XSOBP00();
    else
      TA1REC.TA1DBASE = "DORDB   "; /* data base name*/
      TA1REC.TA1TBLVU = "VOBHDR01"; /* table view*/
      TA1REC.TA1LOCAT[1] = "U       "; /* calling option*/
      TA1REC.TA1LOCAT[2] = "IO5160  "; /* i/o mod name*/
      TA1REC.TA1LOCAT[3] = "OB0IS65 "; /* statement group*/
      if (SQLCA.VAGen_SQLCODE == -911)
        XSOBS05();
      else
        XSOBEDR(); /* abort routine - with rollback*/
      end
    end
  end

      /* update temp storage*/

  XSOBT1R();
  OBAREC.OBAMSEL[OBWTSF1S] = "U ";
  XSOBT1U();


end // end OB0IS65

// DELETE BATCH ADDRESS RECORD
Function OB0IS70()
       /* **************************************************/
       /* *    DELETE ADDRESS RECORD                      **/
       /* **************************************************/

  set SQLCA empty;

  call "IO5190" ("D ", SQLCA, OB5REC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue                    ;    OK*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* OK, no record to delete*/
       /* continue*/
    else
      TA1REC.TA1LOCAT[1] = "D "; /* transaction*/
      TA1REC.TA1LOCAT[2] = "IO5190"; /* i/o mod*/
      TA1REC.TA1LOCAT[3] = "OB0IS70"; /* stmt group*/
      TA1REC.TA1LOCAT[4] = OB5REC.OP5SHPIN;
      TA1REC.TA1DBASE = "DORDB"; /* database name*/
      TA1REC.TA1TBLVU = "VOBADR01"; /* database view name*/
      if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
        XSOBS05();
      else /* all other codes - abort*/
        XSOBEDR();
      end
    end
  end


end // end OB0IS70

// PROCESS 1-TIME ADDRESS
Function OB0IS73()

       /* **************************************************/
       /* *    TEXT CHANGED - PROCESS UPDATES             **/
       /* **************************************************/
       /* *modified for spain tardemark project           **/
       /* *sbhara 02/21/00                                **/
       /* **************************************************/

  set OB5REC empty;

  OB5REC.OP1PARTN = OB1REC.OP1PARTN;
  OB5REC.OP1CUOID = OB1REC.OP1CUOID;
  OB5REC.OP1NORID = OB1REC.OP1NORID;
  OB5REC.OP5BILIN = "N"; /* bill indicator*/
  OB5REC.OP5SHPIN = "Y"; /* ship indicator*/
  OB0IS18(); /* call IO5190 to select address*/

  OB5REC.KUCCOID = OB1REC.KUCCOID;
  OB5REC.KUMSTRID = OB1REC.KUMSTRID;
  OB5REC.XNXCD = OB1REC.XNXCD;
  OB5REC.XGPCD = OB1REC.XGPCD;
  OB5REC.OP5ALTNM = OB0IM001.OB0IMSNM; /* move map to addr rec*/
  OB5REC.XXXADDR[1] = OB0IM001.OB0IMSA1;
  OB5REC.XXXADDR[2] = OB0IM001.OB0IMSA2;
  OB5REC.XXXADDR[3] = OB0IM001.OB0IMSA3;
  OB5REC.XXXCITY = OB0IM001.OB0IMSCT;
  OB5REC.XSTCD = OB0IM001.OB0IMSST;
  OB5REC.XXXZIP = OB0IM001.OB0IMSZP;
  OB5REC.XCTCD = OB0IM001.XCTCD-1; /* nike-spain changes 02/21/00*/
  OB5REC.ZZZCHGDT = OBWREC.ZZZCHGDT;
  OB5REC.ZZZCHGTM = OBWREC.ZZZCHGTM;

  if (SQLCA.VAGen_SQLCODE == 0) /* addr rec found*/
    OB0IS75(); /* update addr rec*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* addr rec not found*/
      OB0IS80(); /* insert addr rec*/
    end
  end

  OB1REC.OP1SGPAO = "N";
  OB1REC.OP11TMSF = "Y";
  OB1REC.OP1SHAID = 0;
  OB0IS65(); /* call IO5160 to update header*/

  XSOBT2C(); /* update temp storage for errors*/


  OBWREC.CAMSG = "CUSTOMER 1-TIME ADDRESS UPDATED";
  OB0IW01.OB0IWUPD = "Y";

end // end OB0IS73

// UPDATE BATCH ADDRESS RECORD
Function OB0IS75()
       /* **************************************************/
       /* *    UPDATE ADDRESS RECORD                      **/
       /* **************************************************/

  set SQLCA empty;

  call "IO5190" ("U ", SQLCA, OB5REC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue                    ;    OK*/
  else
    if (SQLCA.VAGen_SQLCODE == 100) /* address not found*/
      VGVar.handleSysLibraryErrors = 0;
      sysLib.rollback();
      OBWREC.CAMSG = "ORDER HAS BEEN MODIFIED BY ANOTHER SERVICE REP";
      XSOBP00();
    else
      TA1REC.TA1LOCAT[1] = "U "; /* transaction*/
      TA1REC.TA1LOCAT[2] = "IO5190"; /* i/o mod*/
      TA1REC.TA1LOCAT[3] = "OB0IS75"; /* stmt group*/
      TA1REC.TA1LOCAT[4] = OB5REC.OP5SHPIN;
      TA1REC.TA1DBASE = "DORDB"; /* database name*/
      TA1REC.TA1TBLVU = "VOBADR01"; /* database view name*/
      if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
        XSOBS05();
      else /* all other codes - abort*/
        XSOBEDR();
      end
    end
  end


end // end OB0IS75

// INSERT BATCH ADDRESS RECORD
Function OB0IS80()
       /* **************************************************/
       /* *    INSERT ADDRESS RECORD                      **/
       /* **************************************************/

  set SQLCA empty;

  call "IO5190" ("A ", SQLCA, OB5REC) {isNoRefresh = yes, isExternal = yes};

  if (SQLCA.VAGen_SQLCODE == 0)
     /* continue                    ;    OK*/
  else
    TA1REC.TA1LOCAT[1] = "A "; /* transaction*/
    TA1REC.TA1LOCAT[2] = "IO5190"; /* i/o mod*/
    TA1REC.TA1LOCAT[3] = "OB0IS80"; /* stmt group*/
    TA1REC.TA1LOCAT[4] = OB5REC.OP5SHPIN;
    TA1REC.TA1DBASE = "DORDB"; /* database name*/
    TA1REC.TA1TBLVU = "VOBADR01"; /* database view name*/
    if (SQLCA.VAGen_SQLCODE == -911) /* timed out*/
      XSOBS05();
    else /* all other codes - abort*/
      XSOBEDR();
    end
  end


end // end OB0IS80

// EDIT PFKEYS FOR OB0I
Function OB0ISPF()

  COMMAREA.CAUSERA = OBWREC.OBWGROUP;


  if (converseVar.eventKey is pf1)
    XSOBP01();
    OB0IM001.CAMSG = OBWREC.OBWHELP; /* redisplay msg if no help*/
  end

  if (converseVar.eventKey is pf3)
    XSOBP03();
  end

  if (converseVar.eventKey is pf4)
    XSOBP04();
  end

  if (converseVar.eventKey is pf6)
    XSOBP06();
  end

  if (converseVar.eventKey is pf9)
    XSOBP09();
  end

  if (converseVar.eventKey is pf13)
    XSOBP13();
  end

  if (converseVar.eventKey is pf14)
    XSOBP14();
  end

  if (converseVar.eventKey is pf15)
    XSOBP15();
  end

  if (converseVar.eventKey is pf17)
    XSOBP17();
  end

  if (converseVar.eventKey is pf18)
    XSOBP18();
  end

  if (converseVar.eventKey is pf19)
    XSOBP19();
  end



  if (converseVar.eventKey is enter
   || converseVar.eventKey is pf1)
     /* next sentence*/
  else
    converseLib.validationFailed(1); /* invalid pf key*/
    OBWREC.OBWERRFL = "Y"; /* set 'OB' error flag*/
  end



  if (converseVar.eventKey is enter
   && OBWREC.OBWERRFL == "N")
    if (OB0IW01.OB0IWUPD == "Y")
      XSOBP00();
    else
      XSOBP09();
    end
  end

end // end OB0ISPF

//*** RECORD=OB0IW01 ****
// ************************************************************
// *         M A I N T E N A N C E   L O G
// ************************************************************
// *  REF #    DATE      WHO    DESC
// * ------  --------   ------  -------------------------------
// * #642    05/28/91   DHARRI  ADDED OM0KWFLD, FLD1, FLD2 FLD3
// *                            TO FORMAT KEY TO KUJREC FOR DIS
// *                            PLAY & OMWKWHD1, LIT, KUJSLFID
// *                            TO FORMAT DEPT SELF ID FOR ADDR
// *                            LINE 1.
// * #4414   02/21/00   SBHARA  NEW VARIABLES ADDED FOR ZIPCODE
// *                            VALIDATION
// ***********************
Record OB0IW01 type basicRecord
  10 OB0IWCID OB0IWCID ; 
  10 OB0IWAID OB0IWAID ; 
  10 OB0IWUPD OB0IWUPD ; 
  10 OB0IWFLD OB0IWFLD ; 
    15 OB0IWFD1 OB0IWFD1 ; 
    15 OB0IWFD2 OB0IWFD2 ; 
    15 OB0IWFD3 OB0IWFD3 ; 
  10 OB0IWHD1 OB0IWHD1 ; 
    15 OB0IWLIT OB0IWLIT ; 
    15 KUJSLFID KUJSLFID ; 
  10 XXXADDR1 XXXADDR1 ; 
  10 XXXADDR2 XXXADDR2 ; 
  10 XXXADDR3 XXXADDR3 ; 
  10 OB0IW-US-ZIP5 char(5) ; // ZIP CODE FOR USA
    15 OB0IW-US-ZIP char(1) [5] ; // ZIP CODE FOR USA
  10 OB0IW-SUB num(1) ; // SUBSCRIPT
end // end OB0IW01

//*** RECORD=OB5REC ****
// **********************  ADDRESS TABLE  *********************
// 
// DB2 TABLE:           DORDB.VOBADR01
// 
// COPYLIB MEMBER:      DCL00818
// 
// I/O MOD:             IO5190
// 
// KEY TO DB2 TABLE:    OP1PARTN
//                      OP1CUOID
//                      OP1NORID
// 
// DATE CREATED:        04/11/90
// 
// MAINTENANCE LOG:
// 
//   DATE    INIT.      COMMENT
// --------  ------     ---------------------------------------
// 04-11-90   SMK       INITIAL RECORD CREATION
// 02-21-94  gcalki     db2 changes
//                      add:xxx-addr 1-6
// **********************
Record OB5REC type basicRecord
  5 OB5GROUP OB5GROUP ; 
    10 OB5KEY OB5KEY ; 
      15 OP1PARTN OP1PARTN ; 
      15 OP1CUOID OP1CUOID ; 
      15 OP1NORID OP1NORID ; 
      15 OP5BILIN OP5BILIN ; 
      15 OP5SHPIN OP5SHPIN ; 
    10 KUCCOID KUCCOID ; 
    10 KUMSTRID KUMSTRID ; 
    10 XNXCD XNXCD ; 
    10 XGPCD XGPCD ; 
    10 OP5ALTNM OP5ALTNM ; 
    10 XXX-ADDR XXX-ADDR [6] ; 
      15 XXXADDR XXXADDR ; 
      15 * char(8) ; 
    10 XXXCITY XXXCITY ; 
    10 XSTCD XSTCD ; 
    10 XXXZIP XXXZIP ; 
    10 XCTCD XCTCD ; 
    10 ZZZCHGDT ZZZCHGDT ; 
    10 ZZZCHGTM ZZZCHGTM ; 
    10 ZZZCHGCT ZZZCHGCT ; 
end // end OB5REC

// work address id
DataItem OB0IWAID num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// work company id
DataItem OB0IWCID num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// kuccoid display
DataItem OB0IWFD1 num(9)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// filler
DataItem OB0IWFD2 char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// xnxcd display
DataItem OB0IWFD3 num(4)  {
  currency = no, numericSeparator = no, sign = none, align = right, 
  fillCharacter = " ", inputRequired = no
}
end

// kujrec display key
DataItem OB0IWFLD char(14)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// formatted dept self id
DataItem OB0IWHD1 char(15)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// literal field for 'dept '
DataItem OB0IWLIT char(5)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// update occured flag
DataItem OB0IWUPD char(1)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// record group level
DataItem OB5GROUP char(326)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

// ob5rec key
DataItem OB5KEY char(9)  {
  align = left, fillCharacter = nullFill, inputRequired = no
}
end

